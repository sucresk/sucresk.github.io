var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),State=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.prototype.onAdded=function(t){this.init()},e.prototype.init=function(){console.log("this is a state")},e.prototype.show=function(t){t.addChild(this)},e.prototype.next=function(t,e){void 0===e&&(e=null),this.dispatchEvent(new StateEvent(StateEvent.NEXT,{state:t,data:e})),this.parent.removeChild(this)},e.prototype.tick=function(t){},e}(egret.DisplayObjectContainer);__reflect(State.prototype,"State",["IState","egret.IEventDispatcher"]);var StoryTreeNode=function(t){function e(e){var i=t.call(this)||this;return i._depth=0,i.data=e,i.touchEnabled=!0,i.touchChildren=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTap,i),i}return __extends(e,t),e.prototype.onTap=function(t){t.target.parent==this&&this.dispatchEvent(new egret.Event(e.EVENT_TAP,!0,!1,this.data))},Object.defineProperty(e.prototype,"depth",{get:function(){return this._depth},set:function(t){this._depth=t},enumerable:!0,configurable:!0}),e.EVENT_TAP="TapNode",e.DEPTH_RATE=.9,e}(egret.Sprite);__reflect(StoryTreeNode.prototype,"StoryTreeNode");var TreePage=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!0,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this._view=new StoryTreePageUI,fairygui.GRoot.inst.addChild(this._view),this._view.btnReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReturn,this),this._view.btnNext.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onNext,this),this._view.btnLast.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onLast,this),this.initTree()},e.prototype.initTree=function(){if(Game.userData){var t=Game.userData.story;t.length>0&&(this._curStoryVO=this.data,null==this._curStoryVO&&(this._curStoryVO=t[0]))}this.refreshTree()},e.prototype.refreshTree=function(){this._curTree&&(this._curTree.removeEventListener(StoryTreeNode.EVENT_TAP,this.onTapTreeNode,this),this._curTree.parent&&(this._curTree.parent.removeChild(this._curTree),this._curTree=null));var t=new StoryTree(this._curStoryVO);t.x=this.stage.stageWidth/2,t.y=this.stage.stageHeight-300,this._curTree=t,this.addChild(t),this._curTree&&this._curTree.addEventListener(StoryTreeNode.EVENT_TAP,this.onTapTreeNode,this),this._totalIndex=Game.userData.story.length-1,this._curIndex=Game.userData.story.indexOf(this._curStoryVO),this._view.txtPage.text=this._curIndex+1+"/"+(this._totalIndex+1),0==this._totalIndex?(this._view.btnLast.visible=!1,this._view.btnNext.visible=!1):0==this._curIndex?(this._view.btnLast.visible=!1,this._view.btnNext.visible=!0):this._curIndex==this._totalIndex?(this._view.btnLast.visible=!0,this._view.btnNext.visible=!1):(this._view.btnLast.visible=!0,this._view.btnNext.visible=!0)},e.prototype.onTapTreeNode=function(t){var e=t.data;this.dispose(),this.next("ReadPage",e),console.log("tap tree node ",e)},e.prototype.onNext=function(t){this._curIndex<this._totalIndex&&(this._curIndex++,this._curStoryVO=Game.userData.story[this._curIndex],this.refreshTree())},e.prototype.onLast=function(t){this._curIndex>0&&(this._curIndex--,this._curStoryVO=Game.userData.story[this._curIndex],this.refreshTree())},e.prototype.onReturn=function(t){this.dispose(),this.next("TitlePage")},e.prototype.over=function(){this.dispose()},e.prototype.dispose=function(){fairygui.GRoot.inst.removeChild(this._view),this._view.dispose(),this._view=null,this.removeChildren()},e}(State);__reflect(TreePage.prototype,"TreePage");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){if("preload"==t.groupName){this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this);var e=new Game;this.addChild(e)}},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,i=this.stage.stageHeight;t.width=e,t.height=i;var r=new egret.Shape;r.graphics.beginFill(0,.5),r.graphics.drawRect(0,0,e,172),r.graphics.endFill(),r.y=33,this.addChild(r);var n=this.createBitmapByName("egret_icon_png");this.addChild(n),n.x=26,n.y=33;var o=new egret.Shape;o.graphics.lineStyle(2,16777215),o.graphics.moveTo(0,0),o.graphics.lineTo(0,117),o.graphics.endFill(),o.x=172,o.y=61,this.addChild(o);var s=new egret.TextField;s.textColor=16777215,s.width=e-172,s.textAlign="center",s.text="Hello Egret",s.size=24,s.x=172,s.y=80,this.addChild(s);var a=new egret.TextField;this.addChild(a),a.alpha=0,a.width=e-172,a.textAlign=egret.HorizontalAlign.CENTER,a.size=24,a.textColor=16777215,a.x=172,a.y=135,this.textfield=a,RES.getResAsync("description_json",this.startAnimation,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,r=t.map(function(t){return i.parse(t)}),n=this.textfield,o=-1,s=function(){o++,o>=r.length&&(o=0);var t=r[o];n.textFlow=t;var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(s,e)};s()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var StoryData=function(){function t(t){this._rawData=t,this.parse()}return t.prototype.parse=function(){if(null!=this._rawData){this.user=new UserVO(this._rawData),this.story=[];var t,e;if(this._rawData.story)for(t=0,e=this._rawData.story.length;e>t;t++){var i=new StoryTreeVO(this._rawData.story[t]);i.id>this._maxStoryId&&(this._maxStoryId=i.id),this.story.push(i)}}},t.prototype.getNextStoryId=function(){return this._maxStoryId++,this._maxStoryId},t}();__reflect(StoryData.prototype,"StoryData");var StoryPartVO=function(){function t(t){this.like=1,t&&(this.id=t.id,this.parent=t.parent,this.content=t.content,this.keyword=t.keyword,this.modifyTime=t.modifyTime,this.like=t.like?t.like:Math.floor(100*Math.random()),t.arthor&&(this.arthor=new UserVO(t.arthor)))}return t}();__reflect(StoryPartVO.prototype,"StoryPartVO");var StoryTreeVO=function(){function t(t){if(t){this.id=t.id,this.topic=parseInt(t.topic),this.type=t.type,this.keyword=t.keyword,this.over=t.over,this.parts=[];var e=void 0,i=void 0;if(t.parts){for(e=0,i=t.parts.length;i>e;e++)this.parts.push(new StoryPartVO(t.parts[e]));this.parseParts()}}}return t.prototype.parseParts=function(){var t,e;for(t=0,e=this.parts.length;e>t;t++)this.parts[t].id>this._maxId&&(this._maxId=this.parts[t].id),this.parts[t].parentVO=this.getPartById(this.parts[t].parent),this.parts[t].children=this.getPartChildren(this.parts[t].id),this.parts[t].tree=this,null==this.parts[t].parentVO&&(this.root=this.parts[t])},t.prototype.getPartChildren=function(t){var e,i,r=[];for(e=0,i=this.parts.length;i>e;e++)this.parts[e].parent==t&&r.push(this.parts[e]);return r},t.prototype.getPartById=function(t){var e,i;for(e=0,i=this.parts.length;i>e;e++)if(this.parts[e].id==t)return this.parts[e];return null},t.prototype.getNextPartId=function(){return this._maxId++,this._maxId},t}();__reflect(StoryTreeVO.prototype,"StoryTreeVO");var UserVO=function(){function t(t){t&&(this.username=t.username,this.uid=parseInt(t.uid),this.imgurl=t.imgurl,this.password=t.password)}return t.prototype.toObj=function(){var t={};return t.username=this.username,t.uid=this.uid,t.imgurl=this.imgurl,t},t}();__reflect(UserVO.prototype,"UserVO");var CreatePage=function(t){function e(){var e=t.call(this)||this;return e._topicIndex=0,e._typeIndex=0,e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this._view=new StoryCreatePageUI,this._config=RES.getRes("storyConfig_json"),fairygui.GRoot.inst.addChild(this._view),this._view.btnReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReturn,this),this._view.btnPublish.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPublish,this),this._view.txtInput.text="",this._view.txtInput.requestFocus(),this._view.topicController.addEventListener(fairygui.StateChangeEvent.CHANGED,this.onTopicChange,this),this._view.typeController.addEventListener(fairygui.StateChangeEvent.CHANGED,this.onTopicChange,this),this._typeIndex=0,this._topicIndex=0,this.updateTip(0,0)},e.prototype.onPublish=function(t){if(!(this._view.txtInput.text.length<1)){var e=DataControl.instance.createTree(this._typeIndex,this._topicIndex,this._view.txtInput.text);e&&(this.dispose(),this.next("TreePage",e))}},e.prototype.onTopicChange=function(){var t=this._view.topicController.selectedIndex,e=this._view.typeController.selectedIndex;this._topicIndex=t,this._typeIndex=e,this.updateTip(t,e)},e.prototype.updateTip=function(t,i){var r=this._config.topic[t].desc,n=this._config.type[i].desc;switch(this._view.txtTip.text="主题："+r+"\n类型："+n,this._typeIndex){case e.TYPE_FREE:this._view.txtInput.promptText="最多140个字",this._view.txtInput.text="";break;case e.TYPE_15:this._view.txtInput.promptText="最多15个字",this._view.txtInput.text="";break;case e.TYPE_QUEST:this._view.txtInput.promptText="最多140个字",this._view.txtInput.text="?";break;case e.TYPE_REVERT:this._view.txtInput.promptText="最多140个字",this._view.txtInput.text="";break;case e.TYPE_OUAT:this._view.txtInput.promptText="最多140个字",this._view.txtInput.text="很久很久以前，"}},e.prototype.onReturn=function(t){this.dispose(),this.next("TitlePage")},e.prototype.dispose=function(){fairygui.GRoot.inst.removeChild(this._view),this._view.dispose(),this._view=null,this.removeChildren()},e.TYPE_FREE=0,e.TYPE_15=1,e.TYPE_QUEST=2,e.TYPE_REVERT=3,e.TYPE_OUAT=4,e}(State);__reflect(CreatePage.prototype,"CreatePage");var ReadPage=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this._view=new StoryReadPageUI,fairygui.GRoot.inst.addChild(this._view),this._view.btnReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReturn,this),this._list=this._view.list,this._list.itemRenderer=this.renderListItem,this._list.callbackThisObj=this,this._list.setVirtual();var e=this.data,i=[];if(this._storys=i,i.push(e),e)for(;e.parentVO;)i.unshift(e.parentVO),e=e.parentVO;this._list.numItems=i.length},e.prototype.renderListItem=function(t,e){var i=this,r=this._storys[t];e.data=r,e.getChild("txtStory").text=r.content,e.getChild("txtName").text=r.arthor?r.arthor.username:"someone";var n=e.getChild("btnLike").asButton,o=(e.getChild("btnComment").asButton,e.getChild("btnGoon").asButton);n.text="赞（"+r.like+"）",o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){DataControl.instance.like(r),n.text="赞（"+r.like+"）"},this),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.writeStory(r)},this)},e.prototype.writeStory=function(t){this.dispose(),this.next("WritePage",t)},e.prototype.onReturn=function(t){var e,i=this.data;i&&(e=i.tree),this.dispose(),this.next("TreePage",e)},e.prototype.over=function(){this.dispose()},e.prototype.dispose=function(){this._list.removeChildrenToPool(),fairygui.GRoot.inst.removeChild(this._view),this._view.dispose(),this._view=null,this.removeChildren()},e}(State);__reflect(ReadPage.prototype,"ReadPage");var StateBG=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.stageWidth=this.stage.stageWidth,this.stageHeight=this.stage.stageHeight},Object.defineProperty(e.prototype,"bg",{set:function(t){this.background=AssetManager.getBitmap(t),this.background&&this.stage&&(this.background.x=this.stageWidth/2,this.background.y=this.stageHeight/2,this.addChild(this.background))},enumerable:!0,configurable:!0}),e}(State);__reflect(StateBG.prototype,"StateBG");var TitlePage=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this._view=new StoryTitlePageUI,fairygui.GRoot.inst.addChild(this._view),this._view.btnCreate.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCreate,this),this._view.btnTree.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTree,this),this._view.btnFriends.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFriends,this)},e.prototype.onGetComplete=function(t){var e=t.currentTarget;console.log("get data : ",e.response)},e.prototype.onGetIOError=function(t){console.log("get error : "+t)},e.prototype.onGetProgress=function(t){console.log("get progress : "+Math.floor(100*t.bytesLoaded/t.bytesTotal)+"%")},e.prototype.onCreate=function(t){this.dispose(),this.next("CreatePage")},e.prototype.onTree=function(t){this.dispose(),this.next("TreePage")},e.prototype.onFriends=function(t){},e.prototype.onTouchBegin=function(t){this.over()},e.prototype.over=function(){this.dispose()},e.prototype.dispose=function(){fairygui.GRoot.inst.removeChild(this._view),this._view.dispose(),this._view=null,this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(State);__reflect(TitlePage.prototype,"TitlePage");var DataControl=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.like=function(t){t.like++},t.prototype.createTree=function(t,e,i){var r={};r.id=this.userData.getNextStoryId(),r.topic=e,r.type=t;var n={};n.id=1,n.parent=null,n.content=i,n.modifyTime=(new Date).getTime(),n.like=0,n.arthor=this.userData.user.toObj(),r.parts=[n];var o=new StoryTreeVO(r);return this.userData.story.push(o),o},t.prototype.addStoryPart=function(t,e){var i=e.tree;if(i){var r=(i.parts.indexOf(e),{});r.id=i.getNextPartId(),r.parent=e.id,r.content=t,r.modifyTime=(new Date).getTime(),r.like=0;var n=new StoryPartVO(r);return n.arthor=this.userData.user,n.parentVO=e,n.tree=i,n.children=[],i.parts.push(n),e.children.push(n),n}return null},t}();__reflect(DataControl.prototype,"DataControl");var WritePage=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this._view=new StoryWritePageUI,fairygui.GRoot.inst.addChild(this._view),this._view.btnReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReturn,this),this._view.btnPublish.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPublish,this);var e=this.data;if(e){var i=e.tree,r=i.topic,n=i.type;this.updateTip(r,n)}},e.prototype.updateTip=function(t,e){var i=DataControl.instance.storyConfig,r=i.topic[t].desc,n=i.type[e].desc;switch(this._view.txtTip.text="主题："+r+"\n类型："+n,t){case CreatePage.TYPE_FREE:this._view.txtInput.promptText="最多140个字",this._view.txtInput.text="";break;case CreatePage.TYPE_15:this._view.txtInput.promptText="最多15个字",this._view.txtInput.text="";break;case CreatePage.TYPE_QUEST:this._view.txtInput.promptText="最多140个字",this._view.txtInput.text="?";break;case CreatePage.TYPE_REVERT:this._view.txtInput.promptText="最多140个字",this._view.txtInput.text="";break;case CreatePage.TYPE_OUAT:this._view.txtInput.promptText="最多140个字",this._view.txtInput.text="很久很久以前，"}},e.prototype.onPublish=function(t){if(this.data&&this._view.txtInput.text.length>1){var e=DataControl.instance.addStoryPart(this._view.txtInput.text,this.data);e&&(this.dispose(),this.next("ReadPage",e))}},e.prototype.onReturn=function(t){this.dispose(),this.next("TreePage")},e.prototype.over=function(){this.dispose()},e.prototype.dispose=function(){fairygui.GRoot.inst.removeChild(this._view),this._view.dispose(),this._view=null,this.removeChildren()},e}(State);__reflect(WritePage.prototype,"WritePage");var AssetManager=function(){function t(){}return t.getBitmap=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0);var r=new egret.Bitmap,n=RES.getRes(t);return r.texture=n,e&&(r.anchorOffsetX=r.width/2),i&&(r.anchorOffsetY=r.height/2),r},t.getSound=function(t){return RES.getRes(t)},t}();__reflect(AssetManager.prototype,"AssetManager");var StateEvent=function(t){function e(e,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1);var o=t.call(this,e,r,n)||this;return o.data=i,o}return __extends(e,t),e.NEXT="NEXT",e}(egret.Event);__reflect(StateEvent.prototype,"StateEvent");var StateManager=function(){function t(t){this._parent=t,this._stateObj={}}return t.prototype.startTick=function(){this._curTime=egret.getTimer(),egret.startTick(this.tick,this)},t.prototype.stopTick=function(){egret.stopTick(this.tick,this)},t.prototype.tick=function(t){return this._lastTime=this._curTime,this._curTime=t,this._curState&&this._curState.tick(this._curTime-this._lastTime),!0},t.prototype.registerState=function(t,e){this._stateObj[t]=e},t.prototype.setCurStateName=function(t){var e=this._stateObj[t];e&&this.setCurState(e)},t.prototype.setCurState=function(t){this._curState&&(this._curState.removeEventListener(StateEvent.NEXT,this.onNext,this),this._prevState=this._curState),this._curState=t,this._curState.show(this._parent),this._curState.addEventListener(StateEvent.NEXT,this.onNext,this)},t.prototype.onNext=function(t){var e=t.data.state,i=t.data.data,r=this._stateObj[e];r.data=i,r&&this.setCurState(r)},t}();__reflect(StateManager.prototype,"StateManager");var StoryCreatePageUI=function(t){function e(){var e=t.call(this)||this;return e.view=fairygui.UIPackage.createObject("storyTreeUI","Create").asCom,e.addChild(e.view),e.btnReturn=e.view.getChild("btnReturn").asButton,e.btnPublish=e.view.getChild("btnPublish"),e.txtTip=e.view.getChild("txtTip"),e.txtInput=e.view.getChild("txtInput"),e.topicController=e.view.getController("topicC"),e.typeController=e.view.getController("typeC"),e}return __extends(e,t),e}(fairygui.GComponent);__reflect(StoryCreatePageUI.prototype,"StoryCreatePageUI");var StoryReadPageUI=function(t){function e(){var e=t.call(this)||this;return e.view=fairygui.UIPackage.createObject("storyTreeUI","StoryRead").asCom,e.addChild(e.view),e.btnReturn=e.view.getChild("btnReturn"),e.list=e.view.getChild("list"),e}return __extends(e,t),e}(fairygui.GComponent);__reflect(StoryReadPageUI.prototype,"StoryReadPageUI");var StoryTitlePageUI=function(t){function e(){var e=t.call(this)||this;return e.view=fairygui.UIPackage.createObject("storyTreeUI","Title").asCom,e.addChild(e.view),e.btnCreate=e.view.getChild("btnCreate"),e.btnTree=e.view.getChild("btnTree"),e.btnFriends=e.view.getChild("btnFriends"),e}return __extends(e,t),e}(fairygui.GComponent);__reflect(StoryTitlePageUI.prototype,"StoryTitlePageUI");var StoryTree=function(t){function e(e){var i=t.call(this)||this;return i.data=e,i.create(),i.touchEnabled=!0,i.touchChildren=!0,i}return __extends(e,t),e.prototype.create=function(){if(this.data&&this.data.root){var t=new StoryTreeRoot(this.data.root);this.addChild(t)}},e}(egret.Sprite);__reflect(StoryTree.prototype,"StoryTree");var StoryTreeLeaf=function(t){function e(e,i){var r=t.call(this,e)||this;return r.color2=47704,r.color1=102978,r.color3=3809292,r.size=100,r.depth=i,r._shape=new egret.Shape,r._shape.graphics.beginFill(r.color1),r._shape.graphics.drawRoundRect(-r.size/2,-r.size/2,r.size,r.size,r.size/5),r._shape.graphics.beginFill(r.color3),r._shape.graphics.drawCircle(0,.4*r.size,5),r._shape.graphics.endFill(),r.addChild(r._shape),r._shape.touchEnabled=!0,r.createChildren(),r}return __extends(e,t),e.prototype.createChildren=function(){var t,i,r;if(null!=this.data.children)for(t=0,i=this.data.children.length;i>t&&!(t>2);t++){r=this.data.children[t];var n=new e(r,this.depth+1);n.depth<=5&&(n.scaleX=n.scaleY=.8),0==t?(n.x=0,n.y=1.1*-this._shape.height):2==t?(n.x=1.1*this._shape.width,n.y=.1*-this._shape.height,n.rotation=90):1==t&&(n.x=1.1*-this._shape.width,n.y=.1*-this._shape.height,n.rotation=-90),this.addChild(n)}},e}(StoryTreeNode);__reflect(StoryTreeLeaf.prototype,"StoryTreeLeaf");var Game=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.prototype.onAdded=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.init()},e.prototype.init=function(){console.log("rhythmMeow start, let's rock! "),this._uiLayer=new egret.DisplayObjectContainer,this._pageLayer=new egret.DisplayObjectContainer,e.userData=new StoryData(RES.getRes("userData_json")),DataControl.instance.storyConfig=RES.getRes("storyConfig_json"),DataControl.instance.userData=e.userData,this.addChild(this._uiLayer),this.addChild(this._pageLayer),fairygui.UIPackage.addPackage("basic"),fairygui.UIPackage.addPackage("storyTreeUI"),fairygui.UIConfig.defaultFont="宋体",fairygui.UIConfig.verticalScrollBar=fairygui.UIPackage.getItemURL("Basic","ScrollBar_VT"),fairygui.UIConfig.horizontalScrollBar=fairygui.UIPackage.getItemURL("Basic","ScrollBar_HZ"),fairygui.UIConfig.popupMenu=fairygui.UIPackage.getItemURL("Basic","PopupMenu"),fairygui.UIConfig.buttonSound=fairygui.UIPackage.getItemURL("Basic","click"),this._uiLayer.addChild(fairygui.GRoot.inst.displayObject);var t=new StateManager(this._pageLayer);t.registerState("TitlePage",new TitlePage),t.registerState("CreatePage",new CreatePage),t.registerState("TreePage",new TreePage),t.registerState("WritePage",new WritePage),t.registerState("ReadPage",new ReadPage),t.setCurStateName("TitlePage"),t.startTick()},e}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");var StoryTreePageUI=function(t){function e(){var e=t.call(this)||this;return e.view=fairygui.UIPackage.createObject("storyTreeUI","StoryTree").asCom,e.addChild(e.view),e.btnReturn=e.view.getChild("btnReturn"),e.btnLast=e.view.getChild("btnLast"),e.btnNext=e.view.getChild("btnNext"),e.txtPage=e.view.getChild("txtPage"),e}return __extends(e,t),e}(fairygui.GComponent);__reflect(StoryTreePageUI.prototype,"StoryTreePageUI");var StoryTreeRoot=function(t){function e(e){var i=t.call(this,e)||this;return i._bg=AssetManager.getBitmap("TreeRoot_png"),i._bg.touchEnabled=!0,i.addChild(i._bg),i._originPoint=new egret.Point,i._originPoint.x=0,i._originPoint.y=-300,i.createChildren(),i}return __extends(e,t),e.prototype.createChildren=function(){var t,e,i;for(t=0,e=this.data.children.length;e>t&&!(t>2);t++){i=this.data.children[t];var r=new StoryTreeLeaf(i,1);r.depth=this.depth+1,0==t?(r.x=this._originPoint.x+0,r.y=this._originPoint.y+100):1==t?(r.x=this._originPoint.x-120,r.y=this._originPoint.y+220,r.rotation=-90):2==t&&(r.x=this._originPoint.x+120,r.y=this._originPoint.y+220,r.rotation=90),this.addChild(r)}},e}(StoryTreeNode);__reflect(StoryTreeRoot.prototype,"StoryTreeRoot");var StoryWritePageUI=function(t){function e(){var e=t.call(this)||this;return e.view=fairygui.UIPackage.createObject("storyTreeUI","StoryWrite").asCom,e.addChild(e.view),e.btnReturn=e.view.getChild("btnReturn"),e.btnPublish=e.view.getChild("btnPublish"),e.txtTip=e.view.getChild("txtTip").asTextField,e.txtInput=e.view.getChild("txtInput"),e}return __extends(e,t),e}(fairygui.GComponent);__reflect(StoryWritePageUI.prototype,"StoryWritePageUI");