var Game=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onAdded=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.init()},i.init=function(){console.log("this is a new game!");var e=new StateManager(this);e.registerState("levelInfo",new LevelInfo),e.registerState("level1",new Level1),e.registerState("levelOver0",new LevelOver0),e.registerState("levelOver1",new LevelOver1),e.registerState("levelOver2",new LevelOver2),e.registerState("levelOver3",new LevelOver3),e.registerState("levelOver4",new LevelOver4),e.registerState("levelScore",new LevelScore),e.registerState("levelTitle",new LevelTitle),e.registerState("levelEnd",new LevelEnd),e.registerState("levelThanks",new LevelThanks),e.registerState("story",new LevelStroy),e.setCurStateName("levelInfo"),e.startTick()},t}(egret.DisplayObjectContainer);egret.registerClass(Game,"Game");var GameData=function(){function e(){}var t=(__define,e);t.prototype;return e.maxComboo=0,e.comboo=0,e.score=0,e.roles=[],e}();egret.registerClass(GameData,"GameData");var GamePad=function(e){function t(t,n){e.call(this),this._stage=t,this._type=n}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){this._stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.onTouchBegin=function(e){void 0==this._touchId&&(this._touchId=e.touchPointID,console.log(this._touchId),this._startX=e.stageX,this._startY=e.stageY,this._endX=this._startX,this._endY=this._startY,this.touchX=this._startX,this.touchY=this._startY,this.bg&&(this.bg.visible=!0,this.bg.x=this._startX,this.bg.y=this._startY),this.pad&&(this.pad.visible=!0,this.pad.x=this.touchX,this.pad.y=this.touchY),this._stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this))},i.onTouchEnd=function(e){e.touchPointID==this._touchId&&(this._touchId=void 0,this.bg&&(this.bg.visible=!1),this.pad&&(this.pad.visible=!1),this._stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this))},i.onTouchMove=function(e){if(e.touchPointID==this._touchId){this._lastX=this._endX,this._lastY=this._endY,this._endX=e.stageX,this._endY=e.stageY;var t=this._endX-this._startX,n=this._endY-this._startY;this.force=Math.abs(t)+Math.abs(n),this.left=t>0,this.right=0>t,this.up=0>n,this.down=n>0;var i=Math.sqrt(t*t+n*n);this.radian=Math.atan(t/n),0>n&&(this.radian+=Math.PI),this.angle=57.29578*this.radian;var r=i>this.radius?this.radius:i;this.radius>0&&(this.padX=r*Math.sin(this.radian),this.padY=r*Math.cos(this.radian)),this.bg&&(this.bg.x=this.touchX,this.bg.y=this.touchY),this.pad&&(this.pad.x=this.touchX+this.padX,this.pad.y=this.touchY+this.padY)}},t}(egret.EventDispatcher);egret.registerClass(GamePad,"GamePad");var GamePadEvent=function(e){function t(t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===r&&(r=null),e.call(this,t,n,i,r)}__extends(t,e);var n=(__define,t);n.prototype;return t.START="START",t}(egret.Event);egret.registerClass(GamePadEvent,"GamePadEvent");var GestureController=function(e){function t(t,n){e.call(this),this._canvas=new egret.Shape,this._container=n,this._myRec=new GestureRecognizer,this._myRec.addTemplate("triangle",new Array(new egret.Point(137,139),new egret.Point(135,141),new egret.Point(133,144),new egret.Point(132,146),new egret.Point(130,149),new egret.Point(128,151),new egret.Point(126,155),new egret.Point(123,160),new egret.Point(120,166),new egret.Point(116,171),new egret.Point(112,177),new egret.Point(107,183),new egret.Point(102,188),new egret.Point(100,191),new egret.Point(95,195),new egret.Point(90,199),new egret.Point(86,203),new egret.Point(82,206),new egret.Point(80,209),new egret.Point(75,213),new egret.Point(73,213),new egret.Point(70,216),new egret.Point(67,219),new egret.Point(64,221),new egret.Point(61,223),new egret.Point(60,225),new egret.Point(62,226),new egret.Point(65,225),new egret.Point(67,226),new egret.Point(74,226),new egret.Point(77,227),new egret.Point(85,229),new egret.Point(91,230),new egret.Point(99,231),new egret.Point(108,232),new egret.Point(116,233),new egret.Point(125,233),new egret.Point(134,234),new egret.Point(145,233),new egret.Point(153,232),new egret.Point(160,233),new egret.Point(170,234),new egret.Point(177,235),new egret.Point(179,236),new egret.Point(186,237),new egret.Point(193,238),new egret.Point(198,239),new egret.Point(200,237),new egret.Point(202,239),new egret.Point(204,238),new egret.Point(206,234),new egret.Point(205,230),new egret.Point(202,222),new egret.Point(197,216),new egret.Point(192,207),new egret.Point(186,198),new egret.Point(179,189),new egret.Point(174,183),new egret.Point(170,178),new egret.Point(164,171),new egret.Point(161,168),new egret.Point(154,160),new egret.Point(148,155),new egret.Point(143,150),new egret.Point(138,148),new egret.Point(136,148))),this._myRec.addTemplate("x",new Array(new egret.Point(87,142),new egret.Point(89,145),new egret.Point(91,148),new egret.Point(93,151),new egret.Point(96,155),new egret.Point(98,157),new egret.Point(100,160),new egret.Point(102,162),new egret.Point(106,167),new egret.Point(108,169),new egret.Point(110,171),new egret.Point(115,177),new egret.Point(119,183),new egret.Point(123,189),new egret.Point(127,193),new egret.Point(129,196),new egret.Point(133,200),new egret.Point(137,206),new egret.Point(140,209),new egret.Point(143,212),new egret.Point(146,215),new egret.Point(151,220),new egret.Point(153,222),new egret.Point(155,223),new egret.Point(157,225),new egret.Point(158,223),new egret.Point(157,218),new egret.Point(155,211),new egret.Point(154,208),new egret.Point(152,200),new egret.Point(150,189),new egret.Point(148,179),new egret.Point(147,170),new egret.Point(147,158),new egret.Point(147,148),new egret.Point(147,141),new egret.Point(147,136),new egret.Point(144,135),new egret.Point(142,137),new egret.Point(140,139),new egret.Point(135,145),new egret.Point(131,152),new egret.Point(124,163),new egret.Point(116,177),new egret.Point(108,191),new egret.Point(100,206),new egret.Point(94,217),new egret.Point(91,222),new egret.Point(89,225),new egret.Point(87,226),new egret.Point(87,224))),this._myRec.addTemplate("rectangle",new Array(new egret.Point(78,149),new egret.Point(78,153),new egret.Point(78,157),new egret.Point(78,160),new egret.Point(79,162),new egret.Point(79,164),new egret.Point(79,167),new egret.Point(79,169),new egret.Point(79,173),new egret.Point(79,178),new egret.Point(79,183),new egret.Point(80,189),new egret.Point(80,193),new egret.Point(80,198),new egret.Point(80,202),new egret.Point(81,208),new egret.Point(81,210),new egret.Point(81,216),new egret.Point(82,222),new egret.Point(82,224),new egret.Point(82,227),new egret.Point(83,229),new egret.Point(83,231),new egret.Point(85,230),new egret.Point(88,232),new egret.Point(90,233),new egret.Point(92,232),new egret.Point(94,233),new egret.Point(99,232),new egret.Point(102,233),new egret.Point(106,233),new egret.Point(109,234),new egret.Point(117,235),new egret.Point(123,236),new egret.Point(126,236),new egret.Point(135,237),new egret.Point(142,238),new egret.Point(145,238),new egret.Point(152,238),new egret.Point(154,239),new egret.Point(165,238),new egret.Point(174,237),new egret.Point(179,236),new egret.Point(186,235),new egret.Point(191,235),new egret.Point(195,233),new egret.Point(197,233),new egret.Point(200,233),new egret.Point(201,235),new egret.Point(201,233),new egret.Point(199,231),new egret.Point(198,226),new egret.Point(198,220),new egret.Point(196,207),new egret.Point(195,195),new egret.Point(195,181),new egret.Point(195,173),new egret.Point(195,163),new egret.Point(194,155),new egret.Point(192,145),new egret.Point(192,143),new egret.Point(192,138),new egret.Point(191,135),new egret.Point(191,133),new egret.Point(191,130),new egret.Point(190,128),new egret.Point(188,129),new egret.Point(186,129),new egret.Point(181,132),new egret.Point(173,131),new egret.Point(162,131),new egret.Point(151,132),new egret.Point(149,132),new egret.Point(138,132),new egret.Point(136,132),new egret.Point(122,131),new egret.Point(120,131),new egret.Point(109,130),new egret.Point(107,130),new egret.Point(90,132),new egret.Point(81,133),new egret.Point(76,133))),this._myRec.addTemplate("circle",new Array(new egret.Point(127,141),new egret.Point(124,140),new egret.Point(120,139),new egret.Point(118,139),new egret.Point(116,139),new egret.Point(111,140),new egret.Point(109,141),new egret.Point(104,144),new egret.Point(100,147),new egret.Point(96,152),new egret.Point(93,157),new egret.Point(90,163),new egret.Point(87,169),new egret.Point(85,175),new egret.Point(83,181),new egret.Point(82,190),new egret.Point(82,195),new egret.Point(83,200),new egret.Point(84,205),new egret.Point(88,213),new egret.Point(91,216),new egret.Point(96,219),new egret.Point(103,222),new egret.Point(108,224),new egret.Point(111,224),new egret.Point(120,224),new egret.Point(133,223),new egret.Point(142,222),new egret.Point(152,218),new egret.Point(160,214),new egret.Point(167,210),new egret.Point(173,204),new egret.Point(178,198),new egret.Point(179,196),new egret.Point(182,188),new egret.Point(182,177),new egret.Point(178,167),new egret.Point(170,150),new egret.Point(163,138),new egret.Point(152,130),new egret.Point(143,129),new egret.Point(140,131),new egret.Point(129,136),new egret.Point(126,139))),this._myRec.addTemplate("check",new Array(new egret.Point(91,185),new egret.Point(93,185),new egret.Point(95,185),new egret.Point(97,185),new egret.Point(100,188),new egret.Point(102,189),new egret.Point(104,190),new egret.Point(106,193),new egret.Point(108,195),new egret.Point(110,198),new egret.Point(112,201),new egret.Point(114,204),new egret.Point(115,207),new egret.Point(117,210),new egret.Point(118,212),new egret.Point(120,214),new egret.Point(121,217),new egret.Point(122,219),new egret.Point(123,222),new egret.Point(124,224),new egret.Point(126,226),new egret.Point(127,229),new egret.Point(129,231),new egret.Point(130,233),new egret.Point(129,231),new egret.Point(129,228),new egret.Point(129,226),new egret.Point(129,224),new egret.Point(129,221),new egret.Point(129,218),new egret.Point(129,212),new egret.Point(129,208),new egret.Point(130,198),new egret.Point(132,189),new egret.Point(134,182),new egret.Point(137,173),new egret.Point(143,164),new egret.Point(147,157),new egret.Point(151,151),new egret.Point(155,144),new egret.Point(161,137),new egret.Point(165,131),new egret.Point(171,122),new egret.Point(174,118),new egret.Point(176,114),new egret.Point(177,112),new egret.Point(177,114),new egret.Point(175,116),new egret.Point(173,118))),this._myRec.addTemplate("caret",new Array(new egret.Point(79,245),new egret.Point(79,242),new egret.Point(79,239),new egret.Point(80,237),new egret.Point(80,234),new egret.Point(81,232),new egret.Point(82,230),new egret.Point(84,224),new egret.Point(86,220),new egret.Point(86,218),new egret.Point(87,216),new egret.Point(88,213),new egret.Point(90,207),new egret.Point(91,202),new egret.Point(92,200),new egret.Point(93,194),new egret.Point(94,192),new egret.Point(96,189),new egret.Point(97,186),new egret.Point(100,179),new egret.Point(102,173),new egret.Point(105,165),new egret.Point(107,160),new egret.Point(109,158),new egret.Point(112,151),new egret.Point(115,144),new egret.Point(117,139),new egret.Point(119,136),new egret.Point(119,134),new egret.Point(120,132),new egret.Point(121,129),new egret.Point(122,127),new egret.Point(124,125),new egret.Point(126,124),new egret.Point(129,125),new egret.Point(131,127),new egret.Point(132,130),new egret.Point(136,139),new egret.Point(141,154),new egret.Point(145,166),new egret.Point(151,182),new egret.Point(156,193),new egret.Point(157,196),new egret.Point(161,209),new egret.Point(162,211),new egret.Point(167,223),new egret.Point(169,229),new egret.Point(170,231),new egret.Point(173,237),new egret.Point(176,242),new egret.Point(177,244),new egret.Point(179,250),new egret.Point(181,255),new egret.Point(182,257))),this._myRec.addTemplate("question",new Array(new egret.Point(104,145),new egret.Point(103,142),new egret.Point(103,140),new egret.Point(103,138),new egret.Point(103,135),new egret.Point(104,133),new egret.Point(105,131),new egret.Point(106,128),new egret.Point(107,125),new egret.Point(108,123),new egret.Point(111,121),new egret.Point(113,118),new egret.Point(115,116),new egret.Point(117,116),new egret.Point(119,116),new egret.Point(121,115),new egret.Point(124,116),new egret.Point(126,115),new egret.Point(128,114),new egret.Point(130,115),new egret.Point(133,116),new egret.Point(135,117),new egret.Point(140,120),new egret.Point(142,121),new egret.Point(144,123),new egret.Point(146,125),new egret.Point(149,127),new egret.Point(150,129),new egret.Point(152,130),new egret.Point(154,132),new egret.Point(156,134),new egret.Point(158,137),new egret.Point(159,139),new egret.Point(160,141),new egret.Point(160,143),new egret.Point(160,146),new egret.Point(160,149),new egret.Point(159,153),new egret.Point(158,155),new egret.Point(157,157),new egret.Point(155,159),new egret.Point(153,161),new egret.Point(151,163),new egret.Point(146,167),new egret.Point(142,170),new egret.Point(138,172),new egret.Point(134,173),new egret.Point(132,175),new egret.Point(127,175),new egret.Point(124,175),new egret.Point(122,176),new egret.Point(120,178),new egret.Point(119,180),new egret.Point(119,183),new egret.Point(119,185),new egret.Point(120,190),new egret.Point(121,194),new egret.Point(122,200),new egret.Point(123,205),new egret.Point(123,211),new egret.Point(124,215),new egret.Point(124,223),new egret.Point(124,225))),this._myRec.addTemplate("arrow",new Array(new egret.Point(68,222),new egret.Point(70,220),new egret.Point(73,218),new egret.Point(75,217),new egret.Point(77,215),new egret.Point(80,213),new egret.Point(82,212),new egret.Point(84,210),new egret.Point(87,209),new egret.Point(89,208),new egret.Point(92,206),new egret.Point(95,204),new egret.Point(101,201),new egret.Point(106,198),new egret.Point(112,194),new egret.Point(118,191),new egret.Point(124,187),new egret.Point(127,186),new egret.Point(132,183),new egret.Point(138,181),new egret.Point(141,180),new egret.Point(146,178),new egret.Point(154,173),new egret.Point(159,171),new egret.Point(161,170),new egret.Point(166,167),new egret.Point(168,167),new egret.Point(171,166),new egret.Point(174,164),new egret.Point(177,162),new egret.Point(180,160),new egret.Point(182,158),new egret.Point(183,156),new egret.Point(181,154),new egret.Point(178,153),new egret.Point(171,153),new egret.Point(164,153),new egret.Point(160,153),new egret.Point(150,154),new egret.Point(147,155),new egret.Point(141,157),new egret.Point(137,158),new egret.Point(135,158),new egret.Point(137,158),new egret.Point(140,157),new egret.Point(143,156),new egret.Point(151,154),new egret.Point(160,152),new egret.Point(170,149),new egret.Point(179,147),new egret.Point(185,145),new egret.Point(192,144),new egret.Point(196,144),new egret.Point(198,144),new egret.Point(200,144),new egret.Point(201,147),new egret.Point(199,149),new egret.Point(194,157),new egret.Point(191,160),new egret.Point(186,167),new egret.Point(180,176),new egret.Point(177,179),new egret.Point(171,187),new egret.Point(169,189),new egret.Point(165,194),new egret.Point(164,196))),this._myRec.addTemplate("leftsquarebracket",new Array(new egret.Point(140,124),new egret.Point(138,123),new egret.Point(135,122),new egret.Point(133,123),new egret.Point(130,123),new egret.Point(128,124),new egret.Point(125,125),new egret.Point(122,124),new egret.Point(120,124),new egret.Point(118,124),new egret.Point(116,125),new egret.Point(113,125),new egret.Point(111,125),new egret.Point(108,124),new egret.Point(106,125),new egret.Point(104,125),new egret.Point(102,124),new egret.Point(100,123),new egret.Point(98,123),new egret.Point(95,124),new egret.Point(93,123),new egret.Point(90,124),new egret.Point(88,124),new egret.Point(85,125),new egret.Point(83,126),new egret.Point(81,127),new egret.Point(81,129),new egret.Point(82,131),new egret.Point(82,134),new egret.Point(83,138),new egret.Point(84,141),new egret.Point(84,144),new egret.Point(85,148),new egret.Point(85,151),new egret.Point(86,156),new egret.Point(86,160),new egret.Point(86,164),new egret.Point(86,168),new egret.Point(87,171),new egret.Point(87,175),new egret.Point(87,179),new egret.Point(87,182),new egret.Point(87,186),new egret.Point(88,188),new egret.Point(88,195),new egret.Point(88,198),new egret.Point(88,201),new egret.Point(88,207),new egret.Point(89,211),new egret.Point(89,213),new egret.Point(89,217),new egret.Point(89,222),new egret.Point(88,225),new egret.Point(88,229),new egret.Point(88,231),new egret.Point(88,233),new egret.Point(88,235),new egret.Point(89,237),new egret.Point(89,240),new egret.Point(89,242),new egret.Point(91,241),new egret.Point(94,241),new egret.Point(96,240),new egret.Point(98,239),new egret.Point(105,240),new egret.Point(109,240),new egret.Point(113,239),new egret.Point(116,240),new egret.Point(121,239),new egret.Point(130,240),new egret.Point(136,237),new egret.Point(139,237),new egret.Point(144,238),new egret.Point(151,237),new egret.Point(157,236),new egret.Point(159,237))),this._myRec.addTemplate("rightsquarebracket",new Array(new egret.Point(112,138),new egret.Point(112,136),new egret.Point(115,136),new egret.Point(118,137),new egret.Point(120,136),new egret.Point(123,136),new egret.Point(125,136),new egret.Point(128,136),new egret.Point(131,136),new egret.Point(134,135),new egret.Point(137,135),new egret.Point(140,134),new egret.Point(143,133),new egret.Point(145,132),new egret.Point(147,132),new egret.Point(149,132),new egret.Point(152,132),new egret.Point(153,134),new egret.Point(154,137),new egret.Point(155,141),new egret.Point(156,144),new egret.Point(157,152),new egret.Point(158,161),new egret.Point(160,170),new egret.Point(162,182),new egret.Point(164,192),new egret.Point(166,200),new egret.Point(167,209),new egret.Point(168,214),new egret.Point(168,216),new egret.Point(169,221),new egret.Point(169,223),new egret.Point(169,228),new egret.Point(169,231),new egret.Point(166,233),new egret.Point(164,234),new egret.Point(161,235),new egret.Point(155,236),new egret.Point(147,235),new egret.Point(140,233),new egret.Point(131,233),new egret.Point(124,233),new egret.Point(117,235),new egret.Point(114,238),new egret.Point(112,238))),this._myRec.addTemplate("v",new Array(new egret.Point(89,164),new egret.Point(90,162),new egret.Point(92,162),new egret.Point(94,164),new egret.Point(95,166),new egret.Point(96,169),new egret.Point(97,171),new egret.Point(99,175),new egret.Point(101,178),new egret.Point(103,182),new egret.Point(106,189),new egret.Point(108,194),new egret.Point(111,199),new egret.Point(114,204),new egret.Point(117,209),new egret.Point(119,214),new egret.Point(122,218),new egret.Point(124,222),new egret.Point(126,225),new egret.Point(128,228),new egret.Point(130,229),new egret.Point(133,233),new egret.Point(134,236),new egret.Point(136,239),new egret.Point(138,240),new egret.Point(139,242),new egret.Point(140,244),new egret.Point(142,242),new egret.Point(142,240),new egret.Point(142,237),new egret.Point(143,235),new egret.Point(143,233),new egret.Point(145,229),new egret.Point(146,226),new egret.Point(148,217),new egret.Point(149,208),new egret.Point(149,205),new egret.Point(151,196),new egret.Point(151,193),new egret.Point(153,182),new egret.Point(155,172),new egret.Point(157,165),new egret.Point(159,160),new egret.Point(162,155),new egret.Point(164,150),new egret.Point(165,148),new egret.Point(166,146))),this._myRec.addTemplate("delete",new Array(new egret.Point(123,129),new egret.Point(123,131),new egret.Point(124,133),new egret.Point(125,136),new egret.Point(127,140),new egret.Point(129,142),new egret.Point(133,148),new egret.Point(137,154),new egret.Point(143,158),new egret.Point(145,161),new egret.Point(148,164),new egret.Point(153,170),new egret.Point(158,176),new egret.Point(160,178),new egret.Point(164,183),new egret.Point(168,188),new egret.Point(171,191),new egret.Point(175,196),new egret.Point(178,200),new egret.Point(180,202),new egret.Point(181,205),new egret.Point(184,208),new egret.Point(186,210),new egret.Point(187,213),new egret.Point(188,215),new egret.Point(186,212),new egret.Point(183,211),new egret.Point(177,208),new egret.Point(169,206),new egret.Point(162,205),new egret.Point(154,207),new egret.Point(145,209),new egret.Point(137,210),new egret.Point(129,214),new egret.Point(122,217),new egret.Point(118,218),new egret.Point(111,221),new egret.Point(109,222),new egret.Point(110,219),new egret.Point(112,217),new egret.Point(118,209),new egret.Point(120,207),new egret.Point(128,196),new egret.Point(135,187),new egret.Point(138,183),new egret.Point(148,167),new egret.Point(157,153),new egret.Point(163,145),new egret.Point(165,142),new egret.Point(172,133),new egret.Point(177,127),new egret.Point(179,127),new egret.Point(180,125))),this._myRec.addTemplate("leftcurlybrace",new Array(new egret.Point(150,116),new egret.Point(147,117),new egret.Point(145,116),new egret.Point(142,116),new egret.Point(139,117),new egret.Point(136,117),new egret.Point(133,118),new egret.Point(129,121),new egret.Point(126,122),new egret.Point(123,123),new egret.Point(120,125),new egret.Point(118,127),new egret.Point(115,128),new egret.Point(113,129),new egret.Point(112,131),new egret.Point(113,134),new egret.Point(115,134),new egret.Point(117,135),new egret.Point(120,135),new egret.Point(123,137),new egret.Point(126,138),new egret.Point(129,140),new egret.Point(135,143),new egret.Point(137,144),new egret.Point(139,147),new egret.Point(141,149),new egret.Point(140,152),new egret.Point(139,155),new egret.Point(134,159),new egret.Point(131,161),new egret.Point(124,166),new egret.Point(121,166),new egret.Point(117,166),new egret.Point(114,167),new egret.Point(112,166),new egret.Point(114,164),new egret.Point(116,163),new egret.Point(118,163),new egret.Point(120,162),new egret.Point(122,163),new egret.Point(125,164),new egret.Point(127,165),new egret.Point(129,166),new egret.Point(130,168),new egret.Point(129,171),new egret.Point(127,175),new egret.Point(125,179),new egret.Point(123,184),new egret.Point(121,190),new egret.Point(120,194),new egret.Point(119,199),new egret.Point(120,202),new egret.Point(123,207),new egret.Point(127,211),new egret.Point(133,215),new egret.Point(142,219),new egret.Point(148,220),new egret.Point(151,221))),this._myRec.addTemplate("rightcurlybrace",new Array(new egret.Point(117,132),new egret.Point(115,132),new egret.Point(115,129),new egret.Point(117,129),new egret.Point(119,128),new egret.Point(122,127),new egret.Point(125,127),new egret.Point(127,127),new egret.Point(130,127),new egret.Point(133,129),new egret.Point(136,129),new egret.Point(138,130),new egret.Point(140,131),new egret.Point(143,134),new egret.Point(144,136),new egret.Point(145,139),new egret.Point(145,142),new egret.Point(145,145),new egret.Point(145,147),new egret.Point(145,149),new egret.Point(144,152),new egret.Point(142,157),new egret.Point(141,160),new egret.Point(139,163),new egret.Point(137,166),new egret.Point(135,167),new egret.Point(133,169),new egret.Point(131,172),new egret.Point(128,173),new egret.Point(126,176),new egret.Point(125,178),new egret.Point(125,180),new egret.Point(125,182),new egret.Point(126,184),new egret.Point(128,187),new egret.Point(130,187),new egret.Point(132,188),new egret.Point(135,189),new egret.Point(140,189),new egret.Point(145,189),new egret.Point(150,187),new egret.Point(155,186),new egret.Point(157,185),new egret.Point(159,184),new egret.Point(156,185),new egret.Point(154,185),new egret.Point(149,185),new egret.Point(145,187),new egret.Point(141,188),new egret.Point(136,191),new egret.Point(134,191),new egret.Point(131,192),new egret.Point(129,193),new egret.Point(129,195),new egret.Point(129,197),new egret.Point(131,200),new egret.Point(133,202),new egret.Point(136,206),new egret.Point(139,211),new egret.Point(142,215),new egret.Point(145,220),new egret.Point(147,225),new egret.Point(148,231),new egret.Point(147,239),new egret.Point(144,244),new egret.Point(139,248),new egret.Point(134,250),new egret.Point(126,253),new egret.Point(119,253),new egret.Point(115,253))),this._myRec.addTemplate("star",new Array(new egret.Point(75,250),new egret.Point(75,247),new egret.Point(77,244),new egret.Point(78,242),new egret.Point(79,239),new egret.Point(80,237),new egret.Point(82,234),new egret.Point(82,232),new egret.Point(84,229),new egret.Point(85,225),new egret.Point(87,222),new egret.Point(88,219),new egret.Point(89,216),new egret.Point(91,212),new egret.Point(92,208),new egret.Point(94,204),new egret.Point(95,201),new egret.Point(96,196),new egret.Point(97,194),new egret.Point(98,191),new egret.Point(100,185),new egret.Point(102,178),new egret.Point(104,173),new egret.Point(104,171),new egret.Point(105,164),new egret.Point(106,158),new egret.Point(107,156),new egret.Point(107,152),new egret.Point(108,145),new egret.Point(109,141),new egret.Point(110,139),new egret.Point(112,133),new egret.Point(113,131),new egret.Point(116,127),new egret.Point(117,125),new egret.Point(119,122),new egret.Point(121,121),new egret.Point(123,120),new egret.Point(125,122),new egret.Point(125,125),new egret.Point(127,130),new egret.Point(128,133),new egret.Point(131,143),new egret.Point(136,153),new egret.Point(140,163),new egret.Point(144,172),new egret.Point(145,175),new egret.Point(151,189),new egret.Point(156,201),new egret.Point(161,213),new egret.Point(166,225),new egret.Point(169,233),new egret.Point(171,236),new egret.Point(174,243),new egret.Point(177,247),new egret.Point(178,249),new egret.Point(179,251),new egret.Point(180,253),new egret.Point(180,255),new egret.Point(179,257),new egret.Point(177,257),new egret.Point(174,255),new egret.Point(169,250),new egret.Point(164,247),new egret.Point(160,245),new egret.Point(149,238),new egret.Point(138,230),new egret.Point(127,221),new egret.Point(124,220),new egret.Point(112,212),new egret.Point(110,210),new egret.Point(96,201),new egret.Point(84,195),new egret.Point(74,190),new egret.Point(64,182),new egret.Point(55,175),new egret.Point(51,172),new egret.Point(49,170),new egret.Point(51,169),new egret.Point(56,169),new egret.Point(66,169),new egret.Point(78,168),new egret.Point(92,166),new egret.Point(107,164),new egret.Point(123,161),new egret.Point(140,162),new egret.Point(156,162),new egret.Point(171,160),new egret.Point(173,160),new egret.Point(186,160),new egret.Point(195,160),new egret.Point(198,161),new egret.Point(203,163),new egret.Point(208,163),new egret.Point(206,164),new egret.Point(200,167),new egret.Point(187,172),new egret.Point(174,179),new egret.Point(172,181),new egret.Point(153,192),new egret.Point(137,201),new egret.Point(123,211),new egret.Point(112,220),new egret.Point(99,229),new egret.Point(90,237),new egret.Point(80,244),new egret.Point(73,250),new egret.Point(69,254),new egret.Point(69,252))),this._myRec.addTemplate("pigtail",new Array(new egret.Point(81,219),new egret.Point(84,218),new egret.Point(86,220),new egret.Point(88,220),new egret.Point(90,220),new egret.Point(92,219),new egret.Point(95,220),new egret.Point(97,219),new egret.Point(99,220),new egret.Point(102,218),new egret.Point(105,217),new egret.Point(107,216),new egret.Point(110,216),new egret.Point(113,214),new egret.Point(116,212),new egret.Point(118,210),new egret.Point(121,208),new egret.Point(124,205),new egret.Point(126,202),new egret.Point(129,199),new egret.Point(132,196),new egret.Point(136,191),new egret.Point(139,187),new egret.Point(142,182),new egret.Point(144,179),new egret.Point(146,174),new egret.Point(148,170),new egret.Point(149,168),new egret.Point(151,162),new egret.Point(152,160),new egret.Point(152,157),new egret.Point(152,155),new egret.Point(152,151),new egret.Point(152,149),new egret.Point(152,146),new egret.Point(149,142),new egret.Point(148,139),new egret.Point(145,137),new egret.Point(141,135),new egret.Point(139,135),new egret.Point(134,136),new egret.Point(130,140),new egret.Point(128,142),new egret.Point(126,145),new egret.Point(122,150),new egret.Point(119,158),new egret.Point(117,163),new egret.Point(115,170),new egret.Point(114,175),new egret.Point(117,184),new egret.Point(120,190),new egret.Point(125,199),new egret.Point(129,203),new egret.Point(133,208),new egret.Point(138,213),new egret.Point(145,215),new egret.Point(155,218),new egret.Point(164,219),new egret.Point(166,219),new egret.Point(177,219),new egret.Point(182,218),new egret.Point(192,216),new egret.Point(196,213),new egret.Point(199,212),new egret.Point(201,211))),console.log("gesture"),this._stage=t,this._stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onTouchBegin=function(e){this._start&&(this._record||(this._record=!0,this._recordedPoints=new Array,this._touchId=e.touchPointID,this._canvas.graphics.lineStyle(30,16711935,.5)))},i.onTouchMove=function(e){this._start&&e.touchPointID==this._touchId&&(this._recordedPoints.push(new egret.Point(e.stageX,e.stageY)),1==this._recordedPoints.length?this._canvas.graphics.moveTo(e.stageX,e.stageY):this._canvas.graphics.lineTo(e.stageX,e.stageY))},i.onTouchEnd=function(e){if(this._canvas.graphics.clear(),this._start&&e.touchPointID==this._touchId){this._record=!1;var t=this._myRec.recognize(this._recordedPoints);t&&(console.log(t.name,t.score),this.dispatchEvent(new GestureEvent(GestureEvent.GESTURE,!0,!1,t.name)))}},i.start=function(){this._start=!0,this._container.addChild(this._canvas)},i.stop=function(){this._start=!1,this._record=!1,this._recordedPoints&&(this._recordedPoints.length=0),null!=this._canvas.parent&&(this._canvas.graphics.clear(),this._canvas.parent.removeChild(this._canvas))},t}(egret.EventDispatcher);egret.registerClass(GestureController,"GestureController");var GestureEvent=function(e){function t(t,n,i,r){void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===r&&(r=null),e.call(this,t,n,i,r)}__extends(t,e);var n=(__define,t);n.prototype;return t.GESTURE="GESTURE",t}(egret.Event);egret.registerClass(GestureEvent,"GestureEvent");var GestureRecognizer=function(){function e(){this.templates=new Array}var t=(__define,e),n=t.prototype;return n.recognize=function(t){if(null==t[0])return null;t=e.resample(t,e.numPoints),t=e.rotate2Zero(t),t=e.scale2Square(t,e.squareSize),t=e.translate2Origin(t);for(var n,i=Number.POSITIVE_INFINITY,r=0,o=this.templates.length;o>r;r++){var s=e.distanceAtBestAngle(t,this.templates[r],-e.angleRange,e.angleRange,e.anglePrecision);i>s&&(i=s,n=r)}var g=1-i/e.halfDiagonal;return new GestureResult(this.templates[n].name,g)},n.addTemplate=function(e,t){this.templates[this.templates.length]=new GestureTemplate(e,t);for(var n=0,i=0;i<this.templates.length;i++)this.templates[i].name==e&&n++;return n},e.resample=function(t,n){for(var i=e.pathLength(t)/(n-1),r=0,o=new Array(t[0]),s=1;s<t.length;s++){var g=e.Distance(t[s-1],t[s]);if(r+g>=i){var h=t[s-1].x+(i-r)/g*(t[s].x-t[s-1].x),a=t[s-1].y+(i-r)/g*(t[s].y-t[s-1].y),w=new egret.Point(h,a);o[o.length]=w,t.splice(s,0,w),r=0}else r+=g}return o.length==n-1&&(o[o.length]=t[t.length-1]),o},e.rotate2Zero=function(t){var n=e.Centroid(t);null==t[0]&&(i=0);var i=Math.atan2(n.y-t[0].y,n.x-t[0].x);return e.RotateBy(t,-i)},e.scale2Square=function(t,n){for(var i=e.BoundingBox(t),r=new Array,o=0;o<t.length;o++){var s=t[o].x*(n/i.width),g=t[o].y*(n/i.height);r[r.length]=new egret.Point(s,g)}return r},e.translate2Origin=function(t){for(var n=e.Centroid(t),i=new Array,r=0;r<t.length;r++){var o=t[r].x-n.x,s=t[r].y-n.y;
i[i.length]=new egret.Point(o,s)}return i},e.distanceAtBestAngle=function(t,n,i,r,o){for(var s=e.phi*i+(1-e.phi)*r,g=e.DistanceAtAngle(t,n,s),h=(1-e.phi)*i+e.phi*r,a=e.DistanceAtAngle(t,n,h);Math.abs(r-i)>o;)a>g?(r=h,h=s,a=g,s=e.phi*i+(1-e.phi)*r,g=this.DistanceAtAngle(t,n,s)):(i=s,s=h,g=a,h=(1-e.phi)*i+e.phi*r,a=e.DistanceAtAngle(t,n,h));return Math.min(g,a)},e.pathLength=function(t){for(var n=0,i=1;i<t.length;i++)n+=e.Distance(t[i-1],t[i]);return n},e.Distance=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},e.Centroid=function(e){for(var t=0,n=0,i=0;i<e.length;i++)null!=e[1]&&(t+=e[i].x,n+=e[i].y);return t/=e.length,n/=e.length,new egret.Point(t,n)},e.RotateBy=function(t,n){for(var i=e.Centroid(t),r=Math.cos(n),o=Math.sin(n),s=new Array,g=0;g<t.length;g++){var h=(t[g].x-i.x)*r-(t[g].y-i.y)*o+i.x,a=(t[g].x-i.x)*o+(t[g].y-i.y)*r+i.y;s[s.length]=new egret.Point(h,a)}return s},e.BoundingBox=function(e){for(var t=+(1/0),n=-(1/0),i=+(1/0),r=-(1/0),o=0;o<e.length;o++)e[o].x<t&&(t=e[o].x),e[o].x>n&&(n=e[o].x),e[o].y<i&&(i=e[o].y),e[o].y>r&&(r=e[o].y);return new egret.Rectangle(t,i,n-t,r-i)},e.DistanceAtAngle=function(t,n,i){var r=e.RotateBy(t,i);return e.PathDistance(r,n.points)},e.PathDistance=function(t,n){for(var i=0,r=0;r<t.length;r++)i+=e.Distance(t[r],n[r]);return i/t.length},e.numPoints=64,e.squareSize=250,e.halfDiagonal=.5*Math.sqrt(125e3),e.angleRange=45,e.anglePrecision=2,e.phi=.5*(-1+Math.sqrt(5)),e}();egret.registerClass(GestureRecognizer,"GestureRecognizer");var GestureResult=function(){function e(e,t){this.name=e,this.score=t}var t=(__define,e);t.prototype;return e}();egret.registerClass(GestureResult,"GestureResult");var GestureTemplate=function(){function e(e,t){this.name=e,this.points=GestureRecognizer.resample(t,GestureRecognizer.numPoints),this.points=GestureRecognizer.rotate2Zero(this.points),this.points=GestureRecognizer.scale2Square(this.points,GestureRecognizer.squareSize),this.points=GestureRecognizer.translate2Origin(this.points)}var t=(__define,e);t.prototype;return e}();egret.registerClass(GestureTemplate,"GestureTemplate");var Gesture=function(){function e(){this._symbol=["28","46","82","64","141","585","3","7","5","1","4321876","2345678"],this._symbolG=[0,0,3,3,5,5,1,1,2,2,4,4]}var t=(__define,e),n=t.prototype;return n.addEvent=function(e){this._layer=e,egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),egret.MainContext.instance.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},n.removeEvent=function(){egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),egret.MainContext.instance.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},n.mouseDown=function(e){this._layer.graphics.clear(),this._mouseDatas=[];var t=new egret.Point(e.stageX,e.stageY);this._mouseDatas.push(t),this._currentPoint=t},n.mouseMove=function(e){var t=new egret.Point(e.stageX,e.stageY);this._mouseDatas.push(t),this._layer.graphics.lineStyle(5,0),this._layer.graphics.moveTo(this._currentPoint.x,this._currentPoint.y),this._layer.graphics.lineTo(t.x,t.y),this._layer.graphics.endFill(),this._currentPoint=t},n.mouseUp=function(e){var t=new egret.Point(e.stageX,e.stageY);this._mouseDatas.push(t),this._layer.graphics.clear(),this.motion()},n.motion=function(){var e=[],t=0,n=this._mouseDatas.length;e.push(this._mouseDatas[t]);for(var i=0;n>i;i++)egret.Point.distance(this._mouseDatas[t],this._mouseDatas[i])>30&&(t=i,e.push(this._mouseDatas[t]));this._mouseDatas=e,this.parseDirection()},n.parseDirection=function(){this._dirsArr=[];for(var e=this._mouseDatas.length,t=0;e>t;t++)if(this._mouseDatas[t+1]){var n=this._mouseDatas[t],i=this._mouseDatas[t+1],r=n.y-i.y,o=egret.Point.distance(n,i),s=Math.asin(r/o),g=57.29578*s,h=this.quadrant(n,i),a=this.getDirByAngQuad(g,h);this._dirsArr.push(a)}var w=this.repDiff(this._dirsArr);console.log(w);var P=this.sweep(w);console.log("type: ",P),this.disEvent(P)},n.disEvent=function(e){-1!=e&&egret.MainContext.instance.stage.dispatchEvent(new egret.Event("action"))},n.sweep=function(e){for(var t=-1,n=-1,i=this._symbol.length,r=0;i>r;r++){var o=this.Levenshtein_Distance_Percent(this._symbol[r],e);o>n&&(n=o,t=this._symbolG[r])}return.4>n&&(t=-1),t},n.repDiff=function(e){for(var t="",n=e.length,i=0,r=0;n>r;r++)i!=e[r]&&(i=e[r],t+=e[r]);return t},n.getDirByAngQuad=function(e,t){switch(t){case 1:return 22.5>=e&&e>=0?1:67.5>=e&&e>22.5?8:7;case 2:return 22.5>=e&&e>=0?5:67.5>=e&&e>22.5?6:7;case 3:return-67.5>=e&&e>=-90?3:-22.5>=e&&e>-67.5?4:5;case 4:return-67.5>=e&&e>=-90?3:-22.5>=e&&e>-67.5?2:1}},n.quadrant=function(e,t){return t.x>=e.x?t.y<=e.y?1:4:t.y<=e.y?2:3},n.Levenshtein_Distance=function(e,t){var n,i,r,o,s,g=e.length,h=t.length,a=[];if(0==g)return h;if(0==h)return g;for(n=0;g>=n;n++)a[n]=[],a[n][0]=n;for(i=0;h>=i;i++)a[0][i]=i;for(n=1;g>=n;n++)for(r=e.charAt(n-1),i=1;h>=i;i++)o=t.charAt(i-1),s=r==o?0:1,a[n][i]=this.Minimum(a[n-1][i]+1,a[n][i-1]+1,a[n-1][i-1]+s);return a[g][h]},n.Levenshtein_Distance_Percent=function(e,t){var n=e.length>t.length?e.length:t.length,i=this.Levenshtein_Distance(e,t);return 1-i/n},n.Minimum=function(e,t,n){return t>e?n>e?e:n:n>t?t:n},e}();egret.registerClass(Gesture,"Gesture");var State=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onAdded=function(e){this.init()},i.init=function(){console.log("this is a state")},i.show=function(e){e.addChild(this)},i.next=function(e){this.dispatchEvent(new StateEvent(StateEvent.NEXT,e)),this.parent.removeChild(this)},i.tick=function(e){},t}(egret.DisplayObjectContainer);egret.registerClass(State,"State",["IState","egret.IEventDispatcher"]);var Level1=function(e){function t(){e.call(this),this.goodTime=200,this.perfectTime=50,this.hitStepTime=500,this.maxToken=4,this._curHitIndex=-1,this._rhythmArr=[],this._rhythmTypeArr=[],this._touchType=-1,this._score=0,this._comboo=0,this._maxComboo=0,this._pillarArr=[],this.heads=[],this.tokens=[],this.headNames=["lei_png","wei_png","kui_png","meng_png","zhi_png"],this.roleNames=["lei","wei","kui","meng","zhi"],this.roles=[],this.decorationNames=["barrel_png","flower_png","chair_png","toilet_png"],this.decorationPos=[150,200,480,200,150,700,480,700],this.decorations=[],this.playDecorationNum=4,this.tokenNames=["blank_png","v_png","caret_png","x_png","delete_png","triangle_png","left_square_bracket_png","right_square_bracket_png","rectangle_png","star_png","arrow_png"],this.headLayer=new egret.DisplayObjectContainer,this.userGestureLayer=new egret.DisplayObjectContainer}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){this.heads.length=0,this.tokens.length=0,this.roles.length=0,this.decorations.length=0;var e=this.createBitmapByName("bgImage");console.log("image_test",e),e.x=0,e.y=0,this.addChild(e),this.testSprite=new egret.Sprite,this.testSprite.x=200,this.testSprite.y=50,this._debugText=new egret.TextField,this._debugText.x=400,this.initConfig(),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.bgSound=RES.getRes("level_mp3"),this.bgChannel=this.bgSound.play(0,1),this.failSound=RES.getRes("fail_hit_mp3"),this.getCardSound=RES.getRes("get_card_mp3"),this.drawSound=RES.getRes("write_mp3"),this.hitSound=RES.getRes("good_hit_mp3"),this.toiletSound=RES.getRes("tolet_mp3"),this.gesture=new GestureController(this.stage,this.userGestureLayer),this.gesture.addEventListener(GestureEvent.GESTURE,this.onGesture,this),this.initAltar(),this.initPillar(),this.initDecoration(),this.headLayer.removeChildren(),this.addChild(this.headLayer),this.addChild(this.userGestureLayer),this.addOneRole(),this.helpSprite=new egret.Sprite,this.addChild(this.helpSprite),this.startTime()},i.initUI=function(){this._score=0,this._comboo=0,this._labelScore=new egret.TextField,this._txtScore=new egret.TextField,this._labelComboo=new egret.TextField,this._txtComboo=new egret.TextField,this._labelScore.text="分数",this._labelScore.x=10,this._txtScore.text="0",this._txtScore.x=100,this._labelComboo.text="连击",this._labelComboo.x=170,this._txtComboo.text="0",this._txtComboo.x=270,this.addChild(this._labelScore),this.addChild(this._txtScore),this.addChild(this._labelComboo),this.addChild(this._txtComboo)},i.updateUI=function(){this._txtScore.text=this._score.toString(),this._txtComboo.text=this._comboo.toString()},i.initConfig=function(){var e=RES.getRes("level_1_json");console.log(e),this._rhythmObjs=e,this._rhythmArr.length=0,this._rhythmTypeArr.length=0;for(var t=0,n=e.length;n>t;t++)this._rhythmArr.push(500*e[t].beat),this._rhythmTypeArr.push(e[t].action);console.log(this._rhythmArr.length,"aaaaaaaaaaaaa"),this._endIndex=this._rhythmArr.length},i.initRhythm=function(){for(var e=0;10>e;e++)this._rhythmArr.push(2e3*e),this._rhythmTypeArr.push(0);this._endIndex=this._rhythmArr.length},i.initAltar=function(){this.altar=new Altar,this.altar.x=300,this.altar.y=580,this.addChild(this.altar),this.altar.normal()},i.initPillar=function(){this._pillarArr.length=0;var e=new egret.Point(299,310),t=new egret.Point(453,424),n=new egret.Point(389,567),i=new egret.Point(202,569),r=new egret.Point(153,398);this._pillarArr.push(e),this._pillarArr.push(t),this._pillarArr.push(n),this._pillarArr.push(i),this._pillarArr.push(r)},i.initDecoration=function(){for(var e=0,t=this.decorationNames.length;t>e;e++){var n=new Decoration(this.decorationNames[e]);n.x=this.decorationPos[2*e],n.y=this.decorationPos[2*e+1]+120,this.decorations.push(n),this.addChild(n)}},i.goodTip=function(){this.testSprite.graphics.clear(),this.testSprite.graphics.beginFill(16776960),this.testSprite.graphics.drawCircle(0,0,30),this.testSprite.graphics.endFill()},i.perfectTip=function(){this.testSprite.graphics.clear(),this.testSprite.graphics.beginFill(16711680),this.testSprite.graphics.drawCircle(0,0,30),this.testSprite.graphics.endFill()},i.normalTip=function(){this.testSprite.graphics.clear(),this.testSprite.graphics.beginFill(255),this.testSprite.graphics.drawCircle(0,0,30),this.testSprite.graphics.endFill()},i.onTouchBegin=function(e){this._touching=!0,this._startTouchX=e.localX},i.onTouchEnd=function(e){this._touching=!1,this._touchedOver=!0;var n=e.localX-this._startTouchX;this._curTouchType==t.TYPE_TAP&&(n>0?this._touchType=1:this._touchType=2,console.log("touch",this._touchType))},i.onGesture=function(e){if(console.log("ongesture",e.data),!this._touched&&this._curTouchType==t.TYPE_GESTURE){var n=this._rhythmObjs[this._curIndex];console.log("ddddddddd",n.gesture,e.data),n.gesture==e.data?this._touchType=t.TYPE_GESTURE:this.missGesture()}},i.startTime=function(){this._curTime=0,this._curIndex=0,this._startGame=!0,this._curHitTime=this._rhythmArr[this._curIndex],this._curTouchType=this._rhythmTypeArr[this._curTouchType]},i.levelEnd=function(){GameData.score=this._score,GameData.comboo=this._comboo,GameData.maxComboo=this._maxComboo,GameData.maxComboo>GameData.globalMaxComboo&&(GameData.globalMaxComboo=GameData.maxComboo),GameData.score>GameData.globalMaxScore&&(GameData.globalMaxScore=GameData.score);var e=function(){this.toiletSound.play(0,1),this.dispose(),console.log("end end end "),this.next("levelScore")};this._startGame=!1;var t=this;console.log("end game");var n=new egret.Shape;n.graphics.beginFill(0),n.graphics.drawRect(0,0,600,960),n.graphics.endFill(),n.alpha=0,this.addChild(n),this.bgChannel&&this.bgChannel.stop();var i=egret.Tween.get(n);i.wait(2e3),i.to({alpha:1},5e3),i.wait(20),i.to({scaleX:1},1),i.call(e,t)},i.dispose=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.gesture.removeEventListener(GestureEvent.GESTURE,this.onGesture,this),this.removeChildren()},i.goodTouch=function(){this._touched=!0,this._touchedOver=!1,console.log("good touch"),this._comboo++,this._score+=10,this.altar.correct(),this.hitSound.play(0,1)},i.goodGesture=function(){this._touched=!0,this._touchedOver=!1,console.log("good gesture"),this._comboo++,this._score+=50,this.addOneToken(this.curTokenName),this.altar.correct()},i.perfectTouch=function(){this._touched=!0,this._touchedOver=!1,console.log("perfect touch")},i.missTouch=function(){this._comboo>this._maxComboo&&(this._maxComboo=this._comboo),this._touched=!0,this._touchedOver=!1,console.log("missing"),this._comboo=0,this.altar.wrong()},i.missGesture=function(){this.missTouch(),console.log("miss gesture"),this.addOneToken(),this.failSound.play(0,1)},i.nextRhythm=function(){if(this._curIndex++,this._touched||(this._curTouchType==t.TYPE_TAP?this.missTouch():this._curTouchType==t.TYPE_GESTURE&&this.missGesture()),this._drawed=!1,this._curHitTime=this._rhythmArr[this._curIndex],this._curTouchType=this._rhythmTypeArr[this._curIndex],this._touched=!1,this._touchType=-1,this._curTouchType==t.TYPE_GESTURE){var e=this._rhythmObjs[this._curIndex];this.goodTime=e.duration*this.hitStepTime,this.curTokenName=e.gesture,console.log("gesture begin",this.curTokenName),this.gesture.start()}else this.goodTime=200,console.log("gesture over"),this.gesture.stop(),this._curTouchType==t.TYPE_LEFT?this.AllLeft():this._curTouchType==t.TYPE_RIGHT&&this.AllRight()},i.tick=function(e){if(this._startGame){for(this._curTime+=e,this._debugText.text=this._curTime.toString();this._curTime>this._curHitTime+this.goodTime&&this._curIndex<this._endIndex;)this.nextRhythm();if(this._curIndex>=this._endIndex&&this.levelEnd(),this._curTouchType==t.TYPE_TAP)this._curTime>this._curHitTime-this.perfectTime&&this._curTime<this._curHitTime+this.perfectTime?(this._perfectDuring=!0,this.goodTip()):(this._perfectDuring=!1,this._curTime>this._curHitTime-this.goodTime&&this._curTime<this._curHitTime+this.goodTime?(this._goodDuring=!0,this.goodTip()):(this._goodDuring=!1,this.normalTip())),this._goodDuring&&!this._touched&&this.checkTouchType(this._touchType)&&this.goodTouch();else if(this._curTouchType==t.TYPE_DRAW)this._curTime>this._curHitTime&&this.drawHelp(this._curIndex);else if(this._curTouchType==t.TYPE_CLEAR)this._curTime>this._curHitTime&&this.clearHelp();else if(this._curTouchType==t.TYPE_GESTURE){var n=this._rhythmObjs[this._curIndex];this._curTime>this._curHitTime&&this._curTime<this._curHitTime+n.duration*this.hitStepTime?this._goodDuring=!0:this._goodDuring=!1,this._goodDuring&&!this._touched&&this.checkTouchType(this._touchType)&&this.goodGesture()}this.hitStep(this._curTime),dragonBones.WorldClock.clock.advanceTime(e/1e3)}},i.checkTouchType=function(e){if(0==this._curTouchType){if(e>=0)return!0}else if(this._curTouchType==e)return!0;return!1},i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},i.addHeadTo=function(e,t){var n=this._pillarArr[t].x,i=this._pillarArr[t].y;e.x=n,e.y=i+120,this.heads.push(e),this.headLayer.addChild(e)},i.createHead=function(e){return new Head(e)},i.hitStep=function(e){var t=Math.floor(e/this.hitStepTime);return t!=this._curHitIndex?(this._curHitIndex=t,void this.AllHit()):void 0},i.AllHit=function(){for(var e=0,t=this.heads.length;t>e;e++)this.heads[e].play();for(e=0,t=this.roles.length;t>e;e++)this.roles[e].play("hit");var n=this.playDecorationNum<this.decorations.length?this.playDecorationNum:this.decorations.length;for(e=0,t=n;t>e;e++)this.decorations[e].play()},i.AllLeft=function(){for(var e=0,t=this.heads.length;t>e;e++)this.heads[e].left();for(e=0,t=this.roles.length;t>e;e++)this.roles[e].play("left");var n=this.playDecorationNum<this.decorations.length?this.playDecorationNum:this.decorations.length;for(e=0,t=n;t>e;e++)this.decorations[e].play()},i.AllRight=function(){for(var e=0,t=this.heads.length;t>e;e++)this.heads[e].right();for(e=0,t=this.roles.length;t>e;e++)this.roles[e].play("right");var n=this.playDecorationNum<this.decorations.length?this.playDecorationNum:this.decorations.length;for(e=0,t=n;t>e;e++)this.decorations[e].play()},i.drawHelp=function(e){if(!this._drawed){this._drawed=!0;var t=this._rhythmObjs[e];this.helpSprite.graphics.lineStyle(20,16711680,1),this.helpSprite.graphics.moveTo(t.line[0],t.line[1]),this.helpSprite.graphics.lineTo(t.line[2],t.line[3]),this.drawSound.play(0,1)}},i.clearHelp=function(){this.helpSprite.graphics.clear()},i.addOneToken=function(e){void 0===e&&(e=null),this.getCardSound.play(0,1),this.tokens.length>=this.maxToken&&this.clearToken();var t;t=null==e?0:this.getTokenIndex(e)+1;var n=this.createToken(t);this.addToken(n),this.tokens.length>=this.maxToken&&this.addOneRole()},i.createToken=function(e){var t=this.createBitmapByName(this.tokenNames[e]);return t},i.addToken=function(e){this.tokens.push(e),e.x=100*this.tokens.length,e.y=800,this.addChild(e)},i.clearToken=function(){for(var e=0,t=this.tokens.length;t>e;e++)this.tokens[e].parent&&this.removeChild(this.tokens[e]);this.tokens.length=0},i.addOneRole=function(){var e=Math.floor(Math.random()*this.roleNames.length),t=this.createRole(e);if(this.addRole(t),this.heads.length<5){var n=this.createHead(this.headNames[e]);this.addHeadTo(n,this.heads.length)}},i.createRole=function(e){var t=this.roleNames[e],n=new Role(t);return n},i.addRole=function(e){this.roles.push(e),e.play("hit"),e.x=120*this.roles.length-60,e.y=200,this.addChild(e)},i.clearRole=function(){for(var e=0,t=this.roles.length;t>e;e++)this.roles[e].remove(),this.roles[e].parent&&this.removeChild(this.roles[e]);this.roles.length=0},i.getTokenIndex=function(e){switch(e){case"v":return 0;case"caret":return 1;case"x":return 2;case"delete":return 3;case"triangle":return 4;case"left square bracket":return 5;case"right square bracket":return 6;case"rectangle":return 7;case"star":return 8;case"arrow":return 9;default:return 0}},t.TYPE_TAP=0,t.TYPE_DRAW=-1,t.TYPE_CLEAR=-2,t.TYPE_GESTURE=3,t.TYPE_RIGHT=1,t.TYPE_LEFT=2,t}(State);egret.registerClass(Level1,"Level1");var LevelEnd=function(e){function t(){e.call(this),this.bg=this.createBitmapByName("ending_png"),this.bg.x=300,this.bg.y=480,this.addChild(this.bg)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t},t}(State);egret.registerClass(LevelEnd,"LevelEnd");var LevelInfo=function(e){function t(){e.call(this),this.imageNames=["info0_jpg","info1_jpg","info2_jpg","info3_jpg","info4_jpg","info5_jpg","info6_jpg","info7_jpg","info8_jpg","info9_jpg","info10_jpg"],this.images=[],this.centerX=300,this.centerY=480,this.bg1Sound=RES.getRes("title_bg_1_mp3"),this.bg2Sound=RES.getRes("title_bg_2_mp3")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){e.prototype.init.call(this),this.bg1Channel=this.bg1Sound.play(0,1);var t,n;for(t=0,n=this.imageNames.length;n>t;t++){var i=this.createBitmapByName(this.imageNames[t]);this.images.push(i),i.x=this.centerX,i.y=this.centerY,this.addChild(i),i.visible=!1}this._curIndex=0,this.images[this._curIndex].visible=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.dispose=function(){this.removeChildren(),this.images.length=0,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.onTouchBegin=function(e){if(this._curIndex++,7==this._curIndex&&(this.bg1Channel&&this.bg1Channel.stop(),this.bg2Channel=this.bg2Sound.play(0,1)),this._curIndex>=this.imageNames.length)return void this.over();var t,n;for(t=0,n=this.images.length;n>t;t++){var i=this.images[t];i.visible=!1}this.images[this._curIndex].visible=!0},i.over=function(){this.dispose(),this.next("levelTitle")},i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t},t}(State);egret.registerClass(LevelInfo,"LevelInfo");var LevelOver=function(e){function t(t){e.call(this),this.infoArr=["程序员：苏魁","美术：李孟","策划：李经纬","美术：李治","策划：张晨"],this._curTime=0,this._curIndex=0,this.name=t}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){switch(e.prototype.init.call(this),this.bg=this.createBitmapByName(this.name+"_bg_png"),this.bg.x=300,this.bg.y=480,this.addChild(this.bg),console.log("aaaaaaa",this.name),this.role=new Role(this.name,.8),this.role.x=300,this.role.y=700,this.addChild(this.role),this.txtInfo=new egret.TextField,this.txtInfo.x=10,this.txtInfo.y=520,this.name){case"kui":this.txtInfo.text=this.infoArr[0],this.playSound();break;case"meng":this.txtInfo.text=this.infoArr[1];break;case"wei":this.txtInfo.text=this.infoArr[2];break;case"zhi":this.txtInfo.text=this.infoArr[3];break;case"lei":this.txtInfo.text=this.infoArr[4]}this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.playSound=function(){t.bgSound=RES.getRes("level_mp3"),t.bgChannel=t.bgSound.play(0,1)},i.dispose=function(){this.role.remove(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.removeChildren()},i.onTouchBegin=function(e){this.dispose(),this.over()},i.over=function(){},i.tick=function(e){if(this._curTime+=e,this._curTime>500){for(;this._curTime>500;)this._curTime-=500,this._curIndex+=1,this._curIndex>=3&&(this._curIndex=0);this.play()}dragonBones.WorldClock.clock.advanceTime(e/1e3)},i.play=function(){0==this._curIndex?this.role.play("hit"):1==this._curIndex?this.role.play("left"):this.role.play("right")},i.creatBg=function(e){},i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t},t}(State);egret.registerClass(LevelOver,"LevelOver");var LevelOver0=function(e){function t(){e.call(this,"kui")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.over=function(){this.next("levelOver1")},t}(LevelOver);egret.registerClass(LevelOver0,"LevelOver0");var LevelOver1=function(e){function t(){e.call(this,"meng")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.over=function(){this.next("levelOver2")},t}(LevelOver);egret.registerClass(LevelOver1,"LevelOver1");var LevelOver2=function(e){function t(){e.call(this,"wei")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.over=function(){this.next("levelOver3")},t}(LevelOver);egret.registerClass(LevelOver2,"LevelOver2");var LevelOver3=function(e){function t(){e.call(this,"zhi")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.over=function(){this.next("levelOver4")},t}(LevelOver);egret.registerClass(LevelOver3,"LevelOver3");var LevelOver4=function(e){function t(){e.call(this,"lei")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.over=function(){this.stopSound(),this.next("levelThanks")},i.stopSound=function(){LevelOver.bgChannel&&LevelOver.bgChannel.stop()},t}(LevelOver);egret.registerClass(LevelOver4,"LevelOver4");var LevelScore=function(e){function t(){e.call(this),this.centerX=300,this.centerY=480,this.score0=this.createBitmapByName("S_png"),this.score1=this.createBitmapByName("A_png"),this.score2=this.createBitmapByName("B_png"),this.score3=this.createBitmapByName("C_png"),this.score4=this.createBitmapByName("D_png"),this.txtScore=new egret.TextField,this.txtComboo=new egret.TextField}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){GameData.score>1500?this.curScore=this.score0:GameData.score>1e3?this.curScore=this.score1:GameData.score>800?this.curScore=this.score2:GameData.score>500?this.curScore=this.score3:this.curScore=this.score4,this.curScore.x=this.centerX,this.curScore.y=this.centerY,this.addChild(this.curScore),this.txtScore.text=GameData.score.toString(),this.txtComboo.text=GameData.maxComboo.toString(),this.txtScore.x=350,this.txtScore.y=400,this.txtComboo.x=350,this.txtComboo.y=450,this.addChild(this.txtScore),this.addChild(this.txtComboo),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.onTouchBegin=function(e){this.dispose(),this.next("levelOver0")},i.dispose=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.removeChildren()},i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t},t}(State);egret.registerClass(LevelScore,"LevelScore");var LevelStroy=function(e){function t(){e.call(this),this.imageNames=["story0_png","story1_png","story2_png"],this.images=[],this.centerX=300,this.centerY=480}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){var e,t;for(e=0,t=this.imageNames.length;t>e;e++){var n=this.createBitmapByName(this.imageNames[e]);this.images.push(n),n.x=this.centerX,n.y=this.centerY,this.addChild(n),n.visible=!1}this._curIndex=0,this.images[this._curIndex].visible=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.dispose=function(){this.removeChildren(),this.images.length=0,this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.onTouchBegin=function(e){if(this._curIndex++,this._curIndex>=this.imageNames.length)return void this.over();var t,n;for(t=0,n=this.images.length;n>t;t++){var i=this.images[t];i.visible=!1}this.images[this._curIndex].visible=!0},i.over=function(){this.dispose(),this.next("level1")},i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t},t}(State);egret.registerClass(LevelStroy,"LevelStroy");var LevelThanks=function(e){function t(){e.call(this),this.bg=this.createBitmapByName("thanks_png"),this.bg.x=300,this.bg.y=480}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){this.addChild(this.bg),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.onTouchBegin=function(e){this.dispose(),this.next("levelEnd")},i.dispose=function(){this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t},t}(State);egret.registerClass(LevelThanks,"LevelThanks");var LevelTitle=function(e){function t(){e.call(this),this.imageNames=["title_1_png","title_2_png","title_3_png","title_4_png"],this.images=[],this.centerX=300,this.centerY=480}__extends(t,e);var n=(__define,t),i=n.prototype;return i.init=function(){e.prototype.init.call(this),this.bgSound=RES.getRes("sound_test"),this.bgChannel=this.bgSound.play(0,1),this.bg=this.createBitmapByName("title_bg_jpg"),this.bg.x=this.centerX,this.bg.y=this.centerY,this.addChild(this.bg);var t,n;for(t=0,n=this.imageNames.length;n>t;t++){var i=this.createBitmapByName(this.imageNames[t]);this.images.push(i),i.x=this.centerX,0==t?i.y=this.centerY:1==t?i.y=this.centerY:2==t?i.y=this.centerY:i.y=this.centerY+350,this.addChild(i),i.visible=!1}this._curIndex=0,this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.onTouchBegin=function(e){return this._curIndex<this.images.length&&(this.images[this._curIndex].visible=!0),this._curIndex++,console.log(this._curIndex,this.images.length),this._curIndex>this.images.length?void this.over():void 0},i.dispose=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.bgChannel&&this.bgChannel.stop()},i.over=function(){this.dispose(),this.next("story")},i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t},t}(State);egret.registerClass(LevelTitle,"LevelTitle");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},i.setProgress=function(e,t){this.textField.text="仪式筹备中"+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},i.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},i.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.addChild(new Game))},i.createBg=function(){var e=new egret.Shape;e.graphics.beginFill(16751001),e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight);var t=RES.getRes("sound_test");console.log("aaa",t);var n=this.createBitmapByName("image_test");console.log("image_test",n),n.x=100,n.y=200},i.createLog=function(){var e=new egret.TextField;e.text="width:"+this.stage.stageWidth+"\n,"+this.stage.stageHeight,e.y=300,this.addChild(e)},i.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},i.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},i.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},i.createGameScene=function(){var e=this.createBitmapByName("bgImage");this.addChild(e);var t=this.stage.stageWidth,n=this.stage.stageHeight;e.width=t,e.height=n;var i=new egret.Shape;i.graphics.beginFill(0,.5),i.graphics.drawRect(0,0,t,n),i.graphics.endFill(),i.width=t,i.height=n,this.addChild(i);var r=this.createBitmapByName("egretIcon");this.addChild(r),r.scaleX=.55,r.scaleY=.55,r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2,r.x=t/2,r.y=n/2-60;var o=new egret.TextField;o.textColor=16777215,o.textAlign="center",o.text="Hello Egret",o.size=20,o.x=t-o.width>>1,o.y=(n-o.height>>1)+50,this.addChild(o);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=t,s.textAlign=egret.HorizontalAlign.CENTER,s.x=0,s.y=n/2+100,this.textfield=s;var g=this.createBitmapByName("image_test");this.addChild(g),g.scaleX=.55,g.scaleY=.55,g.anchorOffsetX=g.width/2,g.anchorOffsetY=g.height/2,g.x=t/2,g.y=n/2-60,RES.getResAsync("description",this.startAnimation,this)},i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},i.startAnimation=function(e){for(var t=this,n=new egret.HtmlTextParser,i=[],r=0;r<e.length;r++)i.push(n.parser(e[r]));var o=t.textfield,s=-1,g=function(){s++,s>=i.length&&(s=0);var e=i[s];t.changeDescription(o,e);var n=egret.Tween.get(o);n.to({alpha:1},200),n.wait(2e3),n.to({alpha:0},200),n.call(g,t)};g()},i.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Altar=function(e){function t(){e.call(this);
var t="altar",n=RES.getRes(t+"_json"),i=RES.getRes(t+"_texture_json"),r=RES.getRes(t+"_texture_png");console.log(n),console.log(i),console.log(r);var o=new dragonBones.EgretFactory;o.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(n)),o.addTextureAtlas(new dragonBones.EgretTextureAtlas(r,i)),this.armature=o.buildArmature(t);var s=this.armature.display;dragonBones.WorldClock.clock.add(this.armature),this.addChild(s)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.play=function(e){this.armature.animation.gotoAndPlay(e,0,-1,1)},i.normal=function(){this.play("normal")},i.correct=function(){this.play("correct")},i.wrong=function(){this.play("wrong")},i.remove=function(){dragonBones.WorldClock.clock.remove(this.armature)},t}(egret.Sprite);egret.registerClass(Altar,"Altar");var Head=function(e){function t(t){e.call(this),this.bmp=this.createBitmapByName(t),this.bmp.anchorOffsetX=this.bmp.width/2,this.bmp.anchorOffsetY=this.bmp.height/2,this.bmp.scaleX=.5,this.bmp.scaleY=.5,this.addChild(this.bmp)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.play=function(){var e=egret.Tween.get(this.bmp);e.to({scaleX:.4},200),e.wait(20),e.to({scaleX:.5},1);var t=egret.Tween.get(this.bmp);t.to({scaleY:.4},200),t.wait(20),t.to({scaleY:.5},1)},i.left=function(){var e=egret.Tween.get(this.bmp);e.to({rotation:90},200),e.wait(20),e.to({rotation:0},1)},i.right=function(){var e=egret.Tween.get(this.bmp);e.to({rotation:-90},200),e.wait(20),e.to({rotation:0},1)},i.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},t}(egret.Sprite);egret.registerClass(Head,"Head");var Decoration=function(e){function t(t){e.call(this,t)}__extends(t,e);var n=(__define,t);n.prototype;return t}(Head);egret.registerClass(Decoration,"Decoration");var Role=function(e){function t(t,n){void 0===t&&(t="man0"),void 0===n&&(n=.35),e.call(this),this.name=t,this._scale=n,console.log("name armature",t);var i=RES.getRes(t+"_json"),r=RES.getRes(t+"_texture_json"),o=RES.getRes(t+"_texture_png");console.log(i),console.log(r),console.log(o);var s=new dragonBones.EgretFactory;s.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(i)),s.addTextureAtlas(new dragonBones.EgretTextureAtlas(o,r)),this.armature=s.buildArmature(t);var g=this.armature.display;g.scaleX=this._scale,g.scaleY=this._scale,dragonBones.WorldClock.clock.add(this.armature),this.addChild(g)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.play=function(e){"right"==e?"meng"==this.name?(this.armature.animation.gotoAndPlay("right",0,-1,1),this.scaleX=1):(this.armature.animation.gotoAndPlay("left",0,-1,1),this.scaleX=-1):"left"==e?"meng"==this.name?(this.armature.animation.gotoAndPlay("right",0,-1,1),this.scaleX=-1):(this.armature.animation.gotoAndPlay("left",0,-1,1),this.scaleX=1):this.armature.animation.gotoAndPlay(e,0,-1,1)},i.remove=function(){dragonBones.WorldClock.clock.remove(this.armature)},t}(egret.Sprite);egret.registerClass(Role,"Role");var StateEvent=function(e){function t(t,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1),e.call(this,t,i,r),this.data=n}__extends(t,e);var n=(__define,t);n.prototype;return t.NEXT="NEXT",t}(egret.Event);egret.registerClass(StateEvent,"StateEvent");var StateManager=function(){function e(e){this._parent=e,this._stateObj={}}var t=(__define,e),n=t.prototype;return n.startTick=function(){this._curTime=egret.getTimer(),egret.startTick(this.tick,this)},n.stopTick=function(){egret.stopTick(this.tick,this)},n.tick=function(e){return this._lastTime=this._curTime,this._curTime=e,this._curState&&this._curState.tick(this._curTime-this._lastTime),!0},n.registerState=function(e,t){this._stateObj[e]=t},n.setCurStateName=function(e){var t=this._stateObj[e];t&&this.setCurState(t)},n.setCurState=function(e){this._curState&&(this._curState.removeEventListener(StateEvent.NEXT,this.onNext,this),this._prevState=this._curState),this._curState=e,this._curState.show(this._parent),this._curState.addEventListener(StateEvent.NEXT,this.onNext,this)},n.onNext=function(e){var t=this._stateObj[e.data];t&&this.setCurState(t)},e}();egret.registerClass(StateManager,"StateManager");