var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},State=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.prototype.onAdded=function(t){this.init()},e.prototype.init=function(){console.log("this is a state")},e.prototype.show=function(t){t.addChild(this)},e.prototype.next=function(t){this.dispatchEvent(new StateEvent(StateEvent.NEXT,t)),parent&&this.parent.removeChild(this)},e.prototype.returnToLast=function(){this.dispatchEvent(new StateEvent(StateEvent.LAST,null)),this.parent&&this.parent.removeChild(this)},e.prototype.tick=function(t){},e.prototype.dispose=function(){},e.prototype.destroy=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this)},e}(egret.DisplayObjectContainer);__reflect(State.prototype,"State",["IState","egret.IEventDispatcher"]);var StateBG=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.stageWidth=this.stage.stageWidth,this.stageHeight=this.stage.stageHeight,this.halfStageWidth=this.stageWidth/2,this.halfStageHeight=this.stageHeight/2},Object.defineProperty(e.prototype,"bg",{set:function(t){this.background=App.asset.getBitmap(t),this.background&&this.stage&&(this.background.x=this.stageWidth/2,this.background.y=this.stageHeight/2,this.addChild(this.background))},enumerable:!0,configurable:!0}),e}(State);__reflect(StateBG.prototype,"StateBG");var RPC=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.initSocket=function(t,e,r,n){this._socket=new r;var o=new n;this._socket.initServer(t,e,o),this._socket.messageCenter=this,this._socket.connect()},e.prototype.socketSend=function(t){this._socket.send(t)},e.EVENT_ENTER_ROOM="EVENT_ENTER_ROOM",e.EVENT_START_GAME="EVENT_START_GAME",e.EVENT_GAME_EVENT="EVENT_GAME_EVENT",e.EVENT_PLAYER_LEAVE="EVENT_PLAYER_LEAVE",e.EVENT_RECEIVE_FAIL="EVENT_RECEIVE_FAIL",e}(egret.EventDispatcher);__reflect(RPC.prototype,"RPC");var TimerManager=function(){function t(){this._handlers=new Array,this._delHandlers=new Array,this._currTime=egret.getTimer(),this._currFrame=0,this._count=0,this._timeScale=1,egret.Ticker.getInstance().register(this.onEnterFrame,this)}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.setTimeScale=function(t){this._timeScale=t},t.prototype.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer();for(var t=0;t<this._count;t++){var e=this._handlers[t],r=e.userFrame?this._currFrame:this._currTime;r>=e.exeTime&&(e.method.call(e.methodObj,(this._currTime-e.dealTime)*this._timeScale),e.dealTime=this._currTime,e.exeTime+=e.delay,e.repeat||(e.repeatCount>1?e.repeatCount--:(e.complateMethod&&e.complateMethod.apply(e.complateMethodObj),this._delHandlers.push(e))))}for(;this._delHandlers.length;){var e=this._delHandlers.pop();this.remove(e.method,e.methodObj)}},t.prototype.create=function(t,e,r,n,o,i,a){if(!(0>e||0>r||null==n)){this.remove(n,o);var s=ObjectPool.pop(TimerHandler,"TimerHandler");s.userFrame=t,s.repeat=0==r,s.repeatCount=r,s.delay=e,s.method=n,s.methodObj=o,s.complateMethod=i,s.complateMethodObj=a,s.exeTime=e+(t?this._currFrame:this._currTime),s.dealTime=this._currTime,this._handlers.push(s),this._count++}},t.prototype.doTimer=function(t,e,r,n,o,i){void 0===o&&(o=null),void 0===i&&(i=null),this.create(!1,t,e,r,n,o,i)},t.prototype.doFrame=function(t,e,r,n,o,i){void 0===o&&(o=null),void 0===i&&(i=null),this.create(!0,t,e,r,n,o,i)},Object.defineProperty(t.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),t.prototype.remove=function(t,e){for(var r=0;r<this._count;r++){var n=this._handlers[r];if(n.method==t&&n.methodObj==e){this._handlers.splice(r,1),ObjectPool.push(n),this._count--;break}}},t.prototype.removeAll=function(t){for(var e=0;e<this._count;e++){var r=this._handlers[e];r.methodObj==t&&(this._handlers.splice(e,1),ObjectPool.push(r),this._count--,e--)}},t.prototype.isExists=function(t,e){for(var r=0;r<this._count;r++){var n=this._handlers[r];if(n.method==t&&n.methodObj==e)return!0}return!1},t}();__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function t(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}return t.prototype.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},t}();__reflect(TimerHandler.prototype,"TimerHandler");var DisplayUtils=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.createBitmap=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},t.prototype.createEuiImage=function(t){var e=new eui.Image,r=RES.getRes(t);return e.source=r,e},t.prototype.removeFromParent=function(t){null!=t.parent&&t.parent.removeChild(t)},t.prototype.quickAddChild=function(t,e){e.$parent!=t&&(t.$children.push(e),e.$parent=t)},t.prototype.quickRemoveChild=function(t){var e=t.$parent;if(e){var r=e.$children.indexOf(t);e.$children.splice(r,1),t.$parent=null}},t}();__reflect(DisplayUtils.prototype,"DisplayUtils");var DataCenter=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gameURL="http://sucresk.github.io/ggj2018/",e.userName="nobody",e.stores=[],e.curAvatars=[],e.hasDance=!1,e.headStores=[],e.bodyStores=[],e.armStores=[],e.legStores=[],e.comboo=0,e.inviteRoomId=-1,e.inviteGameType=-1,e.logined=!1,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.initConfig=function(t,e){this.gameConfigs=t.game},e.prototype.initAvatarConfig=function(t){this.avatarConfigs=t.avatar},e.prototype.initStore=function(t){this.stores=t;var e,r;for(e=0,r=this.stores.length;r>e;e++)this.addStore(this.stores[e])},Object.defineProperty(e.prototype,"playerAvatars",{get:function(){return(null==this._playAvatars||this._playAvatars.length<=0)&&(this._playAvatars=this.randomAvatar()),this._playAvatars},set:function(t){this._playAvatars=t},enumerable:!0,configurable:!0}),e.prototype.addStore=function(t){var e=this.getAvatarPartConfig(t);if(e)switch(e.slot){case"head":this.headStores.push(e);break;case"body":this.bodyStores.push(e);break;case"leg":this.legStores.push(e);break;case"arm":this.armStores.push(e)}},e.prototype.getAllAvatarPart=function(){var t,e,r,n=App.data.avatarConfigs.length,o=[];for(r=0;n>r;r++)for(t=0,e=4;e>t;t++){var i=r,a=App.data.avatarConfigs[i];o.push(a.id+"_"+t)}return o},e.prototype.changePart=function(t){var e,r,n=this.getPartType(t);for(e=0,r=this.curAvatars.length;r>e;e++)if(this.getPartType(this.curAvatars[e])==n)return void(this.curAvatars[e]=t)},e.prototype.getPartType=function(t){var e=t.split("_");return e[1]},e.prototype.randomAvatar=function(){var t,e,r=App.data.avatarConfigs.length,n=[];for(t=0,e=4;e>t;t++){var o=Math.floor(Math.random()*r),i=App.data.avatarConfigs[o];n.push(i.id+"_"+t)}return n},e.prototype.getAvatarPartConfig=function(t){var e=t.split("_"),r=parseInt(e[0]),n=this.getAvatarConfig(r),o="";switch(e[1]){case"0":o="head";break;case"1":o="body";break;case"2":o="leg";break;case"3":o="arm";break;default:o="arm"}if(n){var i={id:t,name:"",db:n.asset,slot:o};return i}return null},e.prototype.getAvatarPartID=function(t){var e=-1;switch(t.slot){case"head":e=0;break;case"body":e=1;break;case"leg":e=2;break;case"arm":e=3}return e>=0?t.id+"_"+e:null},e.prototype.getItemConfig=function(t){var e,r;if(this.itemConfigs)for(e=0,r=this.itemConfigs.length;r>e;e++)if(this.itemConfigs[e].id==t)return this.itemConfigs[e];return null},e.prototype.getGameConfig=function(t){var e,r;for(e=0,r=this.gameConfigs.length;r>e;e++)if(this.gameConfigs[e].id==t)return this.gameConfigs[e];return null},e.prototype.getAvatarConfig=function(t){var e,r;for(e=0,r=this.avatarConfigs.length;r>e;e++)if(this.avatarConfigs[e].id==t)return this.avatarConfigs[e];return null},e.prototype.getCurGame=function(){return this.getGameConfig(this.curGameId)},e.prototype.init=function(t){},e}(egret.EventDispatcher);__reflect(DataCenter.prototype,"DataCenter");var AssetManager=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._gameAssetMap={},e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.getBitmap=function(t,e,r){void 0===e&&(e=!0),void 0===r&&(r=!0);var n=new egret.Bitmap,o=RES.getRes(t);return n.texture=o,e&&(n.anchorOffsetX=n.width/2),r&&(n.anchorOffsetY=n.height/2),n},e.prototype.getSound=function(t){return RES.getRes(t)},e.prototype.loadDBAnimation=function(t){var r,n,o,i;for(r=0,n=t.length;n>r;r+=2){o=t[r],i=parseInt(t[r+1]);var a=RES.getRes(o+"_ske_json");if(a&&e.dbFactory.parseDragonBonesData(a),1==i){console.log("naaa",o);var s=RES.getRes(o+"_tex_json"),u=RES.getRes(o+"_tex_png");e.dbFactory.parseTextureAtlasData(s,u)}else{var h=void 0;for(h=0;i>h;h++){var s=RES.getRes(o+"_tex_"+h+"_json"),u=RES.getRes(o+"_tex_"+h+"_png");e.dbFactory.parseTextureAtlasData(s,u)}}}},e.prototype.disposeDBAnimation=function(t){var r,n,o;for(r=0,n=t.length;n>r;r+=2){o=t[r];var i=RES.getRes(o+"_ske_json"),a=i.name;e.dbFactory.removeDragonBonesData(a),e.dbFactory.removeTextureAtlasData(a)}},e.prototype.getArmatureDisplay=function(t,r){void 0===r&&(r=!0);var n=e.dbFactory.buildArmature(t);return n.display},e.prototype.getDBArmature=function(t,r){void 0===r&&(r=!0);var n=e.dbFactory.buildArmature(t),o=new DBArmature(n,r);return o},e.prototype.changeTexture=function(t,e){var r=t.width,n=t.height;t.texture=RES.getRes(e),t.width=r,t.height=n},e.prototype.setText=function(t,e){t.text=e,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2},e.prototype.loadGameAsset=function(t){this._gameAssetMap[t]?this.dispatchEventWith(e.EVENT_LOAD_COMPLETE):(this._curLoadingGroup=t,RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/"+t+".res.json","resource/"))},e.prototype.disposeGameAsset=function(t){var e=RES.getRes(t+"DBConfig_json");App.asset.disposeDBAnimation(e.db),RES.destroyRes(t),this._gameAssetMap[t]=!1,delete this._gameAssetMap[t]},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup(this._curLoadingGroup)},e.prototype.onResourceLoadComplete=function(t){if(t.groupName==this._curLoadingGroup){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this);var r=RES.getRes(this._curLoadingGroup+"DBConfig_json");r&&App.asset.loadDBAnimation(r.db),this._gameAssetMap[this._curLoadingGroup]=!0,this._curLoadingGroup=null,this.dispatchEventWith(e.EVENT_LOAD_COMPLETE)}},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.dispatchEventWith(e.EVENT_LOAD_ERROR)},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load"),this.dispatchEventWith(e.EVENT_LOAD_ERROR)},e.prototype.onResourceProgress=function(t){if(t.groupName==this._curLoadingGroup){var r=t.itemsLoaded/t.itemsTotal;this.dispatchEventWith(e.EVENT_LOAD_ERROR,!1,r)}},e.EVENT_LOAD_COMPLETE="EVENT_LOAD_COMPLETE",e.EVENT_LOAD_PROGRESS="EVENT_LOAD_PROGRESS",e.EVENT_LOAD_ERROR="EVENT_LOAD_ERROR",e.dbFactory=new dragonBones.EgretFactory,e}(egret.EventDispatcher);__reflect(AssetManager.prototype,"AssetManager");var DBButtonBase=function(t){function e(e){var r=t.call(this)||this;return r.touchEnabled=!0,r._armature=e,r._armature.gotoAndStop("normal"),r.addChild(r._armature),r}return __extends(e,t),Object.defineProperty(e.prototype,"label",{set:function(t){null==this.txtLabel&&(this.txtLabel=new egret.TextField,this.txtLabel.textAlign="center",this.txtLabel.width=this.width,this.txtLabel.x=-this.width/2,this.txtLabel.y=-(this.height-this.txtLabel.size)/2,this.addChild(this.txtLabel)),this.txtLabel.text=t},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(DBButtonBase.prototype,"DBButtonBase");var App=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.Default_Text_Size=32,e.rpc=RPC.instance,e.asset=AssetManager.instance,e.data=DataCenter.instance,e.timerManager=TimerManager.instance,e.DisplayUtils=DisplayUtils.instance,e}(egret.DisplayObjectContainer);__reflect(App.prototype,"App");var BaseSound=function(){function t(){this._cache={},this._loadingCache=new Array}return t.prototype.dealSoundTimer=function(){for(var t=egret.getTimer(),e=Object.keys(this._cache),r=0,n=e.length;n>r;r++){var o=e[r];this.checkCanClear(o)&&t-this._cache[o]>=SoundManager.CLEAR_TIME&&(delete this._cache[o],RES.destroyRes(o))}},t.prototype.getSound=function(t){var e=RES.getRes(t);if(e)this._cache[t]&&(this._cache[t]=egret.getTimer());else{if(-1!=this._loadingCache.indexOf(t))return null;this._loadingCache.push(t),RES.getResAsync(t,this.onResourceLoadComplete,this)}return e},t.prototype.onResourceLoadComplete=function(t,e){var r=this._loadingCache.indexOf(e);-1!=r&&(this._loadingCache.splice(r,1),this._cache[e]=egret.getTimer(),this.loadedPlay(e))},t.prototype.loadedPlay=function(t){},t.prototype.checkCanClear=function(t){return!0},t}();__reflect(BaseSound.prototype,"BaseSound");var SocketMessageManager=function(){function t(){this.dataType=egret.WebSocket.TYPE_BINARY,this._msgBuffer=new egret.ByteArray}return t.prototype.receive=function(t){var e=this.decode(t.getData());e&&t.dispatch(e.key,e.body)},t.prototype.decode=function(t){},t.prototype.encode=function(t){},t}();__reflect(SocketMessageManager.prototype,"SocketMessageManager");var GamePage=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.bg="bg_jpg",this.initIndex()},e.prototype.initIndex=function(){this.pageIndex=new PageIndex,this.addChild(this.pageIndex),this.pageIndex.y=this.stageHeight-this.pageIndex.height,this.pageIndex.btnAvatar.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAvatar,this),this.pageIndex.btnDance.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDance,this),this.pageIndex.btnStore.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStore,this)},e.prototype.onAvatar=function(t){this.next(Const.PAGE_AVATAR)},e.prototype.onDance=function(t){this.next(Const.PAGE_DANCE)},e.prototype.onStore=function(t){this.next(Const.PAGE_STORE)},e.prototype.tick=function(t){},e}(StateBG);__reflect(GamePage.prototype,"GamePage");var EgretSocket=function(){function t(){this._needReconnect=!1,this._maxReconnectCount=Number.MAX_VALUE,this._reconnectCount=0}return t.prototype.addEvents=function(){this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},t.prototype.removeEvents=function(){this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},t.prototype.dispatch=function(t,e){void 0===e&&(e=null),this.messageCenter&&this.messageCenter.dispatchEvent(new egret.Event(t,!1,!1,e))},t.prototype.onSocketOpen=function(){this._reconnectCount=0,this._isConnecting=!0,this._connectFlag?this.dispatch(SocketConst.SOCKET_RECONNECT):this.dispatch(SocketConst.SOCKET_CONNECT),this._connectFlag=!0},t.prototype.onSocketClose=function(){this._needReconnect?(this.reconnect(),this.dispatch(SocketConst.SOCKET_START_RECONNECT)):(this.close(),this.dispatch(SocketConst.SOCKET_CLOSE)),this._isConnecting=!1},t.prototype.onSocketError=function(){console.log("连接错误error"),this._needReconnect?this.reconnect():(this.close(),this.dispatch(SocketConst.SOCKET_NOCONNECT)),this._isConnecting=!1},t.prototype.onReceiveMessage=function(t){this._msg.receive(this)},t.prototype.getData=function(){if(this._msg.dataType==egret.WebSocket.TYPE_BINARY)return this._byteArray=new egret.ByteArray,this._socket.readBytes(this._byteArray),this._byteArray;var t=this._socket.readUTF(),e=JSON.parse(t);return e},t.prototype.initServer=function(t,e,r){this._host=t,this._port=e,this._msg=r},t.prototype.connect=function(){this._socket&&this.close(),this._socket=new egret.WebSocket,this._socket.type=this._msg.dataType,console.log("WebSocket: "+this._host," type:",this._msg.dataType),this.addEvents(),this._socket.connectByUrl(this._host)},t.prototype.reconnect=function(){this.close(),this._reconnectCount++,this._reconnectCount<this._maxReconnectCount?(this._connectFlag=!0,this.connect()):(this._reconnectCount=0,this._connectFlag?this.dispatch(SocketConst.SOCKET_CLOSE):this.dispatch(SocketConst.SOCKET_NOCONNECT))},t.prototype.send=function(t){if(!this._isConnecting)return void console.log("socket尚未连接！");var e=this._msg.encode(t);null!=e?this.sendData(e):console.log("encode error")},t.prototype.sendData=function(t){if(this._msg.dataType==egret.WebSocket.TYPE_BINARY){var e=t;e.position=0,this._socket.writeBytes(e,0,e.bytesAvailable);var r=e.readUTFBytes(e.bytesAvailable);JSON.parse(r)}else{var n=t;this._socket.writeUTF(n)}},t.prototype.close=function(){this.removeEvents(),this._socket.close(),this._socket=null,this._isConnecting=!1,this._connectFlag=!1},t.prototype.isConnecting=function(){return this._isConnecting},t.prototype.debugInfo=function(t){this.dispatch(SocketConst.SOCKET_DEBUG_INFO,t)},t}();__reflect(EgretSocket.prototype,"EgretSocket",["ISocket"]);var SocketConst=function(){function t(){}return t.SOCKET_CONNECT="SOCKET_CONNECT",t.SOCKET_RECONNECT="SOCKET_RECONNECT",t.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",t.SOCKET_CLOSE="SOCKET_CLOSE",t.SOCKET_DATA="SOCKET_DATA",t.SOCKET_NOCONNECT="SOCKET_NOCONNECT",t.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",t}();__reflect(SocketConst.prototype,"SocketConst");var DBArmature=function(t){function e(e,r){var n=t.call(this)||this;return n._playCallbackMap={},n.armature=e,n.armatureDisplay=e.display,n.addChild(n.armatureDisplay),r&&(n.addToClock(dragonBones.EgretFactory.factory.clock),n.autoClock=r),n}return __extends(e,t),e.prototype.addToClock=function(t){null!=this.curClock&&this.curClock.remove(this.armature),this.curClock=t,this.curClock&&this.curClock.add(this.armature),this.autoClock=!1},e.prototype.gotoAndStop=function(t){this.armature.animation.gotoAndStopByFrame(t)},e.prototype.play=function(t,e){void 0===e&&(e=0),this.curAnimationState=this.armature.animation.play(t,e)},e.prototype.stop=function(){this.armature.animation.stop()},e.prototype.replaceSlot=function(t,e){var r=this.armature.getSlot(t);r&&(r.display=e)},e.prototype.playOnce=function(t,e){void 0===e&&(e=null),this._playCallbackMap[t]=e,this.armatureDisplay.addEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onOnceComplete,this),this.play(t,1)},e.prototype.onOnceComplete=function(t){this.armatureDisplay.removeEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onOnceComplete,this);var e=this.armatureDisplay.animation.lastAnimationName;this._playCallbackMap[e]&&(this._playCallbackMap[e](),this._playCallbackMap[e]=null)},e.prototype.dispose=function(){},e}(egret.DisplayObjectContainer);__reflect(DBArmature.prototype,"DBArmature");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e._loopId=0,e._time=1,e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e.prototype.setTip=function(t){this._tip=t},e.prototype.setLoopTip=function(t){var e=this;this._tip=t,this.textField.text=t,0!=this._loopId&&clearInterval(this._loopId),this._loopId=setInterval(function(){e.textField.text=e._tip+" 等待时间："+ ++e._time},1e3)},e.prototype.destroy=function(){0!=this._loopId&&clearInterval(this._loopId),this.parent&&this.parent.removeChild(this)},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var SoundBg=function(t){function e(){var e=t.call(this)||this;return e._currBg="",e}return __extends(e,t),e.prototype.mute=function(){this._currSoundChannel&&(this._currSoundChannel.volume=0)},e.prototype.restoreVolume=function(){this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},e.prototype.stop=function(){this._currSoundChannel&&this._currSoundChannel.stop(),this._currSoundChannel=null,this._currSound=null,this._currBg=""},e.prototype.play=function(t){if(this._currBg!=t){this.stop(),this._currBg=t;var e=this.getSound(t);e&&this.playSound(e)}},e.prototype.playSound=function(t){this._currSound=t,this._currSoundChannel=this._currSound.play(0,0),this._currSoundChannel.volume=this._volume},e.prototype.setVolume=function(t){this._volume=t,this._currSoundChannel&&(this._currSoundChannel.volume=this._volume)},e.prototype.loadedPlay=function(t){this._currBg==t&&this.playSound(RES.getRes(t))},e.prototype.checkCanClear=function(t){return this._currBg!=t},e}(BaseSound);__reflect(SoundBg.prototype,"SoundBg");var SoundEffects=function(t){function e(){var e=t.call(this)||this;return e._playingEffects={},e}return __extends(e,t),e.prototype.play=function(t,e){if(void 0===e&&(e=!1),e||!this._playingEffects[t]){var r=this.getSound(t);r&&this.playSound(t,r)}},e.prototype.playSound=function(t,e){var r=e.play(0,1);r.once(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this),r.volume=this._volume,r.soundName=t,this._playingEffects[t]=r},e.prototype.onSoundComplete=function(t){var e=t.currentTarget,r=e.soundName;delete this._playingEffects[r]},e.prototype.stopSound=function(t){var e=this._playingEffects[t];e&&(e.stop(),delete this._playingEffects[t])},e.prototype.setVolume=function(t){this._volume=t},e.prototype.loadedPlay=function(t){this.playSound(t,RES.getRes(t))},e}(BaseSound);__reflect(SoundEffects.prototype,"SoundEffects");var SoundManager=function(){function t(){this.bgOn=!0,this.effectOn=!0,this.bgVolume=.5,this.effectVolume=.5,this.bg=new SoundBg,this.bg.setVolume(this.bgVolume),this.effect=new SoundEffects,this.effect.setVolume(this.effectVolume)}return Object.defineProperty(t,"instance",{get:function(){return null==t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.playEffect=function(t,e){void 0===e&&(e=!1),this.effectOn&&this.effect.play(t,e)},t.prototype.playBg=function(t){this.currBg=t,this.bgOn&&this.bg.play(t)},t.prototype.stopBg=function(){this.bg.stop()},t.prototype.muteBg=function(){this.bg.mute()},t.prototype.restoreVolumeBg=function(){this.bg.restoreVolume()},t.prototype.stopEffect=function(t){this.effect.stopSound(t)},t.prototype.setEffectOn=function(t){this.effectOn=t},t.prototype.setBgOn=function(t){this.bgOn=t,this.bgOn?this.currBg&&this.playBg(this.currBg):this.stopBg()},t.prototype.setBgVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.bgVolume=t,this.bg.setVolume(this.bgVolume)},t.prototype.getBgVolume=function(){return this.bgVolume},t.prototype.setEffectVolume=function(t){t=Math.min(t,1),t=Math.max(t,0),this.effectVolume=t,this.effect.setVolume(this.effectVolume)},t.prototype.getEffectVolume=function(){return this.effectVolume},Object.defineProperty(t.prototype,"bgIsOn",{get:function(){return this.bgOn},enumerable:!0,configurable:!0}),t.CLEAR_TIME=18e4,t}();__reflect(SoundManager.prototype,"SoundManager");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){if(this.isThemeLoadEnd&&this.isResourceLoadEnd){var t=dragonBones.EgretFactory.factory;t.parseDragonBonesData(RES.getRes("ui_ske_json")),t.parseTextureAtlasData(RES.getRes("ui_tex_json"),RES.getRes("ui_tex_png")),t.parseDragonBonesData(RES.getRes("actor_ske_json")),t.parseTextureAtlasData(RES.getRes("actor_tex_json"),RES.getRes("actor_tex_png")),t.parseDragonBonesData(RES.getRes("woman1_ske_json")),t.parseTextureAtlasData(RES.getRes("woman1_tex_json"),RES.getRes("woman1_tex_png")),t.parseDragonBonesData(RES.getRes("man3_ske_json")),t.parseTextureAtlasData(RES.getRes("man3_tex_json"),RES.getRes("man3_tex_png"));var e=new Game(this.loadingView);this.addChild(e)}},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.startCreateScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,r=this.stage.stageHeight;t.width=e,t.height=r;var n=new egret.Shape;n.graphics.beginFill(0,.5),n.graphics.drawRect(0,0,e,172),n.graphics.endFill(),n.y=33,this.addChild(n);var o=this.createBitmapByName("egret_icon_png");this.addChild(o),o.x=26,o.y=33;var i=new egret.Shape;i.graphics.lineStyle(2,16777215),i.graphics.moveTo(0,0),i.graphics.lineTo(0,117),i.graphics.endFill(),i.x=172,i.y=61,this.addChild(i);var a=new egret.TextField;a.textColor=16777215,a.width=e-172,a.textAlign="center",a.text="Hello Egret",a.size=24,a.x=172,a.y=80,this.addChild(a);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=e-172,s.textAlign=egret.HorizontalAlign.CENTER,s.size=24,s.textColor=16777215,s.x=172,s.y=135,this.textfield=s,RES.getResAsync("description_json",this.startAnimation,this);var u=new eui.Button;u.label="Click!",u.horizontalCenter=0,u.verticalCenter=0,this.addChild(u),u.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.startAnimation=function(t){var e=this,r=new egret.HtmlTextParser,n=t.map(function(t){return r.parse(t)}),o=this.textfield,i=-1,a=function(){i++,i>=n.length&&(i=0);var t=n[i];o.textFlow=t;var r=egret.Tween.get(o);r.to({alpha:1},200),r.wait(2e3),r.to({alpha:0},200),r.call(a,e)};a()},e.prototype.onButtonClick=function(t){var e=new eui.Panel;e.title="Title",e.horizontalCenter=0,e.verticalCenter=0,this.addChild(e)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,r,n){function o(t){e.call(n,t)}function i(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),r.call(n))}return"undefined"!=typeof generateEUI?void egret.callLater(function(){e.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),void RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var StateDB=function(t){function e(e,r){void 0===r&&(r=null);var n=t.call(this)||this;return n.config=null,n.dbName=e,n.config=r,n.build(n.config),n}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.config.bg&&(this.bg=this.config.bg),this.armature.x=this.halfStageWidth,this.armature.y=this.halfStageHeight,this.addChild(this.armature),this.resize()},e.prototype.build=function(t){if(this.dbName)if(this.armature=App.asset.getDBArmature(this.dbName),this.armature){if(this.config)for(var e in this.config)this.buildComponent(e,this.config[e]);else for(var e in this)this.buildComponent(e,{});this.up=this.armature.armature.getBone("up"),this.middle=this.armature.armature.getBone("middle"),this.bottom=this.armature.armature.getBone("bottom")}else console.warn("no armature:",this.dbName)},e.prototype.resize=function(){this.bottom&&this.bottom.global.y>this.halfStageHeight&&(this.bottom.offset.y=this.halfStageHeight-this.bottom.global.y),this.up&&this.up.global.y<-this.halfStageHeight&&(this.up.offset.y=this.halfStageHeight-this.bottom.global.y)},e.prototype.buildComponent=function(t,r){r.name=t;var n=this.getComponentType(r);switch(n){case e.TYPE_ANIMATION_BUTTON:this.buildAnimButton(r);break;case e.TYPE_BUTTON:this.buildButton(r);break;case e.TYPE_LABEL_ANIMATION_BUTTON:this.buildLabelAnimButton(r);break;case e.TYPE_LABEL_BUTTON:this.buildLabelButton(r);break;case e.TYPE_PROGRESS:this.buildProgress(r);break;case e.TYPE_LABEL:this.buildLabel(r);break;case e.TYPE_TEXT:this.buildText(r);break;case e.TYPE_INPUT:this.buildInput(r);break;case e.TYPE_TOGGLE:this.buildToggle(r)}},e.prototype.getComponentType=function(t){var e=t.name;if(e){var r=e.substr(0,3);return r}return""},e.prototype.buildButton=function(t){var e=t.name,r=t.asset||e,n=App.asset.getDBArmature(r);if(n){var o=new DBButton(n);this.armature.replaceSlot(e,o),this[e]=o}},e.prototype.buildToggle=function(t){var e=t.name,r=t.asset||e,n=App.asset.getDBArmature(r);
if(n){var o=new DBToggle(n);this.armature.replaceSlot(e,o),this[e]=o}},e.prototype.buildLabelButton=function(t){var e=t.name,r=t.asset||e,n=App.asset.getDBArmature(r);if(n){var o=new DBButton(n);this.armature.replaceSlot(e,o);var i=this.getTextSizeAlign(e);o.label=t.label||e,o.txtLabel.size=i[0],this[e]=o}},e.prototype.buildAnimButton=function(t){var e=t.name,r=t.asset||e,n=App.asset.getDBArmature(r);if(n){var o=new DBAnimButton(n);this[e]=o,this.armature.replaceSlot(e,o)}},e.prototype.buildLabelAnimButton=function(t){var e=t.name,r=t.asset||e,n=App.asset.getDBArmature(r);if(n){var o=new DBAnimButton(n),i=this.getTextSizeAlign(e);o.label=t.label||e,o.txtLabel.size=i[0],this[e]=o,this.armature.replaceSlot(e,o)}},e.prototype.buildProgress=function(t){var e=t.name,r=t.asset||e,n=App.asset.getDBArmature(r);if(n){var o=new DBProgress(n);this[e]=o,this.armature.replaceSlot(e,o)}},e.prototype.buildLabel=function(t){var e=t.name,r=(t.asset||e,this.armature.armature.getSlot(e));if(r){var n=new egret.TextField;n.text=e,n.width=r.display.width,n.type=egret.TextFieldType.DYNAMIC;var o=this.getTextSizeAlign(e);n.size=o[0],n.textAlign=o[1],this[e]=n,this.armature.replaceSlot(e,n)}},e.prototype.buildText=function(t){console.log(t);var e=t.name,r=(t.asset||e,this.armature.armature.getSlot(e));if(r){var n=100,o=100;r.boundingBoxData&&(n=r.boundingBoxData.width,o=r.boundingBoxData.height,console.log(n,o));var i=new egret.TextField;i.textColor=0,i.width=n,i.height=o,i.anchorOffsetX=n/2,i.anchorOffsetY=o/2,i.type=egret.TextFieldType.DYNAMIC;var a=this.getTextSizeAlign(e);void 0!=t.size&&(a[0]=t.size),void 0!=t.textAlign&&(a[1]=t.textAlign),void 0!=t.verticalAlign&&(a[2]=t.verticalAlign),i.size=a[0],i.textAlign=a[1],i.verticalAlign=a[2],void 0!=t.boarder&&(i.border=t.boarder),void 0!=t.color&&(i.textColor=t.color),i.border=!0,i.text=e,this[e]=i,this.armature.replaceSlot(e,i)}},e.prototype.buildInput=function(t){var e=t.name,r=this.armature.armature.getSlot(e);if(r){var n=new egret.TextField;n.text=e,n.width=r.display.width,n.type=egret.TextFieldType.INPUT;var o=this.getTextSizeAlign(e);n.size=o[0],n.textAlign=o[1],this[e]=n,this.armature.replaceSlot(e,n)}},e.prototype.getTextSizeAlign=function(t){var e=20,r=t.split("_"),n=r.length,o=e,i=egret.HorizontalAlign.LEFT,a=egret.VerticalAlign.TOP;if(n>=2&&(o=parseInt(r[1]),(0>=o||void 0==o)&&(o=e)),n>=3)switch(n[2]){case"C":i=egret.HorizontalAlign.CENTER;break;case"R":i=egret.HorizontalAlign.RIGHT;break;case"L":default:i=egret.HorizontalAlign.LEFT}if(n>=4)switch(n[3]){case"M":a=egret.VerticalAlign.MIDDLE;break;case"B":a=egret.VerticalAlign.BOTTOM;break;case"T":default:a=egret.VerticalAlign.TOP}return[o,i,a]},e.prototype.buildError=function(t){console.log("[autoBuild] ",t," is fail!")},e.TYPE_ANIMATION_BUTTON="bta",e.TYPE_LABEL_ANIMATION_BUTTON="bat",e.TYPE_BUTTON="btn",e.TYPE_LABEL_BUTTON="btt",e.TYPE_PROGRESS="pro",e.TYPE_INPUT="lab",e.TYPE_LABEL="inp",e.TYPE_TOGGLE="tog",e.TYPE_TEXT="txt",e}(StateBG);__reflect(StateDB.prototype,"StateDB");var StateEUI=function(t){function e(e){var r=t.call(this)||this;return r.skinName=e,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAdded,r),r}return __extends(e,t),e.prototype.onAdded=function(t){this.init()},e.prototype.init=function(){console.log("this is a state")},e.prototype.show=function(t){t.addChild(this)},e.prototype.next=function(t){this.dispatchEvent(new StateEvent(StateEvent.NEXT,t)),this.parent&&this.parent.removeChild(this)},e.prototype.returnToLast=function(){this.dispatchEvent(new StateEvent(StateEvent.LAST,null)),this.parent&&this.parent.removeChild(this)},e.prototype.tick=function(t){},e.prototype.dispose=function(){},e.prototype.destroy=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this)},e}(eui.Component);__reflect(StateEUI.prototype,"StateEUI",["IState","egret.IEventDispatcher"]);var StateEvent=function(t){function e(e,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);var i=t.call(this,e,n,o)||this;return i.data=r,i}return __extends(e,t),e.NEXT="NEXT",e.LAST="LAST",e}(egret.Event);__reflect(StateEvent.prototype,"StateEvent");var StateManager=function(){function t(t){this._parent=t,this._stateObj={},this._stateMap={}}return t.prototype.startTick=function(){this._curTime=egret.getTimer(),egret.startTick(this.tick,this)},t.prototype.stopTick=function(){egret.stopTick(this.tick,this)},t.prototype.tick=function(t){return this._lastTime=this._curTime,this._curTime=t,this._curState&&this._curState.tick(this._curTime-this._lastTime),!0},t.prototype.registerState=function(t,e){this._stateMap[t]=e},t.prototype.getState=function(t){var e=this._stateObj[t];if(null==e){var r=this._stateMap[t],n=egret.getDefinitionByName(r);n&&(e=new n,this._stateObj[t]=e)}return null==e&&(console.log("create class fail: ",t),this.missState)?this.missState:e},t.prototype.setCurStateName=function(t){var e=this.getState(t);e&&this.setCurState(e)},t.prototype.setCurState=function(t){this._curState&&(this._curState.dispose(),this._curState.removeEventListener(StateEvent.NEXT,this.onNext,this),this._curState.removeEventListener(StateEvent.LAST,this.onLast,this),this._prevState=this._curState),this._curState=t,this._curState.show(this._parent),this._curState.addEventListener(StateEvent.NEXT,this.onNext,this),this._curState.addEventListener(StateEvent.LAST,this.onLast,this)},t.prototype.onNext=function(t){var e=this.getState(t.data);e&&this.setCurState(e)},t.prototype.onLast=function(t){this._prevState&&this.setCurState(this._prevState)},t.prototype.destoryState=function(t){var e=this.getState(t);e&&e.destroy(),this._stateObj[t]=null,this._stateMap[t]=null},t}();__reflect(StateManager.prototype,"StateManager");var DBAnimButton=function(t){function e(e){var r=t.call(this,e)||this;return r._armature.armatureDisplay.addEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,r.onAnimComplete,r),r.addEventListener(egret.TouchEvent.TOUCH_BEGIN,r.onTouch,r),r}return __extends(e,t),e.prototype.onTouch=function(t){this.touch()},e.prototype.onAnimComplete=function(t){this._armature.gotoAndStop("normal")},e.prototype.touch=function(){this._armature.play("touch")},e}(DBButtonBase);__reflect(DBAnimButton.prototype,"DBAnimButton");var DBButton=function(t){function e(e){var r=t.call(this,e)||this;return r.addEventListener(egret.TouchEvent.TOUCH_BEGIN,r.onTouchBegin,r),r}return __extends(e,t),e.prototype.onTouchBegin=function(t){this._armature.gotoAndStop("touch"),this.stage&&this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.onTouchEnd=function(t){this.stage&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._armature.gotoAndStop("normal")},e}(DBButtonBase);__reflect(DBButton.prototype,"DBButton");var Base64BitmapDataPool=function(){function t(){}return t.getData=function(t,e){var r=this.pools[t];if(r)r.useNum+=1,e(r.data);else{if(this.waitLoading[t])return void this.waitLoading[t].push(e);this.waitLoading[t]=[],this.waitLoading[t].push(e)}},t.reduceUseNum=function(t){var e=this.pools[t];e&&(e.useNum-=1)},t.pools={},t.waitLoading={},t}();__reflect(Base64BitmapDataPool.prototype,"Base64BitmapDataPool");var DBProgress=function(t){function e(e){var r=t.call(this)||this;return r._armature=e,r._armature.gotoAndStop("progress"),r.addChild(r._armature),r}return __extends(e,t),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress=t,this._progress>1&&(this._progress=1),this._progress<0&&(this._progress=0),this._armature.armature.animation.gotoAndStopByProgress("progress",this._progress)},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(DBProgress.prototype,"DBProgress");var DBToggle=function(t){function e(e){var r=t.call(this,e)||this;return r._selected=!1,r.addEventListener(egret.TouchEvent.TOUCH_BEGIN,r.onTouchBegin,r),r}return __extends(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t},enumerable:!0,configurable:!0}),e.prototype.onTouchBegin=function(t){this._armature.gotoAndStop(this._selected?"selectedTouch":"touch"),this.stage&&this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.onTouchEnd=function(t){this._selected=!this._selected,this.stage&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._armature.gotoAndStop(this._selected?"selectedNormal":"normal")},e}(DBButtonBase);__reflect(DBToggle.prototype,"DBToggle");var RoleAvatar=function(){function t(t,e,r){if(void 0===r&&(r="dbxiaoren00"),this._armature=App.asset.getDBArmature(r),this._headContainer=new egret.Sprite,this._head=new RoleHeadImage(e),this._head.x=.5*-this._head.width,this._head.y=.5*-this._head.height,this._headContainer.addChild(this._head),this._armature.replaceSlot("tou",this._headContainer),1!=t){var n=this.getDbRes(t),o=this.getAvatarRes(t),i=function(){if(this._armature){var t=AssetManager.dbFactory.getArmatureData(n);if(t){var e=t.defaultSkin;this._armature.replaceSkin(e),this._armature.replaceSlot("tou",this._headContainer)}}}.bind(this);RES.getRes(o[0])&&i()}}return Object.defineProperty(t.prototype,"avatarConfig",{get:function(){return RES.getRes("avatar_json")},enumerable:!0,configurable:!0}),t.prototype.getDbRes=function(t){return this.avatarConfig[t].res},t.prototype.getAvatarRes=function(t){var e=this.getDbRes(t);return[e+"_ske_json",e+"_tex_json",e+"_tex_png"]},Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._armature.dispose(),this._armature=null,this._head.dispose(),this._head=null},t}();__reflect(RoleAvatar.prototype,"RoleAvatar");var RoleHeadImage=function(t){function e(e,r,n,o){void 0===r&&(r="tou_png"),void 0===n&&(n=96),void 0===o&&(o=96);var i=t.call(this)||this;if(i.userBase64=!1,i.imgUrl=e,i.maskRes=r,i.bitmap=new egret.Bitmap,i.bitmap.width=n,i.bitmap.height=o,i.bitmap.texture=RES.getRes("tou_png"),i.addChild(i.bitmap),!i.imgUrl||!i.imgUrl.length)return i;if(-1==i.imgUrl.indexOf("https://")){var a=i.imgUrl.replace(".","_");return RES.getResAsync(a,function(t){i.setBitmap(t)},i),i}return i}return __extends(e,t),e.prototype.setBitmap=function(t){this.bitmap&&t&&(this.bitmap.texture=t,this.maskBitmap=App.DisplayUtils.createBitmap(this.maskRes),this.addChild(this.maskBitmap),this.bitmap.mask=this.maskBitmap,this.cacheAsBitmap=!0)},e.prototype.dispose=function(){this.removeChildren(),this.bitmap.texture=null,this.bitmap=null,this.maskBitmap&&(this.maskBitmap.texture=null,this.maskBitmap=null),this.userBase64&&Base64BitmapDataPool.reduceUseNum(this.imgUrl),this.cacheAsBitmap=!1},e}(egret.Sprite);__reflect(RoleHeadImage.prototype,"RoleHeadImage");var Const=function(){function t(){}return t.PAGE_GAMECENTER="PAGE_GAMECENTER",t.PAGE_AVATAR="PAGE_AVATAR",t.PAGE_DANCE="PAGE_DANCE",t.PAGE_DANCING="PAGE_DANCING",t.PAGE_STORE="PAGE_STORE",t}();__reflect(Const.prototype,"Const");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,r){function n(n){e.call(r,n,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?n(o):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var DanceView=function(t){function e(){var e=t.call(this)||this;return e._totalTime=0,e._currentTime=0,e._sound=new egret.Sound,e._factory=dragonBones.EgretFactory.factory,e._soundChannel=null,e._sound.addEventListener(egret.Event.COMPLETE,e._soundLoadHandler,e),e._ui=e._factory.buildArmatureDisplay("dance","ui"),e._playerA=new DancePlayer(e._factory.buildArmatureDisplay("actor","actor")),e._playerB=new DancePlayer(e._factory.buildArmatureDisplay("actor","actor")),e._playerA.player.armature.userData=e._playerA,e._playerB.player.armature.userData=e._playerB,e._ui.armature.getSlot("player_a").display=e._playerA.player,e._ui.armature.getSlot("player_b").display=e._playerB.player,e._playerA.player.addEventListener(dragonBones.EventObject.COMPLETE,e._animationHandler,e),e._playerB.player.addEventListener(dragonBones.EventObject.COMPLETE,e._animationHandler,e),e.addChild(e._ui),e.addEventListener(egret.Event.ADDED_TO_STAGE,e._addToStageHandler,e),e}return __extends(e,t),e.prototype._soundLoadHandler=function(t){this._soundChannel=this._sound.play(0,0),this._soundChannel.addEventListener(egret.Event.SOUND_COMPLETE,this._soundPlayHandler,this)},e.prototype._soundPlayHandler=function(t){},e.prototype._getRandomAnimation=function(t,e){for(var r=t.armatureData.animationNames,n=e;n===e;)n=r[Math.floor(Math.random()*r.length)];return n},e.prototype._maskAnimationState=function(t,e){t.upState===e?e.addBoneMask("body"):(e.addBoneMask("leg_l"),e.addBoneMask("leg_r"),e.addBoneMask("ik_leg_l"),e.addBoneMask("ik_leg_r"),e.addBoneMask("ass",!1))},e.prototype._addToStageHandler=function(){},e.prototype._animationHandler=function(t){var r=t.eventObject.armature;if(t.type===dragonBones.EventObject.COMPLETE){var n=t.eventObject.animationState,o=r.userData,i=this._getRandomAnimation(r,n.name);o.upState===n?(o.upState=r.animation.fadeIn(i,.1,Math.floor(2*Math.random())+1,0,"up"),this._maskAnimationState(o,o.upState),this._currentTime+=n.totalTime*n.playTimes,this._currentTime>=this._totalTime&&(this._playerA.player.animation.fadeIn("stand",.1,0,0,null,4),this._playerB.player.animation.fadeIn("stand",.1,0,0,null,4),this._soundChannel&&(this._soundChannel.stop(),this._soundChannel=null),this.dispatchEventWith(e.COMPLETE))):(o.downState=r.animation.fadeIn(i,.1,Math.floor(2*Math.random())+1,0,"down"),this._maskAnimationState(o,o.downState))}},e.prototype.show=function(t,e){this._totalTime=t,this._currentTime=0,e&&(this._sound.addEventListener(egret.Event.COMPLETE,this._soundLoadHandler,this),this._sound.load(e)),this._ui.animation.fadeIn("show"),this._playerA.upState=this._playerA.player.animation.fadeIn("stand",.1,1,0,"up"),this._playerA.downState=this._playerA.player.animation.fadeIn("stand",.1,1,0,"down"),this._playerB.upState=this._playerB.player.animation.fadeIn("stand",.1,1,0,"up"),this._playerB.downState=this._playerB.player.animation.fadeIn("stand",.1,1,0,"down"),this._maskAnimationState(this._playerA,this._playerA.upState),this._maskAnimationState(this._playerA,this._playerA.downState),this._maskAnimationState(this._playerB,this._playerB.upState),this._maskAnimationState(this._playerB,this._playerB.downState)},e.prototype.hide=function(){this._ui.animation.fadeIn("hide")},e.prototype.setSkinList=function(t){this._ui.armature.getSlot("list").display=t},e.prototype.replaceSkin=function(t,e,r,n){var o=this._factory.getArmatureData(e,r);if(!o)return void console.log("Error skin name:",r,e);var i=o.defaultSkin,a=new Array;for(var s in i.displays)s!==n&&a.push(s);this._factory.replaceSkin(t.armature,i,!1,a)},Object.defineProperty(e.prototype,"playerA",{get:function(){return this._playerA.player},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playerB",{get:function(){return this._playerB.player},enumerable:!0,configurable:!0}),e.COMPLETE="danceComplete",e}(egret.DisplayObjectContainer);__reflect(DanceView.prototype,"DanceView");var DancePlayer=function(){function t(t){this.player=t}return t}();__reflect(DancePlayer.prototype,"DancePlayer");var GameAvatar=function(t){function e(){var e=t.call(this)||this;return e.avatar=App.asset.getDBArmature("actor"),e.store=new StoreCompontent,e.store.addEventListener("changePart",e.onChange,e),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),console.log("this is game avatar"),this.avatar.x=320,this.avatar.y=500;var e=App.data.curAvatars;this.avatar.play("stand"),this.setAvatar(e),this.addChild(this.avatar),this.store.refreshData(),this.store.y=this.stageHeight-700,console.log(this.stageHeight,this.store.height),this.addChild(this.store),this.addChild(this.pageIndex)},e.prototype.onChange=function(t){var e=t.data;if(e){var r=App.data.getAvatarPartID(e);r&&-1==App.data.curAvatars.indexOf(r)&&(App.data.changePart(r),this.replacePart(e))}},e.prototype.setAvatar=function(t){var e,r;for(e=0,r=t.length;r>e;e++){var n=App.data.getAvatarPartConfig(t[e]);this.replacePart(n)}},e.prototype.replacePart=function(t){"leg"==t.slot||"arm"==t.slot?(this.replaceSkin(this.avatar.armatureDisplay,t.db,t.db,t.slot+"_l"),this.replaceSkin(this.avatar.armatureDisplay,t.db,t.db,t.slot+"_r")):this.replaceSkin(this.avatar.armatureDisplay,t.db,t.db,t.slot)},e.prototype.replaceSkin=function(t,e,r,n){var o=AssetManager.dbFactory.getArmatureData(e,r);if(!o)return void console.log("Error skin name:",r,e);var i=o.defaultSkin,a=new Array;for(var s in i.displays)s!==n&&a.push(s);AssetManager.dbFactory.replaceSkin(t.armature,i,!1,a)},e.prototype.initIndex=function(){t.prototype.initIndex.call(this),this.pageIndex.btnAvatar.selected=!0,this.pageIndex.btnDance.selected=!1,this.pageIndex.btnStore.selected=!1,this.pageIndex.btnAvatar.enabled=!1},e.prototype.tick=function(t){},e}(GamePage);__reflect(GameAvatar.prototype,"GameAvatar");var GameCenter=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this);var e=App.asset.getBitmap("logo_png");this.addChild(e);var r=new TabBarDemo;r.x=100,r.y=100,this.addChild(r);var n=new TabItem;this.addChild(n)},e.prototype.tick=function(t){},e}(StateBG);__reflect(GameCenter.prototype,"GameCenter");var GameDance=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),console.log("this is game dance");var e={};e.n="苏魁",e.a=App.data.curAvatars;var r=JSON.stringify(e),n=encodeURI(r),o=Game.data.gameURL+"?a="+n;this.qrCode=qr.QRCode.create(o,0,400,400),console.log(o),this.qrCode.x=this.width/2-this.qrCode.width/2,this.qrCode.y=this.height/2-this.qrCode.height/2;var i=new egret.Shape;i.graphics.beginFill(16777215),i.graphics.drawRect(-5,-5,this.qrCode.width+10,this.qrCode.height+10),i.graphics.endFill(),i.x=this.qrCode.x,i.y=this.qrCode.y,this.addChild(i),this.addChild(this.qrCode)},e.prototype.initIndex=function(){t.prototype.initIndex.call(this),this.pageIndex.btnAvatar.selected=!1,this.pageIndex.btnDance.selected=!0,this.pageIndex.btnStore.selected=!1,this.pageIndex.btnDance.enabled=!1},e.prototype.tick=function(t){},e}(GamePage);__reflect(GameDance.prototype,"GameDance");var GameDancing=function(t){function e(){var e=t.call(this)||this;return e.danceView=new DanceView,e.danceView.addEventListener(DanceView.COMPLETE,e.onComplete,e),e.btnReturn=new egret.TextField,e.btnReturn.text="返回",e.btnReturn.touchEnabled=!0,e.btnReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onEnd,e),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.bg="bg_jpg",this.danceView.show(20,"resource/assets/music/bgm_1.mp3"),this.resetPlaySkin(App.data.curAvatars,App.data.playerAvatars),this.addChild(this.danceView),this.btnReturn.x=(this.stageWidth-this.btnReturn.width)/2,this.btnReturn.y=this.stageHeight-100,this.addChild(this.btnReturn),this.btnReturn.visible=!1},e.prototype.replacePart=function(t,e){"leg"==e.slot||"arm"==e.slot?(this.danceView.replaceSkin(t,e.db,e.db,e.slot+"_l"),this.danceView.replaceSkin(t,e.db,e.db,e.slot+"_r")):this.danceView.replaceSkin(t,e.db,e.db,e.slot)},e.prototype.resetPlaySkin=function(t,e){var r,n;for(r=0,n=t.length;n>r;r++){var o=App.data.getAvatarPartConfig(t[r]);o&&this.replacePart(this.danceView.playerA,o)}for(r=0,n=e.length;n>r;r++){var o=App.data.getAvatarPartConfig(e[r]);o&&this.replacePart(this.danceView.playerB,o)}},e.prototype.tick=function(t){},e.prototype.onComplete=function(t){console.log("aaaaaaaaaaa ,end"),this.btnReturn.visible=!0},e.prototype.onEnd=function(t){this.next(Const.PAGE_AVATAR)},e}(StateBG);__reflect(GameDancing.prototype,"GameDancing");var Game=function(t){function e(e){void 0===e&&(e=null);var r=t.call(this)||this;return r._loading=e,r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAdded,r),r}return __extends(e,t),e.prototype.onAdded=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.init()},e.prototype.init=function(){console.log("ggj2018 start! version: 0.01"),App.soundManager=SoundManager.instance,this.initData(),this.initNet(),this.initGame(),this.login()},e.prototype.login=function(){App.data.init(1),this.startGame()},e.prototype.initData=function(){var t=RES.getRes("dbConfig_json");t&&App.asset.loadDBAnimation(t.db),App.data.initAvatarConfig(RES.getRes("avatar_json")),App.data.curAvatars=App.data.randomAvatar();var e=App.data.getAllAvatarPart();App.data.initStore(e);var r=this.GetQueryString("a"),n=JSON.parse(r);n&&n.a&&n.a.length>0&&(App.data.playerAvatars=n.a,App.data.hasDance=!0),console.log("data:",n)},e.prototype.initNet=function(){},e.prototype.GetQueryString=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(e);return null!=r?decodeURI(r[2]):null},e.prototype.startGame=function(){this._loading&&(this._loading.destroy(),this._loading=null),this._stateManager.startTick()},e.prototype.onSocketClose=function(t){this._loading&&this._loading.setTip("断开连接，请刷新一下～")},e.prototype.initGame=function(){this._stateManager=new StateManager(this),this._stateManager.missState=new NoPage,this._stateManager.registerState(Const.PAGE_GAMECENTER,"GameCenter"),this._stateManager.registerState(Const.PAGE_AVATAR,"GameAvatar"),this._stateManager.registerState(Const.PAGE_DANCE,"GameDance"),this._stateManager.registerState(Const.PAGE_STORE,"GameStore"),this._stateManager.registerState(Const.PAGE_DANCING,"GameDancing"),App.data.hasDance?this._stateManager.setCurStateName(Const.PAGE_DANCING):this._stateManager.setCurStateName(Const.PAGE_AVATAR)},e.offset=0,e}(App);__reflect(Game.prototype,"Game");var GameStore=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),console.log("this is game store")},e.prototype.initIndex=function(){t.prototype.initIndex.call(this),this.pageIndex.btnAvatar.selected=!1,this.pageIndex.btnDance.selected=!1,this.pageIndex.btnStore.selected=!0,this.pageIndex.btnStore.enabled=!1},e.prototype.tick=function(t){},e}(GamePage);__reflect(GameStore.prototype,"GameStore");var NoPage=function(t){function e(){var e=t.call(this)||this,r=new egret.TextField;return r.text="还没有做好，点击返回",e.addChild(r),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.stage&&this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onReturn,this)},e.prototype.onReturn=function(t){this.returnToLast()},e.prototype.dispose=function(){this.stage&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onReturn,this)},e}(StateBG);__reflect(NoPage.prototype,"NoPage");var SkinView=function(t){function e(){var e=t.call(this)||this;return e._factory=dragonBones.EgretFactory.factory,e._ui=e._factory.buildArmatureDisplay("skin","ui"),e._player=e._factory.buildArmatureDisplay("actor","actor"),e._ui.armature.getSlot("player").display=e._player,e.addChild(e._ui),e.addEventListener(egret.Event.ADDED_TO_STAGE,e._addToStageHandler,e),e}return __extends(e,t),e.prototype._addToStageHandler=function(){},e.prototype.show=function(){this._ui.animation.fadeIn("show"),this._player.animation.fadeIn("stand",0,0)},e.prototype.hide=function(){this._ui.animation.fadeIn("hide"),this._player.animation.fadeIn("stand",0,0)},e.prototype.setSkinList=function(t){this._ui.armature.getSlot("list").display=t},e.prototype.replaceSkin=function(t,e,r){var n=this._factory.getArmatureData(t,e);if(!n)return void console.log("Error skin name:",e,t);var o=n.defaultSkin,i=new Array;for(var a in o.displays)a!==r&&i.push(a);this._factory.replaceSkin(this._player.armature,o,!1,i)},Object.defineProperty(e.prototype,"player",{get:function(){return this._player},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(SkinView.prototype,"SkinView");var TabBarDemo=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=(new eui.Theme("resource/default.thm.json",this.stage),new eui.TabBar),r=new eui.ViewStack;r.y=100;for(var n=0;3>n;n++){var o=new eui.Group;o.name="Group"+n;var i=new eui.Label;i.text="group "+n,o.addChild(i),r.addChild(o)}e.dataProvider=r,e.itemRenderer=TabItem,r.selectedIndex=1,this.addChild(r),this.addChild(e)},e}(eui.Group);__reflect(TabBarDemo.prototype,"TabBarDemo");var TabItem=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/skins/TabItemSkin.exml",e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.btn.label=this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t,this.btn.label=this._data},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(TabItem.prototype,"TabItem",["eui.IItemRenderer","eui.UIComponent","egret.DisplayObject"]);var PageIndex=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/skins/PageIndexSkin.exml",e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(PageIndex.prototype,"PageIndex");var StoreCompontent=function(t){function e(){var e=t.call(this)||this;e.tabBar=new eui.TabBar,e.viewStack=new eui.ViewStack,e.viewStack.y=100,e.headList=new StoreList,e.bodyList=new StoreList,e.legList=new StoreList,e.armList=new StoreList;var r=e.getGroup("头",e.headList),n=e.getGroup("身体",e.bodyList),o=e.getGroup("腿",e.legList),i=e.getGroup("胳膊",e.armList);return e.viewStack.addChild(r),e.viewStack.addChild(n),e.viewStack.addChild(o),e.viewStack.addChild(i),e.tabBar.dataProvider=e.viewStack,e.tabBar.itemRenderer=TabItem,e.viewStack.selectedIndex=0,e.addChild(e.viewStack),e.addChild(e.tabBar),e}return __extends(e,t),e.prototype.onChange=function(t){var e=t.data;if(e){var r=App.data.getAvatarPartID(e);r&&-1==App.data.curAvatars.indexOf(r)}},e.prototype.refreshData=function(){this.headList.setData(App.data.headStores),this.bodyList.setData(App.data.bodyStores),this.legList.setData(App.data.legStores),this.armList.setData(App.data.armStores)},e.prototype.getGroup=function(t,e){var r=new eui.Group;return r.name=t,r.addChild(e),r},e}(egret.DisplayObjectContainer);__reflect(StoreCompontent.prototype,"StoreCompontent");var StoreItem=function(t){function e(){var e=t.call(this)||this;return e.itemIndex=0,e.skinName="resource/skins/StoreListItemSkin.exml",e}return __extends(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t;var e=t;this.txtName.text=e.name+"_"+e.slot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(t){this._selected=t},enumerable:!0,configurable:!0}),e}(eui.Component);__reflect(StoreItem.prototype,"StoreItem",["eui.IItemRenderer","eui.UIComponent","egret.DisplayObject"]);var StoreList=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/skins/StoreListSkin.exml",e.list.itemRenderer=StoreItem,e.list.addEventListener(eui.UIEvent.CHANGE,e.onChange,e),e}return __extends(e,t),e.prototype.setData=function(t){this.list.dataProvider=new eui.ArrayCollection(t)},e.prototype.onChange=function(t){console.log(this.list.selectedItem),this.dispatchEvent(new egret.Event("changePart",!0,!1,this.list.selectedItem))},e}(eui.Component);__reflect(StoreList.prototype,"StoreList");var Platform=function(){function t(){}return t.login=function(){t._curPlat&&t._curPlat.login()},t.share=function(){t._curPlat&&t._curPlat.share()},t.shareGame=function(e,r){t._curPlat&&t._curPlat.shareGame(e,r)},t.initPlatform=function(){switch(t.curPlatform){case t.WECHAT:t._curPlat=new WechatPlatform,t._curPlat.init();break;default:t._curPlat=new WebPlatform,t._curPlat.init()}},t.WEB=0,t.EGRET_CENTER=1,t.WECHAT=2,t.curPlatform=t.WECHAT,t}();__reflect(Platform.prototype,"Platform");var WebPlatform=function(){function t(){}return t.prototype.init=function(){},t.prototype.shareGame=function(t,e){},t.prototype.share=function(){},t.prototype.login=function(){},t}();__reflect(WebPlatform.prototype,"WebPlatform",["IPlatform"]);var WechatPlatform=function(){function t(){}return t.prototype.init=function(){var t=window.wx;t.onShow(function(t){if(console.log("wx onShow, scene:",t.scene,"query: ",t.query),t&&t.query){parseInt(t.query.g),parseInt(t.query.r),t.query.n}}),t.getLaunchOptionsSync(function(t){console.log("wx getLaunchOptionsSync, scene:",t.scene,"query: ",t.query)})},t.prototype.shareGame=function(t,e){},t.prototype.share=function(){var t=window.wx;t.shareAppMessage({title:"scGame",imageUrl:"resource/assets/banner.png",success:function(t){console.log("share success, ",t)},fail:function(){console.log("share fail")}})},t.prototype.login=function(){var t=this,e=window.wx;window.wx.login({success:function(r){r.code;e.getSetting({success:function(r){console.log("get wx setting:",r.authSetting["scope.userInfo"]),r.authSetting["scope.userInfo"]?e.getUserInfo({success:function(e){t.loginSuccess(e.userInfo)},fail:function(e){t.loginFail()}}):(console.log("get wx userInfo"),e.getUserInfo({success:function(e){t.loginSuccess(e.userInfo)},fail:function(e){t.loginFail()}}))}})}})},t.prototype.loginSuccess=function(t){},t.prototype.loginFail=function(){console.log("lgoin fail")},t}();__reflect(WechatPlatform.prototype,"WechatPlatform",["IPlatform"]);var qr;!function(t){var e=function(){function e(e){this.mode=t.QRMode.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var r=0,n=this.data.length;n>r;r++){var o=[],i=this.data.charCodeAt(r);i>65536?(o[0]=240|(1835008&i)>>>18,o[1]=128|(258048&i)>>>12,o[2]=128|(4032&i)>>>6,o[3]=128|63&i):i>2048?(o[0]=224|(61440&i)>>>12,o[1]=128|(4032&i)>>>6,o[2]=128|63&i):i>128?(o[0]=192|(1984&i)>>>6,o[1]=128|63&i):o[0]=i,this.parsedData.push(o)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}return e.prototype.getLength=function(t){return this.parsedData.length},e.prototype.write=function(t){for(var e=0,r=this.parsedData.length;r>e;e++)t.put(this.parsedData[e],8)},e}();t.QR8bitByte=e,__reflect(e.prototype,"qr.QR8bitByte")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){this.buffer=[],this.length=0}return t.prototype.get=function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},t.prototype.put=function(t,e){for(var r=0;e>r;r++)this.putBit(1==(t>>>e-r-1&1))},t.prototype.getLengthInBits=function(){return this.length},t.prototype.putBit=function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++},t}();t.QRBitBuffer=e,__reflect(e.prototype,"qr.QRBitBuffer")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(){}return e.create=function(r,n,o,i,a){void 0===n&&(n=0),void 0===o&&(o=200),void 0===i&&(i=200),void 0===a&&(a=2);var s={width:o,height:i,correctLevel:t.QRErrorCorrectLevel.H,color:n},u=new t.QRCodeModel(t.QRUtil._getTypeNumber(r,s.correctLevel),s.correctLevel);return u.addData(r),u.make(),e.draw(u,s)},e.draw=function(t,e){for(var r=new egret.Sprite,e=e,n=t.getModuleCount(),o=Math.floor(e.width/n),i=Math.floor(e.height/n),a=0;n>a;a++)for(var s=0;n>s;s++){var u=t.isDark(a,s);u&&(r.graphics.beginFill(e.color),r.graphics.drawCircle(s*o,a*i,4),r.graphics.endFill())}return r},e}();t.QRCode=e,__reflect(e.prototype,"qr.QRCode")}(qr||(qr={}));
var qr;!function(t){var e=function(){function e(t,e){this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[],this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}return e.prototype.addData=function(e){var r=new t.QR8bitByte(e);this.dataList.push(r),this.dataCache=null},e.prototype.isDark=function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},e.prototype.getModuleCount=function(){return this.moduleCount},e.prototype.make=function(){this.makeImpl(!1,this.getBestMaskPattern())},e.prototype.makeImpl=function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++)this.modules[n][o]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},e.prototype.setupPositionProbePattern=function(t,e){for(var r=-1;7>=r;r++)if(!(-1>=t+r||this.moduleCount<=t+r))for(var n=-1;7>=n;n++)-1>=e+n||this.moduleCount<=e+n||(r>=0&&6>=r&&(0==n||6==n)||n>=0&&6>=n&&(0==r||6==r)||r>=2&&4>=r&&n>=2&&4>=n?this.modules[t+r][e+n]=!0:this.modules[t+r][e+n]=!1)},e.prototype.getBestMaskPattern=function(){for(var e=0,r=0,n=0;8>n;n++){this.makeImpl(!0,n);var o=t.QRUtil.getLostPoint(this);(0==n||e>o)&&(e=o,r=n)}return r},e.prototype.createMovieClip=function(t,e,r){var n=t.createEmptyMovieClip(e,r),o=1;this.make();for(var i=0;i<this.modules.length;i++)for(var a=i*o,s=0;s<this.modules[i].length;s++){var u=s*o,h=this.modules[i][s];h&&(n.beginFill(0,100),n.moveTo(u,a),n.lineTo(u+o,a),n.lineTo(u+o,a+o),n.lineTo(u,a+o),n.endFill())}return n},e.prototype.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},e.prototype.setupPositionAdjustPattern=function(){for(var e=t.QRUtil.getPatternPosition(this.typeNumber),r=0;r<e.length;r++)for(var n=0;n<e.length;n++){var o=e[r],i=e[n];if(null==this.modules[o][i])for(var a=-2;2>=a;a++)for(var s=-2;2>=s;s++)-2==a||2==a||-2==s||2==s||0==a&&0==s?this.modules[o+a][i+s]=!0:this.modules[o+a][i+s]=!1}},e.prototype.setupTypeNumber=function(e){for(var r=t.QRUtil.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var o=!e&&1==(r>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=o}for(var n=0;18>n;n++){var o=!e&&1==(r>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=o}},e.prototype.setupTypeInfo=function(e,r){for(var n=this.errorCorrectLevel<<3|r,o=t.QRUtil.getBCHTypeInfo(n),i=0;15>i;i++){var a=!e&&1==(o>>i&1);6>i?this.modules[i][8]=a:8>i?this.modules[i+1][8]=a:this.modules[this.moduleCount-15+i][8]=a}for(var i=0;15>i;i++){var a=!e&&1==(o>>i&1);8>i?this.modules[8][this.moduleCount-i-1]=a:9>i?this.modules[8][15-i-1+1]=a:this.modules[8][15-i-1]=a}this.modules[this.moduleCount-8][8]=!e},e.prototype.mapData=function(e,r){for(var n=-1,o=this.moduleCount-1,i=7,a=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var u=0;2>u;u++)if(null==this.modules[o][s-u]){var h=!1;a<e.length&&(h=1==(e[a]>>>i&1));var c=t.QRUtil.getMask(r,o,s-u);c&&(h=!h),this.modules[o][s-u]=h,i--,-1==i&&(a++,i=7)}if(o+=n,0>o||this.moduleCount<=o){o-=n,n=-n;break}}},e.createData=function(r,n,o){for(var i=t.QRRSBlock.getRSBlocks(r,n),a=new t.QRBitBuffer,s=0;s<o.length;s++){var u=o[s];a.put(u.mode,4),a.put(u.getLength(),t.QRUtil.getLengthInBits(u.mode,r)),u.write(a)}for(var h=0,s=0;s<i.length;s++)h+=i[s].dataCount;if(a.getLengthInBits()>8*h)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*h+")");for(a.getLengthInBits()+4<=8*h&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*h)&&(a.put(e.PAD0,8),!(a.getLengthInBits()>=8*h));)a.put(e.PAD1,8);return e.createBytes(a,i)},e.createBytes=function(e,r){for(var n=0,o=0,i=0,a=new Array(r.length),s=new Array(r.length),u=0;u<r.length;u++){var h=r[u].dataCount,c=r[u].totalCount-h;o=Math.max(o,h),i=Math.max(i,c),a[u]=new Array(h);for(var l=0;l<a[u].length;l++)a[u][l]=255&e.buffer[l+n];n+=h;var p=t.QRUtil.getErrorCorrectPolynomial(c),d=new t.QRPolynomial(a[u],p.getLength()-1),g=d.mod(p);s[u]=new Array(p.getLength()-1);for(var l=0;l<s[u].length;l++){var f=l+g.getLength()-s[u].length;s[u][l]=f>=0?g.get(f):0}}for(var _=0,l=0;l<r.length;l++)_+=r[l].totalCount;for(var m=new Array(_),E=0,l=0;o>l;l++)for(var u=0;u<r.length;u++)l<a[u].length&&(m[E++]=a[u][l]);for(var l=0;i>l;l++)for(var u=0;u<r.length;u++)l<s[u].length&&(m[E++]=s[u][l]);return m},e.PAD0=236,e.PAD1=17,e}();t.QRCodeModel=e,__reflect(e.prototype,"qr.QRCodeModel")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.L=1,t.M=0,t.Q=3,t.H=2,t}();t.QRErrorCorrectLevel=e,__reflect(e.prototype,"qr.QRErrorCorrectLevel")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.PATTERN000=0,t.PATTERN001=1,t.PATTERN010=2,t.PATTERN011=3,t.PATTERN100=4,t.PATTERN101=5,t.PATTERN110=6,t.PATTERN111=7,t}();t.QRMaskPattern=e,__reflect(e.prototype,"qr.QRMaskPattern")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.glog=function(e){return t.isInit||t.init(),1>e&&console.log("错误:n="+e),t.LOG_TABLE[e]},t.gexp=function(e){for(t.isInit||t.init();0>e;)e+=255;for(;e>=256;)e-=255;return t.EXP_TABLE[e]},t.init=function(){t.isInit=!0;for(var e=0;8>e;e++)t.EXP_TABLE[e]=1<<e;for(var e=8;256>e;e++)t.EXP_TABLE[e]=t.EXP_TABLE[e-4]^t.EXP_TABLE[e-5]^t.EXP_TABLE[e-6]^t.EXP_TABLE[e-8];for(var e=0;255>e;e++)t.LOG_TABLE[t.EXP_TABLE[e]]=e},t.EXP_TABLE=new Array(256),t.LOG_TABLE=new Array(256),t}();t.QRMath=e,__reflect(e.prototype,"qr.QRMath")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.MODE_NUMBER=1,t.MODE_ALPHA_NUM=2,t.MODE_8BIT_BYTE=4,t.MODE_KANJI=8,t}();t.QRMode=e,__reflect(e.prototype,"qr.QRMode")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];)r++;this.num=new Array(t.length-r+e);for(var n=0;n<t.length-r;n++)this.num[n]=t[n+r]}return e.prototype.get=function(t){return this.num[t]},e.prototype.getLength=function(){return this.num.length},e.prototype.multiply=function(r){for(var n=new Array(this.getLength()+r.getLength()-1),o=0;o<this.getLength();o++)for(var i=0;i<r.getLength();i++)n[o+i]^=t.QRMath.gexp(t.QRMath.glog(this.get(o))+t.QRMath.glog(r.get(i)));return new e(n,0)},e.prototype.mod=function(r){if(this.getLength()-r.getLength()<0)return this;for(var n=t.QRMath.glog(this.get(0))-t.QRMath.glog(r.get(0)),o=new Array(this.getLength()),i=0;i<this.getLength();i++)o[i]=this.get(i);for(var i=0;i<r.getLength();i++)o[i]^=t.QRMath.gexp(t.QRMath.glog(r.get(i))+n);return new e(o,0).mod(r)},e}();t.QRPolynomial=e,__reflect(e.prototype,"qr.QRPolynomial")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){this.totalCount=t,this.dataCount=e}return e.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e.getRSBlocks=function(t,r){var n=e.getRsBlockTable(t,r);if(void 0==n)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+r);for(var o=n.length/3,i=[],a=0;o>a;a++)for(var s=n[3*a+0],u=n[3*a+1],h=n[3*a+2],c=0;s>c;c++)i.push(new e(u,h));return i},e.getRsBlockTable=function(r,n){switch(n){case t.QRErrorCorrectLevel.L:return e.RS_BLOCK_TABLE[4*(r-1)+0];case t.QRErrorCorrectLevel.M:return e.RS_BLOCK_TABLE[4*(r-1)+1];case t.QRErrorCorrectLevel.Q:return e.RS_BLOCK_TABLE[4*(r-1)+2];case t.QRErrorCorrectLevel.H:return e.RS_BLOCK_TABLE[4*(r-1)+3];default:return}},e}();t.QRRSBlock=e,__reflect(e.prototype,"qr.QRRSBlock")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(){}return e.getBCHTypeInfo=function(t){for(var r=t<<10;e.getBCHDigit(r)-e.getBCHDigit(e.G15)>=0;)r^=e.G15<<e.getBCHDigit(r)-e.getBCHDigit(e.G15);return(t<<10|r)^e.G15_MASK},e.getBCHTypeNumber=function(t){for(var r=t<<12;e.getBCHDigit(r)-e.getBCHDigit(e.G18)>=0;)r^=e.G18<<e.getBCHDigit(r)-e.getBCHDigit(e.G18);return t<<12|r},e.getBCHDigit=function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},e.getPatternPosition=function(t){return e.PATTERN_POSITION_TABLE[t-1]},e.getMask=function(e,r,n){switch(e){case t.QRMaskPattern.PATTERN000:return(r+n)%2==0;case t.QRMaskPattern.PATTERN001:return r%2==0;case t.QRMaskPattern.PATTERN010:return n%3==0;case t.QRMaskPattern.PATTERN011:return(r+n)%3==0;case t.QRMaskPattern.PATTERN100:return(Math.floor(r/2)+Math.floor(n/3))%2==0;case t.QRMaskPattern.PATTERN101:return r*n%2+r*n%3==0;case t.QRMaskPattern.PATTERN110:return(r*n%2+r*n%3)%2==0;case t.QRMaskPattern.PATTERN111:return(r*n%3+(r+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},e.getErrorCorrectPolynomial=function(e){for(var r=new t.QRPolynomial([1],0),n=0;e>n;n++)r=r.multiply(new t.QRPolynomial([1,t.QRMath.gexp(n)],0));return r},e.getLengthInBits=function(e,r){if(r>=1&&10>r)switch(e){case t.QRMode.MODE_NUMBER:return 10;case t.QRMode.MODE_ALPHA_NUM:return 9;case t.QRMode.MODE_8BIT_BYTE:return 8;case t.QRMode.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>r)switch(e){case t.QRMode.MODE_NUMBER:return 12;case t.QRMode.MODE_ALPHA_NUM:return 11;case t.QRMode.MODE_8BIT_BYTE:return 16;case t.QRMode.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>r))throw new Error("type:"+r);switch(e){case t.QRMode.MODE_NUMBER:return 14;case t.QRMode.MODE_ALPHA_NUM:return 13;case t.QRMode.MODE_8BIT_BYTE:return 16;case t.QRMode.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},e.getLostPoint=function(t){for(var e=t.getModuleCount(),r=0,n=0;e>n;n++)for(var o=0;e>o;o++){for(var i=0,a=t.isDark(n,o),s=-1;1>=s;s++)if(!(0>n+s||n+s>=e))for(var u=-1;1>=u;u++)0>o+u||o+u>=e||(0!=s||0!=u)&&a==t.isDark(n+s,o+u)&&i++;i>5&&(r+=3+i-5)}for(var n=0;e-1>n;n++)for(var o=0;e-1>o;o++){var h=0;t.isDark(n,o)&&h++,t.isDark(n+1,o)&&h++,t.isDark(n,o+1)&&h++,t.isDark(n+1,o+1)&&h++,(0==h||4==h)&&(r+=3)}for(var n=0;e>n;n++)for(var o=0;e-6>o;o++)t.isDark(n,o)&&!t.isDark(n,o+1)&&t.isDark(n,o+2)&&t.isDark(n,o+3)&&t.isDark(n,o+4)&&!t.isDark(n,o+5)&&t.isDark(n,o+6)&&(r+=40);for(var o=0;e>o;o++)for(var n=0;e-6>n;n++)t.isDark(n,o)&&!t.isDark(n+1,o)&&t.isDark(n+2,o)&&t.isDark(n+3,o)&&t.isDark(n+4,o)&&!t.isDark(n+5,o)&&t.isDark(n+6,o)&&(r+=40);for(var c=0,o=0;e>o;o++)for(var n=0;e>n;n++)t.isDark(n,o)&&c++;var l=Math.abs(100*c/e/e-50)/5;return r+=10*l},e.prototype.static_isSupportCanvas=function(){return"undefined"!=typeof CanvasRenderingContext2D},e._getTypeNumber=function(r,n){for(var o=1,i=e._getUTF8Length(r),a=0,s=e.QRCodeLimitLength.length;s>=a;a++){var u=0;switch(n){case t.QRErrorCorrectLevel.L:u=e.QRCodeLimitLength[a][0];break;case t.QRErrorCorrectLevel.M:u=e.QRCodeLimitLength[a][1];break;case t.QRErrorCorrectLevel.Q:u=e.QRCodeLimitLength[a][2];break;case t.QRErrorCorrectLevel.H:u=e.QRCodeLimitLength[a][3]}if(u>=i)break;o++}if(o>e.QRCodeLimitLength.length)throw new Error("Too long data");return o},e._getUTF8Length=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)},e.PATTERN_POSITION_TABLE=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],e.G15=1335,e.G18=7973,e.G15_MASK=21522,e.QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],e}();t.QRUtil=e,__reflect(e.prototype,"qr.QRUtil")}(qr||(qr={}));var MyFakeSocket=function(){function t(){}return t.prototype.initServer=function(t,e,r){var n=this;this._host=t,this._port=e,this._msg=r,setTimeout(function(){n.dispatch(SocketConst.SOCKET_CONNECT)},1e3)},t.prototype.connect=function(){},t.prototype.dispatch=function(t,e){void 0===e&&(e=null),this.messageCenter&&this.messageCenter.dispatchEvent(new egret.Event(t,!1,!1,e))},t.prototype.getData=function(){return this._data},t.prototype.send=function(t){1e3==t.key&&this.dispatch(MySocket.ENTER_ROOM)},t.prototype.sendData=function(t){},t}();__reflect(MyFakeSocket.prototype,"MyFakeSocket",["ISocket"]);var MySocket=function(t){function e(){var e=t.call(this)||this;return e.dataType=egret.WebSocket.TYPE_BINARY,e}return __extends(e,t),e.enterRoom=function(t){console.log("[send enter room]");var e={};e.cmd=100,e.roomId=t,App.rpc.socketSend(e)},e.broadEvent=function(t){console.log("[send broadEvent:]",t);var e={};e.cmd=106,e.payload={},e.payload.event=t,App.rpc.socketSend(e)},e.prototype.decode=function(t){var r=t;r.position=0;var n=r.readUTFBytes(r.length);console.log("[decode:]",n);var o=JSON.parse(n);if(o){var i=e.dic[o.cmd];return i?{key:i,body:o.payload}:{key:"error"}}},e.prototype.encode=function(t){var e=JSON.stringify(t),r=new egret.ByteArray;return r.writeUTFBytes(e),r},e.ENTER_ROOM="ENTER_ROOM",e.SEND_GAME_EVENT="SEND_GAME_EVENT",e.GAME_EVENT="GAME_EVENT",e.SYSTEM_MESSAGE="SYSTEM_MESSAGE",e.SOMEBODY_IN="SOMEBODY_IN",e.MATCH_PLAYER_SUCCESS="MATCH_PLAYER_SUCCESS",e.dic={0:"SYSTEM_MESSAGE",3:"SOMEBODY_IN",100:"ENTER_ROOM",101:"MATCH_PLAYER_SUCCESS",106:"SEND_GAME_EVENT",107:"GAME_EVENT"},e}(SocketMessageManager);__reflect(MySocket.prototype,"MySocket");var ObjectPool=function(){function t(){this._objs=new Array}return t.prototype.pushObj=function(t){this._objs.push(t)},t.prototype.popObj=function(){return this._objs.length>0?this._objs.pop():null},t.prototype.clear=function(){for(;this._objs.length>0;)this._objs.pop()},t.pop=function(e,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];t._content[r]||(t._content[r]=[]);var i=t._content[r];if(i.length)return i.pop();var a,s=n.length;return 0==s?a=new e:1==s?a=new e(n[0]):2==s?a=new e(n[0],n[1]):3==s?a=new e(n[0],n[1],n[2]):4==s?a=new e(n[0],n[1],n[2],n[3]):5==s&&(a=new e(n[0],n[1],n[2],n[3],n[4])),a.ObjectPoolKey=r,a},t.popWithExtraKey=function(e,r){t._content[e]||(t._content[e]=[]);var n,o=t._content[e];if(o.length)for(var i=0;i<o.length;i++)if(o[i].extraKey==r){n=o[i],o.splice(i,1);break}if(!n){var a=e;n=new a(r),n.extraKey=r,n.ObjectPoolKey=e}return n},t.push=function(e){if(null==e)return!1;var r=e.ObjectPoolKey;return t._content[r]?(t._content[r].push(e),!0):!1},t.clear=function(){t._content={}},t.clearClass=function(e,r){void 0===r&&(r=null);for(var n=t._content[e];n&&n.length;){var o=n.pop();r&&o[r](),o=null}t._content[e]=null,delete t._content[e]},t.dealFunc=function(e,r){var n=t._content[e];if(null!=n){var o=0,i=n.length;for(o;i>o;o++)n[o][r]()}},t._content={},t}();__reflect(ObjectPool.prototype,"ObjectPool");