function fulls(){launchFullScreen(document.documentElement)}function launchFullScreen(e){e.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen()}var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,i){var o,s=arguments.length,r=3>s?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(r=(3>s?o(r):s>3?o(t,n,r):o(t,n))||r);return s>3&&r&&Object.defineProperty(t,n,r),r},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,s){function r(e){try{u(i.next(e))}catch(t){s(t)}}function a(e){try{u(i["throw"](e))}catch(t){s(t)}}function u(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(r,a)}u((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,s&&(r=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[0,r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(i){n=[6,i],s=0}finally{o=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,s,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return{next:n(0),"throw":n(1),"return":n(2)}},GameScene=function(){function e(e){this.offsetX=90,this.offsetY=0,this.offsetZ=0,this.offY=-180,this.lastY=0,this.curY=0,this.mouseOffsetX=0,this.mouseOffsetY=0,this.gammaOff=!1;var t=new egret3d.View3D(0,(e.height-e.width)/2,e.width,e.width);t.backColor=4279769112,this.camera=t.camera3D,e.addView3D(t),this.view=t,this.cameraHover=new egret3d.HoverController(this.view.camera3D),this.cameraHover.steps=12,this.curY=-alpha+this.offsetY,this.lastY=this.curY,this.lastGamma=gamma,e.addEventListener(egret3d.Event3D.ENTER_FRAME,this.update,this),this.addTouchEvent()}return e.prototype.addTouchEvent=function(){egret3d.Input.addEventListener(egret3d.TouchEvent3D.TOUCH_START,this.onTouchStart,this),egret3d.Input.addEventListener(egret3d.TouchEvent3D.TOUCH_END,this.onTouchEnd,this),egret3d.Input.addEventListener(egret3d.TouchEvent3D.TOUCH_MOVE,this.onTouchMove,this),egret3d.Input.addEventListener(egret3d.MouseEvent3D.MOUSE_DOWN,this.onMouseDown,this),egret3d.Input.addEventListener(egret3d.MouseEvent3D.MOUSE_UP,this.onMouseUp,this),egret3d.Input.addEventListener(egret3d.MouseEvent3D.MOUSE_MOVE,this.onMouseMove,this)},e.prototype.onMouseDown=function(e){switch(e.mouseCode){case egret3d.MouseCode.Mouse_Left:}this.mouseDown=!0,this.lastMouseX=this.curMouseX=egret3d.Input.mouseX,this.lastMouseY=this.curMouseY=egret3d.Input.mouseY},e.prototype.onMouseUp=function(e){switch(e.mouseCode){case egret3d.MouseCode.Mouse_Left:}this.mouseDown=!1},e.prototype.onMouseMove=function(e){this.mouseDown&&(this.curMouseX=egret3d.Input.mouseX,this.curMouseY=egret3d.Input.mouseY,this.mouseOffsetY-=this.curMouseX-this.lastMouseX,this.mouseOffsetX-=this.curMouseY-this.lastMouseY,this.lastMouseX=this.curMouseX,this.lastMouseY=this.curMouseY)},e.prototype.onTouchStart=function(e){this.mouseDown=!0,this.lastMouseX=this.curMouseX=egret3d.Input.mouseX,this.lastMouseY=this.curMouseY=egret3d.Input.mouseY},e.prototype.onTouchEnd=function(e){this.mouseDown=!1},e.prototype.onTouchMove=function(e){this.mouseDown&&(this.curMouseX=egret3d.Input.mouseX,this.curMouseY=egret3d.Input.mouseY,this.mouseOffsetX+=this.curMouseX-this.lastMouseX,this.mouseOffsetY-=this.curMouseY-this.lastMouseY,this.lastMouseX=this.curMouseX,this.lastMouseY=this.curMouseY)},e.prototype.createPanimc=function(){var e=RES.getRes(Main.SMALL_T),t=new egret3d.SphereGeometry(200,45,45),n=new egret3d.TextureMaterial(e);this.mesh=new egret3d.Mesh(t,n),n.cullMode=egret3d.ContextConfig.FRONT,this.view.addChild3D(this.mesh)},e.prototype.changeTexture=function(){var e=RES.getRes(Main.LARGE_T);console.log("aaaaaaaa",e);var t=new egret3d.TextureMaterial(e);this.mesh.material=t},e.prototype.createGameScene=function(){var e=RES.getRes("3d/background.jpg");console.log(e),this.view.backImage=e;var t=RES.getRes("3d/0_Model/Esm/Zhouyu.esm"),n=RES.getRes("3d/0_Model/Eam/attack.eam"),i=RES.getRes("3d/0_Model/Eam/idle.eam"),o=RES.getRes("3d/0_Model/Texture/hero_01.png");n.animationName="attack",i.animationName="idle";var s=new egret3d.Mesh(t);this.mesh=s,n.isLoop=!1,i.isLoop=!0,s.material.diffuseTexture=o,s.material.ambientColor=11842740,s.material.gloss=10,s.material.specularLevel=.5;var r=s.animation.skeletonAnimationController;r.addSkeletonAnimationClip(n),r.addSkeletonAnimationClip(i),r.addEventListener(egret3d.AnimationEvent3D.COMPLETE,this.onAnimationComplete,this),r.addEventListener(egret3d.AnimationEvent3D.CYCLE,this.onAnimationCycle,this),this.view.addChild3D(s),s.animation.play(i.animationName),this.lightGroup=new egret3d.LightGroup;var a=new egret3d.DirectLight(new egret3d.Vector3D(1,-1,0));this.lightGroup.addLight(a),s.lightGroup=this.lightGroup},e.prototype.onKeyDown=function(e){switch(e.keyCode){case egret3d.KeyCode.Key_1:this.mesh.animation.play("attack")}},e.prototype.onAnimationComplete=function(e){console.log("onAnimationComplete"),this.mesh.animation.play("idle")},e.prototype.onAnimationCycle=function(e){console.log("播放完成一个循环")},e.prototype.update=function(e){var t=gamma,n=0;t>0&&(t=gamma-180),t+=this.offsetX,0>t&&(t+=360),this.lastGamma>0&&0>gamma&&Math.abs(gamma)<10?this.gammaOff=!this.gammaOff:this.lastGamma<0&&gamma>0&&Math.abs(gamma)<10&&(this.gammaOff=!this.gammaOff),this.gammaOff&&(t>180?t-=180:180>t&&(t+=180)),this.lastGamma=gamma,this.curY=-alpha+this.offsetY,Math.abs(this.curY-this.lastY)>170&&Math.abs(this.curY-this.lastY)<190&&(this.flipY=!this.flipY),n=this.flipY?this.curY+this.offY:this.curY,this.lastY=this.curY,this.camera.rotationX=t+.1*this.mouseOffsetX,this.camera.rotationY=n+.1*this.mouseOffsetY,Main.txtLog.visible=beta>30},e}();__reflect(GameScene.prototype,"GameScene");var Main=Main_1=function(e){function t(){var t=e.call(this)||this;return t._txtNum=0,utils.map(),t.once(egret.Event.ADDED_TO_STAGE,function(){return __awaiter(t,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=new egret3d.Egret3DCanvas(this.stage),egret.setRendererContext(e),this.game=new GameScene(e),[4,this.loadAssets()];case 1:return t.sent(),this.game.createPanimc(),console.log("create scene"),this.initUI(),[4,this.loadOtherAssets()];case 2:return t.sent(),this.game.changeTexture(),[2]}})})},t),t}return __extends(t,e),t.prototype.initUI=function(){var e=new egret.Sprite,t=new egret.TextField;t.text="全屏",t.x=30,t.y=10,e.graphics.beginFill(16711680,0),e.graphics.drawRect(0,0,100,100),e.graphics.endFill(),this.addChild(e),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_END,function(e){fulls(),t.visible=!1},this),this.addChild(t),Main_1.txtLog=new egret.TextField,Main_1.txtLog.text="请横屏欣赏",Main_1.txtLog.textColor=16777215,Main_1.txtLog.x=100,Main_1.txtLog.y=300,this.addChild(Main_1.txtLog),window&&(window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",function(e){alpha=e.alpha||0,beta=e.beta||0,gamma=e.gamma||0},!1),window.DeviceMotionEvent&&window.addEventListener("devicemotion",function(e){},!1))},t.prototype.createTxt=function(){this._txtNum++;var e=new egret.TextField;return e.text="aaa",e.textColor=16711680,e.x=100,e.y=30*this._txtNum,this.addChild(e),e},t.prototype.loadAssets=function(){return __awaiter(this,void 0,void 0,function(){function e(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(o){switch(o.label){case 0:t=0,n=e,o.label=1;case 1:return t<n.length?(i=n[t],[4,RES.getResAsync(i)]):[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}var t,n,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig()];case 1:return o.sent(),n=[Main_1.SMALL_T],[4,e(n)];case 2:return o.sent(),this.stage.removeChild(t),[3,4];case 3:return i=o.sent(),alert(i.message),[3,4];case 4:return[2]}})})},t.prototype.loadOtherAssets=function(){return __awaiter(this,void 0,void 0,function(){function e(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(o){switch(o.label){case 0:t=0,n=e,o.label=1;case 1:return t<n.length?(i=n[t],[4,RES.getResAsync(i)]):[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}var t,n;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=[Main_1.LARGE_T],[4,e(t)];case 1:return i.sent(),[3,3];case 2:return n=i.sent(),alert(n.message),[3,3];case 3:return[2]}})})},t}(egret.DisplayObjectContainer);Main.SMALL_T="3d/comicS1.jpg",Main.LARGE_T="3d/comicL1.jpg",Main=Main_1=__decorate([RES.mapConfig("config.json",function(){return"resource"},function(e){var t=e.substr(e.lastIndexOf(".")+1),n="";if(e.indexOf("3d")>=0)n="unit";else{var i={jpg:"image",png:"image",webp:"image",json:"json",fnt:"font",pvr:"pvr",mp3:"sound"};n=i[t],"json"==n&&(e.indexOf("sheet")>=0?n="sheet":e.indexOf("movieclip")>=0&&(n="movieclip"))}return n})],Main),__reflect(Main.prototype,"Main");var utils;!function(e){function t(e,t){var n=this;return new Promise(function(i,o){e.addEventListener(egret3d.LoaderEvent3D.LOADER_COMPLETE,function(){i(e.data)},n),e.load("resource/"+t)})}function n(){var e=this;RES.processor.map("unit",{onLoadStart:function(n,i){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(n){return e=new egret3d.UnitLoader,[2,t(e,i.url)]})})},onRemoveStart:function(t,n){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve()]})})}})}e.map=n}(utils||(utils={}));var alpha,beta,gamma,Main_1,LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.textField=new egret.TextField,t.addChild(t.textField),t.textField.x=t.textField.y=200,t.textField.text="loading...",t}return __extends(t,e),t.prototype.onProgress=function(e,t){this.textField.text=e+" / "+t,console.log(e,t)},t}(egret.DisplayObjectContainer);__reflect(LoadingUI.prototype,"LoadingUI");