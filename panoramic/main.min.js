var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=3>o?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(3>o?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{c(i.next(e))}catch(t){o(t)}}function s(e){try{c(i["throw"](e))}catch(t){o(t)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}c((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(i){n=[6,i],o=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return{next:n(0),"throw":n(1),"return":n(2)}},GameScene=function(){function e(e){this.offsetX=90,this.offsetY=0,this.offsetZ=0,this.offY=-180,this.lastY=0,this.curY=0;var t=new egret3d.View3D(0,(e.height-e.width)/2,e.width,e.width);t.backColor=4279769112,this.camera=t.camera3D,console.log("ataaaa",this.camera.fieldOfView),e.addView3D(t),this.view=t,this.cameraHover=new egret3d.HoverController(this.view.camera3D),this.cameraHover.steps=12,this.curY=-alpha+this.offsetY,this.lastY=this.curY,e.addEventListener(egret3d.Event3D.ENTER_FRAME,this.update,this)}return e.prototype.createPanimc=function(){var e=RES.getRes("3d/comic2.jpg");console.log(e);var t=new egret3d.SphereGeometry(200,45,45),n=new egret3d.TextureMaterial(e);this.mesh=new egret3d.Mesh(t,n),n.cullMode=egret3d.ContextConfig.FRONT,this.view.addChild3D(this.mesh)},e.prototype.createGameScene=function(){var e=RES.getRes("3d/background.jpg");console.log(e),this.view.backImage=e;var t=RES.getRes("3d/0_Model/Esm/Zhouyu.esm"),n=RES.getRes("3d/0_Model/Eam/attack.eam"),i=RES.getRes("3d/0_Model/Eam/idle.eam"),r=RES.getRes("3d/0_Model/Texture/hero_01.png");n.animationName="attack",i.animationName="idle";var o=new egret3d.Mesh(t);this.mesh=o,n.isLoop=!1,i.isLoop=!0,o.material.diffuseTexture=r,o.material.ambientColor=11842740,o.material.gloss=10,o.material.specularLevel=.5;var a=o.animation.skeletonAnimationController;a.addSkeletonAnimationClip(n),a.addSkeletonAnimationClip(i),a.addEventListener(egret3d.AnimationEvent3D.COMPLETE,this.onAnimationComplete,this),a.addEventListener(egret3d.AnimationEvent3D.CYCLE,this.onAnimationCycle,this),this.view.addChild3D(o),o.animation.play(i.animationName),this.lightGroup=new egret3d.LightGroup;var s=new egret3d.DirectLight(new egret3d.Vector3D(1,-1,0));this.lightGroup.addLight(s),o.lightGroup=this.lightGroup},e.prototype.onKeyDown=function(e){switch(e.keyCode){case egret3d.KeyCode.Key_1:this.mesh.animation.play("attack")}},e.prototype.onAnimationComplete=function(e){console.log("onAnimationComplete"),this.mesh.animation.play("idle")},e.prototype.onAnimationCycle=function(e){console.log("播放完成一个循环")},e.prototype.update=function(e){var t=gamma;t>0&&(t=gamma-180),t+=this.offsetX,0>t&&(t+=360),this.camera.rotationX=t,this.curY=-alpha+this.offsetY,Math.abs(this.curY-this.lastY)>170&&Math.abs(this.curY-this.lastY)<190&&(this.flipY=!this.flipY),this.flipY?this.camera.rotationY=this.curY+this.offY:this.camera.rotationY=this.curY,this.lastY=this.curY},e}();__reflect(GameScene.prototype,"GameScene");var Main=function(e){function t(){var t=e.call(this)||this;return t._txtNum=0,utils.map(),t.once(egret.Event.ADDED_TO_STAGE,function(){return __awaiter(t,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=new egret3d.Egret3DCanvas(this.stage),egret.setRendererContext(e),t=new GameScene(e),[4,this.loadAssets()];case 1:return n.sent(),t.createPanimc(),console.log("create scene"),this.initUI(),[2]}})})},t),t}return __extends(t,e),t.prototype.initUI=function(){window&&(window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",function(e){alpha=e.alpha||0,beta=e.beta||0,gamma=e.gamma||0},!1),window.DeviceMotionEvent&&window.addEventListener("devicemotion",function(e){},!1))},t.prototype.createTxt=function(){this._txtNum++;var e=new egret.TextField;return e.text="aaa",e.textColor=16711680,e.x=100,e.y=30*this._txtNum,this.addChild(e),e},t.prototype.loadAssets=function(){return __awaiter(this,void 0,void 0,function(){function e(e){return __awaiter(this,void 0,void 0,function(){var t,n,i;return __generator(this,function(r){switch(r.label){case 0:t=0,n=e,r.label=1;case 1:return t<n.length?(i=n[t],[4,RES.getResAsync(i)]):[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}var t,n,i;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig()];case 1:return r.sent(),n=["3d/comic2.jpg","3d/background.jpg"],[4,e(n)];case 2:return r.sent(),this.stage.removeChild(t),[3,4];case 3:return i=r.sent(),alert(i.message),[3,4];case 4:return[2]}})})},t}(egret.DisplayObjectContainer);Main=__decorate([RES.mapConfig("config.json",function(){return"resource"},function(e){var t=e.substr(e.lastIndexOf(".")+1),n="";if(e.indexOf("3d")>=0)n="unit";else{var i={jpg:"image",png:"image",webp:"image",json:"json",fnt:"font",pvr:"pvr",mp3:"sound"};n=i[t],"json"==n&&(e.indexOf("sheet")>=0?n="sheet":e.indexOf("movieclip")>=0&&(n="movieclip"))}return n})],Main),__reflect(Main.prototype,"Main");var utils;!function(e){function t(e,t){var n=this;return new Promise(function(i,r){e.addEventListener(egret3d.LoaderEvent3D.LOADER_COMPLETE,function(){i(e.data)},n),e.load("resource/"+t)})}function n(){var e=this;RES.processor.map("unit",{onLoadStart:function(n,i){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(n){return e=new egret3d.UnitLoader,[2,t(e,i.url)]})})},onRemoveStart:function(t,n){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve()]})})}})}e.map=n}(utils||(utils={}));var alpha,beta,gamma,LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.textField=new egret.TextField,t.addChild(t.textField),t.textField.x=t.textField.y=200,t.textField.text="loading...",t}return __extends(t,e),t.prototype.onProgress=function(e,t){this.textField.text=e+" / "+t,console.log(e,t)},t}(egret.DisplayObjectContainer);__reflect(LoadingUI.prototype,"LoadingUI");