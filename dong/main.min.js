var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var BaseCommand=function(){function t(){this.canUndo=!1,this.canMerge=!1}var e=(__define,t),i=e.prototype;return i.initData=function(t){this.inputData=t},i.merge=function(t){return!1},i.execuse=function(){},i.revert=function(){},t}();egret.registerClass(BaseCommand,"BaseCommand");var BlockCmd=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.execuse=function(){this.commandManager.block()},i(s,"commandManager",function(){return ControlManager.instance.commandManager}),e}(BaseCommand);egret.registerClass(BlockCmd,"BlockCmd");var CommandNotification=function(){function t(){}var e=(__define,t);e.prototype;return t.getCommand=function(t){var e=egret.getDefinitionByName(t);if(e){var i=new e;return i}return null},t.UNDO="UndoCmd",t.REDO="RedoCmd",t.BLOCK="BlockCmd",t.CREATE_ROOM="CreateRoomCmd",t.MODIFY_ROOM="ModifyRoomCmd",t._map={},t}();egret.registerClass(CommandNotification,"CommandNotification");var BaseControl=function(){function t(){this._bus=SignBus.instance,this._commandNotification=new Notification(Notification.COMMAND),this._commandData={}}var e=(__define,t),i=e.prototype;return i.on=function(t,e,i){void 0===i&&(i=0),this._bus.addEventListener(t,e,this,!1,i)},i.off=function(t,e){this._bus.removeEventListener(t,e,this)},i.send=function(t,e){void 0===e&&(e=null),this._bus.dispatchEvent(new Notification(t,e))},i.sendCommand=function(t,e){void 0===e&&(e=null),this._commandData.command=t,this._commandData.data=e,this._commandNotification.data=this._commandData,this._bus.dispatchEvent(this._commandNotification)},i.start=function(){this._running||(this.initListener(),this._running=!0)},i.stop=function(){this._running=!1,this.removeListener()},i.initListener=function(){},i.removeListener=function(){},t}();egret.registerClass(BaseControl,"BaseControl");var CommandManager=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.initWithModel=function(t){this._model=t,this.start()},s.initListener=function(){this.on(Notification.COMMAND,this.onCommand)},s.onCommand=function(t){var e=t.data.command,i=t.data.data,n=CommandNotification.getCommand(e);if(null!=n&&(n.initData(i),n.execuse(),n.canUndo))if(n.canMerge&&this._model.curCommand&&this._model.curCommand.canMerge){var s=this._model.curCommand.merge(n);s||(this._model.curCommand.canMerge=!1,this._model.commandList.push(n),this._model.curIndex++)}else this._model.commandList.push(n),this._model.curIndex++},s.block=function(){this._model.curCommand&&(this._model.curCommand.canMerge=!1)},s.undo=function(){var t=this._model.curCommand;t&&(t.revert(),this._model.curIndex--)},s.redo=function(){var t=this._model.nextCommand;t&&(t.execuse(),this._model.curIndex++)},i(s,"redoEnable",function(){return this._model.redoEnable}),i(s,"undoEnable",function(){return this._model.undoEnable}),e}(BaseControl);egret.registerClass(CommandManager,"CommandManager");var CommandModel=function(){function t(){this.curIndex=-1,this.savedIndex=-1,this.commandList=[]}var e=__define,i=t,n=i.prototype;return e(n,"curCommand",function(){return this.commandList[this.curIndex]}),e(n,"nextCommand",function(){return this.curIndex<this.commandList.length-1?this.commandList[this.curIndex+1]:null}),e(n,"redoEnable",function(){return this.curIndex<this.commandList.length-1}),e(n,"undoEnable",function(){return this.curIndex>=0}),t}();egret.registerClass(CommandModel,"CommandModel");var CreateRoomCmd=function(t){function e(){t.call(this),this.canUndo=!0,this.canMerge=!0}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initData=function(t){this.inputData=t,ControlManager.instance.mainViewControl.wallViewControl.checkRectRoomWall(this.inputData)},n.merge=function(t){if(egret.is(t,"ModifyRoomCmd")){var e=t;if(e.inputData.room==this.inputData)return!0}return!1},n.execuse=function(){var t=this.inputData;t&&ControlManager.instance.mainViewControl.wallViewControl.addRectRoom(t)},n.revert=function(){var t=this.inputData;ControlManager.instance.mainViewControl.wallViewControl.removeRectRoom(t)},e}(BaseCommand);egret.registerClass(CreateRoomCmd,"CreateRoomCmd");var ModifyRoomCmd=function(t){function e(){t.call(this),this.canUndo=!0,this.canMerge=!0}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initData=function(t){this.inputData=t},n.merge=function(t){if(egret.is(t,"ModifyRoomCmd")){var e=t;if(e.inputData.room==this.inputData.room)return!0}return!1},n.execuse=function(){var t=this.inputData.room,e=this.inputData.p0,i=this.inputData.p1;t&&(t.reSize(e,i),ControlManager.instance.mainViewControl.wallViewControl.refresh())},n.revert=function(){},e}(BaseCommand);egret.registerClass(ModifyRoomCmd,"ModifyRoomCmd");var RedoCmd=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.execuse=function(){this.commandManager.redoEnable&&this.commandManager.redo()},i(s,"commandManager",function(){return ControlManager.instance.commandManager}),e}(BaseCommand);egret.registerClass(RedoCmd,"RedoCmd");var UndoCmd=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.execuse=function(){this.commandManager.undoEnable&&this.commandManager.undo()},i(s,"commandManager",function(){return ControlManager.instance.commandManager}),e}(BaseCommand);egret.registerClass(UndoCmd,"UndoCmd");var ControlManager=function(){function t(){var t=document.getElementsByTagName("CANVAS")[0];t&&Cursor.init(t),this.commandManager=new CommandManager,this.commandManager.initWithModel(new CommandModel),this.mainViewControl=new MainViewControl}var e=__define,i=t;i.prototype;return e(t,"instance",function(){return null==t._instance&&(t._instance=new t),t._instance}),t}();egret.registerClass(ControlManager,"ControlManager");var FSM=function(){function t(){this._states=[]}var e=__define,i=t,n=i.prototype;return n.init=function(t){this.switchTo(t)},n.addState=function(t){var e=this.getState(t);return null==e&&(e=new State(t),this._states.push(e)),e},n.removeState=function(t){var e,i;for(e=this._states.length-1;e>=0;--e)if(this._states[e].name==t)return i=this._states.splice(e,1),i[0];return null},n.getState=function(t){var e;for(e=this._states.length-1;e>=0;--e)if(this._states[e].name==t)return this._states[e]},e(n,"currentState",function(){return null==this._curState?null:this._curState.name}),n.switchTo=function(t){if(null!=this._curState){if(this._curState.name==t)return;this._curState.end()}this._curState=this.getState(t),this._curState&&this._curState.start()},n.pushFront=function(t,e){var i=this.getState(t);i&&i.pushFront(e)},n.pushBack=function(t,e){var i=this.getState(t);i&&i.pushBack(e)},t}();egret.registerClass(FSM,"FSM");var State=function(){function t(t){this._name=t,this._beginFun=[],this._endFun=[]}var e=__define,i=t,n=i.prototype;return e(n,"name",function(){return this._name}),n.pushFront=function(t){t&&-1==this._beginFun.indexOf(t)&&this._beginFun.push(t)},n.pushBack=function(t){t&&-1==this._endFun.indexOf(t)&&this._endFun.push(t)},n.start=function(){var t,e=this._beginFun.length;for(t=0;e>t;++t)this._beginFun[t].call(this)},n.end=function(){var t,e=this._endFun.length;for(t=0;e>t;++t)this._endFun[t].call(this)},t}();egret.registerClass(State,"State");var Notification=function(t){function e(e,i){void 0===i&&(i=null),t.call(this,e,!1,!1,i)}__extends(e,t);var i=(__define,e);i.prototype;return e.COMMAND="NOTIFICATION:COMMAND",e}(egret.Event);egret.registerClass(Notification,"Notification");var SignBus=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e;n.prototype;return i(e,"instance",function(){return null==e._instance&&(e._instance=new e),e._instance}),e}(egret.Sprite);egret.registerClass(SignBus,"SignBus");var DrawRoomControl=function(t){function e(e){var i=this;t.call(this),this.STATE_NONE="STATE_NONE",this.STATE_NORMAL="STATE_NOMAL",this.STATE_MOVE="STATE_MOVE",this._stage=e,this._startP=new egret.Point,this._endP=new egret.Point,this._fsm=new FSM,this._fsm.addState(this.STATE_NONE),this._fsm.addState(this.STATE_NORMAL),this._fsm.addState(this.STATE_MOVE),this._fsm.pushFront(this.STATE_NORMAL,function(){i._stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i.onTouchBegin,i)}),this._fsm.pushBack(this.STATE_NORMAL,function(){i._stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,i.onTouchBegin,i)}),this._fsm.pushFront(this.STATE_MOVE,function(){i._stage.addEventListener(egret.TouchEvent.TOUCH_END,i.onTouchEnd,i),i._stage.addEventListener(mouse.MouseEvent.MOUSE_MOVE,i.onTouchMove,i)}),this._fsm.pushBack(this.STATE_MOVE,function(){i._stage.removeEventListener(egret.TouchEvent.TOUCH_END,i.onTouchEnd,i),i._stage.removeEventListener(mouse.MouseEvent.MOUSE_MOVE,i.onTouchMove,i),i._roomVO=null}),this._fsm.pushFront(this.STATE_NONE,function(){i._stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,i.onTouchBegin,i),i._stage.removeEventListener(egret.TouchEvent.TOUCH_END,i.onTouchEnd,i),i._stage.removeEventListener(mouse.MouseEvent.MOUSE_MOVE,i.onTouchMove,i)})}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initListener=function(){this._fsm.switchTo(this.STATE_NORMAL)},n.removeListener=function(){this._fsm.switchTo(this.STATE_NONE)},n.onTouchBegin=function(t){this._fsm.currentState==this.STATE_NORMAL&&(this._startP.x=t.stageX,this._startP.y=t.stageY,this._endP.x=this._startP.x,this._endP.y=this._startP.y,this._fsm.switchTo(this.STATE_MOVE))},n.onTouchMove=function(t){if(this._endP.x=t.stageX,this._endP.y=t.stageY,this._startP.x!=this._endP.x||this._startP.y!=this._endP.y)if(null==this._roomVO)this._roomVO=new RectRoomVO(this._startP,this._endP),this.sendCommand(CommandNotification.CREATE_ROOM,this._roomVO);else{var e={room:this._roomVO,p0:this._startP,p1:this._endP};this.sendCommand(CommandNotification.MODIFY_ROOM,e)}},n.onTouchEnd=function(t){this._fsm.currentState==this.STATE_MOVE&&(this._startP.x!=this._endP.x||this._startP.y!=this._endP.y)&&this._fsm.switchTo(this.STATE_NORMAL)},e}(BaseControl);egret.registerClass(DrawRoomControl,"DrawRoomControl");var MainViewControl=function(t){function e(){t.call(this),this.STATE_DRAW_ROOM="STATE_DRAW_ROOM",this.STATE_NORMAL="STATE_NORMAL",this._houseVO=new HouseVO,this._fsm=new FSM,this.initControl(),this.initState()}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.initControl=function(){this._drawRoomControl=new DrawRoomControl(SignBus.appStage),this._sceneControl=new SceneControl(SignBus.appStage)},s.initState=function(){var t=this;this._fsm.addState(this.STATE_NORMAL),this._fsm.addState(this.STATE_DRAW_ROOM),this._fsm.pushFront(this.STATE_DRAW_ROOM,function(){t._drawRoomControl.start()}),this._fsm.pushBack(this.STATE_DRAW_ROOM,function(){t._drawRoomControl.stop()}),this._fsm.pushFront(this.STATE_NORMAL,function(){t._sceneControl.start()}),this._fsm.pushBack(this.STATE_NORMAL,function(){t._sceneControl.stop()}),this._fsm.init(this.STATE_DRAW_ROOM)},s.initListener=function(){this.on(ViewNotification.MOVE,this.onMove),this._view.btnRedo.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRedo,this),this._view.btnUndo.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onUndo,this),this._view.btnNormal.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onNormal,this),this._view.btnRoom.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRoom,this)},s.removeListener=function(){this.off(ViewNotification.TEST,this.onTest)},s.onRedo=function(t){this.sendCommand(CommandNotification.REDO),t.stopImmediatePropagation()},s.onUndo=function(t){this.sendCommand(CommandNotification.UNDO),t.stopImmediatePropagation()},s.onNormal=function(t){this._fsm.switchTo(this.STATE_NORMAL),t.stopImmediatePropagation()},s.onRoom=function(t){this._fsm.switchTo(this.STATE_DRAW_ROOM),t.stopImmediatePropagation()},s.onMove=function(t){var e=t.data[0];this._view.grid.moveDelta(e.x,e.y),this._view.wallView.x+=e.x,this._view.wallView.y+=e.y},s.onTest=function(t){console.log("test",t.data)},i(s,"view",void 0,function(t){this._view!=t&&(null==t&&this.stop(),this._view=t,null!=this._view&&(this.start(),null==this.wallViewControl&&(this.wallViewControl=new WallViewControl(this._view.wallView,this._houseVO))))}),e}(BaseControl);egret.registerClass(MainViewControl,"MainViewControl");var ViewNotification=function(){function t(){}var e=(__define,t);e.prototype;return t.TEST="TEST",t.MOVE="ViewNotification:MOVE",t}();egret.registerClass(ViewNotification,"ViewNotification");var SceneControl=function(t){function e(e){t.call(this),this.STATE_MOVE="STATE_MOVE",this.STATE_NOMAL="STATE_NOMAL",this._stage=e,this._downPos=new egret.Point,this._deltaPos=new egret.Point,this._curPos=new egret.Point,this._posArr=[this._deltaPos,this._curPos],this._fsm=new FSM,this.initState()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.initState=function(){this._fsm.addState(this.STATE_MOVE),this._fsm.addState(this.STATE_NOMAL),this._fsm.pushFront(this.STATE_MOVE,function(){Cursor.setCursor(Cursor.HAND)}),this._fsm.pushFront(this.STATE_NOMAL,function(){Cursor.setCursor(Cursor.AUTO)}),this._fsm.init(this.STATE_NOMAL)},n.initListener=function(){this._stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this)},n.removeListener=function(){this._stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this._stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},n.onTouch=function(t){this._downPos.x=t.stageX,this._downPos.y=t.stageY,this._curPos.x=this._downPos.x,this._curPos.y=this._downPos.y,this._stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._fsm.switchTo(this.STATE_MOVE)},n.onTouchEnd=function(t){this._stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this._stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._fsm.switchTo(this.STATE_NOMAL)},n.onTouchMove=function(t){var e=t.stageX,i=t.stageY;this._deltaPos.x=e-this._curPos.x,this._deltaPos.y=i-this._curPos.y,this._curPos.x=e,this._curPos.y=i,this.send(ViewNotification.MOVE,this._posArr)},e}(BaseControl);egret.registerClass(SceneControl,"SceneControl");var WallViewControl=function(t){function e(e,i){t.call(this),this._wallView=e,this._houseVO=i}__extends(e,t);var i=(__define,e),n=i.prototype;return n.refresh=function(){this._wallView.wallList=this._houseVO.wallList},n.checkRectRoomWall=function(t){var e,i;for(e=0,i=t.lineList.length;i>e;++e)this.getWallVO(t.lineList[e])},n.addRectRoom=function(t){var e,i,n,s,o;for(e=0,i=t.lineList.length;i>e;++e)for(this._houseVO.addLine(t.lineList[e]),o=t.lineList[e].walls,n=0,s=o.length;s>n;++n)this._houseVO.addWall(o[n]);this._wallView.wallList=this._houseVO.wallList},n.removeRectRoom=function(t){var e,i,n,s,o;for(e=0,i=t.lineList.length;i>e;++e)for(this._houseVO.removeLine(t.lineList[e]),o=t.lineList[e].walls,n=0,s=o.length;s>n;++n)this._houseVO.removeWall(o[n]);this._wallView.wallList=this._houseVO.wallList},n.getWallVO=function(t){var e=[],i=new WallVO;return i.p0=t.p0,i.p1=t.p1,e.push(i),t.walls=e,e},e}(BaseControl);egret.registerClass(WallViewControl,"WallViewControl");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},n.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},n.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.createView()},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},n.startCreateScene=function(){var t=new eui.Button;t.label="Click!",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},n.onButtonClick=function(t){var e=new eui.Panel;e.title="Title",e.horizontalCenter=0,e.verticalCenter=0,this.addChild(e)},n.createView=function(){var t=new MainView;this.addChild(t),SignBus.appStage=this.stage,mouse.enable(this.stage),mouse.setMouseMoveEnabled(!0),ControlManager.instance.mainViewControl.view=t},e}(eui.UILayer);egret.registerClass(Main,"Main");var ConstColor=function(){function t(){}var e=(__define,t);e.prototype;return t.WALL_COLOR=16777215,t}();egret.registerClass(ConstColor,"ConstColor");var ConstVO=function(){function t(){}var e=(__define,t);e.prototype;return t.PIXEL_METER=100,t.DEFAULT_WALL_THICKNESS=.12,t.WALL_THCKNESS=[.37,.3,.24,.2,.18,.12,.1],t}();egret.registerClass(ConstVO,"ConstVO");var HouseVO=function(){function t(){this.lineList=[],this.wallList=[]}var e=(__define,t),i=e.prototype;return i.addLine=function(t){-1==this.lineList.indexOf(t)&&this.lineList.push(t)},i.removeLine=function(t){var e=this.lineList.indexOf(t);e>=0&&this.lineList.splice(e,1)},i.addWall=function(t){-1==this.wallList.indexOf(t)&&this.wallList.push(t)},i.removeWall=function(t){var e=this.wallList.indexOf(t);e>=0&&this.wallList.splice(e,1)},t}();egret.registerClass(HouseVO,"HouseVO");var LineVO=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.thickness=ConstVO.DEFAULT_WALL_THICKNESS,this.p0=t,this.p1=e}var e=(__define,t);e.prototype;return t}();egret.registerClass(LineVO,"LineVO");var PointVO=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0),t.call(this,e,i)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.Point);egret.registerClass(PointVO,"PointVO");var RectRoomVO=function(){function t(t,e){this._lineList=[],this.leftTop=new PointVO(t.x,t.y),this.rightBottom=new PointVO(e.x,e.y),this.leftBottom=new PointVO(t.x,e.y),this.rightTop=new PointVO(e.x,t.y),this.topWall=new LineVO(this.leftTop,this.rightTop),this.bottomWall=new LineVO(this.leftBottom,this.rightBottom),this.leftWall=new LineVO(this.leftTop,this.leftBottom),this.rightWall=new LineVO(this.rightTop,this.rightBottom),this._lineList.push(this.topWall),this._lineList.push(this.bottomWall),this._lineList.push(this.leftWall),this._lineList.push(this.rightWall)}var e=__define,i=t,n=i.prototype;return n.reSize=function(t,e){this.leftTop.x=t.x,this.leftTop.y=t.y,this.rightBottom.x=e.x,this.rightBottom.y=e.y,this.leftBottom.x=t.x,this.leftBottom.y=e.y,this.rightTop.x=e.x,this.rightTop.y=t.y},e(n,"lineList",function(){return this._lineList}),t}();egret.registerClass(RectRoomVO,"RectRoomVO");var RoomVO=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(RoomVO,"RoomVO");var WallVO=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(WallVO,"WallVO");var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var Cursor=function(){function t(){}var e=(__define,t);e.prototype;return t.init=function(e){t.canvas=e},t.setCursor=function(e){switch(e){case t.AUTO:t.canvas.style.cursor=e;break;case t.HAND:t.canvas.style.cursor=e;break;default:t.canvas.style.cursor=t.AUTO}},t.AUTO="auto",t.HAND="pointer",t}();egret.registerClass(Cursor,"Cursor");var GridBackgroud=function(t){function e(){t.call(this),this.LINE_COLOE=13421772,this._size=25,this._posX=0,this._posY=0}__extends(e,t);var i=(__define,e),n=i.prototype;return n.setSize=function(t,e){(this._width!=t||this._height!=e)&&(this._width=t,this._height=e,this._invalide=!0,this.draw())},n.draw=function(){if(this._invalide){this._invalide=!1;var t,e,i=Math.ceil(this._width/this._size),n=Math.ceil(this._height/this._size);for(this.graphics.lineStyle(1,this.LINE_COLOE),t=-2;i+2>t;++t)this.graphics.moveTo(t*this._size,-2*this._size),this.graphics.lineTo(t*this._size,this._height+2*this._size);for(e=-2;n+2>e;++e)this.graphics.moveTo(-2*this._size,e*this._size),this.graphics.lineTo(this._width+2*this._size,e*this._size)}},n.setPosition=function(t,e){(this._posX!=t||this._posY!=e)&&(this._posX=t,this._posY=e,this._deltaX=this._posX%this._size,this._deltaY=this._posY%this._size,this.x=this._deltaX,this.y=this._deltaY)},n.moveDelta=function(t,e){var i=this._posX+t,n=this._posY+e;this.setPosition(i,n)},e}(egret.Shape);egret.registerClass(GridBackgroud,"GridBackgroud");var MainView=function(t){function e(){t.call(this),this.grid=new GridBackgroud,this.addChild(this.grid),this.wallView=new WallView,this.addChild(this.wallView);var e=new eui.Group;e.layout=new eui.HorizontalLayout,this.btnNew=new eui.Button,this.btnNew.label="new",this.btnNormal=new eui.Button,this.btnNormal.label="normal",this.btnRoom=new eui.Button,this.btnRoom.label="room",this.btnRedo=new eui.Button,this.btnRedo.label="redo",this.btnUndo=new eui.Button,this.btnUndo.label="undo",this.addChild(e),e.addChild(this.btnNew),e.addChild(this.btnNormal),e.addChild(this.btnRoom),e.addChild(this.btnRedo),e.addChild(this.btnUndo),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAdded=function(t){this.init()},n.init=function(){this.grid.setSize(this.stage.stageWidth,this.stage.stageHeight),this.initListener()},n.initListener=function(){this.stage.addEventListener(egret.Event.RESIZE,this.onResize,this)},n.onResize=function(){this.grid.setSize(this.stage.stageWidth,this.stage.stageHeight)},e}(egret.DisplayObjectContainer);egret.registerClass(MainView,"MainView");var WallComponent=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e,s=n.prototype;return i(s,"wallVO",void 0,function(t){this._wallVO=t,this.refresh()}),s.refresh=function(){this.graphics.clear(),this.graphics.lineStyle(2,ConstColor.WALL_COLOR),this.graphics.moveTo(this._wallVO.p0.x,this._wallVO.p0.y),this.graphics.lineTo(this._wallVO.p1.x,this._wallVO.p1.y)},e}(egret.Sprite);egret.registerClass(WallComponent,"WallComponent");var WallView=function(t){function e(){t.call(this),this._walls=[]}__extends(e,t);var i=__define,n=e,s=n.prototype;return i(s,"wallList",void 0,function(t){this._wallList=t,this.refresh()}),s.refresh=function(){var t,e;for(this.removeChildren(),t=0,e=this._wallList.length;e>t;++t){var i=new WallComponent;i.wallVO=this._wallList[t],this._walls.push(i),this.addChild(i)}},e}(egret.Sprite);egret.registerClass(WallView,"WallView");