var AssetManager=function(){function t(){}var e=(__define,t);e.prototype;return t.createBitmapByName=function(t,e){void 0===e&&(e=!0);var i=new egret.Bitmap,n=RES.getRes(t);return i.texture=n,e&&(i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2),i},t}();egret.registerClass(AssetManager,"AssetManager");var DBManager=function(){function t(){}var e=(__define,t);e.prototype;return t.addData=function(e,i,n){var s=RES.getRes(e),a=RES.getRes(i),o=RES.getRes(n);t._factory.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(s)),t._factory.addTextureAtlas(new dragonBones.EgretTextureAtlas(o,a))},t.buildArmature=function(e){return t._factory.buildArmature(e)},t.copyAnimation=function(e,i){t._factory.copyAnimationsToArmature(e,i.name)},t._factory=new dragonBones.EgretFactory,t}();egret.registerClass(DBManager,"DBManager");var Game=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAdded=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.init()},n.init=function(){console.log("this is a new game!"),this.initDB();var t=new SceneManager(this);t.registerScene("gameStart",new GameScene),t.registerScene("gameInfo",new GameInfo),t.registerScene("gameLevel",new GameLevel),t.setCurSceneByName("gameInfo"),t.startTick()},n.initDB=function(){DBManager.addData("MomoUI_json","texture_json","texture_png"),DBManager.addData("bubbles_json","texture2_json","texture2_png"),DBManager.addData("questAnim_json","texture3_json","texture3_png")},e}(egret.DisplayObjectContainer);egret.registerClass(Game,"Game");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},n.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.addChild(new Game))},n.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},n.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},n.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},n.createGameScene=function(){var t=this.createBitmapByName("bg_jpg"),e=this.stage.stageWidth,i=this.stage.stageHeight;t.width=e,t.height=i;var n=new egret.Shape;n.graphics.beginFill(0,.5),n.graphics.drawRect(0,0,e,172),n.graphics.endFill(),n.y=33,this.addChild(n);var s=this.createBitmapByName("egret_icon_png");this.addChild(s),s.x=26,s.y=33;var a=new egret.Shape;a.graphics.lineStyle(2,16777215),a.graphics.moveTo(0,0),a.graphics.lineTo(0,117),a.graphics.endFill(),a.x=172,a.y=61,this.addChild(a);var o=new egret.TextField;o.textColor=16777215,o.width=e-172,o.textAlign="center",o.text="Hello Egret",o.size=24,o.x=172,o.y=80,this.addChild(o);var r=new egret.TextField;this.addChild(r),r.alpha=0,r.width=e-172,r.textAlign=egret.HorizontalAlign.CENTER,r.size=24,r.textColor=16777215,r.x=172,r.y=135,this.textfield=r,RES.getResAsync("description_json",this.startAnimation,this);var h="man1",c=RES.getRes("skeleton_"+h+"_json"),_=RES.getRes("texture_"+h+"_json"),u=RES.getRes("texture_"+h+"_png"),d=new dragonBones.EgretFactory;d.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(c)),d.addTextureAtlas(new dragonBones.EgretTextureAtlas(u,_));var l=d.buildArmature(h),g=l.display;console.log(g),g.scaleX=.5,g.scaleY=.5,dragonBones.WorldClock.clock.add(l),this.addChild(g),g.x=200,g.y=600,l.animation.gotoAndPlay("Basic_ear",-1,-1,0),l.animation.timeScale=1,console.log(g,g.parent),egret.startTick(this.tick,this);var E=l.getSlot("R_ear"),m=E.display;m.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),g.touchChildren=!0,m.touchEnabled=!0;var T=l.getSlot("Head"),S=T.display;S.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},n.tick=function(t){return dragonBones.WorldClock.clock.advanceTime(-1),!0},n.onTouchBegin=function(t){var e=t.currentTarget;console.log("aaaaaaaaaaa",e)},n.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},n.startAnimation=function(t){for(var e=this,i=new egret.HtmlTextParser,n=[],s=0;s<t.length;s++)n.push(i.parser(t[s]));var a=e.textfield,o=-1,r=function(){o++,o>=n.length&&(o=0);var t=n[o];e.changeDescription(a,t);var i=egret.Tween.get(a);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(r,e)};r()},n.changeDescription=function(t,e){t.textFlow=e},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Quest=function(t){function e(e){t.call(this),this._questImage=AssetManager.createBitmapByName("quest_"+e+"_png"),this._questImage.scaleX=this._questImage.scaleY=.5,this.addChild(this._questImage),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAdded=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this._w=this.stage.stageWidth,this.show()},n.show=function(){this.effect1()},n.effect1=function(){var t=this;egret.Tween.get(this._questImage).to({x:this._w/2},500).wait(500).to({x:this._w},100).call(function(){t.parent.removeChild(t)})},e.QUEST_NOSE="nose",e.QUEST_HAIR="hair",e.QUEST_LEFT_EYE="lefrEye",e.QUEST_RIGHT_EYE="rightEye",e.QUEST_LEFT_EAR="leftEar",e.QUEST_RIGHT_EAR="rightEar",e.QUEST_MOUTH="mouth",e}(egret.Sprite);egret.registerClass(Quest,"Quest");var Role=function(t){function e(i,n){void 0===i&&(i="man1"),void 0===n&&(n=1),t.call(this),this.hotPoints=[e.LEFT_EAR,e.RIGHT_EAR,e.LEFT_EYE,e.RIGHT_EYE,e.MOUTH,e.NOSE,e.HAIR],this.name=i,this._scale=n,console.log("name armature",i);var s=RES.getRes("skeleton_"+i+"_json"),a=RES.getRes("texture_"+i+"_json"),o=RES.getRes("texture_"+i+"_png"),r=new dragonBones.EgretFactory;r.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(s)),r.addTextureAtlas(new dragonBones.EgretTextureAtlas(o,a)),this.armature=r.buildArmature(i);var h=this.armature.display;h.scaleX=this._scale,h.scaleY=this._scale,dragonBones.WorldClock.clock.add(this.armature),this.addChild(h),this.initEvent()}__extends(e,t);var i=__define,n=e,s=n.prototype;return s.initEvent=function(){var t,e,i,n,s;for(i=0,n=this.hotPoints.length;n>i;i++)s=this.hotPoints[i],t=this.armature.getSlot(s),t&&(e=t.display,e.name=s,e&&(e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchHotPoint,this)));this.armature.addEventListener(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this)},s.onAnimComplete=function(t){this.dispatchEvent(t)},s.onTouchHotPoint=function(t){var e=t.target.name,i=new RoleEvent(RoleEvent.TOUCH_HOT,e);this.dispatchEvent(i)},s.play=function(t){this.armature.animation.gotoAndPlay(t,0,-1,1)},s.gotoAndStop=function(t,e){this.armature.animation.gotoAndStop(t,e)},i(s,"totleTime",function(){return this.armature.animation.lastAnimationState.totalTime}),s.remove=function(){dragonBones.WorldClock.clock.remove(this.armature)},s.randomPart=function(){var t=Math.floor(Math.random()*this.hotPoints.length);return this.hotPoints[t]},e.LEFT_EAR="L_ear",e.RIGHT_EAR="R_ear",e.LEFT_EYE="L_eye",e.RIGHT_EYE="R_eye",e.MOUTH="Mouth",e.NOSE="Nose",e.HAIR="Shit",e.ANIM_EAR="Basic_ear",e.ANIM_EYE="Basic_eye",e.ANIM_EYE_1="Blink",e.ANIM_NOSE="Basic_sniff",e.ANIM_MOUTH="Basic_mouth",e.ANIM_HAIR="Shit jump",e.ANIM_IDLE="scratch",e.ANIM_ERROR="Basic_error",e.ANIM_MAP={L_ear:e.ANIM_EAR,R_ear:e.ANIM_EAR,L_eye:e.ANIM_EYE,R_eye:e.ANIM_EYE_1,Mouth:e.ANIM_MOUTH,Nose:e.ANIM_NOSE,Shit:e.ANIM_HAIR},e}(egret.Sprite);egret.registerClass(Role,"Role");var RoleManager=function(){function t(){this._roleDict={},this._roleSex={},this._roleSex.man1=1,this._roleSex.man2=1,this._roleSex.man3=1,this._roleSex.woman1=0,this._roleSex.woman2=0,this._roleSex.woman3=0}var e=(__define,t),i=e.prototype;return i.getRole=function(t){return console.log(t),null==this._roleDict[t]&&(this._roleDict[t]=new Role(t,1)),this._roleDict[t]},i.getRoleSex=function(t){return this._roleSex[t]},t.ROLES=["man1","man2","man3","woman1","woman2","woman3"],t}();egret.registerClass(RoleManager,"RoleManager");var RoleEvent=function(t){function e(e,i,n,s){void 0===i&&(i=null),void 0===n&&(n=!0),void 0===s&&(s=!1),t.call(this,e,n,s,i)}__extends(e,t);var i=(__define,e);i.prototype;return e.TOUCH_HOT="TOUCH_HOT",e}(egret.Event);egret.registerClass(RoleEvent,"RoleEvent");var BaseControl=function(){function t(){this._bus=SignBus.instance,this._commandNotification=new Notification(Notification.COMMAND),this._commandData={}}var e=(__define,t),i=e.prototype;return i.on=function(t,e,i){void 0===i&&(i=0),this._bus.addEventListener(t,e,this,!1,i)},i.off=function(t,e){this._bus.removeEventListener(t,e,this)},i.send=function(t,e){void 0===e&&(e=null),this._bus.dispatchEvent(new Notification(t,e))},i.sendCommand=function(t,e){void 0===e&&(e=null),this._commandData.command=t,this._commandData.data=e,this._commandNotification.data=this._commandData,this._bus.dispatchEvent(this._commandNotification)},i.start=function(){this._running||(this.initListener(),this._running=!0)},i.stop=function(){this._running=!1,this.removeListener()},i.initListener=function(){},i.removeListener=function(){},t}();egret.registerClass(BaseControl,"BaseControl");var Notification=function(t){function e(e,i){void 0===i&&(i=null),t.call(this,e,!1,!1,i)}__extends(e,t);var i=(__define,e);i.prototype;return e.COMMAND="NOTIFICATION:COMMAND",e}(egret.Event);egret.registerClass(Notification,"Notification");var SignBus=function(t){function e(){t.call(this)}__extends(e,t);var i=__define,n=e;n.prototype;return i(e,"instance",function(){return null==e._instance&&(e._instance=new e),e._instance}),e}(egret.Sprite);egret.registerClass(SignBus,"SignBus");var FSM=function(){function t(){this._states=[]}var e=__define,i=t,n=i.prototype;return n.init=function(t){this.switchTo(t)},n.addState=function(t){var e=this.getState(t);return null==e&&(e=new State(t),this._states.push(e)),e},n.removeState=function(t){var e,i;for(e=this._states.length-1;e>=0;--e)if(this._states[e].name==t)return i=this._states.splice(e,1),i[0];return null},n.getState=function(t){var e;for(e=this._states.length-1;e>=0;--e)if(this._states[e].name==t)return this._states[e]},e(n,"currentState",function(){return null==this._curState?null:this._curState.name}),n.switchTo=function(t){if(null!=this._curState){if(this._curState.name==t)return;this._curState.end()}this._curState=this.getState(t),this._curState&&this._curState.start()},n.pushFront=function(t,e){var i=this.getState(t);i&&i.pushFront(e)},n.pushBack=function(t,e){var i=this.getState(t);i&&i.pushBack(e)},t}();egret.registerClass(FSM,"FSM");var State=function(){function t(t){this._name=t,this._beginFun=[],this._endFun=[]}var e=__define,i=t,n=i.prototype;return e(n,"name",function(){return this._name}),n.pushFront=function(t){t&&-1==this._beginFun.indexOf(t)&&this._beginFun.push(t)},n.pushBack=function(t){t&&-1==this._endFun.indexOf(t)&&this._endFun.push(t)},n.start=function(){var t,e=this._beginFun.length;for(t=0;e>t;++t)this._beginFun[t].call(this)},n.end=function(){var t,e=this._endFun.length;for(t=0;e>t;++t)this._endFun[t].call(this)},t}();egret.registerClass(State,"State");var Scene=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.onAdded=function(t){this.init()},n.init=function(){console.log("this is a scene")},n.show=function(t){t.addChild(this)},n.next=function(t){this.dispatchEvent(new SceneEvent(SceneEvent.NEXT,t)),this.parent.removeChild(this)},n.tick=function(t){},e}(egret.DisplayObjectContainer);egret.registerClass(Scene,"Scene",["IScene","egret.IEventDispatcher"]);var SceneEvent=function(t){function e(e,i,n,s){void 0===n&&(n=!1),void 0===s&&(s=!1),t.call(this,e,n,s),this.data=i}__extends(e,t);var i=(__define,e);i.prototype;return e.NEXT="NEXT",e}(egret.Event);egret.registerClass(SceneEvent,"SceneEvent");var SceneManager=function(){function t(t){this._parent=t,this._sceneObj={}}var e=(__define,t),i=e.prototype;return i.startTick=function(){this._curTime=egret.getTimer(),egret.startTick(this.tick,this)},i.stopTick=function(){egret.stopTick(this.tick,this)},i.tick=function(t){return this._lastTime=this._curTime,this._curTime=t,this._curScene&&this._curScene.tick(this._curTime-this._lastTime),!0},i.registerScene=function(t,e){this._sceneObj[t]=e},i.setCurSceneByName=function(t){var e=this._sceneObj[t];e&&this.setCurScene(e)},i.setCurScene=function(t){this._curScene&&(this._curScene.removeEventListener(SceneEvent.NEXT,this.onNext,this),this._prevScene=this._curScene),this._curScene=t,this._curScene.show(this._parent),this._curScene.addEventListener(SceneEvent.NEXT,this.onNext,this)},i.onNext=function(t){var e=this._sceneObj[t.data];e&&this.setCurScene(e)},t}();egret.registerClass(SceneManager,"SceneManager");var GameInfo=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.init=function(){var t=AssetManager.createBitmapByName("ui0_jpg");t.x=this.stage.stageWidth/2,t.y=this.stage.stageHeight/2,this.addChild(t),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this)},n.onTouch=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.next("gameLevel")},e}(Scene);egret.registerClass(GameInfo,"GameInfo");var GameLevel=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.init=function(){var t=AssetManager.createBitmapByName("ui1_jpg");t.x=this.stage.stageWidth/2,t.y=this.stage.stageHeight/2,this.addChild(t),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this)},n.onTouch=function(t){this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.next("gameStart")},e}(Scene);egret.registerClass(GameLevel,"GameLevel");var GameScene=function(t){function e(){t.call(this),this._fsm=new FSM,this.STATE_NORMAL="STATE_NORMAL",this.STATE_QUEST="STATE_QUEST",this.STATE_QUEST_DO="STATE_QUEST_DO",this.STATE_QUEST_DONE="STATE_QUEST_DONE",this.STATE_QUEST_MISS="STATE_QUEST_MISS",this.STATE_QUEST_OUTTIME="STATE_QUEST_OUTTIME",this.STATE_OVER="STATE_OVER",this._timeConfig={},this._questConfig={},this._curQuestNum=0,this._curScore=0,this._totalScore=3,this._scoreMaskW=10,this._timeConfig.normalTime_min=3e3,this._timeConfig.normalTime_max=3e3,this._timeConfig.questTime=100,this._timeConfig.questDoTime=3e3,this._timeConfig.questResultTime=2e3,this._questConfig.questNum=3,this._txtHelp=new egret.TextField,this._questPartMap={L_ear:Quest.QUEST_LEFT_EAR,R_ear:Quest.QUEST_RIGHT_EAR,L_eye:Quest.QUEST_LEFT_EYE,R_eye:Quest.QUEST_RIGHT_EYE,Shit:Quest.QUEST_HAIR,Mouth:Quest.QUEST_MOUTH,Nose:Quest.QUEST_NOSE},this._questIndexMap={L_ear:6,R_ear:2,L_eye:5,R_eye:1,Shit:0,Mouth:4,Nose:3},this._totalScore=this._questConfig.questNum}__extends(e,t);var i=(__define,e),n=i.prototype;return n.addTip=function(t){this._txtHelp.text=t},n.init=function(){t.prototype.init.call(this),this._roleManager=new RoleManager;var e=DBManager.buildArmature("MomoUI"),i=e.display;e.display.x=this.stage.stageWidth/2,e.display.y=this.stage.stageHeight,this.addChild(i);var n=e.getSlot("progressBar");this._scoreBar=n.display,this._scoreMask=new egret.Shape,this._scoreMask.graphics.beginFill(16776960),this._scoreMask.graphics.drawRect(0,0,this._scoreBar.width,this._scoreBar.height),this.addChild(this._scoreMask),this._scoreMaskW=this._scoreBar.width,this._scoreMask.x=-this._scoreMaskW,this._scoreBar.mask=this._scoreMask,this._mainRole=this._roleManager.getRole("man1"),this._mainRole.x=this.stage.stageWidth/2,this._mainRole.y=this.stage.stageHeight,this.addChild(this._mainRole);var s=DBManager.buildArmature("Bubble1"),a=s.display;dragonBones.WorldClock.clock.add(s),s.animation.gotoAndPlay("float"),a.x=this.stage.stageWidth/8,a.y=this.stage.stageHeight-100;var o=DBManager.buildArmature("Bubble2");this._countDownSlot=o.getSlot("medium");var r=o.display;dragonBones.WorldClock.clock.add(o),DBManager.copyAnimation(o,s),o.animation.gotoAndPlay("float"),r.x=this.stage.stageWidth/2,r.y=this.stage.stageHeight-100;var h=DBManager.buildArmature("Bubble3"),c=h.display;dragonBones.WorldClock.clock.add(h),DBManager.copyAnimation(h,s),h.animation.gotoAndPlay("float"),c.touchEnabled=!0,c.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onPause,this),c.x=this.stage.stageWidth/8*7,c.y=this.stage.stageHeight-100,this.addChild(a),this.addChild(r),this.addChild(c),this._questArm=DBManager.buildArmature("QuestAnim"),this._questSlot=this._questArm.getSlot("quest"),this._questSlot.displayController="no_anim",this._questSlot.displayIndex=-1,dragonBones.WorldClock.clock.add(this._questArm),this._questArm.display.x=this.stage.stageWidth/2,this._questArm.display.y=220,this.addChild(this._questArm.display),this.initEvent(),this.initState(),this.addChild(this._txtHelp)},n.initEvent=function(){},n.onPause=function(t){console.log("aaaa"),this._pause=!this._pause},n.onTouchHot=function(t){var e=t.data;e==this._curQuestName?this._fsm.switchTo(this.STATE_QUEST_DONE):(this.failHit(),this._fsm.switchTo(this.STATE_QUEST_MISS))},n.onAnimComplete=function(t){console.log(t.animationName,"complete")},n.initState=function(){var t=this;this._fsm.addState(this.STATE_NORMAL),this._fsm.addState(this.STATE_QUEST),this._fsm.addState(this.STATE_QUEST_DO),this._fsm.addState(this.STATE_QUEST_DONE),this._fsm.addState(this.STATE_QUEST_MISS),this._fsm.addState(this.STATE_QUEST_OUTTIME),this._fsm.addState(this.STATE_OVER),this._fsm.pushFront(this.STATE_NORMAL,function(){t._mainRole.play(Role.ANIM_IDLE),t._curTime=0,t._targetTime=t._timeConfig.normalTime_min+Math.floor(Math.random()*(t._timeConfig.normalTime_max-t._timeConfig.normalTime_max)),console.log(t._fsm.currentState),t.addTip("normal state"),t._countDownSlot.displayIndex=2}),this._fsm.pushBack(this.STATE_NORMAL,function(){t._countDownSlot.displayIndex=-1}),this._fsm.pushFront(this.STATE_QUEST,function(){t._curTime=0,t._targetTime=t._timeConfig.questTime,t._curQuestNum++,console.log(t._fsm.currentState),t.createQuest(),t.playQuestAnim(),t.addTip("quest state : "+t._curQuestName)}),this._fsm.pushFront(this.STATE_QUEST_DO,function(){t._curTime=0,t._targetTime=t._timeConfig.questDoTime,console.log(t._fsm.currentState),t.addRoleTouchEvent(),t.addTip("do quest")}),this._fsm.pushBack(this.STATE_QUEST_DO,function(){t.removeRoleTouchEvent()}),this._fsm.pushFront(this.STATE_QUEST_DONE,function(){t._curTime=0,t._targetTime=t._timeConfig.questResultTime,console.log(t._fsm.currentState),t.playHitAnim(),t.addScore(),t.addTip("quest done")}),this._fsm.pushFront(this.STATE_QUEST_MISS,function(){t._curTime=0,t._targetTime=t._timeConfig.questResultTime,console.log(t._fsm.currentState),t.playMissAnim(),t.failHit(),t.addTip("quest miss")}),this._fsm.pushFront(this.STATE_QUEST_OUTTIME,function(){t._curTime=0,t._targetTime=t._timeConfig.questResultTime,console.log(t._fsm.currentState),t.playOutAnim(),t.failHit(),t.addTip("quest time out")}),this._fsm.pushFront(this.STATE_OVER,function(){t._curTime=0,console.log(t._fsm.currentState),t.levelOver(),t.addTip("quest level over")}),this._fsm.init(this.STATE_NORMAL)},n.levelOver=function(){var t=this,e=new ScoreBoard;e.x=this.stage.stageWidth/2,e.y=this.stage.stageHeight/2,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_END,function(e){t.next("gameInfo")},this),this.addChild(e)},n.tick=function(t){this._pause||(dragonBones.WorldClock.clock.advanceTime(t/1e3),this._curTime+=t,this._curTime>this._targetTime&&this.stateChange(),this._fsm.currentState==this.STATE_NORMAL&&this.updateCountDown())},n.updateCountDown=function(){this._curTime>2e3?this._countDownSlot.displayIndex=0:this._curTime>1e3&&(this._countDownSlot.displayIndex=1)},n.stateChange=function(){switch(this._fsm.currentState){case this.STATE_NORMAL:this._curQuestNum>this._questConfig.questNum?this._fsm.switchTo(this.STATE_OVER):this._fsm.switchTo(this.STATE_QUEST);break;case this.STATE_QUEST:this._fsm.switchTo(this.STATE_QUEST_DO);break;case this.STATE_QUEST_DO:this._fsm.switchTo(this.STATE_QUEST_OUTTIME);break;case this.STATE_QUEST_DONE:case this.STATE_QUEST_MISS:case this.STATE_QUEST_OUTTIME:this._fsm.switchTo(this.STATE_NORMAL)}},n.createQuest=function(){this._curQuestName=this._mainRole.randomPart()},n.playQuestAnim=function(){this._questSlot.displayIndex=this._questIndexMap[this._curQuestName];var t=Math.floor(11*Math.random());this._questArm.animation.play("quest"+t,1)},n.addRoleTouchEvent=function(){this._mainRole.addEventListener(RoleEvent.TOUCH_HOT,this.onTouchHot,this),this._mainRole.addEventListener(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this)},n.removeRoleTouchEvent=function(){this._mainRole.removeEventListener(RoleEvent.TOUCH_HOT,this.onTouchHot,this),this._mainRole.removeEventListener(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this)},n.playHitAnim=function(){this._mainRole.play(Role.ANIM_MAP[this._curQuestName])},n.addScore=function(){this._curScore++,this._scoreMask.x=-(1-this._curScore/this._totalScore)*this._scoreMaskW,console.log(this._curScore,this._curScore/this._totalScore,this._scoreMask.x)},n.playMissAnim=function(){},n.playOutAnim=function(){},n.failHit=function(){this._mainRole.play(Role.ANIM_ERROR)},e}(Scene);egret.registerClass(GameScene,"GameScene");var ScoreBoard=function(t){function e(){t.call(this),this._bg=AssetManager.createBitmapByName("ui3_png"),this.addChild(this._bg)}__extends(e,t);var i=(__define,e);i.prototype;return e}(egret.Sprite);egret.registerClass(ScoreBoard,"ScoreBoard");