var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),State=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.prototype.onAdded=function(t){this.init()},e.prototype.init=function(){console.log("this is a state")},e.prototype.show=function(t){t.addChild(this)},e.prototype.next=function(t){this.dispose(),this.dispatchEvent(new StateEvent(StateEvent.NEXT,t)),this.parent.removeChild(this)},e.prototype.tick=function(t){},e.prototype.dispose=function(){},e}(egret.DisplayObjectContainer);__reflect(State.prototype,"State",["IState","egret.IEventDispatcher"]);var StateBG=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.stageWidth=this.stage.stageWidth,this.stageHeight=this.stage.stageHeight,console.log("stage:",this.stageWidth,this.stageHeight)},Object.defineProperty(e.prototype,"bg",{set:function(t){this.background=AssetManager.getBitmap(t),this.background&&this.stage&&(this.background.x=this.stageWidth/2,this.background.y=this.stageHeight/2,this.addChild(this.background))},enumerable:!0,configurable:!0}),e}(State);__reflect(StateBG.prototype,"StateBG");var Level1=function(t){function e(){var e=t.call(this)||this;e.SHOW_TIME=3e3,e.BEST_UP_TIME=100,e.BEST_DOWN_TIME=100,e.GOOD_UP_TIME=300,e.GOOD_DOWN_TIME=300,e.MISS_TIME=100,e.SPEED=.3,e.HIT_POSITION=1110,e._curPoints=[],e._curEffects=[],e._pointPool=new RhythmPointPool,e._curRhythm=[];var i;for(i=0;95>i;i++)e._curRhythm.push(1e3*i+3e3);return e._pointContainer=new egret.DisplayObjectContainer,e._effectContainer=new egret.DisplayObjectContainer,e._dbClock=new dragonBones.WorldClock(0),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.bg="mb9_png",this._rhythmBar=AssetManager.getBitmap("mb10_png",!0,!1),this._rhythmBar.x=this.stageWidth/2,this._rhythmBar.y=0,this.addChild(this._rhythmBar);var e=new egret.Shape;e.graphics.beginFill(16777215),e.graphics.drawRect(0,0,10,1080),e.graphics.endFill(),e.x=this.stageWidth/2-5,this.addChild(e),this._pointContainer.x=this.stageWidth/2,this._pointContainer.y=0,this.addChild(this._pointContainer),this._score=new ScoreData,this._meow=new Meow,this._effectContainer.x=this.stageWidth/2,this._effectContainer.y=this._rhythmBar.height+0,this.addChild(this._effectContainer),this._meow.x=this.stageWidth/2,this._meow.y=this._rhythmBar.height+600,this._meow.addClock(this._dbClock),this.addChild(this._meow),this._scoreTxt=new egret.TextField,this._scoreTxt.size=80,this._scoreTxt.x=20,this._scoreTxt.y=20,this.addChild(this._scoreTxt),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this);var i=AssetManager.getBitmap("d3_png"),n=AssetManager.getBitmap("d2_png"),o=AssetManager.getBitmap("d1_png");i.x=n.x=o.x=this.stageWidth/2,i.y=n.y=o.y=this.stageHeight/4;var s=this;s.addChild(i),setTimeout(function(){s.removeChild(i),s.addChild(n)},1e3),setTimeout(function(){s.removeChild(n),s.addChild(o)},2e3),setTimeout(function(){s.removeChild(o),s.gameStart()},3e3)},e.prototype.updateScore=function(){this._scoreTxt&&this._score&&(this._scoreTxt.text="best:"+this._score.curBestHit+"\ngood:"+this._score.curGoodHit+"\ncomboo:"+this._score.curComboo+"\n")},e.prototype.gameEnd=function(){},e.prototype.gameStart=function(){"iOS"==egret.Capabilities.os?this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onIOSStart,this):this.soundStart()},e.prototype.onIOSStart=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onIOSStart,this),this.soundStart()},e.prototype.soundStart=function(){this._curTime=0,this._startGame=!0,this.bgSound=AssetManager.getSound("nianiania40m_mp3"),this.bgChannel=this.bgSound.play(0,1)},e.prototype.addEffect=function(t){var e=new HitEffect(t);this._effectContainer.addChild(e),e.start(),this._curEffects.push(e)},e.prototype.clearEffect=function(){var t,e,i;for(t=0,e=this._curEffects.length;e>t;t++)i=this._curEffects[t],i.isEnd&&(this._curEffects.splice(t,1),t--,e--,i.parent&&i.parent.removeChild(i))},e.prototype.onTouchBegin=function(t){this._meow&&this._meow.playHit(),this._startGame&&this.hitRhythm()},e.prototype.bestHit=function(){this.addEffect(HitEffect.BEST),this._score.curBestHit++,this.updateScore()},e.prototype.goodHit=function(){this.addEffect(HitEffect.GOOD),this._score.curGoodHit++,this.updateScore()},e.prototype.missHit=function(){this._score.curMissHit++,this.updateScore()},e.prototype.tick=function(t){this._dbClock.advanceTime(t/1e3),this._startGame&&(this.bgChannel?this._curTime=1e3*this.bgChannel.position:this._curTime+=t,this._loopLockPoint=!0,this.addRhythm(),this.moveRhythm(),this.removeRhythm(),this._loopLockPoint=!1,this.clearEffect())},e.prototype.hitRhythm=function(){if(!this._loopLockPoint){var t,e,i,n;for(t=0,e=this._curPoints.length;e>t&&(i=this._curPoints[t],!(i.hit-this.GOOD_UP_TIME>this._curTime));t++)i.hit+this.BEST_DOWN_TIME>=this._curTime&&i.hit-this.BEST_UP_TIME<=this._curTime?(n=!0,this.bestHit(),this.removePoint(t),t--,e--):i.hit+this.GOOD_DOWN_TIME>=this._curTime&&i.hit-this.GOOD_UP_TIME<=this._curTime&&(n=!0,this.goodHit(),this.removePoint(t),t--,e--);n||this.addEffect(HitEffect.MISS)}},e.prototype.removePoint=function(t){var e=this._curPoints[t];this._pointPool.disposePoint(e),this._curPoints.splice(t,1),e.parent&&e.parent.removeChild(e)},e.prototype.addRhythm=function(){if(this._curRhythm.length>0)for(var t=this._curRhythm[0];t-3e3<this._curTime;){this._curRhythm.shift();var e=this._pointPool.getPoint();if(e.hit=t,this._pointContainer.addChild(e),this._curPoints.push(e),!(this._curRhythm.length>0)){t=Number.MAX_VALUE;break}t=this._curRhythm[0]}},e.prototype.moveRhythm=function(){var t,e,i;for(t=0,e=this._curPoints.length;e>t;t++)i=this._curPoints[t],i.y=(this._curTime-i.hit)*this.SPEED+this.HIT_POSITION},e.prototype.removeRhythm=function(){var t,e,i;for(t=0,e=this._curPoints.length;e>t;t++)i=this._curPoints[t],this._curTime>=i.hit+this.MISS_TIME&&(this._pointPool.disposePoint(i),this._curPoints.splice(t,1),t--,e--,i.parent&&i.parent.removeChild(i),this.missHit())},e.prototype.over=function(){this.next("levelSelect")},e.prototype.dispose=function(){this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(StateBG);__reflect(Level1.prototype,"Level1");var KingkongItemPool=function(){function t(){this._pool=[]}return t.prototype.getItem=function(){return this._pool.length?this._pool.pop():new KingkongItem},t.prototype.disposeItem=function(t){-1==this._pool.indexOf(t)&&this._pool.push(t)},t}();__reflect(KingkongItemPool.prototype,"KingkongItemPool");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){if("preload"==t.groupName){this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this);var e=new Game;this.addChild(e)}},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,i=this.stage.stageHeight;t.width=e,t.height=i;var n=new egret.Shape;n.graphics.beginFill(0,.5),n.graphics.drawRect(0,0,e,172),n.graphics.endFill(),n.y=33,this.addChild(n);var o=this.createBitmapByName("egret_icon_png");this.addChild(o),o.x=26,o.y=33;var s=new egret.Shape;s.graphics.lineStyle(2,16777215),s.graphics.moveTo(0,0),s.graphics.lineTo(0,117),s.graphics.endFill(),s.x=172,s.y=61,this.addChild(s);var r=new egret.TextField;r.textColor=16777215,r.width=e-172,r.textAlign="center",r.text="Hello Egret",r.size=24,r.x=172,r.y=80,this.addChild(r);var a=new egret.TextField;this.addChild(a),a.alpha=0,a.width=e-172,a.textAlign=egret.HorizontalAlign.CENTER,a.size=24,a.textColor=16777215,a.x=172,a.y=135,this.textfield=a,RES.getResAsync("description_json",this.startAnimation,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,n=t.map(function(t){return i.parse(t)}),o=this.textfield,s=-1,r=function(){s++,s>=n.length&&(s=0);var t=n[s];o.textFlow=t;var i=egret.Tween.get(o);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(r,e)};r()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Meow=function(t){function e(){var e=t.call(this)||this,i="meow",n=RES.getRes(i+"_ske_json"),o=RES.getRes(i+"_tex_json"),s=RES.getRes(i+"_tex_png"),r=new dragonBones.EgretFactory;r.parseDragonBonesData(n),r.parseTextureAtlasData(o,s),e.armature=r.buildArmature(i);var a=e.armature.display;return e.addChild(a),e}return __extends(e,t),e.prototype.addClock=function(t){t.add(this.armature)},e.prototype.playHit=function(){this.armature.animation.play("hit",1)},e}(egret.Sprite);__reflect(Meow.prototype,"Meow");var RhythmPoint=function(t){function e(){var e=t.call(this)||this;return e.graphics.beginFill(16777215),e.graphics.drawCircle(0,0,20),e.graphics.endFill(),e}return __extends(e,t),e}(egret.Shape);__reflect(RhythmPoint.prototype,"RhythmPoint");var RhythmPointPool=function(){function t(){this._pool=[]}return t.prototype.getPoint=function(){return this._pool.length?this._pool.pop():new RhythmPoint},t.prototype.disposePoint=function(t){-1==this._pool.indexOf(t)&&this._pool.push(t)},t}();__reflect(RhythmPointPool.prototype,"RhythmPointPool");var ScoreData=function(){function t(){this._curBestHit=0,this._curGoodHit=0,this._curMissHit=0,this._curComboo=0,this.maxBestHit=0,this.maxGoodHit=0,this.maxMissHit=0,this.maxComboo=0}return Object.defineProperty(t.prototype,"curBestHit",{get:function(){return this._curBestHit},set:function(t){this._curBestHit=t,this.maxBestHit<this._curBestHit&&(this.maxBestHit=this._curBestHit),this.curComboo++,console.log("cur best:",this._curBestHit)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curGoodHit",{get:function(){return this._curGoodHit},set:function(t){this._curGoodHit=t,this.maxGoodHit<this._curGoodHit&&(this.maxGoodHit=this._curGoodHit),this.curComboo++,console.log("cur good:",this._curGoodHit)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curMissHit",{get:function(){return this._curMissHit},set:function(t){this._curMissHit=t,this.maxMissHit<this._curMissHit&&(this.maxMissHit=this._curMissHit),this._curComboo=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curComboo",{get:function(){return this._curComboo},set:function(t){this._curComboo=t,this.maxComboo<this._curComboo&&(this.maxComboo=this._curComboo),console.log("cur comboo:",this._curComboo)},enumerable:!0,configurable:!0}),t}();__reflect(ScoreData.prototype,"ScoreData");var GameChallenge=function(t){function e(){var e=t.call(this)||this,i="challenge",n=RES.getRes(i+"_ske_json"),o=RES.getRes(i+"_tex_json"),s=RES.getRes(i+"_tex_png"),r=new dragonBones.EgretFactory;r.parseDragonBonesData(n),r.parseTextureAtlasData(o,s),e.armatureDisplay=r.buildArmatureDisplay(i),e.armature=e.armatureDisplay.armature;var a=e.armature.getSlot("avatar1"),h=e.armature.getSlot("avatar2"),g=e.armature.getBone("avatar1"),u=e.armature.getBone("avatar2");g.offset.scaleX=2,g.offset.scaleY=2,g.offset.y=200,u.offset.scaleX=2,u.offset.scaleY=2,u.offset.y=400;var c=new Avatar("avatar1"),p=new Avatar("avatar1");return c.normal(),p.normal(),a&&(a.offset.scaleX=2,a.offset.scaleY=2,a.display=c),h&&(h.display=p),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.armatureDisplay.x=this.stageWidth/2,this.armatureDisplay.y=this.stageHeight/2,this.addChild(this.armatureDisplay),this.armature.animation.gotoAndPlayByFrame("run",0,1),this.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.onStart,this)},e.prototype.onStart=function(t){this.armature.getSlot("avatar1");this.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.onStart,this),this.over()},e.prototype.onTouchBegin=function(t){this.over()},e.prototype.over=function(){this.armature.animation.stop(),this.next("gameKingkong")},e.prototype.dispose=function(){this.armature.animation.stop(),this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(StateBG);__reflect(GameChallenge.prototype,"GameChallenge");var GameKingkong=function(t){function e(){var e=t.call(this)||this;e._dbClock=new dragonBones.WorldClock(0),e._uiContainer=new egret.DisplayObjectContainer,e._sceneLeft=new KingkongScene(!0,e._uiContainer),e._sceneRight=new KingkongScene;var i="ui",n=RES.getRes(i+"_ske_json"),o=RES.getRes(i+"_tex_json"),s=RES.getRes(i+"_tex_png"),r=new dragonBones.EgretFactory;return r.parseDragonBonesData(n),r.parseTextureAtlasData(o,s),e._progress1=new DBProgress(r.buildArmatureDisplay("progress1")),e._progress2=new DBProgress(r.buildArmatureDisplay("progress2")),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.bg="bg_jpg",this._sceneLeft.addClock(this._dbClock),this.addChild(this._sceneLeft),this._sceneRight.self=!1,this._sceneRight.addClock(this._dbClock),this._sceneRight.scaleX=-1,this._sceneRight.scaleY=-1,this._sceneRight.x=this.stageWidth,this._sceneRight.y=this.stageHeight,this.addChild(this._sceneRight),this.addChild(this._uiContainer),this._progress1.x=this.stageWidth/2,this._progress2.x=this.stageWidth/2,this._uiContainer.addChild(this._progress2),this._uiContainer.addChild(this._progress1),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._sceneLeft.addEventListener(Kingkong.EVENT_SHOOT,this.onLeftShoot,this),this._sceneRight.addEventListener(Kingkong.EVENT_SHOOT,this.onRightShoot,this),this._sceneLeft.addEventListener(Kingkong.EVENT_WIN,this.onLeftWin,this),this._sceneRight.addEventListener(Kingkong.EVENT_WIN,this.onRightWin,this),this._sceneLeft.addEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneLeft.addEventListener(Kingkong.EVENT_GAME_OVER,this.onGameOver,this),this._sceneRight.addEventListener(Kingkong.EVENT_GAME_OVER,this.onGameOver,this)},e.prototype.onGameOver=function(t){this._progress2&&(this._progress2.progress=0),this._progress1&&(this._progress1.progress=0),this._sceneLeft.dispose(),this._sceneRight.dispose(),this._win?this.next("gameWin"):this.next("gameLose")},e.prototype.onGameStart=function(t){this._win=!1,this._sceneRight.startRun()},e.prototype.onLeftWin=function(t){this._win=!0,this._sceneRight.fail()},e.prototype.onRightWin=function(t){this._win=!1,this._sceneLeft.fail()},e.prototype.onLeftShoot=function(t){this._sceneRight.addBoom()},e.prototype.onRightShoot=function(t){this._sceneLeft.addBoom()},e.prototype.onTouchBegin=function(t){t.stageX<this.stageWidth/2?t.stageY>this.stageHeight/2?this._sceneLeft.touchLeft():this._sceneRight.touchRight():t.stageY>this.stageHeight/2?this._sceneLeft.touchRight():this._sceneRight.touchLeft()},e.prototype.tick=function(t){this._dbClock.advanceTime(t/1e3),this._sceneLeft.gameStart&&(this._progress2&&(this._progress2.progress=this._sceneLeft.progress),this._progress1&&(this._progress1.progress=this._sceneRight.progress))},e.prototype.dispose=function(){this.stage&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_SHOOT,this.onLeftShoot,this),this._sceneRight.removeEventListener(Kingkong.EVENT_SHOOT,this.onRightShoot,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_WIN,this.onLeftWin,this),this._sceneRight.removeEventListener(Kingkong.EVENT_WIN,this.onRightWin,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneRight.removeEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this)},e}(StateBG);__reflect(GameKingkong.prototype,"GameKingkong");var GameLose=function(t){function e(){var e=t.call(this)||this,i="ui",n=RES.getRes(i+"_ske_json"),o=RES.getRes(i+"_tex_json"),s=RES.getRes(i+"_tex_png"),r=new dragonBones.EgretFactory;r.parseDragonBonesData(n),r.parseTextureAtlasData(o,s);var a="losePage";e.armatureDisplay=r.buildArmatureDisplay(a),e.armature=e.armatureDisplay.armature,e.txtGold=new egret.TextField,e.txtScore=new egret.TextField,e.txtGold.size=60,e.txtGold.text="+100",e.txtScore.size=60,e.txtScore.text="+88",e.btnQuit=new DBButton(r.buildArmatureDisplay("btnQuit")),e.btnShare=new DBButton(r.buildArmatureDisplay("btnShare")),e.btnReplay=new DBButton(r.buildArmatureDisplay("btnReplay"));var h=e.armature.getSlot("avatar"),g=e.armature.getSlot("btnShare"),u=e.armature.getSlot("btnQuit"),c=e.armature.getSlot("btnReplay"),p=e.armature.getSlot("txtGold"),_=e.armature.getSlot("txtScore"),l=new Avatar("avatar1");return dragonBones.EgretFactory.factory.clock.add(l.armature),l.lose(),h&&(h.offset.scaleX=2,h.offset.scaleY=2,h.display=l),g.display=e.btnShare,u.display=e.btnQuit,c.display=e.btnReplay,_.display=e.txtScore,p.display=e.txtGold,e.armatureDisplay.touchChildren=!0,e.btnReplay.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onReplay,e),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.armatureDisplay.x=this.stageWidth/2,this.armatureDisplay.y=this.stageHeight/2,this.addChild(this.armatureDisplay),this.armature.animation.gotoAndPlayByFrame("run",0,1)},e.prototype.onReplay=function(t){this.replay()},e.prototype.replay=function(){this.armature.animation.stop(),this.next("gameChallenge")},e.prototype.dispose=function(){this.armature.animation.stop(),this.removeChildren()},e}(StateBG);__reflect(GameLose.prototype,"GameLose");var GameWin=function(t){function e(){var e=t.call(this)||this,i="ui",n=RES.getRes(i+"_ske_json"),o=RES.getRes(i+"_tex_json"),s=RES.getRes(i+"_tex_png"),r=new dragonBones.EgretFactory;r.parseDragonBonesData(n),r.parseTextureAtlasData(o,s);var a="winPage";e.armatureDisplay=r.buildArmatureDisplay(a),e.armature=e.armatureDisplay.armature,e.txtGold=new egret.TextField,e.txtScore=new egret.TextField,e.txtGold.size=60,e.txtGold.text="+100",e.txtScore.size=60,e.txtScore.text="+88",e.btnQuit=new DBButton(r.buildArmatureDisplay("btnQuit")),e.btnShare=new DBButton(r.buildArmatureDisplay("btnShare")),e.btnReplay=new DBButton(r.buildArmatureDisplay("btnReplay"));var h=e.armature.getSlot("avatar"),g=e.armature.getSlot("btnShare"),u=e.armature.getSlot("btnQuit"),c=e.armature.getSlot("btnReplay"),p=e.armature.getSlot("txtGold"),_=e.armature.getSlot("txtScore"),l=new Avatar("avatar1");return dragonBones.EgretFactory.factory.clock.add(l.armature),l.win(),h&&(h.offset.scaleX=2,h.offset.scaleY=2,h.display=l),g.display=e.btnShare,u.display=e.btnQuit,c.display=e.btnReplay,_.display=e.txtScore,p.display=e.txtGold,e.armatureDisplay.touchChildren=!0,e.btnReplay.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onReplay,e),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.armatureDisplay.x=this.stageWidth/2,this.armatureDisplay.y=this.stageHeight/2,this.addChild(this.armatureDisplay),this.armature.animation.gotoAndPlayByFrame("run",0,1)},e.prototype.onReplay=function(t){this.replay()},e.prototype.replay=function(){this.armature.animation.stop(),this.next("gameChallenge")},e.prototype.dispose=function(){this.armature.animation.stop(),this.removeChildren()},e}(StateBG);__reflect(GameWin.prototype,"GameWin");var KingkongScene=function(t){function e(e,i){void 0===e&&(e=!1),void 0===i&&(i=null);var n=t.call(this)||this;n._totalDistance=35570,n._curItemConfigs=[],n._curItems=[],n._kingkongPosMinY=1521,n._kingkongPosMaxY=1900,n._fastLastTime=3,n.self=!0,n._kingkongOffsetY=450,n._curLevel=1,n.progress=0,n.master=e,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAdded,n),n._building=new Building,n._kingkong=new Kingkong(e),n._itemContainer=new egret.DisplayObjectContainer,i?n._uiContainer=i:n._uiContainer=new egret.DisplayObjectContainer,n._txtTime=new egret.TextField,n._itemsPool=new KingkongItemPool;var o="ui",s=RES.getRes(o+"_ske_json"),r=RES.getRes(o+"_tex_json"),a=RES.getRes(o+"_tex_png"),h=new dragonBones.EgretFactory;return h.parseDragonBonesData(s),h.parseTextureAtlasData(r,a),n.btnJump=new DBAnimButton(h.buildArmatureDisplay("btnJump")),n.btnShoot=new DBAnimButton(h.buildArmatureDisplay("btnShoot")),n._tip=h.buildArmatureDisplay("tip"),n._avatar=new Avatar("avatar1"),n}return __extends(e,t),Object.defineProperty(e.prototype,"gameStart",{get:function(){return this._gameStart},enumerable:!0,configurable:!0}),e.prototype.addTip=function(){this._tip&&(this._tip.animation.play("run"),this._tip.x=this.btnJump.x,this._tip.y=this.btnJump.y,this._uiContainer.addChild(this._tip))},e.prototype.removeTip=function(){this._tip&&this._tip.parent&&(this._tip.animation.stop(),this._tip.parent.removeChild(this._tip))},e.prototype.onShot=function(t){this.addBoom()},e.prototype.onAdded=function(t){this.stageWidth=this.stage.stageWidth,this.stageHeight=this.stage.stageHeight,this.init()},e.prototype.dispose=function(){this._avatar.stand(),this.removeAllItems(),this._itemContainer.removeChildren(),this._win.parent&&this._win.parent.removeChild(this._win)},e.prototype.init=function(){var t=RES.getRes("levelConfig_json").level[this._curLevel];this._curItemConfigs=t.concat(),this._building.x=this.stageWidth,this._building.y=this.stageHeight,this.addChild(this._building),this._building.stop(),this.addChild(this._itemContainer),this._itemContainer.x=this.stageWidth-100,this._itemContainer.y=0,this._uiContainer.x=0,this._uiContainer.y=0,this.addChild(this._uiContainer),this.btnJump.x=.75*this.stageWidth,this.btnShoot.x=.25*this.stageWidth,this.btnJump.y=this.btnShoot.y=this.stageHeight-150,this._uiContainer.addChild(this.btnJump),this._uiContainer.addChild(this.btnShoot),this.master||(this.btnJump.visible=!1,this.btnShoot.visible=!1),this._txtTime.size=60,this._txtTime.x=this.stageWidth/2-80,this._txtTime.y=.9*this.stageHeight,this._uiContainer.addChild(this._txtTime),this._avatar.x=this.stageWidth/2,this._avatar.y=this.stageHeight/2+300,this._uiContainer.addChild(this._avatar),this._kingkong.x=this.stageWidth-100,this._kingkong.y=this.stageHeight-this._kingkongOffsetY,this._kingkongPosY=this._kingkong.y,this._kingkongPosMaxY=this._kingkongPosY+Kingkong.LEG_LENGTH+KingkongItem.HALF_SIZE,this._kingkongPosMinY=this._kingkongPosY-Kingkong.arguments-KingkongItem.HALF_SIZE,this.addChild(this._kingkong),this._kingkong.stand(),this._win=new egret.TextField,this._win.size=60,this._win.x=this.stageWidth/2,this._win.y=.8*this.stageHeight,this._win.text="YOU WIN !",this._totalDistance=this.configToD(this._curItemConfigs[this._curItemConfigs.length-1].d)+this.stageHeight-this._kingkongOffsetY,this.master&&this.preStart()},e.prototype.addClock=function(t){this._dbClock=t,this.clock=t,this._kingkong.addClock(this._dbClock),this._building.addClock(this._dbClock),this._avatar.addClock(this._dbClock),this._dbClock.add(this)},e.prototype.advanceTime=function(t){this._gameStart?(this._curTime+=t,this._curDistance=this._building.curDistance,this.addItems(),this.moveItems(),this.removeItems(),this.testHit(),this._fast&&this.checkFast(t),this.checkWin(),this._kingkong.updateBomb(),this.master&&!e.touched&&this._curTime>e.TIP_TIME&&null==this._tip.parent&&this.addTip(),this.progress=this._curDistance/this._totalDistance,this._txtTime.visible=!0,this._txtTime.text="00:"+Math.floor(e.MAX_TIME-this._curTime)):this.master&&(this._txtTime.visible=!1)},e.prototype.checkWin=function(){this._curDistance>this._totalDistance&&this.win()},e.prototype.fail=function(){this._avatar.lose(),this._kingkong.getBoom(!1),this.gameOver()},e.prototype.win=function(){var t=this;if(this.key){this.key.x+=this._itemContainer.x,this.key.y+=this._itemContainer.y,this._uiContainer.addChild(this.key);var e=egret.Tween.get(this.key),i=this._avatar.x-this.key.x,n=this._avatar.y-this.key.y;e.to({x:this.key.x+i/2,y:this.key.y+n/2,scaleX:2,scaleY:2},500),e.to({x:this.key.x+i,y:this.key.y+n,scaleX:1,scaleY:1},500),e.call(function(){t._avatar.win(),t.key.x=0,t.removeItem(t.key,0),t.key=null}),e.wait(1e3),e.call(function(){t.dispatchEvent(new egret.Event(Kingkong.EVENT_GAME_OVER))})}this._kingkong.getBoom(!1),this.addChild(this._win),this.dispatchEvent(new egret.Event(Kingkong.EVENT_WIN)),this.gameOver()},e.prototype.gameOver=function(){this._curDistance=0,this._fastLastTime=0,this._building.curDistance=0,this._curTime=0,this._gameStart=!1,this._building.stop(),this._kingkong.stand(),this.removeTip()},e.prototype.checkFast=function(t){this._fastLastTime>0?this._fastLastTime-=t:this.stopFast()},e.prototype.testHit=function(){var t,e,i,n,o;for(t=0,e=this._curItems.length;e>t&&(this._curItems[t].type!=KingkongItem.TYPE_KEY&&this._curItems[t].y>this._kingkongPosMinY);t++)if(this._curItems[t].y<this._kingkongPosMaxY&&!this._kingkong.onAir()&&!this._kingkong.invincible){o=this._curItems[t],i=!0,n=this._curItems[t].type,this.removeItem(o,t);break}if(i)switch(n){case KingkongItem.TYPE_BANANA:this.kingkongGetBanana();break;case KingkongItem.TYPE_BOOM:this.kingkongGetBoom();break;case KingkongItem.TYPE_FIRE_BOOM:this.kingkongHit()}},e.prototype.stopFast=function(){this._fast=!1,this._building.runNormal(),this._kingkong.runNormal()},e.prototype.kingkongGetBanana=function(){this._fast=!0,this._slow=!1,this._fastLastTime=e.FAST_TIME,this._building.runFast(),this._kingkong.runFast(),this._avatar.happy()},e.prototype.kingkongGetBoom=function(){this._kingkong.getBoom(!0)},e.prototype.kingkongRecover=function(){this._slow=!1,this._fast=!1,this._building.runNormal(),this._kingkong.runNormal(),this._kingkong.removeEventListener(Kingkong.EVENT_RECOVER,this.onKingkongRecover,this)},e.prototype.onKingkongRecover=function(t){this.kingkongRecover()},e.prototype.kingkongHit=function(){this._slow=!0,this._fast=!1,this._building.runSlow(),this._kingkong.runSlow(),this._kingkong.getBoom(!1),this._kingkong.addEventListener(Kingkong.EVENT_RECOVER,this.onKingkongRecover,this),this._kingkong.playHit()},e.prototype.disToConfig=function(t){return(this._curDistance-t)/100},e.prototype.configToD=function(t){return 100*t},e.prototype.addBoom=function(){var t=this._itemsPool.getItem();t.type=KingkongItem.TYPE_FIRE_BOOM,t.x=-this.stageWidth/2,t.y=this._kingkongOffsetY,this._itemContainer.addChild(t);var e=egret.Tween.get(t);e.to({x:-this.stageWidth/4,scaleX:2,scaleY:2},250),e.to({x:-0,scaleX:1,scaleY:1},250),e.call(this.addBoomComplete,this,[t])},e.prototype.addBoomComplete=function(t){t.pos=this.disToConfig(t.y);var e,i,n;for(e=0,i=this._curItems.length;i>e;e++)if(this._curItems[e].pos>t.pos){this._curItems.splice(e,0,t),n=!0;break}n||this._curItems.push(t)},e.prototype.addItems=function(){if(this._curItemConfigs.length>0)for(var t=this._curItemConfigs[0].d,e=this._curItemConfigs[0].t,i=this.configToD(t);i<this._curDistance;){this._curItemConfigs.shift();var n=this._itemsPool.getItem();if(n.x=0,n.type=e,n.pos=t,n.type==KingkongItem.TYPE_KEY&&(this.key=n),this._itemContainer.addChild(n),this._curItems.push(n),!(this._curItemConfigs.length>0)){i=Number.MAX_VALUE;break}t=this._curItemConfigs[0].d,e=this._curItemConfigs[0].t,i=this.configToD(t)}},e.prototype.moveItems=function(){var t,e,i;for(t=0,e=this._curItems.length;e>t;t++)i=this._curItems[t],i.y=this._curDistance-this.configToD(i.pos)},e.prototype.removeItem=function(t,e){this._itemsPool.disposeItem(t),this._curItems.splice(e,1),t.parent&&t.parent.removeChild(t)},e.prototype.removeItems=function(){var t,e,i;for(t=0,e=this._curItems.length;e>t;t++)i=this._curItems[t],i.y>this.stageHeight&&i.type!=KingkongItem.TYPE_KEY&&(this._itemsPool.disposeItem(i),this._curItems.splice(t,1),t--,e--,i.parent&&i.parent.removeChild(i))},e.prototype.removeAllItems=function(){var t,e,i;for(t=0,e=this._curItems.length;e>t;t++)i=this._curItems[t],this._itemsPool.disposeItem(i),this._curItems.splice(t,1),t--,e--,i.parent&&i.parent.removeChild(i)},e.prototype.touchLeft=function(){this._kingkong.hasBoom&&(this.btnShoot.touch(),this._kingkong.getBoom(!1),this.dispatchEvent(new egret.Event(Kingkong.EVENT_SHOOT)),e.touched=!0,this.removeTip())},e.prototype.touchRight=function(){this._kingkong.jumpEnable()&&(this._kingkong.jump(),this.btnJump.touch(),e.touched=!0,this.removeTip())},e.prototype.preStart=function(){var t=this,e=AssetManager.getBitmap("ready_png"),i=AssetManager.getBitmap("go_png");this.addChild(e),this.addChild(i),e.x=-100,e.y=.75*this.stageHeight,i.x=e.x,i.y=e.y;var n=egret.Tween.get(e),o=egret.Tween.get(i);n.to({x:this.stageWidth/2},300),n.to({x:this.stageWidth/2+10},1e3),n.to({x:this.stageWidth+500},300),o.wait(1600),o.to({x:this.stageWidth/2},300),o.to({x:this.stageWidth/2+10},1e3),o.to({x:this.stageWidth+500},300),o.call(function(){t.startRun(),t.dispatchEvent(new egret.Event(Kingkong.EVENT_GAME_START))})},e.prototype.startRun=function(){this._gameStart=!0,this._curTime=0,this.progress=0,this._building.reset(),this._curDistance=0,this._avatar&&this._avatar.stand(),this._building.run(),this._kingkong.run()},e.FAST_TIME=3,e.TIP_TIME=3,e.MAX_TIME=40,e}(egret.DisplayObjectContainer);__reflect(KingkongScene.prototype,"KingkongScene",["dragonBones.IAnimatable"]);var Game=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.prototype.onAdded=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.init()},e.prototype.init=function(){console.log("rhythmMeow start, let's rock! ");var t=new StateManager(this);t.registerState("gameKingkong",new GameKingkong),t.registerState("gameChallenge",new GameChallenge),t.registerState("gameWin",new GameWin),t.registerState("gameLose",new GameLose),t.setCurStateName("gameChallenge"),t.startTick()},e}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");
var LevelSelect=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.bg="bg4_jpg",this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e.prototype.onTouchBegin=function(t){this.over()},e.prototype.over=function(){this.next("level1")},e.prototype.dispose=function(){this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(StateBG);__reflect(LevelSelect.prototype,"LevelSelect");var LevelTitle=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.bg="bg1_png";var e=AssetManager.getBitmap("bg2_png"),i=AssetManager.getBitmap("bg3_png");i.x=e.x=this.stageWidth/2,i.y=e.y=this.stageHeight/2;var n=this;setTimeout(function(){n.addChild(e)},1e3),setTimeout(function(){n.addChild(i)},2e3),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e.prototype.onTouchBegin=function(t){this.over()},e.prototype.over=function(){this.next("levelSelect")},e.prototype.dispose=function(){this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(StateBG);__reflect(LevelTitle.prototype,"LevelTitle");var AssetManager=function(){function t(){}return t.getBitmap=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0);var n=new egret.Bitmap,o=RES.getRes(t);return n.texture=o,e&&(n.anchorOffsetX=n.width/2),i&&(n.anchorOffsetY=n.height/2),n},t.getSound=function(t){return RES.getRes(t)},t}();__reflect(AssetManager.prototype,"AssetManager");var Avatar=function(t){function e(e){var i=t.call(this)||this,n=e,o=RES.getRes(n+"_ske_json"),s=RES.getRes(n+"_tex_json"),r=RES.getRes(n+"_tex_png"),a=new dragonBones.EgretFactory;return a.parseDragonBonesData(o),a.parseTextureAtlasData(s,r),i.armature=a.buildArmature(n),i._avatarBone=i.armature.getBone("avatarIcon"),i._avatarSlot=i.armature.getSlot("avatarIcon"),i.armatureDisplay=i.armature.display,i.addChild(i.armatureDisplay),i.stand(),i.imgUrl="http://localhost:5318/resource/assets/userimg1.jpg",i}return __extends(e,t),Object.defineProperty(e.prototype,"imgUrl",{set:function(t){var e=this;RES.getResByUrl(t,function(t){if(t&&(this.avatarImage=AssetManager.getBitmap("userImg2_jpg"),e._avatarSlot))try{e._avatarSlot.display=e.avatarImage}catch(i){console.log(i)}},this,RES.ResourceItem.TYPE_IMAGE)},enumerable:!0,configurable:!0}),e.prototype.onAnimComplete=function(t){this.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this),this.stand()},e.prototype.onLoseComplete=function(t){this.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.onLoseComplete,this),this.armature.animation.gotoAndStopByTime("lost",1)},e.prototype.addClock=function(t){this.clock=t,t.add(this.armature)},e.prototype.win=function(){this.armature.animation.play("win")},e.prototype.lose=function(){this.armature.animation.play("lost",1),this.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.onLoseComplete,this)},e.prototype.stand=function(){this.armature.animation.play("stand")},e.prototype.happy=function(){this.armature.animation.play("dese",6),this.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this)},e.prototype.normal=function(){this.armature.animation.play("normal")},e.NORMAL_SPEED=2,e.FAST_SPEED=3,e}(egret.Sprite);__reflect(Avatar.prototype,"Avatar");var Building=function(t){function e(){var e=t.call(this)||this;e._offset=2390;var i="ground",n=RES.getRes(i+"_ske_json"),o=RES.getRes(i+"_tex_json"),s=RES.getRes(i+"_tex_png"),r=new dragonBones.EgretFactory;r.parseDragonBonesData(n),r.parseTextureAtlasData(o,s),e.armature=r.buildArmature(i),e._bone=e.armature.getBone("bone");var a=e.armature.display;return e.addChild(a),e.stop(),e.reset(),e}return __extends(e,t),e.prototype.reset=function(){this._curD=this._bone.globalTransformMatrix.ty,this._lastD=this._curD,this.tickDistance=0,this.curDistance=0},e.prototype.addClock=function(t){this.clock=t,t.add(this.armature),t.add(this)},e.prototype.advanceTime=function(t){for(this._curD=this._bone.globalTransformMatrix.ty,this.tickDistance=this._curD-this._lastD;this.tickDistance<0;)this.tickDistance+=this._offset;this._lastD=this._curD,this.curDistance+=this.tickDistance},e.prototype.runNormal=function(){var t=egret.Tween.get(this.armature.animation);t.to({timeScale:e.NORMAL_SPEED},500)},e.prototype.runFast=function(){var t=egret.Tween.get(this.armature.animation);t.to({timeScale:e.FAST_SPEED},500)},e.prototype.runSlow=function(){this.armature.animation.timeScale=0},e.prototype.run=function(){this.armature.animation.play("run"),this.runSlow(),this.runNormal(),this.reset()},e.prototype.stop=function(){this.armature.animation.stop()},e.NORMAL_SPEED=2,e.FAST_SPEED=3,e}(egret.Sprite);__reflect(Building.prototype,"Building",["dragonBones.IAnimatable"]);var Kingkong=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this,n="kingkong",o=e?"kingkong":"kingkongBlue",s=RES.getRes(n+"_ske_json"),r=RES.getRes(n+"_tex_json"),a=RES.getRes(n+"_tex_png"),h=new dragonBones.EgretFactory;h.parseDragonBonesData(s),h.parseTextureAtlasData(r,a),i.kingArmature=h.buildArmature(o),i.kingDisplay=i.kingArmature.display,i._dust=h.buildArmature("dust"),i._dust&&(i._dust.animation.timeScale=1.5,i._dustDisplay=i._dust.display),i._bananaPeel=h.buildArmature("bananaPeel"),i._bananaPeel.animation.timeScale=1.5,i._bananaPeel.animation.gotoAndStop("run"),i._bananaPeelDisplay=i._bananaPeel.display,i.addChild(i.kingDisplay);var g=i.kingArmature.getSlot("boom");g&&(i.boomArmature=g.childArmature);var u=i.kingArmature.getSlot("dust");u&&i._dustDisplay&&(u.display=i._dustDisplay);var c=i.kingArmature.getSlot("bananaPeel");return c.display=i._bananaPeelDisplay,i}return __extends(e,t),e.prototype.addClock=function(t){t.add(this.kingArmature),t.add(this._dust),t.add(this._bananaPeel)},e.prototype.updateBomb=function(){},e.prototype.onAir=function(){return this._status==e.STATUS_JUMP&&this._jumpState&&this._jumpState.currentTime>.17&&this._jumpState.currentTime<1.5?!0:!1},e.prototype.run=function(){if(this.invincible=!1,this._status=e.STATUS_RUN,this.kingArmature.animation.timeScale=e.SLOW_SPEED,this._fast){var t=egret.Tween.get(this.kingArmature.animation);t.to({timeScale:e.FAST_SPEED},500),this.kingArmature.animation.timeScale=e.FAST_SPEED}else this._slow&&(this.kingArmature.animation.timeScale=e.SLOW_SPEED);var i=egret.Tween.get(this.kingArmature.animation);i.to({timeScale:e.NORMAL_SPEED},500),this.kingArmature.animation.play("run",0)},e.prototype.playHit=function(){this.invincible=!0,this._status=e.STATUS_HIT,this.kingArmature.animation.timeScale=e.NORMAL_SPEED,this.kingArmature.animation.play("boom",1),this.kingDisplay.addEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onBoomComplete,this)},e.prototype.onBoomComplete=function(t){this.dispatchEvent(new egret.Event(e.EVENT_RECOVER)),this.run(),this.kingDisplay.removeEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onBoomComplete,this)},e.prototype.jumpEnable=function(){return this._status==e.STATUS_RUN},e.prototype.jump=function(){this.invincible=!1,this._status=e.STATUS_JUMP,this.kingArmature.animation.timeScale=e.NORMAL_SPEED,this._jumpState=this.kingArmature.animation.play("jump",1),this.kingDisplay.addEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onJumpComplete,this);var t=Math.floor(7*Math.random())+1;this._dust.animation.play("boom"+t,1)},e.prototype.runFast=function(){if(this._fast=!0,this._slow=!1,this._bananaPeel.animation.gotoAndPlayByFrame("run",0,1),this._status==e.STATUS_RUN){var t=egret.Tween.get(this.kingArmature.animation);t.to({timeScale:e.FAST_SPEED},500)}},e.prototype.runSlow=function(){this._slow=!0,this._fast=!1,this._status==e.STATUS_RUN&&(this.kingArmature.animation.timeScale=e.SLOW_SPEED)},e.prototype.runNormal=function(){if(this._fast=!1,this._status==e.STATUS_RUN){var t=egret.Tween.get(this.kingArmature.animation);t.to({timeScale:e.NORMAL_SPEED},500),this.kingArmature.animation.timeScale=e.NORMAL_SPEED}},e.prototype.onJumpComplete=function(t){this.run(),this.kingDisplay.removeEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onJumpComplete,this)},e.prototype.stand=function(){this.invincible=!0,this._status=e.STATUS_STAND,this.kingArmature.animation.gotoAndStop("stand")},e.prototype.getBoom=function(t){if(this.hasBoom=t,this.boomArmature){var e=this.hasBoom?"boom1":"boom0";this.boomArmature.animation.gotoAndStop(e)}},e.EVENT_RECOVER="EVENT_RECOVER",e.EVENT_SHOOT="EVENT_SHOOT",e.EVENT_WIN="EVENT_WIN",e.EVENT_GAME_START="EVENT_GAME_START",e.EVENT_GAME_OVER="EVENT_GAME_OVER",e.STATUS_RUN=0,e.STATUS_JUMP=1,e.STATUS_HIT=2,e.STATUS_STAND=3,e.STATUS_OVER=4,e.ARM_LENGTH=140,e.LEG_LENGTH=100,e.LENGTH=e.ARM_LENGTH+e.LEG_LENGTH,e.NORMAL_SPEED=2,e.FAST_SPEED=3,e.SLOW_SPEED=1,e}(egret.Sprite);__reflect(Kingkong.prototype,"Kingkong");var KingkongItem=function(t){function e(){var e=t.call(this)||this,i="kingkongItem",n=RES.getRes(i+"_ske_json"),o=RES.getRes(i+"_tex_json"),s=RES.getRes(i+"_tex_png"),r=new dragonBones.EgretFactory;return r.parseDragonBonesData(n),r.parseTextureAtlasData(o,s),e._item=r.buildArmatureDisplay(i),e._itemArmature=e._item.armature,e.addChild(e._item),e}return __extends(e,t),e.prototype.reDraw=function(){var t=16711680;switch(this._itemArmature.animation.stop(),this._type){case e.TYPE_BANANA:t=16776960,this._itemArmature.animation.gotoAndStop("banana");break;case e.TYPE_BOOM:t=0,this._itemArmature.animation.gotoAndStop("boom");break;case e.TYPE_FIRE_BOOM:t=16711680,this._itemArmature.animation.gotoAndPlay("fireBoom");break;case e.TYPE_KEY:t=16711680,this._itemArmature.animation.gotoAndStop("key");break;default:t=16777215,this._itemArmature.animation.stop()}},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this.reDraw()},enumerable:!0,configurable:!0}),e.TYPE_BANANA=0,e.TYPE_BOOM=1,e.TYPE_FIRE_BOOM=2,e.TYPE_KEY=3,e.SIZE=100,e.HALF_SIZE=e.SIZE/2,e}(egret.Sprite);__reflect(KingkongItem.prototype,"KingkongItem");var HitEffect=function(t){function e(i){var n=t.call(this)||this;n.level=i;var o;switch(i){case e.BEST:o="mb6_png";break;case e.GOOD:o="mb7_png";break;case e.MISS:o="mb8_png"}return n._bmp=AssetManager.getBitmap(o),n.addChild(n._bmp),n}return __extends(e,t),e.prototype.start=function(){var t=egret.Tween.get(this._bmp),e=egret.Tween.get(this._bmp),i=egret.Tween.get(this._bmp),n=egret.Tween.get(this._bmp),o=egret.Tween.get(this._bmp),s=(300+300*Math.random())*(Math.random()>.5?1:-1),r=-300+-300*Math.random(),a=180-360*Math.random();this._bmp.scaleX=.2,this._bmp.scaleY=.2;var h=1e3;o.to({scaleX:1,scaleY:1},100),t.to({x:s},h,egret.Ease.sineIn),e.to({y:r},h),i.to({rotation:a},h),n.wait(h-100),n.to({alpha:0},100),n.call(this.end,this)},e.prototype.end=function(){this.isEnd=!0},e.BEST=0,e.GOOD=1,e.MISS=2,e}(egret.DisplayObjectContainer);__reflect(HitEffect.prototype,"HitEffect");var StateEvent=function(t){function e(e,i,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);var s=t.call(this,e,n,o)||this;return s.data=i,s}return __extends(e,t),e.NEXT="NEXT",e}(egret.Event);__reflect(StateEvent.prototype,"StateEvent");var StateManager=function(){function t(t){this._parent=t,this._stateObj={}}return t.prototype.startTick=function(){this._curTime=egret.getTimer(),egret.startTick(this.tick,this)},t.prototype.stopTick=function(){egret.stopTick(this.tick,this)},t.prototype.tick=function(t){return this._lastTime=this._curTime,this._curTime=t,this._curState&&this._curState.tick(this._curTime-this._lastTime),!0},t.prototype.registerState=function(t,e){this._stateObj[t]=e},t.prototype.setCurStateName=function(t){var e=this._stateObj[t];e&&this.setCurState(e)},t.prototype.setCurState=function(t){this._curState&&(this._curState.removeEventListener(StateEvent.NEXT,this.onNext,this),this._prevState=this._curState),this._curState=t,this._curState.show(this._parent),this._curState.addEventListener(StateEvent.NEXT,this.onNext,this)},t.prototype.onNext=function(t){var e=this._stateObj[t.data];e&&this.setCurState(e)},t}();__reflect(StateManager.prototype,"StateManager");var DBAnimButton=function(t){function e(e){var i=t.call(this)||this;return i._display=e,i._armature=i._display.armature,i._armature.animation.gotoAndStop("normal"),i._display.addEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,i.onAnimComplete,i),i.addChild(i._display),i}return __extends(e,t),e.prototype.onAnimComplete=function(t){this._armature.animation.gotoAndStop("normal")},e.prototype.touch=function(){this._armature.animation.gotoAndPlay("touch")},e}(egret.DisplayObjectContainer);__reflect(DBAnimButton.prototype,"DBAnimButton");var DBButton=function(t){function e(e){var i=t.call(this)||this;return i.touchEnabled=!0,i._display=e,i._armature=i._display.armature,i._armature.animation.gotoAndStop("normal"),i.addChild(i._display),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i.onTouchBegin,i),i.addEventListener(egret.TouchEvent.TOUCH_END,i.onTouchEnd,i),i}return __extends(e,t),e.prototype.onTouchBegin=function(t){this._armature.animation.gotoAndStop("touch")},e.prototype.onTouchEnd=function(t){this._armature.animation.gotoAndStop("normal")},e}(egret.DisplayObjectContainer);__reflect(DBButton.prototype,"DBButton");var DBProgress=function(t){function e(e){var i=t.call(this)||this;return i._display=e,i._armature=i._display.armature,i._armature.animation.gotoAndStop("progress"),i.addChild(i._display),i}return __extends(e,t),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress=t,this._progress>1&&(this._progress=1),this._progress<0&&(this._progress=0),this._armature.animation.gotoAndStopByProgress("progress",this._progress)},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(DBProgress.prototype,"DBProgress");