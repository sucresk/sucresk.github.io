function getNextIndex(t,e){var a=t+1;return a>e-1&&(a=0),a}function getLastIndex(t,e){var a=t-1;return 0>a&&(a=e-1),a}var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),State=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.prototype.onAdded=function(t){this.init()},e.prototype.init=function(){console.log("this is a state")},e.prototype.show=function(t){t.addChild(this)},e.prototype.next=function(t){this.dispose(),this.dispatchEvent(new StateEvent(StateEvent.NEXT,t)),this.parent.removeChild(this)},e.prototype.returnToLast=function(){this.dispose(),this.dispatchEvent(new StateEvent(StateEvent.LAST,null)),this.parent.removeChild(this)},e.prototype.tick=function(t){},e.prototype.dispose=function(){},e}(egret.DisplayObjectContainer);__reflect(State.prototype,"State",["IState","egret.IEventDispatcher"]);var StateBG=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.stageWidth=this.stage.stageWidth,this.stageHeight=this.stage.stageHeight,this.halfStageWidth=this.stageWidth/2,this.halfStageHeight=this.stageHeight/2},Object.defineProperty(e.prototype,"bg",{set:function(t){this.background=AssetManager.getBitmap(t),this.background&&this.stage&&(this.background.x=this.stageWidth/2,this.background.y=this.stageHeight/2,this.addChild(this.background))},enumerable:!0,configurable:!0}),e}(State);__reflect(StateBG.prototype,"StateBG");var MyByteArray=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.readIndex=0,e.writeIndex=0,e.cacheData=new Array,e.resetReader=function(){e.readIndex=0},e.resetWriter=function(){e.writeIndex=0},e.finalWriter=function(){for(var t=new Array,a=0;a<e.cacheData.length;a++)switch(e.cacheData[a][1]){case"utftring":t.push(e.writeIndex),e._writeRealString(e.cacheData[a][2]);break;case"unicode":t.push(e.writeIndex),e._writeRealUnicode(e.cacheData[a][2])}for(var n=new DataView(e.buffer),i=0;i<e.cacheData.length;i++)switch(e.cacheData[i][1]){case"utftring":n.setInt16(e.cacheData[i][0],t[i]-4,!0);break;case"unicode":n.setInt16(e.cacheData[i][0],t[i]-4,!0)}e.buffer=n.buffer,n=null},e._writeRealString=function(t){e.writeUTF(t);var a=new DataView(e.buffer);e.writeIndex+=a.getUint16(e.writeIndex),a=null,e.position=e.writeIndex},e._writeRealUnicode=function(t){var a=0,n=t.length;for(e._writeShort(n);n>a;){var i=t.charCodeAt(a);e._writeShort(i),a+=1}},e._writeBoolean=function(t){e.writeBoolean(t),e.writeIndex+=1,e.position=e.writeIndex},e._writeByte=function(t){e.writeByte(t),e.writeIndex+=1,e.position=e.writeIndex},e._writeChar=function(t){var a=t.charCodeAt(0);e.writeShort(a),e.writeIndex+=2,e.position=e.writeIndex},e._writeShort=function(t){e.writeShort(t),e.writeIndex+=2,e.position=e.writeIndex},e._writeInt=function(t){e.writeInt(t),e.writeIndex+=4,e.position=e.writeIndex},e._writeFloat=function(t){e.writeFloat(t),e.writeIndex+=4,e.position=e.writeIndex},e._writeDouble=function(t){e.writeDouble(t),e.writeIndex+=8,e.position=e.writeIndex},e._writeUnicode=function(t){e.writeShort(0),e.cacheData.push([e.writeIndex,"unicode",t]),e.writeIndex+=2,e.position=e.writeIndex},e._readBoolean=function(){var t=new DataView(e.buffer);return e.readIndex+=1,1===t.getInt8(e.readIndex-1)?(t=null,!0):(t=null,!1)},e._readByte=function(){var t=new DataView(e.buffer);e.readIndex+=1;var a=t.getUint8(e.readIndex-1);return t=null,a},e._readChar=function(){e.readIndex+=2;var t=new DataView(e.buffer),a=t.buffer.slice(e.readIndex-2,e.readIndex);return t=null,e.ab2str(a)},e._readShort=function(){var t=new DataView(e.buffer);e.readIndex+=2;var a=t.getInt16(e.readIndex-2,!0);return t=null,a},e._readInt=function(){var t=new DataView(e.buffer);e.readIndex+=4;var a=t.getInt32(e.readIndex-4,!0);return t=null,a},e._readFloat=function(){var t=new DataView(e.buffer);e.readIndex+=4;var a=t.getFloat32(e.readIndex-4,!0);return t=null,a},e._readDouble=function(){var t=new DataView(e.buffer);e.readIndex+=8;var a=t.getFloat64(e.readIndex-8,!0);return t=null,a},e._readUnicode=function(){var t=e._readShort()+4;e.position=t;var a=2*e.readShort(),n=new DataView(e.buffer),i=n.buffer.slice(t+2,t+2+a),r=e.ab2str(i);return e.position=e.readIndex,n=null,r},e}return __extends(e,t),e.prototype.ab2str=function(t){return void 0!==t?String.fromCharCode.apply(null,new Uint16Array(t)):String.fromCharCode.apply(null,new Uint16Array(this.buffer))},e}(egret.ByteArray);__reflect(MyByteArray.prototype,"MyByteArray");var AIKingkong=function(t){function e(){var e=t.call(this)||this;return e.level=0,e._nextRandomJumpTime=3,e._nextJumpTime=0,e._nextShootTime=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"kingkong",{set:function(t){this._kingkong=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curItems",{set:function(t){this._curItems=t},enumerable:!0,configurable:!0}),e.prototype.start=function(){this._kingkong&&this._curItems&&(this._running=!0)},e.prototype.over=function(){this._running=!1},e.prototype.advanceTime=function(t){this._running&&(this._kingkong.hasBoom&&(this._nextShootTime-=t,this._nextShootTime<0&&(this.kingkongCanShoot()&&this.dispatchEvent(new egret.Event(Kingkong.EVENT_SHOOT)),this.resetNextShootTime())),this._kingkong.jumpEnable()&&(this.kingkongCanJump(t)?this.dispatchEvent(new egret.Event(Kingkong.EVENT_JUMP)):(this._nextRandomJumpTime-=t,this._nextRandomJumpTime<0&&(this._nextRandomJumpTime=Math.random()*e.RANDOM_JUMP_TIME,this.randomJump()&&this.dispatchEvent(new egret.Event(Kingkong.EVENT_JUMP))))))},e.prototype.resetNextShootTime=function(){switch(this.level){case e.AI_LEVEL_0:this._nextShootTime=1*Math.random()+1;break;case e.AI_LEVEL_1:this._nextShootTime=.5*Math.random()+.5;break;case e.AI_LEVEL_2:this._nextShootTime=.5*Math.random()+.2;break;case e.AI_LEVEL_3:this._nextShootTime=.2*Math.random();break;default:this._nextShootTime=1}},e.prototype.kingkongCanShoot=function(){var t=Math.random();switch(this.level){case e.AI_LEVEL_0:if(.2>t)return!0;break;case e.AI_LEVEL_1:if(.4>t)return!0;break;case e.AI_LEVEL_2:if(.8>t)return!0;break;case e.AI_LEVEL_3:if(1.2>t)return!0;break;default:return!0}return!1},e.prototype.kingkongCanJump=function(t){if(this._curItems&&this._curItems.length>0){var a=this._kingkong.y-this._curItems[0].y;if(a>e.MIN_JUMP_DIS&&a<e.MAX_JUMP_DIS&&(this._nextJumpTime-=t,this._nextJumpTime<0)){var n=Math.random();switch(this.level){case e.AI_LEVEL_0:if(this._nextJumpTime=.1*Math.random()+.3,.2>n)return!0;break;case e.AI_LEVEL_1:if(this._nextJumpTime=.1*Math.random()+.2,.5>n)return!0;break;case e.AI_LEVEL_2:if(this._nextJumpTime=.1*Math.random()+.1,.8>n&&this._curItems[0].type==KingkongItem.TYPE_FIRE_BOOM)return!0;break;case e.AI_LEVEL_3:if(1.2>n&&this._curItems[0].type==KingkongItem.TYPE_FIRE_BOOM)return!0;break;default:return!0}}}return!1},e.prototype.randomJump=function(){var t=Math.random();switch(this.level){case e.AI_LEVEL_0:if(t>.2)return!1;break;case e.AI_LEVEL_1:if(.4>t)return!1;break;case e.AI_LEVEL_2:if(.8>t)return!1;break;case e.AI_LEVEL_3:if(1.2>t)return!1;break;default:return!1}return!0},e.AI_LEVEL_0=0,e.AI_LEVEL_1=1,e.AI_LEVEL_2=2,e.AI_LEVEL_3=3,e.MAX_JUMP_DIS=340,e.MIN_JUMP_DIS=100,e.RANDOM_JUMP_TIME=3,e}(egret.EventDispatcher);__reflect(AIKingkong.prototype,"AIKingkong",["dragonBones.IAnimatable"]);var KingkongItemPool=function(){function t(){this._pool=[]}return t.prototype.getItem=function(){return this._pool.length?this._pool.pop():new KingkongItem},t.prototype.disposeItem=function(t){-1==this._pool.indexOf(t)&&this._pool.push(t)},t}();__reflect(KingkongItemPool.prototype,"KingkongItemPool");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){if("preload"==t.groupName){this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this);var e=RES.getRes("dbAssetConfig_json");AssetManager.loadDBAnimation(e.db);var a=new Game;this.addChild(a)}},e.prototype.onInitComplete=function(){console.log("egret.runtime.spid"+egret.getOption("egret.runtime.spid"))},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,a=this.stage.stageHeight;t.width=e,t.height=a;var n=new egret.Shape;n.graphics.beginFill(0,.5),n.graphics.drawRect(0,0,e,172),n.graphics.endFill(),n.y=33,this.addChild(n);var i=this.createBitmapByName("egret_icon_png");this.addChild(i),i.x=26,i.y=33;var r=new egret.Shape;r.graphics.lineStyle(2,16777215),r.graphics.moveTo(0,0),r.graphics.lineTo(0,117),r.graphics.endFill(),r.x=172,r.y=61,this.addChild(r);var o=new egret.TextField;o.textColor=16777215,o.width=e-172,o.textAlign="center",o.text="Hello Egret",o.size=24,o.x=172,o.y=80,this.addChild(o);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=e-172,s.textAlign=egret.HorizontalAlign.CENTER,s.size=24,s.textColor=16777215,s.x=172,s.y=135,this.textfield=s,RES.getResAsync("description_json",this.startAnimation,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,a=RES.getRes(t);return e.texture=a,e},e.prototype.startAnimation=function(t){var e=this,a=new egret.HtmlTextParser,n=t.map(function(t){return a.parse(t)}),i=this.textfield,r=-1,o=function(){r++,r>=n.length&&(r=0);var t=n[r];i.textFlow=t;var a=egret.Tween.get(i);a.to({alpha:1},200),a.wait(2e3),a.to({alpha:0},200),a.call(o,e)};o()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Meow=function(t){function e(){var e=t.call(this)||this,a="meow",n=RES.getRes(a+"_ske_json"),i=RES.getRes(a+"_tex_json"),r=RES.getRes(a+"_tex_png"),o=new dragonBones.EgretFactory;o.parseDragonBonesData(n),o.parseTextureAtlasData(i,r),e.armature=o.buildArmature(a);var s=e.armature.display;return e.addChild(s),e}return __extends(e,t),e.prototype.addClock=function(t){t.add(this.armature)},e.prototype.playHit=function(){this.armature.animation.play("hit",1)},e}(egret.Sprite);__reflect(Meow.prototype,"Meow");var Platform=function(){function t(){}return t.WEB=0,t.EGRET_CENTER=1,t.curPlatform=1,t}();__reflect(Platform.prototype,"Platform");var RhythmPoint=function(t){function e(){var e=t.call(this)||this;return e.graphics.beginFill(16777215),e.graphics.drawCircle(0,0,20),e.graphics.endFill(),e}return __extends(e,t),e}(egret.Shape);__reflect(RhythmPoint.prototype,"RhythmPoint");var RhythmPointPool=function(){function t(){this._pool=[]}return t.prototype.getPoint=function(){return this._pool.length?this._pool.pop():new RhythmPoint},t.prototype.disposePoint=function(t){-1==this._pool.indexOf(t)&&this._pool.push(t)},t}();__reflect(RhythmPointPool.prototype,"RhythmPointPool");var ScoreData=function(){function t(){this._curBestHit=0,this._curGoodHit=0,this._curMissHit=0,this._curComboo=0,this.maxBestHit=0,this.maxGoodHit=0,this.maxMissHit=0,this.maxComboo=0}return Object.defineProperty(t.prototype,"curBestHit",{get:function(){return this._curBestHit},set:function(t){this._curBestHit=t,this.maxBestHit<this._curBestHit&&(this.maxBestHit=this._curBestHit),this.curComboo++,console.log("cur best:",this._curBestHit)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curGoodHit",{get:function(){return this._curGoodHit},set:function(t){this._curGoodHit=t,this.maxGoodHit<this._curGoodHit&&(this.maxGoodHit=this._curGoodHit),this.curComboo++,console.log("cur good:",this._curGoodHit)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curMissHit",{get:function(){return this._curMissHit},set:function(t){this._curMissHit=t,this.maxMissHit<this._curMissHit&&(this.maxMissHit=this._curMissHit),this._curComboo=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curComboo",{get:function(){return this._curComboo},set:function(t){this._curComboo=t,this.maxComboo<this._curComboo&&(this.maxComboo=this._curComboo),console.log("cur comboo:",this._curComboo)},enumerable:!0,configurable:!0}),t}();__reflect(ScoreData.prototype,"ScoreData");var CandyMachinePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var t=this;this.setBackGround();var e=AssetManager.getBitmap("sit_png");e.scaleX=1.5,e.scaleY=1.5,e.x=900,e.y=1400+Game.offset,this.addChild(e);var a=AssetManager.getBitmap("returnLast_png");a.x=1e3,a.y=1800+Game.offset,this.addChild(a),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.returnToLast()},this)},e.prototype.setBackGround=function(){for(var t=AssetManager.getBitmap("background_png",!1,!1),e=t.width,a=t.height,n=0;n<this.stage.stageHeight/t.height+1;n++)for(var i=0;i<this.stage.stageWidth/t.width+1;i++){var r=new egret.Bitmap;r=AssetManager.getBitmap("background_png",!1,!1),r.scaleX=1,r.scaleY=1,r.x=i*t.width-e,r.y=n*t.height+Game.offset-a,this.addChild(r)}var o=AssetManager.getBitmap("light_png");o.x=540,o.y=1200+Game.offset,this.addChild(o);var s=AssetManager.getBitmap("ground_png");s.x=540,s.y=1450+Game.offset,this.addChild(s);var h=AssetManager.getBitmap("ground_png");h.scaleX=3,h.x=540,h.y=1750+Game.offset,this.addChild(h);var c=AssetManager.getBitmap("stand_png");c.rotation=-15,c.scaleX=1.5,c.scaleY=1.5,c.x=150,c.y=1400+Game.offset,this.addChild(c);var g=AssetManager.getBitmap("stand_png");g.scaleX=1.5,g.scaleY=1.5,g.x=380,g.y=1250+Game.offset,this.addChild(g);var l=AssetManager.getBitmap("sugarBowl_png");l.x=540,l.scaleX=2,l.scaleY=2,l.y=1100+Game.offset,this.addChild(l)},e.prototype.onload=function(){},e.prototype.onremove=function(){},e}(StateBG);__reflect(CandyMachinePanel.prototype,"CandyMachinePanel");var ChooseGamePanel=function(t){function e(){var e=t.call(this)||this;e.vo=new ChooseGamePanelVO;var a="choosePanel";e.armature=AssetManager.getDBArmature(a),e.avatarBar=AssetManager.getDBArmature("avatarBar"),e.avatarBarInit(),e.gameBar=AssetManager.getDBArmature("gameBar"),e.gameBarInit(),e.light_Bottom=AssetManager.getDBArmature("light"),e.light_Up=AssetManager.getDBArmature("light"),e.light_Up.rotation=180,e.light_Up.play("light_normal",1),e.light_Bottom.play("light_normal",1),e.light_Bottom.armature.animation.timeScale=e.light_Up.armature.animation.timeScale=.7,e.touchBar=e.armature.armature.getSlot("light_bottom").display,e.touchBar.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.onChangeAvatarStart,e),e.touchBar.addEventListener(egret.TouchEvent.TOUCH_MOVE,e.onChangeAvatar,e),e.touchBar.addEventListener(egret.TouchEvent.TOUCH_END,e.onChangeAvatarEnd,e),e.inviteButton=new DBButton(AssetManager.getDBArmature("btn_invite")),e.startButton=new DBButton(AssetManager.getDBArmature("btn_start")),e.matchButton=new DBButton(AssetManager.getDBArmature("btn_match")),e.giveUpButton=new DBButton(AssetManager.getDBArmature("btn_giveUp")),e.backButton=new DBButton(AssetManager.getDBArmature("buttonUI")),e.armature.replaceSlot("light_bottom",e.light_Bottom),e.armature.replaceSlot("light_up",e.light_Up),e.armature.replaceSlot("btn_invite",e.inviteButton),e.armature.replaceSlot("btn_match",e.matchButton),e.armature.replaceSlot("btn_start",e.startButton),e.armature.replaceSlot("btn_giveUp",e.giveUpButton),e.armature.replaceSlot("btn_back",e.backButton),e.arrowL=e.armature.armature.getSlot("arrow_L").display,e.arrowR=e.armature.armature.getSlot("arrow_R").display,e.gameBarMid=e.gameBar.armature.getSlot("gameBarMid").display,e.inviteButton.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onInvite,e),e.startButton.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onGameStart,e),e.matchButton.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onMatch,e),e.giveUpButton.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onGiveUp,e),e.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,e.backToChoose,e),e.gameBarMid.addEventListener(egret.TouchEvent.TOUCH_TAP,e.getWait,e),e.arrowL.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onLastGame,e),e.arrowR.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onNextGame,e),e.giveUpButton.touchEnabled=!0,e.inviteButton.touchEnabled=!1,e.matchButton.touchEnabled=!1,e.startButton.touchEnabled=!1,e.backButton.touchEnabled=!0;var n=new egret.TextField;return n.size=120,n.text="  ",n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,e.timeField=n,e.armature.replaceSlot("matchTime",e.timeField),e}return __extends(e,t),e.prototype.avatarBarInit=function(){this.avatarBar.armature.animation.timeScale=4;var t=this.vo.avatarList.indexOf(this.vo.myAvatar),e=AssetManager.getBitmap(this.vo.avatarList[t].name,!0,!0),a=getNextIndex(t,this.vo.avatarList.length),n=AssetManager.getBitmap(this.vo.avatarList[a].name,!0,!0),i=getNextIndex(a,this.vo.avatarList.length),r=AssetManager.getBitmap(this.vo.avatarList[i].name,!0,!0),o=getLastIndex(t,this.vo.avatarList.length),s=AssetManager.getBitmap(this.vo.avatarList[o].name,!0,!0),h=getLastIndex(o,this.vo.avatarList.length),c=AssetManager.getBitmap(this.vo.avatarList[h].name,!0,!0),g=AssetManager.getBitmap(this.vo.avatarList[t].name,!0,!0),l=AssetManager.getBitmap(this.vo.avatarList[a].name,!0,!0),d=AssetManager.getBitmap(this.vo.avatarList[i].name,!0,!0),u=AssetManager.getBitmap(this.vo.avatarList[o].name,!0,!0),p=AssetManager.getBitmap(this.vo.avatarList[h].name,!0,!0);this.armature.replaceSlot("choose_M",g),this.armature.replaceSlot("choose_R1",l),this.armature.replaceSlot("choose_R2",d),this.armature.replaceSlot("choose_L1",u),this.armature.replaceSlot("choose_L2",p),this.avatarBar.replaceSlot("choose_M",e),this.avatarBar.replaceSlot("choose_R1",n),this.avatarBar.replaceSlot("choose_R2",r),this.avatarBar.replaceSlot("choose_L1",s),this.avatarBar.replaceSlot("choose_L2",c),this.choose_M=e,this.choose_R1=n,this.choose_R2=r,this.choose_L1=s,this.choose_L2=c},e.prototype.gameBarInit=function(){this.gameBar.armature.animation.timeScale=8;var t=this.vo.currentGameIndex,e=AssetManager.getBitmap(this.vo.gameList[t].texture,!0,!0),a=getNextIndex(t,this.vo.gameList.length),n=AssetManager.getBitmap(this.vo.gameList[a].texture,!0,!0),i=getNextIndex(a,this.vo.gameList.length),r=AssetManager.getBitmap(this.vo.gameList[i].texture,!0,!0),o=getLastIndex(t,this.vo.gameList.length),s=AssetManager.getBitmap(this.vo.gameList[o].texture,!0,!0),h=getLastIndex(o,this.vo.gameList.length),c=AssetManager.getBitmap(this.vo.gameList[h].texture,!0,!0),g=AssetManager.getBitmap(this.vo.gameList[t].texture,!0,!0),l=AssetManager.getBitmap(this.vo.gameList[a].texture,!0,!0),d=AssetManager.getBitmap(this.vo.gameList[i].texture,!0,!0),u=AssetManager.getBitmap(this.vo.gameList[o].texture,!0,!0),p=AssetManager.getBitmap(this.vo.gameList[h].texture,!0,!0);this.armature.replaceSlot("gameBarMid",g),this.armature.replaceSlot("gameBarRight1",l),this.armature.replaceSlot("gameBarRight2",d),this.armature.replaceSlot("gameBarLeft1",u),this.armature.replaceSlot("gameBarLeft2",p),this.gameBar.replaceSlot("gameBarMid",e),this.gameBar.replaceSlot("gameBarRight1",n),this.gameBar.replaceSlot("gameBarRight2",r),this.gameBar.replaceSlot("gameBarLeft1",s),this.gameBar.replaceSlot("gameBarLeft2",c),this.gameBar_M=e,this.gameBar_R1=n,this.gameBar_R2=r,this.gameBar_L1=s,this.gameBar_L2=c,this._gameBar_M=g,this._gameBar_R1=l,this._gameBar_R2=d,this._gameBar_L1=u,this._gameBar_L2=p},e.prototype.setAvatarBar=function(t){var e=getNextIndex(t,this.vo.avatarList.length),a=getNextIndex(e,this.vo.avatarList.length),n=getLastIndex(t,this.vo.avatarList.length),i=getLastIndex(n,this.vo.avatarList.length);AssetManager.changeTexture(this.choose_M,this.vo.avatarList[t].name),AssetManager.changeTexture(this.choose_R1,this.vo.avatarList[e].name),AssetManager.changeTexture(this.choose_R2,this.vo.avatarList[a].name),AssetManager.changeTexture(this.choose_L1,this.vo.avatarList[n].name),AssetManager.changeTexture(this.choose_L2,this.vo.avatarList[i].name)},e.prototype.setGameBar=function(t){var e=getNextIndex(t,this.vo.gameList.length),a=getNextIndex(e,this.vo.gameList.length),n=getLastIndex(t,this.vo.gameList.length),i=getLastIndex(n,this.vo.gameList.length);AssetManager.changeTexture(this.gameBar_M,this.vo.gameList[t].texture),AssetManager.changeTexture(this.gameBar_R1,this.vo.gameList[e].texture),AssetManager.changeTexture(this.gameBar_R2,this.vo.gameList[a].texture),AssetManager.changeTexture(this.gameBar_L1,this.vo.gameList[n].texture),AssetManager.changeTexture(this.gameBar_L2,this.vo.gameList[i].texture),AssetManager.changeTexture(this._gameBar_M,this.vo.gameList[t].texture),AssetManager.changeTexture(this._gameBar_R1,this.vo.gameList[e].texture),AssetManager.changeTexture(this._gameBar_R2,this.vo.gameList[a].texture),AssetManager.changeTexture(this._gameBar_L1,this.vo.gameList[n].texture),AssetManager.changeTexture(this._gameBar_L2,this.vo.gameList[i].texture)},e.prototype.onNextGame=function(t){this.arrowR.touchEnabled=!1,this.arrowL.touchEnabled=!1,this.gameBarMid.touchEnabled=!1,this.vo.getNextGame(),this.gameBar.play("gameBar_RtoL",1),this.gameBar.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.changeGameComplete,this),console.log("当前index，",this.vo.currentGameIndex)},e.prototype.onLastGame=function(t){this.arrowR.touchEnabled=!1,this.arrowL.touchEnabled=!1,this.gameBarMid.touchEnabled=!1,this.vo.getLastGame(),this.gameBar.play("gameBar_LtoR",1),this.gameBar.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.changeGameComplete,this),console.log("当前index，",this.vo.currentGameIndex)},e.prototype.changeGameComplete=function(t){this.gameBar.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.changeGameComplete,this),this.arrowR.touchEnabled=!0,this.arrowL.touchEnabled=!0,this.gameBarMid.touchEnabled=!0,this.gameBar.play("gameBar_normal",1),this.setGameBar(this.vo.currentGameIndex)},e.prototype.onChangeAvatarStart=function(t){this.vo.touchStartX=t.stageX,this.vo.touchStartY=t.stageY},e.prototype.onChangeAvatar=function(t){var e,a=t.stageX-this.vo.touchStartX,n=(t.stageY-this.vo.touchStartY,Math.abs(Math.round(a/3)));a>0?(this.avatarBar.armature.animation.gotoAndStopByFrame("avatarBar_LtoR",n),e=!0):(this.avatarBar.armature.animation.gotoAndStopByFrame("avatarBar_RtoL",n),e=!1),n>100*this.vo.multi&&(this.vo.multi++,e===!0?this.vo.myAvatar=this.vo.lastAvatar:this.vo.myAvatar=this.vo.nextAvatar,this.setAvatarBar(this.vo.avatarList.indexOf(this.vo.myAvatar)))},e.prototype.onChangeAvatarEnd=function(t){var e=t.stageX,a=(t.stageY,e-this.vo.touchStartX),n=Math.abs(Math.round(a/3));if(this.vo.multi=1,a>0&&n>50)this.avatarBar.armature.animation.gotoAndPlayByFrame("avatarBar_LtoR",n,1),this.vo.myAvatar=this.vo.lastAvatar;else if(0>a&&50>n){var i=getNextIndex(this.vo.avatarIndex,this.vo.avatarList.length);this.setAvatarBar(i),this.avatarBar.armature.animation.gotoAndPlayByFrame("avatarBar_LtoR",100-n,1)}else if(0>a&&n>50)this.avatarBar.armature.animation.gotoAndPlayByFrame("avatarBar_RtoL",n,1),this.vo.myAvatar=this.vo.nextAvatar;else if(a>0&&50>n){var i=getLastIndex(this.vo.avatarIndex,this.vo.avatarList.length);this.setAvatarBar(i),this.avatarBar.armature.animation.gotoAndPlayByFrame("avatarBar_RtoL",100-n,1)}this.avatarBar.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.changeAvatarComplete,this)},e.prototype.changeAvatarComplete=function(t){this.avatarBar.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.changeAvatarComplete,this),this.avatarBar.play("avatarBar_normal",1),this.setAvatarBar(this.vo.avatarList.indexOf(this.vo.myAvatar))},e.prototype.replaceBar=function(t){this.armature.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.replaceBar,this),this.armature.play("choose_normal",1),this.avatarBar.play("avatarBar_normal",1),this.setAvatarBar(this.vo.avatarList.indexOf(this.vo.myAvatar)),this.armature.replaceSlot("_avatarBar",this.avatarBar),this.gameBar.play("gameBar_normal",1),this.armature.replaceSlot("_gameBar",this.gameBar),this.light_Bottom.play("light_ripple",0),this.gameBarMid.touchEnabled=!0,this.touchBar.touchEnabled=!0,this.arrowL.touchEnabled=!0,this.arrowR.touchEnabled=!0},e.prototype.onInvite=function(t){console.log("邀请"),this.onGetPlayer(),this.giveUpButton.touchEnabled=!0,this.inviteButton.touchEnabled=!1,this.matchButton.touchEnabled=!1,this.startButton.touchEnabled=!0},e.prototype.matchCount=function(){var t=this;this.vo.matchCount(function(){t.timeField.text=t.vo.waitTime+""},function(){t.armature.play("choose_matchToBack",1),t.timeField.text="  "})},e.prototype.backToChoose=function(){this.armature.play("choose_backToStart",1),this.avatarBar.play("avatarBar_appear",1),this.armature.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.replaceBar,this)},e.prototype.onGameStart=function(t){RPC.instance.startGame(DataCenter.instance.room.id),RPC.instance.addEventListener(RPC.EVENT_START_GAME,this.onStartGameSuccess,this)},e.prototype.onStartGameSuccess=function(t){RPC.instance.removeEventListener(RPC.EVENT_START_GAME,this.onStartGameSuccess,this),this.next("gameChallenge"),this.giveUpButton.touchEnabled=!1,this.inviteButton.touchEnabled=!1,this.startButton.touchEnabled=!1,this.startButton.touchEnabled=!1},e.prototype.onMatch=function(t){this.armature.play("choose_waitToMatch",1),this.matchCount(),RPC.instance.enterRoom(1,1),RPC.instance.addEventListener(RPC.EVENT_ENTER_ROOM,this.onMatchSuccess,this)},e.prototype.onMatchSuccess=function(t){var e=t.data,a=new User(e.userID);a.loadPlatformInfo(),DataCenter.instance.room=new RoomVO(e.roomID,e.gameID,a),console.log("onMatchSuccess",e),RPC.instance.removeEventListener(RPC.EVENT_ENTER_ROOM,this.onMatchSuccess,this),this.onGetPlayer(),this.giveUpButton.touchEnabled=!0,this.inviteButton.touchEnabled=!1,this.startButton.touchEnabled=!0,this.matchButton.touchEnabled=!1},e.prototype.onGiveUp=function(t){this.vo.resetMatchCount(),this.timeField.text="  ",this.next("gameIndex")},e.prototype.init=function(){t.prototype.init.call(this),this.viewInit()},e.prototype.viewInit=function(){this.armature.x=this.stageWidth/2,this.armature.y=this.stageHeight/2,this.armature.armatureDisplay.animation.timeScale=.7,this.gameBar.play("gameBar_null",1),this.avatarBar.play("avatar_null",1),this.light_Up.play("light_normal",1),this.light_Bottom.play("light_normal",1),this.armature.play("choose_start",1),this.armature.armatureDisplay.animation.timeScale=1.3,this.gameBarMid.touchEnabled=!1,this.arrowL.touchEnabled=!1,this.arrowR.touchEnabled=!1,this.armature.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.replaceBar,this),this.addChild(this.armature)},e.prototype.getWait=function(){console.log("进入匹配邀请"),this.gameBarMid.touchEnabled=!1,this.touchBar.touchEnabled=!1,this.arrowL.touchEnabled=!1,this.arrowR.touchEnabled=!1,this.gameBar.play("gameBar_disapper",1),this.avatarBar.play("avatarBar_disapper",1),this.armature.play("choose_startToWait",1),this.armature.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.replaceLightBottom,this)},e.prototype.replaceLightBottom=function(t){this.armature.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.replaceLightBottom,this),this.light_Up.play("light_ripple"),this.giveUpButton.touchEnabled=!0,this.inviteButton.touchEnabled=!0,this.startButton.touchEnabled=!1,this.matchButton.touchEnabled=!0},e.prototype.onGetPlayer=function(){this.vo.resetMatchCount(),this.armature.play("choose_matchToReady",1)},e}(StateBG);__reflect(ChooseGamePanel.prototype,"ChooseGamePanel");var ChooseGamePanelState;!function(t){t[t.ChooseGame=0]="ChooseGame",t[t.WaitPlayer=1]="WaitPlayer",t[t.ready=2]="ready"}(ChooseGamePanelState||(ChooseGamePanelState={}));var GameChallenge=function(t){function e(){var e=t.call(this)||this,a="challenge";e.dbChallenge=AssetManager.getDBArmature(a);var n=e.dbChallenge.armature.getBone("avatar1"),i=e.dbChallenge.armature.getBone("avatar2");n.offset.scaleX=2,n.offset.scaleY=2,n.offset.y=200,i.offset.scaleX=2,i.offset.scaleY=2,i.offset.y=400;var r=new Avatar("avatar1"),o=new Avatar("avatar1");return r.normal(),o.normal(),e.dbChallenge.replaceSlot("avatar1",r),e.dbChallenge.replaceSlot("avatar2",o),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.dbChallenge.x=this.stageWidth/2,this.dbChallenge.y=this.stageHeight/2,this.addChild(this.dbChallenge),this.dbChallenge.play("run",1),this.dbChallenge.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.onStart,this)},e.prototype.onStart=function(t){this.dbChallenge.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.onStart,this),this.over()},e.prototype.onTouchBegin=function(t){this.over()},e.prototype.over=function(){this.next("gameKingkong")},e.prototype.dispose=function(){this.dbChallenge.stop(),this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(StateBG);__reflect(GameChallenge.prototype,"GameChallenge");var GameIndex=function(t){function e(){var e=t.call(this)||this;e.replaceButton=function(){var t=new DBAnimButton(AssetManager.getDBArmature("rankMatchButton"));t.touchChildren=t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.switchPanel("chooseGame")},e),e.indexPanel.replaceSlot("rankMatch",t);var a=new DBAnimButton(AssetManager.getDBArmature("friendMatchButton"));a.touchChildren=a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.switchPanel("chooseGame")},e),e.indexPanel.replaceSlot("friendMatch",a);var n=new DBAnimButton(AssetManager.getDBArmature("shopButton"));n.touchChildren=n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.switchPanel("shop")},e),e.indexPanel.replaceSlot("shop",n);var i=new DBButton(AssetManager.getDBArmature("buttonUI"));i.touchChildren=i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.indexPanel.play("sugarReturn",1)
},e),e.indexPanel.replaceSlot("returnButton1",i);var r=AssetManager.getDBArmature("light");r.play("light_ripple",0),e.indexPanel.replaceSlot("light",r)},e.avatars=[],e.replaceAvatar=function(){var t=AssetManager.getDBArmature("avatar1");e.indexPanel.replaceSlot("stand",t),e.avatars.push(t);var a=AssetManager.getDBArmature("avatar1");e.indexPanel.replaceSlot("stand1",a),e.avatars.push(a);var n=AssetManager.getDBArmature("avatar1");e.indexPanel.replaceSlot("sit",n),e.avatars.push(n)};var a=e.initUserDetail();a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,e.indexPanel=AssetManager.getDBArmature("kingkongIndex"),e.indexPanel.y+=Game.offset,e.replaceButton(),e.replaceAvatar(),a.touchChildren=a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.switchPanel("userDetail")},e),e.indexPanel.replaceSlot("userInfo",a);var n=e.indexPanel.armature.getSlot("sit").display;n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.switchPanel("switchUserImage")},e);var i=e.indexPanel.armature.getSlot("rank").display;i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.switchPanel("rank")},e);var r=e.indexPanel.armature.getSlot("sugarBowl").display;r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.indexPanel.play("tapSugar",1)},e);var o=e.indexPanel.armature.getSlot("sugarButton").display;return o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("获得***扭蛋")},e),e.addChild(e.indexPanel),e}return __extends(e,t),e.prototype.initUserDetail=function(){var t=new egret.DisplayObjectContainer,e=AssetManager.getBitmap("userbg_png");e.x=e.width/2,e.y=e.height/2,t.addChild(e);var a=AssetManager.getBitmap("headMask_png");a.width=163,a.height=163,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=130,a.y=230;var n=AssetManager.getBitmap("userimg1_jpg");n.width=a.width,n.height=a.height,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.x=a.x,n.y=a.y,t.addChild(n),t.addChild(a);var i=new egret.TextField;i.text="Name",i.size=50,i.x=a.x+a.width/2+30,i.y=a.y-a.height/2,t.addChild(i);var r=new egret.TextField;r.text="Lv.99",r.size=50,r.x=a.x+a.width/2+30,r.y=a.y,t.addChild(r);var o=new egret.TextField;o.text="999999",o.width=190,o.textColor=0,o.textAlign="right",o.size=45,o.x=700,o.y=170,t.addChild(o);var s=new Exe(520);return s.x=430,s.y=260,t.addChild(s),this.userDetailView={head:n,name:i,Lv:r,gold:o,exe:s},t},e.prototype.switchPanel=function(t){this.indexPanel.play("end",1),this._nextState=t,this.indexPanel.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.endOver,this)},e.prototype.endOver=function(t){this.indexPanel.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.endOver,this),this._nextState&&this.next(this._nextState)},e.prototype.startOver=function(t){this.indexPanel.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.startOver,this),this.avatars[2].play("lost",1)},e.prototype.init=function(){var e=this;t.prototype.init.call(this),this.indexPanel.x=this.stageWidth/2,this.indexPanel.y=this.stageHeight/2,this.indexPanel.play("start",1);for(var a=0,n=this.avatars;a<n.length;a++){var i=n[a];i.play("normal",0)}this.indexPanel.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.startOver,this),setTimeout(function(){e.updataDetailView({head:null,name:"string",Lv:100,gold:9999,exe:.67})},5e3)},e.prototype.updataDetailView=function(t){this.userDetailView.name.text=t.name,this.userDetailView.Lv.text="Lv."+t.Lv.toString(),this.userDetailView.gold.text=t.gold.toString(),this.userDetailView.exe.updataLengthByDecimal(t.exe)},e}(StateBG);__reflect(GameIndex.prototype,"GameIndex");var GameKingkong=function(t){function e(){var e=t.call(this)||this;return e._dbClock=new dragonBones.WorldClock(0),e._uiContainer=new egret.DisplayObjectContainer,e._sceneLeft=new KingkongScene(!0,e._uiContainer),e._sceneRight=new KingkongScene,e._progress1=new DBProgress(AssetManager.getDBArmature("progress1")),e._progress2=new DBProgress(AssetManager.getDBArmature("progress2")),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this);var e=DataCenter.instance.room;e&&e.id>=0?this._sceneRight.mode=KingkongScene.MODE_NET:this._sceneRight.mode=KingkongScene.MODE_AI,this.bg="bg_jpg",this._sceneLeft.addClock(this._dbClock),this.addChild(this._sceneLeft),this._sceneRight.self=!1,this._sceneRight.addClock(this._dbClock),this._sceneRight.scaleX=-1,this._sceneRight.scaleY=-1,this._sceneRight.x=this.stageWidth,this._sceneRight.y=this.stageHeight,this.addChild(this._sceneRight),this.addChild(this._uiContainer),this._progress1.x=this.stageWidth/2,this._progress2.x=this.stageWidth/2,this._uiContainer.addChild(this._progress2),this._uiContainer.addChild(this._progress1),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._sceneLeft.addEventListener(Kingkong.EVENT_SHOOT,this.onLeftShoot,this),this._sceneRight.addEventListener(Kingkong.EVENT_SHOOT,this.onRightShoot,this),this._sceneLeft.addEventListener(Kingkong.EVENT_WIN,this.onLeftWin,this),this._sceneRight.addEventListener(Kingkong.EVENT_WIN,this.onRightWin,this),this._sceneLeft.addEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneLeft.addEventListener(Kingkong.EVENT_GAME_OVER,this.onGameOver,this),this._sceneRight.addEventListener(Kingkong.EVENT_GAME_OVER,this.onGameOver,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_BOOM,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_GET_BANANA,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_GET_BOOM,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_JUMP,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_SHOOT,this.onMasterEvent,this),this._sceneLeft.addEventListener(KingkongScene.EVENT_SHOOT_GROUND,this.onMasterEvent,this),RPC.instance.addEventListener(RPC.EVENT_GAME_EVENT,this.onGameEvent,this)},e.prototype.onMasterEvent=function(t){if(this._sceneRight.mode==KingkongScene.MODE_NET){t.data;switch(t.type){case KingkongScene.EVENT_BOOM:RPC.instance.kingkongBoom();break;case KingkongScene.EVENT_GET_BANANA:RPC.instance.kingkongGetBanana();break;case KingkongScene.EVENT_GET_BOOM:RPC.instance.kingkongGetBoom();break;case KingkongScene.EVENT_JUMP:RPC.instance.kingkongJump();break;case KingkongScene.EVENT_SHOOT:RPC.instance.kingkongShoot();break;case KingkongScene.EVENT_SHOOT_GROUND:}}},e.prototype.onGameEvent=function(t){var e=t.data;if(e)switch(e.event){case"getBoom":this._sceneRight.kingkongGetBoom();break;case"getBanana":this._sceneRight.kingkongGetBanana();break;case"boom":this._sceneRight.kingkongHit();break;case"jump":this._sceneRight.kingkongJump();break;case"shoot":this._sceneRight.kingkongShoot()}},e.prototype.onGameOver=function(t){this._progress2&&(this._progress2.progress=0),this._progress1&&(this._progress1.progress=0),this._sceneLeft.dispose(),this._sceneRight.dispose(),this._win?(RPC.instance.enterRoom,DataCenter.instance.win(),this.next("gameWin")):(DataCenter.instance.lose(),this.next("gameLose"))},e.prototype.onGameStart=function(t){this._win=!1,this._sceneRight.startRun()},e.prototype.onLeftWin=function(t){this._win=!0,this._sceneRight.fail()},e.prototype.onRightWin=function(t){this._win=!1,this._sceneLeft.fail()},e.prototype.onLeftShoot=function(t){this._sceneRight.addBoom()},e.prototype.onRightShoot=function(t){this._sceneLeft.addBoom()},e.prototype.onTouchBegin=function(t){t.stageX<this.stageWidth/2?t.stageY>this.stageHeight/2?this._sceneLeft.touchLeft():this._sceneRight.mode==KingkongScene.MODE_MANUAL&&this._sceneRight.touchRight():t.stageY>this.stageHeight/2?this._sceneLeft.touchRight():this._sceneRight.mode==KingkongScene.MODE_MANUAL&&this._sceneRight.touchLeft()},e.prototype.tick=function(t){this._dbClock.advanceTime(t/1e3),this._sceneLeft.gameStart&&(this._progress2&&(this._progress2.progress=this._sceneLeft.progress),this._progress1&&(this._progress1.progress=this._sceneRight.progress))},e.prototype.dispose=function(){this.stage&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_SHOOT,this.onLeftShoot,this),this._sceneRight.removeEventListener(Kingkong.EVENT_SHOOT,this.onRightShoot,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_WIN,this.onLeftWin,this),this._sceneRight.removeEventListener(Kingkong.EVENT_WIN,this.onRightWin,this),this._sceneLeft.removeEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this),this._sceneRight.removeEventListener(Kingkong.EVENT_GAME_START,this.onGameStart,this)},e}(StateBG);__reflect(GameKingkong.prototype,"GameKingkong");var GameLose=function(t){function e(){var e=t.call(this)||this,a="losePage";e.armature=AssetManager.getDBArmature(a),e.txtGold=new egret.TextField,e.txtScore=new egret.TextField,e.txtGold.size=60,e.txtGold.text="+100",e.txtScore.size=60,e.txtScore.text="+88",e.btnQuit=new DBButton(AssetManager.getDBArmature("btnQuit")),e.btnShare=new DBButton(AssetManager.getDBArmature("btnShare")),e.btnReplay=new DBButton(AssetManager.getDBArmature("btnReplay"));var n=e.armature.armature.getSlot("avatar"),i=new Avatar("avatar1");return dragonBones.EgretFactory.factory.clock.add(i.armature),i.lose(),n&&(n.offset.scaleX=2,n.offset.scaleY=2),e.armature.replaceSlot("btnShare",e.btnShare),e.armature.replaceSlot("btnQuit",e.btnQuit),e.armature.replaceSlot("btnReplay",e.btnReplay),e.armature.replaceSlot("txtScore",e.txtScore),e.armature.replaceSlot("txtGold",e.txtGold),e.armature.replaceSlot("avatar",i),e.btnReplay.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onReplay,e),e.btnQuit.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onQuit,e),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.armature.x=this.stageWidth/2,this.armature.y=this.stageHeight/2,this.addChild(this.armature),this.armature.play("run",1)},e.prototype.onQuit=function(t){this.armature.stop(),this.next("gameIndex")},e.prototype.onReplay=function(t){this.replay()},e.prototype.replay=function(){this.armature.stop(),this.next("chooseGame")},e.prototype.dispose=function(){this.armature.stop(),this.removeChildren()},e}(StateBG);__reflect(GameLose.prototype,"GameLose");var GameWin=function(t){function e(){var e=t.call(this)||this,a="winPage";e.armature=AssetManager.getDBArmature(a),e.txtGold=new egret.TextField,e.txtScore=new egret.TextField,e.txtGold.size=60,e.txtGold.text="+100",e.txtScore.size=60,e.txtScore.text="+88",e.btnQuit=new DBButton(AssetManager.getDBArmature("btnQuit")),e.btnShare=new DBButton(AssetManager.getDBArmature("btnShare")),e.btnReplay=new DBButton(AssetManager.getDBArmature("btnReplay"));var n=e.armature.armature.getSlot("avatar"),i=new Avatar("avatar1");return dragonBones.EgretFactory.factory.clock.add(i.armature),i.win(),n&&(n.offset.scaleX=2,n.offset.scaleY=2),e.armature.replaceSlot("btnShare",e.btnShare),e.armature.replaceSlot("btnQuit",e.btnQuit),e.armature.replaceSlot("btnReplay",e.btnReplay),e.armature.replaceSlot("txtScore",e.txtScore),e.armature.replaceSlot("txtGold",e.txtGold),e.armature.replaceSlot("avatar",i),e.armature.touchChildren=!0,e.btnReplay.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onReplay,e),e.btnQuit.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onQuit,e),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.armature.x=this.stageWidth/2,this.armature.y=this.stageHeight/2,this.addChild(this.armature),this.armature.play("run",1)},e.prototype.onQuit=function(t){this.armature.stop(),this.next("gameIndex")},e.prototype.onReplay=function(t){this.replay()},e.prototype.replay=function(){this.armature.stop(),this.next("chooseGame")},e.prototype.dispose=function(){this.armature.stop(),this.removeChildren()},e}(StateBG);__reflect(GameWin.prototype,"GameWin");var KingkongScene=function(t){function e(e,a){void 0===e&&(e=!1),void 0===a&&(a=null);var n=t.call(this)||this;return n._totalDistance=35570,n._curItemConfigs=[],n._curItems=[],n._kingkongPosMinY=1521,n._kingkongPosMaxY=1900,n._fastLastTime=3,n.self=!0,n._kingkongOffsetY=450,n._curLevel=1,n._invincibleTime=0,n.progress=0,n.master=e,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAdded,n),n._building=new Building,n._kingkong=new Kingkong(e),n._itemContainer=new egret.DisplayObjectContainer,a?n._uiContainer=a:n._uiContainer=new egret.DisplayObjectContainer,n._txtTime=new egret.TextField,n._itemsPool=new KingkongItemPool,n.btnJump=new DBAnimButton(AssetManager.getDBArmature("btnJump")),n.btnShoot=new DBAnimButton(AssetManager.getDBArmature("btnShoot")),n._tip=AssetManager.getDBArmature("tip"),n._avatar=new Avatar("avatar2"),n}return __extends(e,t),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t,this._mode==e.MODE_AI&&this.initAI(AIKingkong.AI_LEVEL_3)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gameStart",{get:function(){return this._gameStart},enumerable:!0,configurable:!0}),e.prototype.addTip=function(){this._tip&&(this._tip.play("run"),this._tip.x=this.btnJump.x,this._tip.y=this.btnJump.y,this._uiContainer.addChild(this._tip))},e.prototype.removeTip=function(){this._tip&&this._tip.parent&&(this._tip.stop(),this._tip.parent.removeChild(this._tip))},e.prototype.onShot=function(t){this.addBoom()},e.prototype.onAdded=function(t){this.stageWidth=this.stage.stageWidth,this.stageHeight=this.stage.stageHeight,this.init()},e.prototype.dispose=function(){this._avatar.stand(),this.removeAllItems(),this._itemContainer.removeChildren(),this._win.parent&&this._win.parent.removeChild(this._win)},e.prototype.init=function(){var t=RES.getRes("levelConfig_json").level[this._curLevel];this._curItemConfigs=t.concat(),this._building.x=this.stageWidth,this._building.y=this.stageHeight,this.addChild(this._building),this._building.stop(),this.addChild(this._itemContainer),this._itemContainer.x=this.stageWidth-100,this._itemContainer.y=0,this._uiContainer.x=0,this._uiContainer.y=0,this.addChild(this._uiContainer),this.btnJump.x=.75*this.stageWidth,this.btnShoot.x=.25*this.stageWidth,this.btnJump.y=this.btnShoot.y=this.stageHeight-150,this._uiContainer.addChild(this.btnJump),this._uiContainer.addChild(this.btnShoot),this.master||(this.btnJump.visible=!1,this.btnShoot.visible=!1),this._txtTime.size=60,this._txtTime.x=this.stageWidth/2-80,this._txtTime.y=.9*e.DESIGN_HEIGHT-(e.DESIGN_HEIGHT-this.stageHeight)/2,this._uiContainer.addChild(this._txtTime),this._avatar.x=this.stageWidth/2,this._avatar.y=this.stageHeight/2+300,this.addChild(this._avatar),this._kingkong.x=this.stageWidth-100,this._kingkong.y=this.stageHeight-this._kingkongOffsetY,this._kingkongPosY=this._kingkong.y,this._kingkongPosMaxY=this._kingkongPosY+Kingkong.LEG_LENGTH+KingkongItem.HALF_SIZE,this._kingkongPosMinY=this._kingkongPosY-Kingkong.arguments-KingkongItem.HALF_SIZE,this.addChild(this._kingkong),this._kingkong.stand(),this._win=new egret.TextField,this._win.size=60,this._win.x=this.stageWidth/2,this._win.y=.8*this.stageHeight,this._win.text="YOU WIN !",this._totalDistance=this.configToD(this._curItemConfigs[this._curItemConfigs.length-1].d)+this.stageHeight-this._kingkongOffsetY,this.master&&this.preStart(),this._mode==e.MODE_AI&&this.initAI(AIKingkong.AI_LEVEL_3)},e.prototype.initAI=function(t){this._mode==e.MODE_AI&&(null==this._ai&&(this._ai=new AIKingkong,this._ai.addEventListener(Kingkong.EVENT_SHOOT,this.onAIShoot,this),this._ai.addEventListener(Kingkong.EVENT_JUMP,this.onAIJump,this)),this._ai.level=t,this._ai.kingkong=this._kingkong,this._ai.curItems=this._curItems)},e.prototype.onAIShoot=function(t){this.touchLeft()},e.prototype.onAIJump=function(t){this.touchRight()},e.prototype.addClock=function(t){this._dbClock=t,this.clock=t,this._kingkong.addClock(this._dbClock),this._building.addClock(this._dbClock),this._avatar.addClock(this._dbClock),this._dbClock.add(this)},e.prototype.advanceTime=function(t){this._gameStart?(this._curTime+=t,this._curDistance=this._building.curDistance,this.addItems(),this.moveItems(),this.removeItems(),this.testHit(),this._fast&&this.checkFast(t),this.checkWin(),this.master&&!e.touched&&this._curTime>e.TIP_TIME&&null==this._tip.parent&&this.addTip(),this.progress=this._curDistance/this._totalDistance,this._txtTime.visible=!0,this._txtTime.text="00:"+Math.floor(e.MAX_TIME-this._curTime),this._mode==e.MODE_AI&&this._ai.advanceTime(t),this._invincibleTime>0&&(this._invincibleTime-=t)):this.master&&(this._txtTime.visible=!1)},e.prototype.checkWin=function(){this._curDistance>this._totalDistance&&this.win()},e.prototype.fail=function(){this._avatar.lose(),this._kingkong.getBoom(!1),this.gameOver()},e.prototype.win=function(){var t=this;if(this.key){this.key.x+=this._itemContainer.x,this.key.y+=this._itemContainer.y,this._uiContainer.addChild(this.key);var e=egret.Tween.get(this.key),a=this._avatar.x-this.key.x,n=this._avatar.y-this.key.y;e.to({x:this.key.x+a/2,y:this.key.y+n/2,scaleX:2,scaleY:2},500),e.to({x:this.key.x+a,y:this.key.y+n,scaleX:1,scaleY:1},500),e.call(function(){t._avatar.win(),t.key.x=0,t.removeItem(t.key,0),t.key=null}),e.wait(1e3),e.call(function(){t.dispatchEvent(new egret.Event(Kingkong.EVENT_GAME_OVER))})}this._kingkong.getBoom(!1),this.dispatchEvent(new egret.Event(Kingkong.EVENT_WIN)),this.gameOver()},e.prototype.gameOver=function(){this._curDistance=0,this._fastLastTime=0,this._building.curDistance=0,this._curTime=0,this._gameStart=!1,this._building.stop(),this._kingkong.stand(),this.removeTip(),this._mode==e.MODE_AI&&this._ai.over()},e.prototype.checkFast=function(t){this._fastLastTime>0?this._fastLastTime-=t:this.stopFast()},e.prototype.testHit=function(){var t,a,n,i,r;for(t=0,a=this._curItems.length;a>t&&(this._curItems[t].type!=KingkongItem.TYPE_KEY&&this._curItems[t].y>this._kingkongPosMinY);t++)if(this._curItems[t].y<this._kingkongPosMaxY&&!this._kingkong.onAir()&&!this._kingkong.invincible){r=this._curItems[t],n=!0,i=this._curItems[t].type,this.removeItem(r,t);break}if(n&&this.mode!=e.MODE_NET)switch(i){case KingkongItem.TYPE_BANANA:this.kingkongGetBanana();break;case KingkongItem.TYPE_BOOM:this.kingkongGetBoom();break;case KingkongItem.TYPE_FIRE_BOOM:this._invincibleTime<=0&&(this.kingkongHit(),this._invincibleTime=e.INVINCIBLE_TIME)}},e.prototype.stopFast=function(){this._fast=!1,this._building.runNormal(),this._kingkong.runNormal()},e.prototype.kingkongGetBanana=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_GET_BANANA,!1,!1,this._curDistance)),this._fast=!0,this._slow=!1,this._fastLastTime=e.FAST_TIME,this._building.runFast(),this._kingkong.runFast(),this._avatar.banana()},e.prototype.kingkongGetBoom=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_GET_BOOM,!1,!1,this._curDistance)),this._kingkong.getBoom(!0)},e.prototype.kingkongRecover=function(){this._slow=!1,this._fast=!1,this._building.runNormal(),this._kingkong.runNormal(),this._kingkong.removeEventListener(Kingkong.EVENT_RECOVER,this.onKingkongRecover,this)},e.prototype.onKingkongRecover=function(t){this.kingkongRecover()},e.prototype.kingkongHit=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_BOOM,!1,!1,this._curDistance)),this._slow=!0,this._fast=!1,this._building.runSlow(),this._kingkong.runSlow(),this._kingkong.getBoom(!1),this._kingkong.addEventListener(Kingkong.EVENT_RECOVER,this.onKingkongRecover,this),this._kingkong.playHit(),this._avatar.boom()},e.prototype.disToConfig=function(t){return(this._curDistance-t)/100},e.prototype.configToD=function(t){return 100*t},e.prototype.addBoom=function(){var t=this._itemsPool.getItem();t.type=KingkongItem.TYPE_FIRE_BOOM,t.x=-this.stageWidth/2,t.y=this._kingkongOffsetY,this._itemContainer.addChild(t);var e=egret.Tween.get(t);e.to({x:-this.stageWidth/4,scaleX:2,scaleY:2},250),e.to({x:-0,scaleX:1,scaleY:1},250),e.call(this.addBoomComplete,this,[t])},e.prototype.addBoomComplete=function(t){t.pos=this.disToConfig(t.y),this.master||this.dispatchEvent(new egret.Event(e.EVENT_SHOOT_GROUND,!1,!1,t.pos)),this._lastAddedBoom=t;var a,n,i;for(a=0,n=this._curItems.length;n>a;a++)if(this._curItems[a].pos>t.pos){this._curItems.splice(a,0,t),i=!0;break}i||this._curItems.push(t)},e.prototype.addItems=function(){if(this._curItemConfigs.length>0)for(var t=this._curItemConfigs[0].d,e=this._curItemConfigs[0].t,a=this.configToD(t);a<this._curDistance;){this._curItemConfigs.shift();var n=this._itemsPool.getItem();if(n.x=0,n.type=e,n.pos=t,n.type==KingkongItem.TYPE_KEY&&(this.key=n),this._itemContainer.addChild(n),this._curItems.push(n),!(this._curItemConfigs.length>0)){a=Number.MAX_VALUE;break}t=this._curItemConfigs[0].d,e=this._curItemConfigs[0].t,a=this.configToD(t)}},e.prototype.moveItems=function(){var t,e,a;for(t=0,e=this._curItems.length;e>t;t++)a=this._curItems[t],a.y=this._curDistance-this.configToD(a.pos)},e.prototype.removeItem=function(t,e){this._itemsPool.disposeItem(t),this._curItems.splice(e,1),t.parent&&t.parent.removeChild(t)},e.prototype.removeItems=function(){var t,e,a;for(t=0,e=this._curItems.length;e>t;t++)a=this._curItems[t],a.y>this.stageHeight&&a.type!=KingkongItem.TYPE_KEY&&(this._itemsPool.disposeItem(a),this._curItems.splice(t,1),t--,e--,a.parent&&a.parent.removeChild(a))},e.prototype.removeAllItems=function(){var t,e,a;for(t=0,e=this._curItems.length;e>t;t++)a=this._curItems[t],this._itemsPool.disposeItem(a),this._curItems.splice(t,1),t--,e--,a.parent&&a.parent.removeChild(a)},e.prototype.touchLeft=function(){this._kingkong.hasBoom&&this.kingkongShoot()},e.prototype.touchRight=function(){this._kingkong.jumpEnable()&&this.kingkongJump()},e.prototype.kingkongJump=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_JUMP,!1,!1,this._curDistance)),this._kingkong.jump(),this.btnJump.touch(),e.touched=!0,this.removeTip()},e.prototype.kingkongShoot=function(){this.master&&this.dispatchEvent(new egret.Event(e.EVENT_SHOOT,!1,!1,this._curDistance)),this.btnShoot.touch(),this._kingkong.getBoom(!1),this.dispatchEvent(new egret.Event(Kingkong.EVENT_SHOOT)),e.touched=!0,this.removeTip()},e.prototype.preStart=function(){var t=this,e=AssetManager.getBitmap("ready_png"),a=AssetManager.getBitmap("go_png");this.addChild(e),this.addChild(a),e.x=-100,e.y=.75*this.stageHeight,a.x=e.x,a.y=e.y;var n=egret.Tween.get(e),i=egret.Tween.get(a);n.to({x:this.stageWidth/2},240),n.to({x:this.stageWidth/2+10},800),n.to({x:this.stageWidth+500},240),i.wait(1600),i.to({x:this.stageWidth/2},240),i.to({x:this.stageWidth/2+10},800),i.to({x:this.stageWidth+500},240),i.call(function(){t.startRun(),t.dispatchEvent(new egret.Event(Kingkong.EVENT_GAME_START))})},e.prototype.startRun=function(){this._gameStart=!0,this._curTime=0,this.progress=0,this._building.reset(),this._kingkong.reset(),this._invincibleTime=0,this._curDistance=0,this._avatar&&this._avatar.stand(),this._building.run(),this._kingkong.run(),this._mode==e.MODE_AI&&this._ai.start()},e.EVENT_SHOOT="kingkongScene:EVENT_SHOOT",e.EVENT_SHOOT_GROUND="kingkongScene:EVENT_SHOOT_GROUND",e.EVENT_JUMP="kingkongScene:EVENT_JUMP",e.EVENT_BOOM="kingkongScene:EVENT_BOOM",e.EVENT_GET_BOOM="kingkongScene:EVENT_GET_BOOM",e.EVENT_GET_BANANA="kingkongScene:EVENT_GET_BANANA",e.MODE_MANUAL=0,e.MODE_NET=1,e.MODE_AI=2,e.FAST_TIME=3,e.TIP_TIME=3,e.MAX_TIME=40,e.INVINCIBLE_TIME=1.1,e.DESIGN_WIDTH=1080,e.DESIGN_HEIGHT=1920,e}(egret.DisplayObjectContainer);__reflect(KingkongScene.prototype,"KingkongScene",["dragonBones.IAnimatable"]);var Level1=function(t){function e(){var e=t.call(this)||this;e.SHOW_TIME=3e3,e.BEST_UP_TIME=100,e.BEST_DOWN_TIME=100,e.GOOD_UP_TIME=300,e.GOOD_DOWN_TIME=300,e.MISS_TIME=100,e.SPEED=.3,e.HIT_POSITION=1110,e._curPoints=[],e._curEffects=[],e._pointPool=new RhythmPointPool,e._curRhythm=[];var a;for(a=0;95>a;a++)e._curRhythm.push(1e3*a+3e3);return e._pointContainer=new egret.DisplayObjectContainer,e._effectContainer=new egret.DisplayObjectContainer,e._dbClock=new dragonBones.WorldClock(0),e}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.bg="mb9_png",this._rhythmBar=AssetManager.getBitmap("mb10_png",!0,!1),this._rhythmBar.x=this.stageWidth/2,this._rhythmBar.y=0,this.addChild(this._rhythmBar);var e=new egret.Shape;e.graphics.beginFill(16777215),e.graphics.drawRect(0,0,10,1080),e.graphics.endFill(),e.x=this.stageWidth/2-5,this.addChild(e),this._pointContainer.x=this.stageWidth/2,this._pointContainer.y=0,this.addChild(this._pointContainer),this._score=new ScoreData,this._meow=new Meow,this._effectContainer.x=this.stageWidth/2,this._effectContainer.y=this._rhythmBar.height+0,this.addChild(this._effectContainer),this._meow.x=this.stageWidth/2,this._meow.y=this._rhythmBar.height+600,this._meow.addClock(this._dbClock),this.addChild(this._meow),this._scoreTxt=new egret.TextField,this._scoreTxt.size=80,this._scoreTxt.x=20,this._scoreTxt.y=20,this.addChild(this._scoreTxt),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this);var a=AssetManager.getBitmap("d3_png"),n=AssetManager.getBitmap("d2_png"),i=AssetManager.getBitmap("d1_png");a.x=n.x=i.x=this.stageWidth/2,a.y=n.y=i.y=this.stageHeight/4;var r=this;r.addChild(a),setTimeout(function(){r.removeChild(a),r.addChild(n)},1e3),setTimeout(function(){r.removeChild(n),r.addChild(i)},2e3),setTimeout(function(){r.removeChild(i),r.gameStart()},3e3)},e.prototype.updateScore=function(){this._scoreTxt&&this._score&&(this._scoreTxt.text="best:"+this._score.curBestHit+"\ngood:"+this._score.curGoodHit+"\ncomboo:"+this._score.curComboo+"\n")},e.prototype.gameEnd=function(){},e.prototype.gameStart=function(){"iOS"==egret.Capabilities.os?this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onIOSStart,this):this.soundStart()},e.prototype.onIOSStart=function(t){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onIOSStart,this),this.soundStart()},e.prototype.soundStart=function(){this._curTime=0,this._startGame=!0,this.bgSound=AssetManager.getSound("nianiania40m_mp3"),this.bgChannel=this.bgSound.play(0,1)},e.prototype.addEffect=function(t){var e=new HitEffect(t);this._effectContainer.addChild(e),e.start(),this._curEffects.push(e)},e.prototype.clearEffect=function(){var t,e,a;for(t=0,e=this._curEffects.length;e>t;t++)a=this._curEffects[t],a.isEnd&&(this._curEffects.splice(t,1),t--,e--,a.parent&&a.parent.removeChild(a))},e.prototype.onTouchBegin=function(t){this._meow&&this._meow.playHit(),this._startGame&&this.hitRhythm()},e.prototype.bestHit=function(){this.addEffect(HitEffect.BEST),this._score.curBestHit++,this.updateScore()},e.prototype.goodHit=function(){this.addEffect(HitEffect.GOOD),this._score.curGoodHit++,this.updateScore()},e.prototype.missHit=function(){this._score.curMissHit++,this.updateScore()},e.prototype.tick=function(t){this._dbClock.advanceTime(t/1e3),this._startGame&&(this.bgChannel?this._curTime=1e3*this.bgChannel.position:this._curTime+=t,this._loopLockPoint=!0,this.addRhythm(),this.moveRhythm(),this.removeRhythm(),this._loopLockPoint=!1,this.clearEffect())},e.prototype.hitRhythm=function(){if(!this._loopLockPoint){var t,e,a,n;for(t=0,e=this._curPoints.length;e>t&&(a=this._curPoints[t],!(a.hit-this.GOOD_UP_TIME>this._curTime));t++)a.hit+this.BEST_DOWN_TIME>=this._curTime&&a.hit-this.BEST_UP_TIME<=this._curTime?(n=!0,this.bestHit(),this.removePoint(t),t--,e--):a.hit+this.GOOD_DOWN_TIME>=this._curTime&&a.hit-this.GOOD_UP_TIME<=this._curTime&&(n=!0,this.goodHit(),this.removePoint(t),t--,e--);n||this.addEffect(HitEffect.MISS)}},e.prototype.removePoint=function(t){var e=this._curPoints[t];this._pointPool.disposePoint(e),this._curPoints.splice(t,1),e.parent&&e.parent.removeChild(e)},e.prototype.addRhythm=function(){if(this._curRhythm.length>0)for(var t=this._curRhythm[0];t-3e3<this._curTime;){this._curRhythm.shift();var e=this._pointPool.getPoint();if(e.hit=t,this._pointContainer.addChild(e),this._curPoints.push(e),!(this._curRhythm.length>0)){t=Number.MAX_VALUE;break}t=this._curRhythm[0]}},e.prototype.moveRhythm=function(){var t,e,a;for(t=0,e=this._curPoints.length;e>t;t++)a=this._curPoints[t],a.y=(this._curTime-a.hit)*this.SPEED+this.HIT_POSITION},e.prototype.removeRhythm=function(){var t,e,a;for(t=0,e=this._curPoints.length;e>t;t++)a=this._curPoints[t],this._curTime>=a.hit+this.MISS_TIME&&(this._pointPool.disposePoint(a),this._curPoints.splice(t,1),t--,e--,a.parent&&a.parent.removeChild(a),this.missHit())},e.prototype.over=function(){this.next("levelSelect")},e.prototype.dispose=function(){this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(StateBG);__reflect(Level1.prototype,"Level1");var LevelSelect=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.bg="bg4_jpg",this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e.prototype.onTouchBegin=function(t){this.over()},e.prototype.over=function(){this.next("level1")},e.prototype.dispose=function(){this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(StateBG);__reflect(LevelSelect.prototype,"LevelSelect");var LevelTitle=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.init.call(this),this.bg="bg1_png";var e=AssetManager.getBitmap("bg2_png"),a=AssetManager.getBitmap("bg3_png");a.x=e.x=this.stageWidth/2,a.y=e.y=this.stageHeight/2;var n=this;setTimeout(function(){n.addChild(e)},1e3),setTimeout(function(){n.addChild(a)},2e3),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e.prototype.onTouchBegin=function(t){this.over()},e.prototype.over=function(){this.next("levelSelect")},e.prototype.dispose=function(){this.removeChildren(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},e}(StateBG);__reflect(LevelTitle.prototype,"LevelTitle");var RankPanel=function(t){function e(){var e=t.call(this)||this;e.list=[];var a=new egret.Shape,n=a.graphics;n.beginFill(14937842),n.drawRect(0,0,1080,1920),n.endFill(),e.addChild(a);var i=new egret.Shape,r=i.graphics;r.beginFill(3684156),r.drawRect(0,0,1080,115),r.endFill(),e.addChild(i),fairygui.UIPackage.addPackage("kingkong");var o=fairygui.UIPackage.createObject("kingkong","rankPanel");fairygui.GRoot.inst.addChild(o),e.addChild(fairygui.GRoot.inst.displayObject);for(var s=o.getChild("rankList").asList,h=0;h<s.numChildren;h++){var c=s.getChildAt(h).asButton.getChild("rank"),g=s.getChildAt(h).asButton.getChild("head"),l=s.getChildAt(h).asButton.getChild("name"),d=s.getChildAt(h).asButton.getChild("score"),u=void 0;switch(h){case 0:u=new egret.Bitmap,u.texture=RES.getRes("first_png");break;case 1:u=new egret.Bitmap,u.texture=RES.getRes("second_png");break;case 2:u=new egret.Bitmap,u.texture=RES.getRes("third_png");break;default:u=new egret.TextField,u.text=(h+1).toString(),u.size=70,u.y=40,u.textColor=0}c.asGraph.setNativeObject(u);var p=new egret.Bitmap;p.texture=RES.getRes("bg_jpg"),p.width=g.width,p.height=g.height,g.asGraph.setNativeObject(p),l.asTextField.text=(h+1).toString(),d.asTextField.text=(100-h).toString(),e.list.push({head:g,name:l,score:d})}e.playerButton=new Button,e.playerButton.x=e.playerButton.width/2+20,e.playerButton.y=e.playerButton.height/2+Game.offset,e.addChild(e.playerButton),e.playerButton.touchEnabled=!0,e.playerButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e._rankVO.rankState=RankState.Player},e);var m=AssetManager.getBitmap("playerTitle_png");m.x=e.playerButton.x,m.y=e.playerButton.y,e.addChild(m),e.goldButton=new Button,e.goldButton.x=e.playerButton.x+e.playerButton.width+20,e.goldButton.y=e.goldButton.height/2+Game.offset,e.addChild(e.goldButton),e.goldButton.touchEnabled=!0,e.goldButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e._rankVO.rankState=RankState.Gold},e);var _=AssetManager.getBitmap("goldTitle_png");_.x=e.goldButton.x,_.y=e.goldButton.y,e.addChild(_),e.friendButton=new Button,e.friendButton.x=e.goldButton.x+e.goldButton.width+20,e.friendButton.y=e.friendButton.height/2+Game.offset,e.addChild(e.friendButton),e.friendButton.touchEnabled=!0,e.friendButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e._rankVO.rankState=RankState.Friend
},e);var v=AssetManager.getBitmap("friendTitle_png");v.x=e.friendButton.x,v.y=e.friendButton.y,e.addChild(v);var f=new DBButton(AssetManager.getDBArmature("buttonUI"));return f.touchChildren=f.touchEnabled=!0,f.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.returnToLast()},e),f.x=180,f.y=1840,e.addChild(f),e._rankVO=new RankVO(e),e}return __extends(e,t),e.prototype.setState=function(t){switch(this.friendButton.isSelect=!1,this.playerButton.isSelect=!1,this.goldButton.isSelect=!1,t){case RankState.Friend:this.friendButton.isSelect=!0;break;case RankState.Player:this.playerButton.isSelect=!0;break;case RankState.Gold:this.goldButton.isSelect=!0}},e.prototype.updataView=function(t){for(var e=0;e<this.list.length;e++)if(t[e]&&this.list[e]){var a=this.list[e].head,n=new egret.Bitmap;n.texture=RES.getRes(t[e].head),n.width=a.width,n.height=a.height,a.asGraph.setNativeObject(n),this.list[e].name.asTextField.text=t[e].name,this.list[e].score.asTextField.text=t[e].score}},e.prototype.onload=function(){this._rankVO.rankState=RankState.Player},e.prototype.onremove=function(){},e}(StateBG);__reflect(RankPanel.prototype,"RankPanel");var ShopPanel=function(t){function e(){var e=t.call(this)||this;e.isShop=!1,e.replaceAvatar=function(){var t=AssetManager.getDBArmature("avatar1");e.shopPanel.replaceSlot("stand",t),t.play("normal",0);var a=AssetManager.getDBArmature("avatar1");e.shopPanel.replaceSlot("stand1",a),a.play("normal",0);var n=AssetManager.getDBArmature("avatar1");e.shopPanel.replaceSlot("sit",n),n.play("lost",1)},e.shopPanel=AssetManager.getDBArmature("kingkongShop"),e.replaceAvatar();var a=e.shopPanel.armature.getSlot("banner").display;a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.floatPanel.updataView("是否观看好看视频",function(){console.log("获得免费金币")}),e.next("float")},e);var n=e.shopPanel.armature.getSlot("shopItem1").display;n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.floatPanel.updataView("是否分享到群",function(){console.log("获得免费金币5次")}),e.next("float")},e);var i=e.shopPanel.armature.getSlot("shopItem2").display;i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.floatPanel.updataView("是否购买500金币",function(){console.log("获得500金币")}),e.next("float")},e);var r=e.shopPanel.armature.getSlot("shopItem3").display;r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.floatPanel.updataView("是否购买3000金币",function(){console.log("获得3000金币")}),e.next("float")},e);var o=e.shopPanel.armature.getSlot("shopItem4").display;o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.floatPanel.updataView("是否购买12000金币",function(){console.log("获得12000金币")}),e.next("float")},e);var s=e.shopPanel.armature.getSlot("sit").display;s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.shopPanel.play("end",1),e._nextState="switchUserImage",e.shopPanel.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,e.endOver,e)},e);var h=e.shopPanel.armature.getSlot("sugarBowl").display;h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.shopPanel.play("tapSugar",1),e.isShop=!0},e);var c=e.shopPanel.armature.getSlot("sugarButton").display;c.touchEnabled=!0,c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("获得***扭蛋")},e);var g=new DBButton(AssetManager.getDBArmature("buttonUI"));g.touchChildren=g.touchEnabled=!0,g.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.isShop?e.shopPanel.play("sugarReturn",1):e.returnToLast(),e.isShop=!1},e),e.shopPanel.replaceSlot("returnButton1",g);var l=AssetManager.getDBArmature("light");return l.play("light_ripple",0),e.shopPanel.replaceSlot("light",l),e}return __extends(e,t),e.prototype.endOver=function(t){this.shopPanel.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.endOver,this),this._nextState&&this.next(this._nextState)},e.prototype.startOver=function(t){this.shopPanel.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.startOver,this)},e.prototype.init=function(){t.prototype.init.call(this),this.shopPanel.x=this.stageWidth/2,this.shopPanel.y=this.stageHeight/2,this.addChild(this.shopPanel),this.shopPanel.play("start",1),this.shopPanel.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.startOver,this)},e.prototype.onload=function(){},e.prototype.onremove=function(){},e}(StateBG);__reflect(ShopPanel.prototype,"ShopPanel");var AssetManager=function(){function t(){}return t.getBitmap=function(t,e,a){void 0===e&&(e=!0),void 0===a&&(a=!0);var n=new egret.Bitmap,i=RES.getRes(t);return n.texture=i,e&&(n.anchorOffsetX=n.width/2),a&&(n.anchorOffsetY=n.height/2),n},t.getSound=function(t){return RES.getRes(t)},t.loadDBAnimation=function(e){var a,n,i;for(a=0,n=e.length;n>a;a++){i=e[a];var r=RES.getRes(i+"_ske_json"),o=RES.getRes(i+"_tex_json"),s=RES.getRes(i+"_tex_png");r&&o&&s&&(t.dbFactory.parseDragonBonesData(r),t.dbFactory.parseTextureAtlasData(o,s))}},t.getDBArmature=function(e,a){void 0===a&&(a=!0);var n=t.dbFactory.buildArmature(e),i=new DBArmature(n,a);return i},t.changeTexture=function(t,e){var a=t.width,n=t.height;t.texture=RES.getRes(e),t.width=a,t.height=n},t.setText=function(t,e){t.text=e,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2},t.dbFactory=new dragonBones.EgretFactory,t}();__reflect(AssetManager.prototype,"AssetManager");var SwitchImagePanel=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var t=this,e=new egret.Shape,a=e.graphics;a.beginFill(14937842),a.drawRect(0,0,1080,1920),a.endFill(),this.addChild(e);var n=new egret.TextField;n.size=50,n.textColor=0,n.text="形象更换",n.x=540-n.measuredWidth/2,n.y=40+Game.offset,this.addChild(n);var i=new egret.TextField;i.text="9999金币",i.x=800,i.y=140+Game.offset,this.addChild(i);var r=new ImageItem("1","XXX","Head_middle_png",!0);r.x=200,r.y=200+Game.offset,this.addChild(r);var o=new ImageItem("2","YYY","Head_middle_png",!0);o.x=495,o.y=200+Game.offset,this.addChild(o);var s=new ImageItem("3","ZZZ","Head_middle_png",!0);s.x=790,s.y=200+Game.offset,this.addChild(s);var h=new ImageItem("4","金币","Head_middle_png",!1);h.x=200,h.y=550+Game.offset,this.addChild(h);var c=new ImageItem("5","3000 金币","Head_middle_png",!1);c.x=495,c.y=550+Game.offset,this.addChild(c);var g=new ImageItem("6","3000 金币","Head_middle_png",!1);g.x=790,g.y=550+Game.offset,this.addChild(g);var l=new DBButton(AssetManager.getDBArmature("buttonUI"));l.touchChildren=l.touchEnabled=!0,l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.returnToLast()},this),l.x=180,l.y=1840,this.addChild(l)},e}(StateBG);__reflect(SwitchImagePanel.prototype,"SwitchImagePanel");var UserDetailPanel=function(t){function e(){var e=t.call(this)||this,a=AssetManager.getBitmap("userDetailBG_png",!1,!1);a.scaleX=8,a.scaleY=8,a.x=100,a.y=300+Game.offset,e.addChild(a);var n=AssetManager.getBitmap("white_png",!1,!1);n.y=Game.offset,n.scaleX=1,n.scaleY=1,n.height=300,n.width=1100,e.addChild(n);var i=AssetManager.getBitmap("black_png",!1,!1);i.y=280+Game.offset,i.scaleX=1,i.scaleY=1,i.height=20,i.width=1100,e.addChild(i);var r=new egret.TextField;r.text="力量",r.size=40,r.x=620,r.y=450+Game.offset,e.addChild(r);var o=new egret.TextField;o.text="速度",o.size=40,o.x=880,o.y=700+Game.offset,e.addChild(o);var s=new egret.TextField;s.text="智慧",s.size=40,s.x=310,s.y=570+Game.offset,e.addChild(s);var h=new egret.TextField;h.text="耐力",h.size=40,h.x=380,h.y=940+Game.offset,e.addChild(h);var c=new egret.TextField;c.text="反应",c.size=40,c.x=700,c.y=1e3+Game.offset,e.addChild(c);var g=AssetManager.getBitmap("userHead_png",!1,!1);g.scaleX=2,g.scaleY=2,g.x=40,g.y=40+Game.offset,e.addChild(g);var l=new egret.TextField;l.text="根据属性随机变化评估文案 XXX",l.size=40,l.x=300,l.y=150+Game.offset,l.textColor=0,e.addChild(l);var d=AssetManager.getBitmap("returnLast_png");return d.x=900,d.y=1800+Game.offset,e.addChild(d),d.touchEnabled=!0,d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.returnToLast()},e),e.abilityPhotograph=new DrawWeightPhotograph(5,270,!0,4),e.abilityPhotograph.x=620,e.abilityPhotograph.y=750+Game.offset,e.abilityPhotograph.rotation=-7,e.addChild(e.abilityPhotograph),e.abilityPhotograph.draw([1,1,1,1,1]),e}return __extends(e,t),e}(StateBG);__reflect(UserDetailPanel.prototype,"UserDetailPanel");var WatchPanel=function(t){function e(){var e=t.call(this)||this;e.gridMap=[];var a=new egret.Shape,n=a.graphics;n.beginFill(14937842),n.drawRect(0,0,1080,1920),n.endFill(),e.addChild(a);var i=new egret.Shape,r=i.graphics;r.beginFill(3684156),r.drawRect(0,0,1080,115),r.endFill(),e.addChild(i),e.progressButton=new Button,e.progressButton.text="进行中",e.progressButton.x=e.progressButton.width/2+180,e.progressButton.y=e.progressButton.height/2+Game.offset,e.addChild(e.progressButton),e.progressButton.touchEnabled=!0,e.progressButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e._watchVO.watchPanelState=WatchState.Progress},e),e.videoButton=new Button,e.videoButton.text="录像",e.videoButton.y=e.videoButton.height/2+Game.offset,e.videoButton.x=e.progressButton.x+e.videoButton.width+40,e.addChild(e.videoButton),e.videoButton.touchEnabled=!0,e.videoButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e._watchVO.watchPanelState=WatchState.Video},e);var o=AssetManager.getBitmap("returnLast_png");o.x=1e3,o.y=1800+Game.offset,e.addChild(o),o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.returnToLast()},e);var s=new ProgressItem;s.x=40,s.y=200+Game.offset,e.addChild(s),e.gridMap.push(s);var h=new ProgressItem;h.x=40,h.y=670+Game.offset,e.addChild(h),e.gridMap.push(h);var c=new ProgressItem;return c.x=40,c.y=1140+Game.offset,e.addChild(c),e.gridMap.push(c),e._watchVO=new WatchVO(e),e}return __extends(e,t),e.prototype.init=function(){this._watchVO.watchPanelState=WatchState.Progress},e.prototype.setState=function(t){switch(this.progressButton.isSelect=!1,this.videoButton.isSelect=!1,t){case WatchState.Progress:this.progressButton.isSelect=!0;break;case WatchState.Video:this.videoButton.isSelect=!0}},e.prototype.updataView=function(t){switch(this._watchVO.watchPanelState){case WatchState.Progress:for(var e=0;e<this.gridMap.length;e++)this.gridMap[e].state=WatchState.Progress,t&&this.gridMap[e].setprogressData(t[e]);break;case WatchState.Video:this.videoButton.isSelect=!0;for(var e=0;e<this.gridMap.length;e++)this.gridMap[e].state=WatchState.Video,t&&this.gridMap[e].setVideoData(t[e])}},e}(StateBG);__reflect(WatchPanel.prototype,"WatchPanel");var DBArmature=function(t){function e(e,a){var n=t.call(this)||this;return n.armature=e,n.armatureDisplay=e.display,n.addChild(n.armatureDisplay),a&&(n.addToClock(dragonBones.EgretFactory.factory.clock),n.autoClock=a),n}return __extends(e,t),e.prototype.addToClock=function(t){null!=this.curClock&&this.curClock.remove(this.armature),this.curClock=t,this.curClock&&this.curClock.add(this.armature),this.autoClock=!1},e.prototype.gotoAndStop=function(t){this.armature.animation.gotoAndStopByFrame(t)},e.prototype.play=function(t,e){void 0===e&&(e=0),this.curAnimationState=this.armature.animation.play(t,e)},e.prototype.stop=function(){this.armature.animation.stop()},e.prototype.replaceSlot=function(t,e){var a=this.armature.getSlot(t);a&&(a.display=e)},e}(egret.DisplayObjectContainer);__reflect(DBArmature.prototype,"DBArmature");var Avatar=function(t){function e(e){var a=t.call(this)||this,n=e;return a.dbAvatar=AssetManager.getDBArmature(n,!1),a.armature=a.dbAvatar.armature,a.armatureDisplay=a.dbAvatar.armatureDisplay,a._avatarSlot=a.armature.getSlot("avatarIcon"),a.addChild(a.dbAvatar),a.stand(),a.imgUrl="http://localhost:5318/resource/assets/userimg1.jpg",a}return __extends(e,t),Object.defineProperty(e.prototype,"imgUrl",{set:function(t){var e=this;RES.getResByUrl(t,function(t){if(t&&(this.avatarImage=AssetManager.getBitmap("userImg2_jpg"),e._avatarSlot))try{e.dbAvatar.replaceSlot("avatarIcon",this.avatarImage)}catch(a){console.log(a)}},this,RES.ResourceItem.TYPE_IMAGE)},enumerable:!0,configurable:!0}),e.prototype.onAnimComplete=function(t){this.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this),this.stand()},e.prototype.onLoseComplete=function(t){this.armatureDisplay.removeEvent(dragonBones.AnimationEvent.COMPLETE,this.onLoseComplete,this),this.armature.animation.gotoAndStopByTime("lost",1)},e.prototype.addClock=function(t){this.clock=t,this.dbAvatar.addToClock(this.clock)},e.prototype.win=function(){this.dbAvatar.play("win")},e.prototype.lose=function(){this.dbAvatar.play("lost",1),this.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.onLoseComplete,this)},e.prototype.stand=function(){this.dbAvatar.play("stand")},e.prototype.happy=function(){this.dbAvatar.play("dese",6),this.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this)},e.prototype.normal=function(){this.dbAvatar.play("normal")},e.prototype.banana=function(){this.dbAvatar.play("banana",1),this.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this)},e.prototype.boom=function(){this.dbAvatar.play("bomb",1),this.armatureDisplay.addEvent(dragonBones.AnimationEvent.COMPLETE,this.onAnimComplete,this)},e.NORMAL_SPEED=2,e.FAST_SPEED=3,e}(egret.Sprite);__reflect(Avatar.prototype,"Avatar");var Building=function(t){function e(){var e=t.call(this)||this;e._offset=2390;var a="ground";return e.dbBuilding=AssetManager.getDBArmature(a,!1),e.armature=e.dbBuilding.armature,e._bone=e.armature.getBone("bone"),e.addChild(e.dbBuilding),e.stop(),e.reset(),e}return __extends(e,t),e.prototype.reset=function(){this._curD=this._bone.globalTransformMatrix.ty,this._lastD=this._curD,this.tickDistance=0,this.curDistance=0},e.prototype.addClock=function(t){this.clock=t,this.dbBuilding.addToClock(this.clock),t.add(this)},e.prototype.advanceTime=function(t){for(this._curD=this._bone.globalTransformMatrix.ty,this.tickDistance=this._curD-this._lastD;this.tickDistance<0;)this.tickDistance+=this._offset;this._lastD=this._curD,this.curDistance+=this.tickDistance},e.prototype.runNormal=function(){var t=egret.Tween.get(this.armature.animation);t.to({timeScale:e.NORMAL_SPEED},500)},e.prototype.runFast=function(){var t=egret.Tween.get(this.armature.animation);t.to({timeScale:e.FAST_SPEED},500)},e.prototype.runSlow=function(){this.armature.animation.timeScale=0},e.prototype.run=function(){this.armature.animation.play("run"),this.runSlow(),this.runNormal(),this.reset()},e.prototype.stop=function(){this.armature.animation.stop()},e.NORMAL_SPEED=2,e.FAST_SPEED=3,e}(egret.Sprite);__reflect(Building.prototype,"Building",["dragonBones.IAnimatable"]);var Kingkong=function(t){function e(e){void 0===e&&(e=!1);var a=t.call(this)||this,n=e?"kingkong":"kingkongBlue";a.dbKingkong=AssetManager.getDBArmature(n,!1),a.kingArmature=a.dbKingkong.armature,a.kingDisplay=a.dbKingkong.armatureDisplay,a._dust=AssetManager.getDBArmature("dust",!1),a._dust&&(a._dust.armature.animation.timeScale=1.5),a._bananaPeel=AssetManager.getDBArmature("bananaPeel",!1),a._bananaPeel.armature.animation.timeScale=1.5,a._bananaPeel.gotoAndStop("run"),a.addChild(a.kingDisplay);var i=a.kingArmature.getSlot("boom");return i&&(a.boomArmature=i.childArmature),a.dbKingkong.replaceSlot("dust",a._dust),a.dbKingkong.replaceSlot("bananaPeel",a._bananaPeel),a}return __extends(e,t),e.prototype.addClock=function(t){this.dbKingkong.addToClock(t),this._dust.addToClock(t),this._bananaPeel.addToClock(t)},e.prototype.onAir=function(){return this._status==e.STATUS_JUMP&&this._jumpState&&this._jumpState.currentTime>.17&&this._jumpState.currentTime<1.5?!0:!1},e.prototype.run=function(){this.invincible=!1,this._status=e.STATUS_RUN,this.kingArmature.animation.timeScale=e.NORMAL_SPEED,this._fast?(this._speedTw=egret.Tween.get(this.kingArmature.animation),this._speedTw.to({timeScale:e.FAST_SPEED},500)):this._slow?this.kingArmature.animation.timeScale=e.SLOW_SPEED:this.kingArmature.animation.timeScale=e.NORMAL_SPEED,this.kingArmature.animation.play("run",0)},e.prototype.playHit=function(){this._speedTw&&egret.Tween.removeTweens(this.kingArmature.animation),this.invincible=!0,this._fast=!1,this._status=e.STATUS_HIT,this.kingArmature.animation.timeScale=e.NORMAL_SPEED,this.kingArmature.animation.play("boom",1),this.kingDisplay.addEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onBoomComplete,this)},e.prototype.onBoomComplete=function(t){this.dispatchEvent(new egret.Event(e.EVENT_RECOVER)),this.run(),this.kingDisplay.removeEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onBoomComplete,this)},e.prototype.jumpEnable=function(){return this._status==e.STATUS_RUN},e.prototype.jump=function(){this._speedTw&&egret.Tween.removeTweens(this.kingArmature.animation),this.invincible=!1,this._status=e.STATUS_JUMP,this.kingArmature.animation.timeScale=e.NORMAL_SPEED,this._jumpState=this.kingArmature.animation.play("jump",1),this.kingDisplay.addEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onJumpComplete,this);var t=Math.floor(7*Math.random())+1;this._dust.play("boom"+t,1)},e.prototype.runFast=function(){this._fast=!0,this._slow=!1,this._bananaPeel&&this._bananaPeel.play("run",1),this._status==e.STATUS_RUN&&(this._speedTw=egret.Tween.get(this.kingArmature.animation),this._speedTw.to({timeScale:e.FAST_SPEED},500))},e.prototype.runSlow=function(){this._slow=!0,this._fast=!1,this._status==e.STATUS_RUN&&(this.kingArmature.animation.timeScale=e.SLOW_SPEED)},e.prototype.runNormal=function(){this._fast=!1,this._status==e.STATUS_RUN&&(this._speedTw=egret.Tween.get(this.kingArmature.animation),this._speedTw.to({timeScale:e.NORMAL_SPEED},500),this.kingArmature.animation.timeScale=e.NORMAL_SPEED)},e.prototype.onJumpComplete=function(t){this._fast?this.kingArmature.animation.timeScale=e.FAST_SPEED:this._slow?this.kingArmature.animation.timeScale=e.SLOW_SPEED:this.kingArmature.animation.timeScale=e.NORMAL_SPEED,this.run(),this.kingDisplay.removeEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,this.onJumpComplete,this)},e.prototype.stand=function(){this.invincible=!0,this._status=e.STATUS_STAND,this.kingArmature.animation.gotoAndStop("stand")},e.prototype.getBoom=function(t){if(this.hasBoom=t,this.boomArmature){var e=this.hasBoom?"boom1":"boom0";this.boomArmature.animation.gotoAndStop(e)}},e.prototype.reset=function(){this._fast=!1,this._slow=!1,this.invincible=!1},e.EVENT_RECOVER="EVENT_RECOVER",e.EVENT_SHOOT="EVENT_SHOOT",e.EVENT_JUMP="EVENT_JUMP",e.EVENT_WIN="EVENT_WIN",e.EVENT_GAME_START="EVENT_GAME_START",e.EVENT_GAME_OVER="EVENT_GAME_OVER",e.STATUS_RUN=0,e.STATUS_JUMP=1,e.STATUS_HIT=2,e.STATUS_STAND=3,e.STATUS_OVER=4,e.ARM_LENGTH=140,e.LEG_LENGTH=100,e.LENGTH=e.ARM_LENGTH+e.LEG_LENGTH,e.NORMAL_SPEED=2,e.FAST_SPEED=3,e.SLOW_SPEED=1,e}(egret.Sprite);__reflect(Kingkong.prototype,"Kingkong");var KingkongItem=function(t){function e(){var e=t.call(this)||this,a="kingkongItem";return e._item=AssetManager.getDBArmature(a),e.addChild(e._item),e}return __extends(e,t),e.prototype.reDraw=function(){var t=16711680;switch(this._item.stop(),this._type){case e.TYPE_BANANA:t=16776960,this._item.gotoAndStop("banana");break;case e.TYPE_BOOM:t=0,this._item.gotoAndStop("boom");break;case e.TYPE_FIRE_BOOM:t=16711680,this._item.play("fireBoom");break;case e.TYPE_KEY:t=16711680,this._item.gotoAndStop("key");break;default:t=16777215,this._item.stop()}},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this.reDraw()},enumerable:!0,configurable:!0}),e.TYPE_BANANA=0,e.TYPE_BOOM=1,e.TYPE_FIRE_BOOM=2,e.TYPE_KEY=3,e.SIZE=100,e.HALF_SIZE=e.SIZE/2,e}(egret.Sprite);__reflect(KingkongItem.prototype,"KingkongItem");var Game=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.prototype.onAdded=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.init()},e.prototype.init=function(){console.log("世界大乱斗 start, let's rock! "),this.initData(),this.initNet(),this.initGame(),this.login()},e.prototype.login=function(){DataCenter.instance.init(123)},e.prototype.onLogin=function(t){this._stateManager.setCurStateName("gameIndex"),this._stateManager.startTick()},e.prototype.initData=function(){DataCenter.instance.initConfig(RES.getRes("gameConfig_json"),RES.getRes("itemConfig_json")),DataCenter.instance.addEventListener(DataCenter.EVENT_LOGIN,this.onLogin,this)},e.prototype.initNet=function(){RPC.instance.initSocket()},e.prototype.initGame=function(){e.floatPanel=new FloatPanel,this._stateManager=new StateManager(this),this._stateManager.registerState("gameKingkong",new GameKingkong),this._stateManager.registerState("gameChallenge",new GameChallenge),this._stateManager.registerState("gameWin",new GameWin),this._stateManager.registerState("gameLose",new GameLose),this._stateManager.registerState("gameIndex",new GameIndex),this._stateManager.registerState("userDetail",new UserDetailPanel),this._stateManager.registerState("switchUserImage",new SwitchImagePanel),this._stateManager.registerState("watch",new WatchPanel),this._stateManager.registerState("rank",new RankPanel),this._stateManager.registerState("shop",new ShopPanel),this._stateManager.registerState("chooseGame",new ChooseGamePanel),this._stateManager.registerState("float",e.floatPanel),this._stateManager.registerState("candyMachine",new CandyMachinePanel)},e.offset=0,e}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");var RPC=function(t){function e(){var e=t.call(this)||this;return e.HOST="http://localhost:3000/",e._socketConnecting=!0,e._request=new egret.HttpRequest,e._request.responseType=egret.HttpResponseType.TEXT,e._request.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),e._request.addEventListener(egret.Event.COMPLETE,e.onGetComplete,e),e._request.addEventListener(egret.IOErrorEvent.IO_ERROR,e.onGetIOError,e),e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.onGetComplete=function(t){var e=t.currentTarget,a=JSON.parse(e.response);console.log(a),0==a.error?this._callback&&(this._callback("0",a),this._callback=null):this._callback&&(this._callback(a.error),this._callback=null),this._run=!1},e.prototype.onGetIOError=function(t){console.log("get error : "+t),this._callback&&(this._callback("404"),this._callback=null),this._run=!1},e.prototype.onGetProgress=function(t){console.log("get progress : "+Math.floor(100*t.bytesLoaded/t.bytesTotal)+"%")},e.prototype.login=function(t,e,a){this._callback=a,this._request.responseType=egret.HttpResponseType.TEXT,this._request.open(this.HOST+"login",egret.HttpMethod.POST),this._request.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),this._request.send(JSON.stringify({email:t,password:e}))},e.prototype.signup=function(t,e,a,n){this._callback=n,this._request.open(this.HOST+"register",egret.HttpMethod.POST),this._request.send(JSON.stringify({name:t,email:e,password:a}))},e.prototype.getUserInfo=function(t,e){null!=e&&e({id:t,name:"小明",sex:1,imgUrl:""})},e.prototype.initSocket=function(){NetManager.openWebSocket(),NetManager.webSocket.onopen=this.onSocketOpen,NetManager.webSocket.onmessage=this.onReceiveSocketMessage,NetManager.webSocket.onerror=this.onSocketError,NetManager.webSocket.onclose=this.onSocketClose},e.prototype.onSocketOpen=function(){console.log("socket connect success!"),this._socketConnecting=!0},e.prototype.onSocketClose=function(){console.log("socket disconnected !!!"),this._socketConnecting=!1},e.prototype.onReceiveSocketMessage=function(t){console.log("socket receive message"),console.log(t);NetManager.autoRespond(t,e.instance.handleSocketMessage,e.instance.handleSocketError)},e.prototype.onSocketError=function(t){console.log("socket error: ",t)},e.prototype.enterRoom=function(t,a){this._socketConnecting?(console.log("send enterRoom ",t,a),MyRequest.enterRoom(t,a)):this.dispatchEvent(new egret.Event(e.EVENT_ENTER_ROOM,!1,!1,{userID:-1,avatarType:1,roomID:-1,gameType:a}))},e.prototype.startGame=function(t){this._socketConnecting?(console.log("send startGame ",t),MyRequest.startGame(t)):this.dispatchEvent(new egret.Event(e.EVENT_START_GAME,!1,!1,{roomID:t}))},e.prototype.gameResult=function(t){console.log("game Result ",t),this._socketConnecting&&MyRequest.gameResult(t)},e.prototype.kingkongGetBoom=function(){MyRequest.gameEvent("getBoom")},e.prototype.kingkongGetBanana=function(){MyRequest.gameEvent("getBanana")},e.prototype.kingkongBoom=function(){MyRequest.gameEvent("boom")},e.prototype.kingkongJump=function(){MyRequest.gameEvent("jump")},e.prototype.kingkongShoot=function(){MyRequest.gameEvent("shoot")},e.prototype.handleSocketError=function(){console.log("handleSocketError")},e.prototype.handleSocketMessage=function(t){switch(t.index){case 101:console.log("enter room success",t),e.instance.dispatchEvent(new egret.Event(e.EVENT_ENTER_ROOM,!1,!1,t));break;case 103:console.log("start game success"),e.instance.dispatchEvent(new egret.Event(e.EVENT_START_GAME,!1,!1,t));break;case 107:console.log("get game event :",t.event),e.instance.dispatchEvent(new egret.Event(e.EVENT_GAME_EVENT,!1,!1,t));break;default:console.log("no handle message: ",t.index)}},e.EVENT_ENTER_ROOM="EVENT_ENTER_ROOM",e.EVENT_START_GAME="EVENT_START_GAME",e.EVENT_GAME_EVENT="EVENT_GAME_EVENT",e}(egret.EventDispatcher);__reflect(RPC.prototype,"RPC");var MyRequest=function(){function t(){}return t.enterRoom=function(t,e,a){NetManager.stampManager(),NetManager.netMap[NetManager.stamp.toString()]=a;var n=new MyByteArray;n.endian=egret.Endian.LITTLE_ENDIAN,n._writeShort(0),n._writeShort(100),n._writeShort(NetManager.stamp),n._writeInt(t),n._writeInt(e),n.finalWriter();var i=new DataView(n.buffer);i.setInt8(0,n.length-2),n.buffer=i.buffer,1===NetManager.webSocket.readyState?NetManager.webSocket.send(n.buffer):console.log("webSocket has not opend!")},t.startGame=function(t,e){NetManager.stampManager(),NetManager.netMap[NetManager.stamp.toString()]=e;var a=new MyByteArray;a.endian=egret.Endian.LITTLE_ENDIAN,a._writeShort(0),a._writeShort(102),a._writeShort(NetManager.stamp),a._writeInt(t),a.finalWriter();var n=new DataView(a.buffer);n.setInt8(0,a.length-2),a.buffer=n.buffer,1===NetManager.webSocket.readyState?NetManager.webSocket.send(a.buffer):console.log("webSocket has not opend!")},t.quitRoom=function(t,e){NetManager.stampManager(),NetManager.netMap[NetManager.stamp.toString()]=e;var a=new MyByteArray;a.endian=egret.Endian.LITTLE_ENDIAN,a._writeShort(0),a._writeShort(104),a._writeShort(NetManager.stamp),a._writeInt(t),a.finalWriter();var n=new DataView(a.buffer);n.setInt8(0,a.length-2),a.buffer=n.buffer,1===NetManager.webSocket.readyState?NetManager.webSocket.send(a.buffer):console.log("webSocket has not opend!")},t.gameEvent=function(t,e){NetManager.stampManager(),NetManager.netMap[NetManager.stamp.toString()]=e;var a=new MyByteArray;a.endian=egret.Endian.LITTLE_ENDIAN,a._writeShort(0),a._writeShort(106),a._writeShort(NetManager.stamp),a._writeUnicode(t),a.finalWriter();var n=new DataView(a.buffer);n.setInt8(0,a.length-2),a.buffer=n.buffer,1===NetManager.webSocket.readyState?NetManager.webSocket.send(a.buffer):console.log("webSocket has not opend!")},t.gameResult=function(t,e){NetManager.stampManager(),NetManager.netMap[NetManager.stamp.toString()]=e;var a=new MyByteArray;a.endian=egret.Endian.LITTLE_ENDIAN,a._writeShort(0),a._writeShort(108),a._writeShort(NetManager.stamp),a._writeBoolean(t),a.finalWriter();var n=new DataView(a.buffer);n.setInt8(0,a.length-2),a.buffer=n.buffer,1===NetManager.webSocket.readyState?NetManager.webSocket.send(a.buffer):console.log("webSocket has not opend!")},t}();__reflect(MyRequest.prototype,"MyRequest");var MyResponse=function(){function t(){}return t.readIndexAndStamp=function(t){var e=new MyByteArray;e.endian=egret.Endian.LITTLE_ENDIAN,e.buffer=t.data;var a=e._readShort(),n=e._readShort(),i=e._readShort(),r={length:a,index:n,stamp:i};return r},t.enterRoom=function(t){var e=new MyByteArray;e.endian=egret.Endian.LITTLE_ENDIAN,e.buffer=t.data;var a=e._readShort(),n=e._readShort(),i=e._readShort(),r=e._readInt(),o=e._readInt(),s=e._readInt(),h=e._readInt(),c={length:a,index:n,stamp:i,userID:r,avatarType:o,roomID:s,gameType:h};NetManager.callbackJudge(i,c)},t.startGame=function(t){var e=new MyByteArray;e.endian=egret.Endian.LITTLE_ENDIAN,e.buffer=t.data;var a=e._readShort(),n=e._readShort(),i=e._readShort(),r=e._readInt(),o={length:a,index:n,stamp:i,roomID:r};NetManager.callbackJudge(i,o)},t.gameEvent=function(t){var e=new MyByteArray;e.endian=egret.Endian.LITTLE_ENDIAN,e.buffer=t.data;var a=e._readShort(),n=e._readShort(),i=e._readShort(),r=e._readUnicode(),o={length:a,index:n,stamp:i,event:r};NetManager.callbackJudge(i,o)},t.gameResult=function(t){var e=new MyByteArray;e.endian=egret.Endian.LITTLE_ENDIAN,e.buffer=t.data;var a=e._readShort(),n=e._readShort(),i=e._readShort(),r=e._readBoolean(),o=e._readInt(),s=e._readInt(),h=e._readInt(),c={length:a,index:n,stamp:i,win:r,gold:o,exp:s,item:h};NetManager.callbackJudge(i,c)},t}();__reflect(MyResponse.prototype,"MyResponse");var NetManager=function(){function t(){}return t.stamp=0,t["byte"]=new MyByteArray,t.netMap={},t.stampManager=function(){t.stamp>32765?t.stamp=0:t.stamp+=1},t.openWebSocket=function(){t.webSocket=new WebSocket("ws://123.59.110.113:8423"),t.webSocket.binaryType="arraybuffer"},t.switchTable={101:MyResponse.enterRoom,103:MyResponse.startGame,107:MyResponse.gameEvent,109:MyResponse.gameResult},t.autoRespond=function(e,a,n){t.netMap.globalcallback=a,t.netMap.globalErrorcallback=n;var i=MyResponse.readIndexAndStamp(e),r=i.index,o=(i.stamp,t.switchTable[r.toString()]);o?o(e):(console.log("tempFunc is undfined!"),n&&n(e))},t.callbackJudge=function(e,a){var n=t.netMap[e.toString()],i=t.netMap.globalcallback;n?(n(a),t.netMap[t.stamp.toString()]=null):i&&i(a)},t}();__reflect(NetManager.prototype,"NetManager");var HitEffect=function(t){function e(a){var n=t.call(this)||this;n.level=a;var i;switch(a){case e.BEST:i="mb6_png";break;case e.GOOD:i="mb7_png";break;case e.MISS:i="mb8_png"}return n._bmp=AssetManager.getBitmap(i),n.addChild(n._bmp),n}return __extends(e,t),e.prototype.start=function(){var t=egret.Tween.get(this._bmp),e=egret.Tween.get(this._bmp),a=egret.Tween.get(this._bmp),n=egret.Tween.get(this._bmp),i=egret.Tween.get(this._bmp),r=(300+300*Math.random())*(Math.random()>.5?1:-1),o=-300+-300*Math.random(),s=180-360*Math.random();this._bmp.scaleX=.2,this._bmp.scaleY=.2;var h=1e3;i.to({scaleX:1,scaleY:1},100),t.to({x:r},h,egret.Ease.sineIn),e.to({y:o},h),a.to({rotation:s},h),n.wait(h-100),n.to({alpha:0},100),n.call(this.end,this)},e.prototype.end=function(){this.isEnd=!0},e.BEST=0,e.GOOD=1,e.MISS=2,e}(egret.DisplayObjectContainer);__reflect(HitEffect.prototype,"HitEffect");var StateEvent=function(t){function e(e,a,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var r=t.call(this,e,n,i)||this;return r.data=a,r}return __extends(e,t),e.NEXT="NEXT",e.LAST="LAST",e}(egret.Event);__reflect(StateEvent.prototype,"StateEvent");var StateManager=function(){function t(t){this._parent=t,this._stateObj={}}return t.prototype.startTick=function(){this._curTime=egret.getTimer(),egret.startTick(this.tick,this)},t.prototype.stopTick=function(){egret.stopTick(this.tick,this)},t.prototype.tick=function(t){return this._lastTime=this._curTime,this._curTime=t,this._curState&&this._curState.tick(this._curTime-this._lastTime),!0},t.prototype.registerState=function(t,e){this._stateObj[t]=e},t.prototype.setCurStateName=function(t){var e=this._stateObj[t];e&&this.setCurState(e)},t.prototype.setCurState=function(t){this._curState&&(this._curState.removeEventListener(StateEvent.NEXT,this.onNext,this),this._curState.removeEventListener(StateEvent.LAST,this.onLast,this),this._prevState=this._curState),this._curState=t,this._curState.show(this._parent),this._curState.addEventListener(StateEvent.NEXT,this.onNext,this),this._curState.addEventListener(StateEvent.LAST,this.onLast,this)
},t.prototype.onNext=function(t){var e=this._stateObj[t.data];e&&this.setCurState(e)},t.prototype.onLast=function(t){this._prevState&&this.setCurState(this._prevState)},t}();__reflect(StateManager.prototype,"StateManager");var Button=function(t){function e(){var e=t.call(this)||this;return e.border=AssetManager.getBitmap("rankButton_png"),e.addChild(e.border),e.selectMask=AssetManager.getBitmap("rankButtonSelect_png"),e.selectMask.width=e.border.width,e.selectMask.height=e.border.height,e._isSelect=!1,e.selectMask.alpha=0,e.addChild(e.selectMask),e.context=new egret.TextField,e.context.textColor=0,e.context.size=40,e.addChild(e.context),e}return __extends(e,t),Object.defineProperty(e.prototype,"width",{get:function(){return this.border.width},set:function(t){this.border.width=t,this.border.anchorOffsetX=this.border.width/2,this.setContextPosition()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.border.height},set:function(t){this.border.height=t,this.border.anchorOffsetY=this.border.height/2,this.setContextPosition()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.context.size},set:function(t){this.context.size=t,this.setContextPosition()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this.context.text},set:function(t){this.context.text=t,this.setContextPosition()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelect",{get:function(){return this._isSelect},set:function(t){this._isSelect=t,this._isSelect?this.selectMask.alpha=1:this.selectMask.alpha=0},enumerable:!0,configurable:!0}),e.prototype.setContextPosition=function(){this.context.x=this.border.x-this.context.measuredWidth/2,this.context.y=this.border.y-this.context.measuredHeight/2},e}(egret.DisplayObjectContainer);__reflect(Button.prototype,"Button");var DBAnimButton=function(t){function e(e){var a=t.call(this)||this;return a._armature=e,a._armature.gotoAndStop("normal"),a._armature.armatureDisplay.addEvent(dragonBones.AnimationEvent.LOOP_COMPLETE,a.onAnimComplete,a),a.addChild(a._armature),a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,a.onTouch,a),a}return __extends(e,t),e.prototype.onTouch=function(t){this.touch()},e.prototype.onAnimComplete=function(t){this._armature.gotoAndStop("normal")},e.prototype.touch=function(){this._armature.play("touch")},e}(egret.DisplayObjectContainer);__reflect(DBAnimButton.prototype,"DBAnimButton");var DBButton=function(t){function e(e){var a=t.call(this)||this;return a.touchEnabled=!0,a._armature=e,a._armature.gotoAndStop("normal"),a.addChild(a._armature),a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,a.onTouchBegin,a),a}return __extends(e,t),e.prototype.onTouchBegin=function(t){this._armature.gotoAndStop("touch"),this.stage&&this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.onTouchEnd=function(t){this.stage&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._armature.gotoAndStop("normal")},e}(egret.DisplayObjectContainer);__reflect(DBButton.prototype,"DBButton");var DBProgress=function(t){function e(e){var a=t.call(this)||this;return a._armature=e,a._armature.gotoAndStop("progress"),a.addChild(a._armature),a}return __extends(e,t),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress=t,this._progress>1&&(this._progress=1),this._progress<0&&(this._progress=0),this._armature.armature.animation.gotoAndStopByProgress("progress",this._progress)},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(DBProgress.prototype,"DBProgress");var DrawWeightPhotograph=function(t){function e(e,a,n,i){void 0===n&&(n=!1);var r=t.call(this)||this;if(r.vectors=[],r.concaveVectors=[],r._isConCave=!1,r._isConCave=n,n)for(var o=i?i:4,s=360/(2*e),h=s,c=0;2*e>c;c++){if(r.isConcaveVector(c)){var g=Math.cos(Math.PI/180*h)*a,l=Math.sin(Math.PI/180*h)*a,d={x:g,y:l};r.vectors.push(d)}else{var g=Math.cos(Math.PI/180*h)*a/o,l=Math.sin(Math.PI/180*h)*a/o,d={x:g,y:l};r.concaveVectors.push(d)}h+=s}else for(var s=360/e,h=s,c=0;e>c;c++){var g=Math.cos(Math.PI/180*h)*a,l=Math.sin(Math.PI/180*h)*a;h+=s;var d={x:g,y:l};r.vectors.push(d)}return r}return __extends(e,t),e.prototype.draw=function(t){this.removeChildren();var e=[];if(this._isConCave)for(var a=0;a<this.vectors.length+this.concaveVectors.length;a++)if(this.isConcaveVector(a)){var n=t[Math.floor(a/2)];n>1&&(n=1),0>n&&(n=0);var i=this.vectors[Math.floor(a/2)].x*n,r=this.vectors[Math.floor(a/2)].y*n;e.push({x:i,y:r})}else e.push({x:this.concaveVectors[Math.floor(a/2)].x,y:this.concaveVectors[Math.floor(a/2)].y});else for(var a=0;a<this.vectors.length;a++){var n=t[a];n>1&&(n=1),0>n&&(n=0);var i=this.vectors[a].x*n,r=this.vectors[a].y*n;e.push({x:i,y:r})}var o=new egret.Shape,s=o.graphics;s.beginFill(16776960),s.lineStyle(2,16777215);for(var h=0,c=e;h<c.length;h++){var g=c[h];s.lineTo(g.x,g.y)}s.lineTo(e[0].x,e[0].y),s.endFill(),this.addChild(o)},e.prototype.isConcaveVector=function(t){return t%2},e}(egret.DisplayObjectContainer);__reflect(DrawWeightPhotograph.prototype,"DrawWeightPhotograph");var Exe=function(t){function e(a){var n=t.call(this)||this;return n.left=AssetManager.getBitmap(e.borderUrl),n.right=AssetManager.getBitmap(e.borderUrl),n.middle=AssetManager.getBitmap(e.centerUrl),n.left.height=n.right.height=n.middle.height,n.middle.width=n.length=a,n.right.anchorOffsetX=n.right.width,n.right.rotation=180,n.left.anchorOffsetX=n.left.width,n.middle.anchorOffsetX=0,n.middle.x=0,n.left.x=0,n.right.x=n.middle.width,n.addChild(n.left),n.addChild(n.right),n.addChild(n.middle),n}return __extends(e,t),e.prototype.updataLengthByDecimal=function(t){this.middle.width=this.length*t,this.right.x=this.middle.width},e.prototype.updataLength=function(t){this.middle.width=this.length=t,this.right.x=this.middle.width},e.centerUrl="exeCenter_png",e.borderUrl="exeBorder_png",e}(egret.DisplayObjectContainer);__reflect(Exe.prototype,"Exe");var FloatPanel=function(t){function e(){var e=t.call(this)||this,a=AssetManager.getBitmap("black_png",!1,!1);a.width=1080,a.height=1920,a.alpha=1,e.addChild(a),e.descView=new egret.TextField,e.addChild(e.descView);var n=AssetManager.getBitmap("borderButton_png",!1,!1);n.x=300,n.y=820,e.addChild(n);var i=new egret.TextField;i.text="确定",i.size=40,i.x=320,i.y=830,e.addChild(i),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.confirm&&e.confirm(),e.returnToLast()},e);var r=AssetManager.getBitmap("borderButton_png",!1,!1);r.x=700,r.y=820,e.addChild(r);var o=new egret.TextField;return o.text="取消",o.size=40,o.x=720,o.y=830,e.addChild(o),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.returnToLast()},e),e}return __extends(e,t),e.prototype.updataView=function(t,e){this.descView.text=t,this.descView.size=50,this.descView.x=(1080-this.descView.measuredWidth)/2,this.descView.y=500,this.confirm=e},e.prototype.onload=function(){},e.prototype.onremove=function(){this.removeChildren()},e}(StateBG);__reflect(FloatPanel.prototype,"FloatPanel");var ImageItem=function(t){function e(e,a,n,i){var r=t.call(this)||this;r.id=e;var o=AssetManager.getBitmap(n),s=AssetManager.getBitmap("borderCircle_png"),h=s.width/o.width<s.height/o.height?s.width/o.width:s.height/o.height;o.scaleX*=h,o.scaleY*=h,o.x=s.x=0,o.y=s.y=0,r.addChild(o),r.addChild(s);var c=new egret.TextField;if(c.textColor=0,c.size=50,c.text=a,c.x=s.x-c.measuredWidth/2,c.y=s.y-c.measuredHeight/2+100,r.addChild(c),!i){var g=AssetManager.getBitmap("borderCircleMask_png");g.name="mask",g.alpha=.5,r.addChild(g);var l=new egret.TextField;l.size=50,l.text="未解锁",l.x=s.x-l.measuredWidth/2,l.y=s.y-l.measuredHeight/2,r.addChild(l)}return o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i?(Game.floatPanel.updataView("是否装备"+e+"号主题",function(){console.log("装备当前主题",e)}),r.parent.next("float")):(Game.floatPanel.updataView("是否解锁"+e+"号主题",function(){console.log("解锁",e)}),r.parent.next("float"))},r),r}return __extends(e,t),e.prototype.update=function(t){t&&this.getChildByName("mask")&&this.removeChild(this.getChildByName("mask"))},e}(egret.DisplayObjectContainer);__reflect(ImageItem.prototype,"ImageItem");var ProgressItem=function(t){function e(){var e=t.call(this)||this;e.amount=1234,e.border=AssetManager.getBitmap("border_png",!1,!1),e.border.width=1e3,e.border.height=400,e.addChild(e.border),e.groupName1=new egret.TextField,e.groupName1.text="群名称",e.groupName1.textColor=0,e.groupName1.size=40,e.groupName1.x=80,e.groupName1.y=40,e.addChild(e.groupName1),e.name1=new egret.TextField,e.name1.text="XX",e.name1.textColor=0,e.name1.size=40,e.name1.x=80,e.name1.y=80,e.addChild(e.name1),e.rank1=new egret.TextField,e.rank1.text="排名",e.rank1.textColor=0,e.rank1.size=40,e.rank1.x=80,e.rank1.y=120,e.addChild(e.rank1),e.groupName2=new egret.TextField,e.groupName2.text="群名称",e.groupName2.textColor=0,e.groupName2.size=40,e.groupName2.x=800,e.groupName2.y=40,e.addChild(e.groupName2),e.name2=new egret.TextField,e.name2.text="XX",e.name2.textColor=0,e.name2.size=40,e.name2.x=800,e.name2.y=80,e.addChild(e.name2),e.rank2=new egret.TextField,e.rank2.text="排名",e.rank2.textColor=0,e.rank2.size=40,e.rank2.x=800,e.rank2.y=120,e.addChild(e.rank2);var a=new egret.TextField;a.text="VS",a.size=60,a.textColor=0,a.x=480-a.measuredWidth/2,a.y=80-a.measuredHeight/2,e.addChild(a);var n=AssetManager.getBitmap("borderCircle_png");return n.scaleX=1.5,n.scaleY=1.5,n.x=480,n.y=220,e.addChild(n),e.gameName=new egret.TextField,e.gameName.text="游戏名",e.gameName.textColor=0,e.gameName.size=50,e.gameName.x=480-e.gameName.measuredWidth/2,e.gameName.y=220-e.gameName.measuredHeight/2,e.addChild(e.gameName),e.button=new Button,e.button.x=660+e.button.width/2,e.button.y=250+e.button.height/2,e.button.width=200,e.button.height=120,e.addChild(e.button),e.state=WatchState.Progress,e.videoLayer=new egret.DisplayObjectContainer,e.score1=new egret.TextField,e.score1.x=a.x-100,e.score1.y=a.y,e.score1.textColor=0,e.score1.size=60,e.score1.text="1",e.videoLayer.addChild(e.score1),e.score2=new egret.TextField,e.score2.x=a.x+a.measuredWidth+100,e.score2.y=a.y,e.score2.textColor=0,e.score2.size=60,e.score2.text="9",e.videoLayer.addChild(e.score2),e.audience=new egret.TextField,e.audience.text="观看者"+e.amount,e.audience.textColor=0,e.audience.size=40,e.audience.x=80,e.audience.y=300,e.videoLayer.addChild(e.audience),e.videoLayer.name="videoLayer",e}return __extends(e,t),Object.defineProperty(e.prototype,"state",{set:function(t){t===WatchState.Progress?(this.button.text="进入",this.getChildByName("videoLayer")&&this.removeChild(this.videoLayer)):(this.button.text="观看",this.addChild(this.videoLayer))},enumerable:!0,configurable:!0}),e.prototype.setprogressData=function(t){this.gameName.text=t.GameName,this.groupName1.text=t.players[0].groupName,this.name1.text=t.players[0].name,this.rank1.text=t.players[0].rank,this.groupName2.text=t.players[1].groupName,this.name2.text=t.players[1].name,this.rank2.text=t.players[1].rank},e.prototype.setVideoData=function(t){this.gameName.text=t.GameName,this.groupName1.text=t.players[0].groupName,this.name1.text=t.players[0].name,this.rank1.text=t.players[0].rank,this.score1.text=t.players[0].score.toString(),this.groupName2.text=t.players[1].groupName,this.name2.text=t.players[1].name,this.rank2.text=t.players[1].rank,this.score2.text=t.players[1].score.toString(),this.audience.text="观看者"+t.audience},e}(egret.DisplayObjectContainer);__reflect(ProgressItem.prototype,"ProgressItem");var RankPanelItem=function(t){function e(e,a,n,i){var r=t.call(this)||this;r.ranking=e;var o=AssetManager.getBitmap("rankItemBorder_png",!1,!1);switch(o.width=1e3,o.height=140,o.x=40,o.scaleX=1,o.scaleY=1,r.addChild(o),e){case 1:var s=AssetManager.getBitmap("first_png");s.x=120,s.y=60,s.scaleX=1,s.scaleY=1,r.addChild(s);break;case 2:var h=AssetManager.getBitmap("second_png");h.x=120,h.y=60,h.scaleX=1,h.scaleY=1,r.addChild(h);break;case 3:var c=AssetManager.getBitmap("third_png");c.x=120,c.y=60,c.scaleX=1,c.scaleY=1,r.addChild(c);break;default:var g=new egret.TextField;g.text=e.toString(),g.textColor=0,g.size=40,g.x=110,g.y=50,r.addChild(g)}var l=a?a:"Head_middle_png",d=AssetManager.getBitmap(l);return d.x=280,d.y=130,d.scaleX=1,d.scaleY=1,d.width=100,d.height=100,r.addChild(d),r._id=new egret.TextField,r._id.text=n?n:"wwwwwwwwwww",r._id.textColor=0,r._id.size=40,r._id.x=450-r._id.measuredWidth/2,r._id.y=60,r.addChild(r._id),r._data=new egret.TextField,r._data.text=i?i:"12345676",r._data.textColor=0,r._data.size=40,r._data.x=800-r._data.measuredWidth/2,r._data.y=60,r.addChild(r._data),r}return __extends(e,t),Object.defineProperty(e.prototype,"id",{set:function(t){this._id.text=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{set:function(t){this._data.text=t},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(RankPanelItem.prototype,"RankPanelItem");var ChooseGamePanelVO=function(){function t(){this.currentState=null,this.totalWaitTime=10,this._gameList=DataCenter.instance.gameConfigs,this.avatarList=[{id:0,name:"choose_png",type:1,price:0,desc:"",asset:"aa"}],this._currentGameIndex=0,this._myAvatar=this.avatarList[0],this.avatarIndex=0,this.multi=1}return Object.defineProperty(t.prototype,"gameList",{get:function(){return this._gameList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentGameIndex",{get:function(){return this._currentGameIndex},enumerable:!0,configurable:!0}),t.prototype.getNextGame=function(){this._currentGameIndex=getNextIndex(this._currentGameIndex,this.gameList.length)},t.prototype.getLastGame=function(){this._currentGameIndex=getLastIndex(this._currentGameIndex,this.gameList.length)},Object.defineProperty(t.prototype,"myAvatar",{get:function(){return this._myAvatar},set:function(t){var e=this.avatarList.indexOf(t);0>e||(this._myAvatar=t,this.avatarIndex=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastAvatar",{get:function(){var t=this.avatarIndex;if(!(0>t)){var e=t-1;return 0>e&&(e=this.avatarList.length-1),this.avatarList[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextAvatar",{get:function(){var t=this.avatarIndex;if(!(0>t)){var e=t+1;return e>this.avatarList.length-1&&(e=0),this.avatarList[e]}},enumerable:!0,configurable:!0}),t.prototype.matchCount=function(t,e){var a=this;0!==this.waitTime&&(this.waitTime=0),this.waitInterval=egret.setInterval(function(){a.waitTime>=a.totalWaitTime&&(a.resetMatchCount(),e()),t(),a.waitTime++},this,1e3)},t.prototype.resetMatchCount=function(){egret.clearInterval(this.waitInterval),this.waitTime=0},t}();__reflect(ChooseGamePanelVO.prototype,"ChooseGamePanelVO");var DataCenter=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.comboo=0,e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.initConfig=function(t,e){this.gameConfigs=t.games,this.itemConfigs=e.items},e.prototype.getItemConfig=function(t){var e,a;for(e=0,a=this.itemConfigs.length;a>e;e++)if(this.itemConfigs[e].id==t)return this.itemConfigs[e];return null},e.prototype.getGameConfig=function(t){var e,a;for(e=0,a=this.gameConfigs.length;a>e;e++)if(this.gameConfigs[e].id==t)return this.gameConfigs[e];return null},e.prototype.init=function(t){this.user=new User(t),this.user.addEventListener(User.EVENT_LOAD_COMPLETE,this.onLoadUserInfo,this),this.user.loadPlatformInfo()},e.prototype.onLoadUserInfo=function(t){this.dispatchEvent(new egret.Event(e.EVENT_LOGIN))},e.prototype.win=function(){},e.prototype.lose=function(){},e.EVENT_LOGIN="EVENT_LOGIN",e.ITEM_TYPE_AVATAR=1,e}(egret.EventDispatcher);__reflect(DataCenter.prototype,"DataCenter");var RankState;!function(t){t[t.Player=0]="Player",t[t.Gold=1]="Gold",t[t.Friend=2]="Friend"}(RankState||(RankState={}));var RankVO=function(){function t(t){this._rankPanel=t,this._rankState=RankState.Player,this._rankPanel.setState(RankState.Player)}return Object.defineProperty(t.prototype,"rankState",{set:function(t){this._rankState=t,this._rankPanel.setState(this._rankState);var e=[{head:"egret_icon_png",name:"wwww"+RankState[this._rankState],score:"12345"},{head:"egret_icon_png",name:"hhhh"+RankState[this._rankState],score:"9977"},{head:"egret_icon_png",name:"cccc"+RankState[this._rankState],score:"7856"},{head:"egret_icon_png",name:"ccc"+RankState[this._rankState],score:"4533"},{head:"egret_icon_png",name:"eee"+RankState[this._rankState],score:"2334"},{head:"egret_icon_png",name:"wrrrwww"+RankState[this._rankState],score:"1222"},{head:"egret_icon_png",name:"tttt"+RankState[this._rankState],score:"888"},{head:"egret_icon_png",name:"yyyy"+RankState[this._rankState],score:"777"},{head:"egret_icon_png",name:"uuuu"+RankState[this._rankState],score:"666"},{head:"egret_icon_png",name:"iiii"+RankState[this._rankState],score:"555"},{head:"egret_icon_png",name:"ooo"+RankState[this._rankState],score:"444"},{head:"egret_icon_png",name:"pppp"+RankState[this._rankState],score:"333"}];this._rankPanel.updataView(e)},enumerable:!0,configurable:!0}),t}();__reflect(RankVO.prototype,"RankVO");var RoomVO=function(){function t(t,e,a){this.id=t,this.gameId=e,this.player=a}return t}();__reflect(RoomVO.prototype,"RoomVO");var User=function(t){function e(e){var a=t.call(this)||this;return a.name="",a.sex=0,a.imgUrl="",a.exp=100,a.gold=100,a.status=0,a.roomId=-1,a.gameId=-1,a.id=e,a.items=[1],a.initAvatars(),a}return __extends(e,t),e.prototype.loadPlatformInfo=function(){var t=this;RPC.instance.getUserInfo(this.id,function(a){t.name=a.name,t.sex=a.sex,t.imgUrl=a.imgUrl,t.dispatchEvent(new egret.Event(e.EVENT_LOAD_COMPLETE))})},e.prototype.initAvatars=function(){var t,e;for(this.avatars=[],t=0,e=this.items.length;e>t;t++){var a=DataCenter.instance.getItemConfig(this.items[t]);a&&a.type==DataCenter.ITEM_TYPE_AVATAR&&this.avatars.push(a)}},e.EVENT_LOAD_COMPLETE="EVENT_LOAD_COMPLETE",e.STATUS_IDLE=0,e.STATUS_ROOM=1,e.STATUS_MATCHING=2,e.STATUS_GAME_LOADING=3,e.STATUS_GAMING=4,e.STATUS_GAME_RESULT=5,e}(egret.EventDispatcher);__reflect(User.prototype,"User");var WatchState;!function(t){t[t.Progress=0]="Progress",t[t.Video=1]="Video"}(WatchState||(WatchState={}));var WatchVO=function(){function t(t){this._watchPanel=t,this._watchState=WatchState.Progress,this._watchPanel.setState(this._watchState)}return Object.defineProperty(t.prototype,"watchPanelState",{get:function(){return this._watchState},set:function(t){this._watchState=t,this._watchPanel.setState(this._watchState),this._watchPanel.updataView(null)},enumerable:!0,configurable:!0}),t}();__reflect(WatchVO.prototype,"WatchVO");