var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},Scene=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAdded,e),e}return __extends(e,t),e.prototype.onAdded=function(t){this.init()},e.prototype.init=function(){console.log("this is a scene")},e.prototype.show=function(t){t.addChild(this)},e.prototype.next=function(t){this.dispatchEvent(new SceneEvent(SceneEvent.NEXT,t)),this.parent.removeChild(this)},e.prototype.tick=function(t){},e}(egret.DisplayObjectContainer);__reflect(Scene.prototype,"Scene",["IScene","egret.IEventDispatcher"]);var SceneManager=function(){function t(t){this._parent=t,this._sceneObj={}}return t.prototype.startTick=function(){this._curTime=egret.getTimer(),egret.startTick(this.tick,this)},t.prototype.stopTick=function(){egret.stopTick(this.tick,this)},t.prototype.tick=function(t){return this._lastTime=this._curTime,this._curTime=t,this._curScene&&this._curScene.tick(this._curTime-this._lastTime),!0},t.prototype.registerScene=function(t,e){this._sceneObj[t]=e},t.prototype.setCurSceneByName=function(t){var e=this._sceneObj[t];e&&this.setCurScene(e)},t.prototype.setCurScene=function(t){this._curScene&&(this._curScene.removeEventListener(SceneEvent.NEXT,this.onNext,this),this._prevScene=this._curScene),this._curScene=t,this._curScene.show(this._parent),this._curScene.addEventListener(SceneEvent.NEXT,this.onNext,this)},t.prototype.onNext=function(t){var e=this._sceneObj[t.data];e&&this.setCurScene(e)},t}();__reflect(SceneManager.prototype,"SceneManager");var DBManager=function(){function t(){}return t.addData=function(e,n,i){var r=RES.getRes(e),o=RES.getRes(n),a=RES.getRes(i);t._factory.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(r)),t._factory.addTextureAtlas(new dragonBones.EgretTextureAtlas(a,o))},t.buildArmature=function(e){return t._factory.buildArmature(e)},t.copyAnimation=function(e,n){t._factory.copyAnimationsToArmature(e,n.name)},t}();DBManager._factory=new dragonBones.EgretFactory,__reflect(DBManager.prototype,"DBManager");var Game=function(t){function e(){var n=t.call(this)||this;return n.gameURL="http://10.0.12.50:5334/index.html",e._instance=n,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAdded,n),n.roleManager=new RoleManager,n.random=new Random(0,RES.getRes("random_png")),n}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return e._instance},enumerable:!0,configurable:!0}),e.prototype.resetGame=function(){this.clearData(),this.initGameData();var t=this.GetQueryString("rid"),e=parseFloat(t);e>=0&&7>=e&&this.addRole(e)},e.prototype.loadGame=function(){this.load(),this.initGameData();var t=this.GetQueryString("rid"),e=parseFloat(t);e>=0&&7>=e&&this.addRole(e),this.loadPackage()},e.prototype.GetQueryString=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(e);return null!=n?decodeURI(n[2]):null},e.prototype.addRole=function(t){var e=roleDefine[t];e&&userGameData.roles.length<7&&(userGameData.roles.push({id:e}),this.save())},e.prototype.clearData=function(){egret.localStorage.clear()},e.prototype.save=function(){var t=JSON.stringify(userGameData);egret.localStorage.setItem("uuuData",t)},e.prototype.load=function(){var t=egret.localStorage.getItem("uuuData"),e=JSON.parse(t);userGameData=e},e.prototype.initGameData=function(){if(null==userGameData){userGameData={};var t=e.instance.random.Int(roleDefine.length);userGameData.mainRole=roleDefine[t],userGameData["package"]=[],userGameData.roles=[],this.save()}},e.prototype.addPackageItem=function(t){userGameData["package"].push(t),this.save()},e.prototype.loadPackage=function(){if(userGameData["package"])for(var t=0,e=userGameData["package"].length;e>t;t++)packageList.addID(userGameData["package"][t])},e.prototype.getItemObj=function(t){for(var e=RES.getRes("items_json").items,n=0,i=e.length;i>n;n++)if(e[n].id==t)return e[n];return null},e.prototype.onAdded=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this.init()},e.prototype.init=function(){console.log("this is a new game!"),this.initDB(),this.pageLayer=new egret.DisplayObjectContainer,this.addChild(this.pageLayer),packageList=new PackageList,this.addChild(packageList),packageList.bottom=0,talk=new Talk,this.addChild(talk),talk.visible=!1,letter=new Letter,this.addChild(letter),letter.visible=!1;var t=new SceneManager(this.pageLayer);t.registerScene("gameInfo",new GameInfo),t.registerScene("gameLevel",new GameLevel),t.registerScene("gameStart",new GameStart),t.registerScene("gameEnd1",new GameEnd1),t.registerScene("gameEnd2",new GameEnd2),t.setCurSceneByName("gameStart"),t.startTick()},e.prototype.initDB=function(){DBManager.addData("items_ske_json","items_tex_json","items_tex_png")},e}(eui.UILayer);__reflect(Game.prototype,"Game");var Goods=function(t){function e(e,n){var i=t.call(this)||this;return i.isHad=!1,i.id=e,i.itemID=n,i.once(egret.Event.ADDED_TO_STAGE,i.init,i),i}return __extends(e,t),e.prototype.init=function(){this.armature=DBManager.buildArmature("item"+this.id),this.icon=this.armature.display,this.icon.scaleX=2,this.icon.scaleY=2,dragonBones.WorldClock.clock.add(this.armature),this.addChild(this.icon),this.armature.animation.play("normal",0),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},e.prototype.dispose=function(){this.touchEnabled=!1,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTapHandler,this),dragonBones.WorldClock.clock.remove(this.armature),this.armature.dispose()},e.prototype.onTapHandler=function(t){t.stopPropagation(),this.armature.animation.play("found",1);var e=this;this.armature.addEventListener(dragonBones.AnimationEvent.COMPLETE,function n(t){if(t.currentTarget.animation.play("normal"),t.currentTarget.removeEventListener(dragonBones.AnimationEvent.COMPLETE,n,this),!e.isHad&&(e.isHad=!0,e.itemID>0&&-1==userGameData["package"].indexOf(e.itemID))){var i=Game.instance.getItemObj(e.itemID);i&&talk.setTalk("获得  "+i.name,function(){Game.instance.addPackageItem(e.itemID),packageList.addID(e.itemID)})}},this)},e}(egret.DisplayObjectContainer);__reflect(Goods.prototype,"Goods");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.createGame()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.createGame=function(){var t=new Game;this.addChild(t)},e.prototype.startCreateScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,n=this.stage.stageHeight;t.width=e,t.height=n;var i=new egret.Shape;i.graphics.beginFill(0,.5),i.graphics.drawRect(0,0,e,172),i.graphics.endFill(),i.y=33,this.addChild(i);var r=this.createBitmapByName("egret_icon_png");this.addChild(r),r.x=26,r.y=33;var o=new egret.Shape;o.graphics.lineStyle(2,16777215),o.graphics.moveTo(0,0),o.graphics.lineTo(0,117),o.graphics.endFill(),o.x=172,o.y=61,this.addChild(o);var a=new egret.TextField;a.textColor=16777215,a.width=e-172,a.textAlign="center",a.text="Hello Egret",a.size=24,a.x=172,a.y=80,this.addChild(a);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=e-172,s.textAlign=egret.HorizontalAlign.CENTER,s.size=24,s.textColor=16777215,s.x=172,s.y=135,this.textfield=s,RES.getResAsync("description_json",this.startAnimation,this);var h=new eui.Button;h.label="Click!",h.horizontalCenter=0,h.verticalCenter=0,this.addChild(h),h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.startAnimation=function(t){var e=this,n=new egret.HtmlTextParser,i=t.map(function(t){return n.parse(t)}),r=this.textfield,o=-1,a=function(){o++,o>=i.length&&(o=0);var t=i[o];r.textFlow=t;var n=egret.Tween.get(r);n.to({alpha:1},200),n.wait(2e3),n.to({alpha:0},200),n.call(a,e)};a()},e.prototype.onButtonClick=function(t){var e=new eui.Panel;e.title="Title",e.horizontalCenter=0,e.verticalCenter=0,this.addChild(e)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Quest=function(t){function e(e){var n=t.call(this)||this;return n._questImage=AssetManager.createBitmapByName("quest_"+e+"_png"),n._questImage.scaleX=n._questImage.scaleY=.5,n.addChild(n._questImage),n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAdded,n),n}return __extends(e,t),e.prototype.onAdded=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdded,this),this._w=this.stage.stageWidth,this.show()},e.prototype.show=function(){this.effect1()},e.prototype.effect1=function(){var t=this;egret.Tween.get(this._questImage).to({x:this._w/2},500).wait(500).to({x:this._w},100).call(function(){t.parent.removeChild(t)})},e}(egret.Sprite);Quest.QUEST_NOSE="nose",Quest.QUEST_HAIR="hair",Quest.QUEST_LEFT_EYE="lefrEye",Quest.QUEST_RIGHT_EYE="rightEye",Quest.QUEST_LEFT_EAR="leftEar",Quest.QUEST_RIGHT_EAR="rightEar",Quest.QUEST_MOUTH="mouth",__reflect(Quest.prototype,"Quest");var Role=function(t){function e(e,n){void 0===e&&(e="man1"),void 0===n&&(n=1);var i=t.call(this)||this;i.name=e,i._scale=n,console.log("name armature",e);var r=RES.getRes(e+"_ske_json"),o=RES.getRes(e+"_tex_json"),a=RES.getRes(e+"_tex_png"),s=new dragonBones.EgretFactory;s.addSkeletonData(dragonBones.DataParser.parseDragonBonesData(r)),s.addTextureAtlas(new dragonBones.EgretTextureAtlas(a,o)),i.armature=s.buildArmature(e);var h=i.armature.display;return h.scaleX=2*i._scale,h.scaleY=2*i._scale,dragonBones.WorldClock.clock.add(i.armature),i.addChild(h),i}return __extends(e,t),Object.defineProperty(e.prototype,"roleX",{get:function(){return this._roleX},set:function(t){this._roleX=t,this.x=this._roleX*GameLevel.STEP},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roleY",{get:function(){return this._roleY},set:function(t){this._roleY=t,this.y=this._roleY*GameLevel.STEP},enumerable:!0,configurable:!0}),e.prototype.addStep=function(t,n){return this.roleX==t&&this.roleY==n?0:(this.roleX>t?(this.roleX--,this.walk(e.LEFT)):this.roleX<t?(this.roleX++,this.walk(e.RIGHT)):this.roleY>n?(this.roleY--,this.walk(e.BACK)):this.roleY<n&&(this.roleY++,this.walk(e.FRONT)),this.roleX==t&&this.roleY==n?2:1)},Object.defineProperty(e.prototype,"direct",{get:function(){return this._direct},set:function(t){this._direct=t},enumerable:!0,configurable:!0}),e.prototype.stand=function(t){(t!=this._direct||"stand"!=this.dbType)&&(this._direct=t,this.dbType="stand",this.play("stand_"+t))},e.prototype.walk=function(t){(t!=this._direct||"walk"!=this.dbType)&&(this._direct=t,this.dbType="walk",this.play("walk_"+t))},e.prototype.play=function(t){this.armature.animation.play(t,0)},e.prototype.gotoAndStop=function(t,e){this.armature.animation.gotoAndStop(t,e)},Object.defineProperty(e.prototype,"totleTime",{get:function(){return this.armature.animation.lastAnimationState.totalTime},enumerable:!0,configurable:!0}),e.prototype.remove=function(){dragonBones.WorldClock.clock.remove(this.armature)},e}(egret.Sprite);Role.LEFT="left",Role.RIGHT="right",Role.FRONT="front",Role.BACK="back",__reflect(Role.prototype,"Role");var RoleManager=function(){function t(){this._roleDict={},this._roleSex={},this._roleSex.man1=1,this._roleSex.man2=1,this._roleSex.man3=1,this._roleSex.woman1=0,this._roleSex.woman2=0,this._roleSex.woman3=0}return t.prototype.getRole=function(t){return console.log(t),this._roleDict[t]=new Role(t,1)},t.prototype.getRoleSex=function(t){return this._roleSex[t]},t}();RoleManager.ROLES=["man1","man2","man3","woman1","woman2","woman3"],__reflect(RoleManager.prototype,"RoleManager");var Talk=function(t){function e(){var e=t.call(this)||this;return e.skinName="TalkSkin",e.percentWidth=100,e.percentHeight=100,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this)},e.prototype.onClickHandler=function(t){this.visible=!1,this.call&&this.call()},e.prototype.setTalk=function(t,e){this.text.text=t,this.call=e,this.bg.scaleX=this.bg.scaleY=1,this.bg.width=this.text.width+20,this.bg.height=this.text.height+20,this.bg.y=this.height/2-this.bg.height/2,this.bg.x=this.width/2-this.bg.width/2,this.text.y=this.bg.y+10,this.text.x=this.bg.x+10,this.visible=!0},e}(eui.Component);__reflect(Talk.prototype,"Talk");var talk,ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function r(t){e.call(i,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var RoleEvent=function(t){function e(e,n,i,r){return void 0===n&&(n=null),void 0===i&&(i=!0),void 0===r&&(r=!1),t.call(this,e,i,r,n)||this}return __extends(e,t),e}(egret.Event);RoleEvent.TOUCH_HOT="TOUCH_HOT",__reflect(RoleEvent.prototype,"RoleEvent");var BaseControl=function(){function t(){this._bus=SignBus.instance,this._commandNotification=new Notification(Notification.COMMAND),this._commandData={}}return t.prototype.on=function(t,e,n){void 0===n&&(n=0),this._bus.addEventListener(t,e,this,!1,n)},t.prototype.off=function(t,e){this._bus.removeEventListener(t,e,this)},t.prototype.send=function(t,e){void 0===e&&(e=null),this._bus.dispatchEvent(new Notification(t,e))},t.prototype.sendCommand=function(t,e){void 0===e&&(e=null),this._commandData.command=t,this._commandData.data=e,this._commandNotification.data=this._commandData,this._bus.dispatchEvent(this._commandNotification)},t.prototype.start=function(){this._running||(this.initListener(),this._running=!0)},t.prototype.stop=function(){this._running=!1,this.removeListener()},t.prototype.initListener=function(){},t.prototype.removeListener=function(){},t}();__reflect(BaseControl.prototype,"BaseControl");var Notification=function(t){function e(e,n){return void 0===n&&(n=null),t.call(this,e,!1,!1,n)||this}return __extends(e,t),e}(egret.Event);Notification.COMMAND="NOTIFICATION:COMMAND",__reflect(Notification.prototype,"Notification");var SignBus=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return null==e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}(egret.Sprite);__reflect(SignBus.prototype,"SignBus");var FSM=function(){function t(){this._states=[]}return t.prototype.init=function(t){this.switchTo(t)},t.prototype.addState=function(t){var e=this.getState(t);return null==e&&(e=new State(t),this._states.push(e)),e},t.prototype.removeState=function(t){var e,n;for(e=this._states.length-1;e>=0;--e)if(this._states[e].name==t)return n=this._states.splice(e,1),n[0];return null},t.prototype.getState=function(t){var e;for(e=this._states.length-1;e>=0;--e)if(this._states[e].name==t)return this._states[e]},Object.defineProperty(t.prototype,"currentState",{get:function(){return null==this._curState?null:this._curState.name},enumerable:!0,configurable:!0}),t.prototype.switchTo=function(t){if(null!=this._curState){if(this._curState.name==t)return;this._curState.end()}this._curState=this.getState(t),this._curState&&this._curState.start()},t.prototype.pushFront=function(t,e){var n=this.getState(t);n&&n.pushFront(e)},t.prototype.pushBack=function(t,e){var n=this.getState(t);n&&n.pushBack(e)},t}();__reflect(FSM.prototype,"FSM");var State=function(){function t(t){this._name=t,this._beginFun=[],this._endFun=[]}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t.prototype.pushFront=function(t){t&&-1==this._beginFun.indexOf(t)&&this._beginFun.push(t)},t.prototype.pushBack=function(t){t&&-1==this._endFun.indexOf(t)&&this._endFun.push(t)},t.prototype.start=function(){var t,e=this._beginFun.length;for(t=0;e>t;++t)this._beginFun[t].call(this)},t.prototype.end=function(){var t,e=this._endFun.length;for(t=0;e>t;++t)this._endFun[t].call(this)},t}();__reflect(State.prototype,"State");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?i(r):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var SceneEvent=function(t){function e(e,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var o=t.call(this,e,i,r)||this;return o.data=n,o}return __extends(e,t),e}(egret.Event);SceneEvent.NEXT="NEXT",__reflect(SceneEvent.prototype,"SceneEvent");var AssetManager=function(){function t(){}return t.createBitmapByName=function(t,e){void 0===e&&(e=!0);var n=new egret.Bitmap,i=RES.getRes(t);return n.texture=i,e&&(n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2),n.scaleX=n.scaleY=2,n},t}();AssetManager.BGS=[""],__reflect(AssetManager.prototype,"AssetManager");var Random=function(){function t(t,e){void 0===t&&(t=0),this.mPointer=0,this.mSeed=0,this.mSeed=t,this.mTexture=e}return Object.defineProperty(t.prototype,"seed",{get:function(){return this.mSeed},set:function(t){t!=this.mSeed&&(this.mIsSeedValid=!1,this.mPointer=0),this.mSeed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointer",{get:function(){return this.mPointer},set:function(t){this.mPointer=t},enumerable:!0,configurable:!0}),t.prototype.Float=function(t,e){return void 0===e&&(e=0/0),isNaN(e)&&(e=t,t=0),this.Next()*(e-t)+t},t.prototype.Int=function(t,e){return void 0===e&&(e=0/0),isNaN(e)&&(e=t,t=0),Math.floor(this.Float(t,e))},t.prototype.Sign=function(t){return void 0===t&&(t=.5),this.Next()<t?1:-1},t.prototype.Reset=function(){this.mPointer=0},t.prototype.Bool=function(t){return void 0===t&&(t=.5),this.Next()<t},t.prototype.Bit=function(t,e){return void 0===t&&(t=.5),void 0===e&&(e=0),this.Next()<t?1<<e:0},t.prototype.Next=function(){0==this.mIsSeedValid&&(this.mIsSeedValid=!0),this.mPointer=(this.mPointer+this.mSeed+1)%2e5;var t=this.mPointer%1e3,e=this.mPointer/1e3>>0,n=this.mTexture.getPixels(t,e,1,1),i=1*n[0]+256*n[1]+65536*n[2]+16777216*n[3];return i/4294967295},t}();__reflect(Random.prototype,"Random");var Letter=function(t){function e(){var e=t.call(this)||this;return e.d={},e.percentWidth=100,e.percentHeight=100,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this)},e.prototype.onClickHandler=function(t){this.visible=!1},e.prototype.setLetter=function(t){var e=RES.getRes("items_json").items[t-1];this.d.text=e.content;var n=t-1;this.qrCode&&this.qrCode.parent&&this.qrCode.parent.removeChild(this.qrCode);var i=Game.instance.gameURL+"?rid="+n;this.qrCode=qr.QRCode.create(i),console.log(i),this.qrCode.x=this.width/2,this.qrCode.y=this.height/2,this.addChild(this.qrCode),this.visible=!0},e}(eui.Component);__reflect(Letter.prototype,"Letter",["eui.UIComponent","egret.DisplayObject"]);var letter,PackageIcon=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShowHandler,this)},e.prototype.onShowHandler=function(t){var e=Game.instance.getItemObj(this.data.id);"letter"==e.type?letter.setLetter(e.id):"code"==e.type?talk.setTalk(this.getCode(e.content)):"codeSegment"==e.type?talk.setTalk(e.content+" = "+e.key):talk.setTalk(e.content)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.d={};var e=Game.instance.getItemObj(this.data.id);this.d.icon=e.icon},e.prototype.getCode=function(t){for(var e="(",n=!1,i=9;15>=i;i++){var r=Game.instance.getItemObj(i);-1==userGameData["package"].indexOf(i)?e+=r.content:(e+=r.key,n=!0)}return e+=")",n?t+"\n\n"+e:t},e}(eui.ItemRenderer);__reflect(PackageIcon.prototype,"PackageIcon",["eui.UIComponent","egret.DisplayObject"]);var PackageList=function(t){function e(){var e=t.call(this)||this;return e.isShow=!1,e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.ac.removeAll(),this.group.y=this.height-355+270,this.packageBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this)},e.prototype.onClickHandler=function(t){this.isShow?egret.Tween.get(this.group).to({y:this.height-355+270},300):egret.Tween.get(this.group).to({y:this.height-355},300),this.isShow=!this.isShow},e.prototype.addID=function(t){this.ac.addItem({id:t})},e}(eui.Component);__reflect(PackageList.prototype,"PackageList",["eui.UIComponent","egret.DisplayObject"]);var packageList,qr;!function(t){var e=function(){function e(e){this.mode=t.QRMode.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var n=0,i=this.data.length;i>n;n++){var r=[],o=this.data.charCodeAt(n);o>65536?(r[0]=240|(1835008&o)>>>18,r[1]=128|(258048&o)>>>12,r[2]=128|(4032&o)>>>6,r[3]=128|63&o):o>2048?(r[0]=224|(61440&o)>>>12,r[1]=128|(4032&o)>>>6,r[2]=128|63&o):o>128?(r[0]=192|(1984&o)>>>6,r[1]=128|63&o):r[0]=o,this.parsedData.push(r)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}return e.prototype.getLength=function(t){return this.parsedData.length},e.prototype.write=function(t){for(var e=0,n=this.parsedData.length;n>e;e++)t.put(this.parsedData[e],8)},e}();t.QR8bitByte=e,__reflect(e.prototype,"qr.QR8bitByte")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){this.buffer=[],this.length=0}return t.prototype.get=function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},t.prototype.put=function(t,e){for(var n=0;e>n;n++)this.putBit(1==(t>>>e-n-1&1))},t.prototype.getLengthInBits=function(){return this.length},t.prototype.putBit=function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++},t}();t.QRBitBuffer=e,__reflect(e.prototype,"qr.QRBitBuffer")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(){}return e.create=function(n,i,r,o,a){void 0===i&&(i=0),void 0===r&&(r=200),void 0===o&&(o=200),void 0===a&&(a=2);var s={width:r,height:o,correctLevel:t.QRErrorCorrectLevel.H,color:i},h=new t.QRCodeModel(t.QRUtil._getTypeNumber(n,s.correctLevel),s.correctLevel);return h.addData(n),h.make(),e.draw(h,s)},e.draw=function(t,e){for(var n=new egret.Sprite,e=e,i=t.getModuleCount(),r=Math.floor(e.width/i),o=Math.floor(e.height/i),a=0;i>a;a++)for(var s=0;i>s;s++){var h=t.isDark(a,s);h&&(n.graphics.beginFill(e.color),n.graphics.drawRect(s*r,a*o,r,o),n.graphics.endFill())}return n},e}();t.QRCode=e,__reflect(e.prototype,"qr.QRCode")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[],this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}return e.prototype.addData=function(e){var n=new t.QR8bitByte(e);this.dataList.push(n),this.dataCache=null},e.prototype.isDark=function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},e.prototype.getModuleCount=function(){return this.moduleCount},e.prototype.make=function(){this.makeImpl(!1,this.getBestMaskPattern())},e.prototype.makeImpl=function(t,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++){this.modules[i]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[i][r]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,n),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},e.prototype.setupPositionProbePattern=function(t,e){for(var n=-1;7>=n;n++)if(!(-1>=t+n||this.moduleCount<=t+n))for(var i=-1;7>=i;i++)-1>=e+i||this.moduleCount<=e+i||(n>=0&&6>=n&&(0==i||6==i)||i>=0&&6>=i&&(0==n||6==n)||n>=2&&4>=n&&i>=2&&4>=i?this.modules[t+n][e+i]=!0:this.modules[t+n][e+i]=!1)},e.prototype.getBestMaskPattern=function(){for(var e=0,n=0,i=0;8>i;i++){this.makeImpl(!0,i);var r=t.QRUtil.getLostPoint(this);(0==i||e>r)&&(e=r,n=i)}return n},e.prototype.createMovieClip=function(t,e,n){var i=t.createEmptyMovieClip(e,n),r=1;this.make();for(var o=0;o<this.modules.length;o++)for(var a=o*r,s=0;s<this.modules[o].length;s++){var h=s*r,c=this.modules[o][s];c&&(i.beginFill(0,100),i.moveTo(h,a),i.lineTo(h+r,a),i.lineTo(h+r,a+r),i.lineTo(h,a+r),i.endFill())}return i},e.prototype.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},e.prototype.setupPositionAdjustPattern=function(){for(var e=t.QRUtil.getPatternPosition(this.typeNumber),n=0;n<e.length;n++)for(var i=0;i<e.length;i++){var r=e[n],o=e[i];if(null==this.modules[r][o])for(var a=-2;2>=a;a++)for(var s=-2;2>=s;s++)-2==a||2==a||-2==s||2==s||0==a&&0==s?this.modules[r+a][o+s]=!0:this.modules[r+a][o+s]=!1}},e.prototype.setupTypeNumber=function(e){for(var n=t.QRUtil.getBCHTypeNumber(this.typeNumber),i=0;18>i;i++){var r=!e&&1==(n>>i&1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=r}for(var i=0;18>i;i++){var r=!e&&1==(n>>i&1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=r}},e.prototype.setupTypeInfo=function(e,n){for(var i=this.errorCorrectLevel<<3|n,r=t.QRUtil.getBCHTypeInfo(i),o=0;15>o;o++){var a=!e&&1==(r>>o&1);6>o?this.modules[o][8]=a:8>o?this.modules[o+1][8]=a:this.modules[this.moduleCount-15+o][8]=a}for(var o=0;15>o;o++){var a=!e&&1==(r>>o&1);8>o?this.modules[8][this.moduleCount-o-1]=a:9>o?this.modules[8][15-o-1+1]=a:this.modules[8][15-o-1]=a}this.modules[this.moduleCount-8][8]=!e},e.prototype.mapData=function(e,n){for(var i=-1,r=this.moduleCount-1,o=7,a=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var h=0;2>h;h++)if(null==this.modules[r][s-h]){var c=!1;a<e.length&&(c=1==(e[a]>>>o&1));var l=t.QRUtil.getMask(n,r,s-h);l&&(c=!c),this.modules[r][s-h]=c,o--,-1==o&&(a++,o=7)}if(r+=i,0>r||this.moduleCount<=r){r-=i,i=-i;break}}},e.createData=function(n,i,r){for(var o=t.QRRSBlock.getRSBlocks(n,i),a=new t.QRBitBuffer,s=0;s<r.length;s++){var h=r[s];a.put(h.mode,4),a.put(h.getLength(),t.QRUtil.getLengthInBits(h.mode,n)),h.write(a)}for(var c=0,s=0;s<o.length;s++)c+=o[s].dataCount;if(a.getLengthInBits()>8*c)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*c+")");for(a.getLengthInBits()+4<=8*c&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*c)&&(a.put(e.PAD0,8),!(a.getLengthInBits()>=8*c));)a.put(e.PAD1,8);return e.createBytes(a,o)},e.createBytes=function(e,n){for(var i=0,r=0,o=0,a=new Array(n.length),s=new Array(n.length),h=0;h<n.length;h++){var c=n[h].dataCount,l=n[h].totalCount-c;r=Math.max(r,c),o=Math.max(o,l),a[h]=new Array(c);for(var u=0;u<a[h].length;u++)a[h][u]=255&e.buffer[u+i];i+=c;var d=t.QRUtil.getErrorCorrectPolynomial(l),p=new t.QRPolynomial(a[h],d.getLength()-1),g=p.mod(d);s[h]=new Array(d.getLength()-1);for(var u=0;u<s[h].length;u++){var f=u+g.getLength()-s[h].length;s[h][u]=f>=0?g.get(f):0}}for(var m=0,u=0;u<n.length;u++)m+=n[u].totalCount;for(var _=new Array(m),v=0,u=0;r>u;u++)for(var h=0;h<n.length;h++)u<a[h].length&&(_[v++]=a[h][u]);for(var u=0;o>u;u++)for(var h=0;h<n.length;h++)u<s[h].length&&(_[v++]=s[h][u]);return _},e}();e.PAD0=236,e.PAD1=17,t.QRCodeModel=e,__reflect(e.prototype,"qr.QRCodeModel")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t}();e.L=1,e.M=0,e.Q=3,e.H=2,t.QRErrorCorrectLevel=e,__reflect(e.prototype,"qr.QRErrorCorrectLevel")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t}();e.PATTERN000=0,e.PATTERN001=1,e.PATTERN010=2,e.PATTERN011=3,e.PATTERN100=4,e.PATTERN101=5,e.PATTERN110=6,e.PATTERN111=7,t.QRMaskPattern=e,__reflect(e.prototype,"qr.QRMaskPattern")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.glog=function(e){return t.isInit||t.init(),1>e&&console.log("错误:n="+e),t.LOG_TABLE[e]},t.gexp=function(e){for(t.isInit||t.init();0>e;)e+=255;for(;e>=256;)e-=255;return t.EXP_TABLE[e]},t.init=function(){t.isInit=!0;for(var e=0;8>e;e++)t.EXP_TABLE[e]=1<<e;for(var e=8;256>e;e++)t.EXP_TABLE[e]=t.EXP_TABLE[e-4]^t.EXP_TABLE[e-5]^t.EXP_TABLE[e-6]^t.EXP_TABLE[e-8];for(var e=0;255>e;e++)t.LOG_TABLE[t.EXP_TABLE[e]]=e},t}();e.EXP_TABLE=new Array(256),e.LOG_TABLE=new Array(256),t.QRMath=e,__reflect(e.prototype,"qr.QRMath")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t}();e.MODE_NUMBER=1,e.MODE_ALPHA_NUM=2,e.MODE_8BIT_BYTE=4,e.MODE_KANJI=8,t.QRMode=e,__reflect(e.prototype,"qr.QRMode")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);
for(var n=0;n<t.length&&0==t[n];)n++;this.num=new Array(t.length-n+e);for(var i=0;i<t.length-n;i++)this.num[i]=t[i+n]}return e.prototype.get=function(t){return this.num[t]},e.prototype.getLength=function(){return this.num.length},e.prototype.multiply=function(n){for(var i=new Array(this.getLength()+n.getLength()-1),r=0;r<this.getLength();r++)for(var o=0;o<n.getLength();o++)i[r+o]^=t.QRMath.gexp(t.QRMath.glog(this.get(r))+t.QRMath.glog(n.get(o)));return new e(i,0)},e.prototype.mod=function(n){if(this.getLength()-n.getLength()<0)return this;for(var i=t.QRMath.glog(this.get(0))-t.QRMath.glog(n.get(0)),r=new Array(this.getLength()),o=0;o<this.getLength();o++)r[o]=this.get(o);for(var o=0;o<n.getLength();o++)r[o]^=t.QRMath.gexp(t.QRMath.glog(n.get(o))+i);return new e(r,0).mod(n)},e}();t.QRPolynomial=e,__reflect(e.prototype,"qr.QRPolynomial")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(t,e){this.totalCount=t,this.dataCount=e}return t}();e.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e.getRSBlocks=function(t,n){var i=e.getRsBlockTable(t,n);if(void 0==i)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+n);for(var r=i.length/3,o=[],a=0;r>a;a++)for(var s=i[3*a+0],h=i[3*a+1],c=i[3*a+2],l=0;s>l;l++)o.push(new e(h,c));return o},e.getRsBlockTable=function(n,i){switch(i){case t.QRErrorCorrectLevel.L:return e.RS_BLOCK_TABLE[4*(n-1)+0];case t.QRErrorCorrectLevel.M:return e.RS_BLOCK_TABLE[4*(n-1)+1];case t.QRErrorCorrectLevel.Q:return e.RS_BLOCK_TABLE[4*(n-1)+2];case t.QRErrorCorrectLevel.H:return e.RS_BLOCK_TABLE[4*(n-1)+3];default:return}},t.QRRSBlock=e,__reflect(e.prototype,"qr.QRRSBlock")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(){}return e.getBCHTypeInfo=function(t){for(var n=t<<10;e.getBCHDigit(n)-e.getBCHDigit(e.G15)>=0;)n^=e.G15<<e.getBCHDigit(n)-e.getBCHDigit(e.G15);return(t<<10|n)^e.G15_MASK},e.getBCHTypeNumber=function(t){for(var n=t<<12;e.getBCHDigit(n)-e.getBCHDigit(e.G18)>=0;)n^=e.G18<<e.getBCHDigit(n)-e.getBCHDigit(e.G18);return t<<12|n},e.getBCHDigit=function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},e.getPatternPosition=function(t){return e.PATTERN_POSITION_TABLE[t-1]},e.getMask=function(e,n,i){switch(e){case t.QRMaskPattern.PATTERN000:return(n+i)%2==0;case t.QRMaskPattern.PATTERN001:return n%2==0;case t.QRMaskPattern.PATTERN010:return i%3==0;case t.QRMaskPattern.PATTERN011:return(n+i)%3==0;case t.QRMaskPattern.PATTERN100:return(Math.floor(n/2)+Math.floor(i/3))%2==0;case t.QRMaskPattern.PATTERN101:return n*i%2+n*i%3==0;case t.QRMaskPattern.PATTERN110:return(n*i%2+n*i%3)%2==0;case t.QRMaskPattern.PATTERN111:return(n*i%3+(n+i)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},e.getErrorCorrectPolynomial=function(e){for(var n=new t.QRPolynomial([1],0),i=0;e>i;i++)n=n.multiply(new t.QRPolynomial([1,t.QRMath.gexp(i)],0));return n},e.getLengthInBits=function(e,n){if(n>=1&&10>n)switch(e){case t.QRMode.MODE_NUMBER:return 10;case t.QRMode.MODE_ALPHA_NUM:return 9;case t.QRMode.MODE_8BIT_BYTE:return 8;case t.QRMode.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>n)switch(e){case t.QRMode.MODE_NUMBER:return 12;case t.QRMode.MODE_ALPHA_NUM:return 11;case t.QRMode.MODE_8BIT_BYTE:return 16;case t.QRMode.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>n))throw new Error("type:"+n);switch(e){case t.QRMode.MODE_NUMBER:return 14;case t.QRMode.MODE_ALPHA_NUM:return 13;case t.QRMode.MODE_8BIT_BYTE:return 16;case t.QRMode.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},e.getLostPoint=function(t){for(var e=t.getModuleCount(),n=0,i=0;e>i;i++)for(var r=0;e>r;r++){for(var o=0,a=t.isDark(i,r),s=-1;1>=s;s++)if(!(0>i+s||i+s>=e))for(var h=-1;1>=h;h++)0>r+h||r+h>=e||(0!=s||0!=h)&&a==t.isDark(i+s,r+h)&&o++;o>5&&(n+=3+o-5)}for(var i=0;e-1>i;i++)for(var r=0;e-1>r;r++){var c=0;t.isDark(i,r)&&c++,t.isDark(i+1,r)&&c++,t.isDark(i,r+1)&&c++,t.isDark(i+1,r+1)&&c++,(0==c||4==c)&&(n+=3)}for(var i=0;e>i;i++)for(var r=0;e-6>r;r++)t.isDark(i,r)&&!t.isDark(i,r+1)&&t.isDark(i,r+2)&&t.isDark(i,r+3)&&t.isDark(i,r+4)&&!t.isDark(i,r+5)&&t.isDark(i,r+6)&&(n+=40);for(var r=0;e>r;r++)for(var i=0;e-6>i;i++)t.isDark(i,r)&&!t.isDark(i+1,r)&&t.isDark(i+2,r)&&t.isDark(i+3,r)&&t.isDark(i+4,r)&&!t.isDark(i+5,r)&&t.isDark(i+6,r)&&(n+=40);for(var l=0,r=0;e>r;r++)for(var i=0;e>i;i++)t.isDark(i,r)&&l++;var u=Math.abs(100*l/e/e-50)/5;return n+=10*u},e.prototype.static_isSupportCanvas=function(){return"undefined"!=typeof CanvasRenderingContext2D},e._getTypeNumber=function(n,i){for(var r=1,o=e._getUTF8Length(n),a=0,s=e.QRCodeLimitLength.length;s>=a;a++){var h=0;switch(i){case t.QRErrorCorrectLevel.L:h=e.QRCodeLimitLength[a][0];break;case t.QRErrorCorrectLevel.M:h=e.QRCodeLimitLength[a][1];break;case t.QRErrorCorrectLevel.Q:h=e.QRCodeLimitLength[a][2];break;case t.QRErrorCorrectLevel.H:h=e.QRCodeLimitLength[a][3]}if(h>=o)break;r++}if(r>e.QRCodeLimitLength.length)throw new Error("Too long data");return r},e._getUTF8Length=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)},e}();e.PATTERN_POSITION_TABLE=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],e.G15=1335,e.G18=7973,e.G15_MASK=21522,e.QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],t.QRUtil=e,__reflect(e.prototype,"qr.QRUtil")}(qr||(qr={}));var GameEnd1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var t=AssetManager.createBitmapByName("scene1_png");t.x=this.stage.stageWidth/2,t.y=this.stage.stageHeight/2,this.addChild(t),this.txt=new egret.TextField,this.txt.y=400,this.txt.text="艾德突然出现，偷袭你成功，将你杀死后，\n艾德从梦境逃离，你被抛进迷失域，无法逃离。\n点击任意地方重新开始",this.addChild(this.txt),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this)},e.prototype.onTouch=function(t){this.next("gameStart")},e}(Scene);__reflect(GameEnd1.prototype,"GameEnd1");var GameEnd2=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var t=AssetManager.createBitmapByName("scene1_png");t.x=this.stage.stageWidth/2,t.y=this.stage.stageHeight/2,this.addChild(t),this.txt=new egret.TextField,this.txt.multiline=!0,this.txt.width=400,this.txt.y=400,this.txt.text="艾德突然出现，想偷袭你，但你的重要道具圣光盾保护了你，你从梦境逃离，艾德被抛进迷失域，无法逃离。\n点击任意地方重新开始",this.addChild(this.txt),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this)},e.prototype.onTouch=function(t){this.next("gameStart")},e}(Scene);__reflect(GameEnd2.prototype,"GameEnd2");var GameInfo=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var t=AssetManager.createBitmapByName("scene1_png");t.x=this.stage.stageWidth/2,t.y=this.stage.stageHeight/2,this.addChild(t),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this)},e.prototype.onTouch=function(t){this.next("gameStart")},e}(Scene);__reflect(GameInfo.prototype,"GameInfo");var roleDefine=["roshan","aziraphale","devil","e10sprite","fey","redskull","sithjester"],sceneDefine=["scene1_png","scene2_png","scene3_png","scene4_png","scene5_png","scene6_png","scene7_png","scene8_png"],letterDefine=[1,2,3,4,5,6,7],codeSegmentDefine=[9,10,11,12,13,14,15],goodsDefine=[1,2,3,4,5,6,7],CODE_ID=8,userGameData,GameLevel=function(t){function e(){var e=t.call(this)||this;return e.gap=8,e._goods=[],e.endX=25,e.endY=50,e.roles=[],e.rolePositions=[],e.walkCount=0,e}return __extends(e,t),e.prototype.initGoods=function(){for(var t=0,e=this._sceneData.goods.length;e>t;t++){var n=this._sceneData.goods[t],i=new Goods(n.id,n.itemID);i.x=n.x,i.y=n.y,this._goods.push(i),this.roleContainer.addChild(i)}},e.prototype.init=function(){this.initGameData(),this.initSceneData(),this.initScene(),this.initGoods(),this.initRole(),this.btnSuicide=AssetManager.createBitmapByName("suicide_png"),this.btnSuicide.scaleX=this.btnSuicide.scaleY=1,this.btnSuicide.x=50,this.btnSuicide.y=50,this.addChild(this.btnSuicide),this.btnSuicide.touchEnabled=!0,this.btnSuicide.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchSuicide,this),this.initListener()},e.prototype.onTouchSuicide=function(){var t=this;talk.setTalk("自杀",function(){t.suicide()})},e.prototype.clearScene=function(){for(var t=0,e=this._goods.length;e>t;t++){var n=this._goods[t];n&&n.parent&&(n.parent.removeChild(n),n.dispose())}},e.prototype.suicide=function(){userGameData.roles&&userGameData.roles.length>=7?-1!=userGameData["package"].indexOf(88)?this.next("gameEnd2"):this.next("gameEnd1"):(this.initSceneData(),this.clearScene(),this.initScene(),this.roleContainer.removeChildren(),this.initGoods(),this.resetRole(),this.addChild(this.btnSuicide))},e.prototype.initGameData=function(){if(null==userGameData){userGameData={};var t=Game.instance.random.Int(roleDefine.length);userGameData.mainRole=roleDefine[t],userGameData["package"]=[]}},e.prototype.initSceneData=function(){this._sceneData={};var t=Game.instance.random.Int(sceneDefine.length);this._sceneData.bg=sceneDefine[t];var e=Game.instance.random.Int(letterDefine.length);this._sceneData.letterID=letterDefine[e];var n=Game.instance.random.Int(codeSegmentDefine.length);this._sceneData.codeSegmentID=codeSegmentDefine[n],userGameData.codeID!=CODE_ID&&(this._sceneData.codeID=CODE_ID);var i=Game.instance.random.Int(4,7);this._sceneData.goods=[];for(var r=0;i>r;r++){var o={},a=Game.instance.random.Int(goodsDefine.length);o.id=goodsDefine[a];var s=Game.instance.random.Next();o.x=s*(this.stage.stageWidth-100)+50,s=Game.instance.random.Next(),o.y=s*(this.stage.stageHeight-360)+50,o.itemID=-1,this._sceneData.goods.push(o)}this._sceneData.goods[0].itemID=this._sceneData.letterID,this._sceneData.goods[1].itemID=this._sceneData.codeSegmentID,null!=this._sceneData.codeID&&(this._sceneData.goods[2].itemID=this._sceneData.codeID)},e.prototype.initScene=function(){this.bg=AssetManager.createBitmapByName(this._sceneData.bg),this.bg.x=this.stage.stageWidth/2,this.bg.y=this.stage.stageHeight/2,this.addChild(this.bg),this.roleContainer=new egret.DisplayObjectContainer,this.addChild(this.roleContainer)},e.prototype.initRole=function(){if(this.mainRole=Game.instance.roleManager.getRole(userGameData.mainRole),userGameData.roles&&userGameData.roles.length>0)for(var t=0,e=userGameData.roles.length;e>t;t++){var n=userGameData.roles[t],i=Game.instance.roleManager.getRole(n.id);i.roleX=this.mainRole.roleX+(t+1)*this.gap,i.roleY=this.mainRole.roleY,this.rolePositions.push({x:this.mainRole.roleX+t*this.gap,y:this.mainRole.roleY}),this.roles.push(i)}this.resetRole()},e.prototype.resetRole=function(){if(this.endX=25,this.endY=50,this.mainRole.roleX=this.endX,this.mainRole.roleY=this.endY,this.roleContainer.addChild(this.mainRole),this.mainRole.stand(Role.FRONT),this.roles&&this.roles.length>0){this.rolePositions.length=0;for(var t=0,e=this.roles.length;e>t;t++){var n=this.roles[t];this.roleContainer.addChild(n),n.roleX=this.mainRole.roleX+(t+1)*this.gap,n.roleY=this.mainRole.roleY,this.rolePositions.push({x:this.mainRole.roleX+t*this.gap,y:this.mainRole.roleY})}}},e.prototype.onTouch=function(t){},e.prototype.tick=function(t){dragonBones.WorldClock.clock.advanceTime(-1);var e=this.mainRole.addStep(this.endX,this.endY);if(e>0){for(var n=0;n<this.roles.length;n++)this.roles[n].addStep(this.rolePositions[n].x,this.rolePositions[n].y);if(this.walkCount++,this.walkCount==this.gap){this.rolePositions[0]={x:this.mainRole.roleX,y:this.mainRole.roleY};for(var n=1;n<this.roles.length;n++)this.rolePositions[n]={x:this.roles[n-1].roleX,y:this.roles[n-1].roleY};this.walkCount=0}if(this.roleSort(),2==e){this.mainRole.stand(this.mainRole.direct);for(var n=0;n<this.roles.length;n++)this.roles[n].stand(this.roles[n].direct)}}},e.prototype.roleSort=function(){this.roleContainer.$children.sort(function(t,e){return t.y<e.y?-1:1})},e.prototype.initListener=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this)},e.prototype.onClickHandler=function(t){this.endX=Math.round(t.stageX/e.STEP),this.endY=Math.round(t.stageY/e.STEP)},e}(Scene);GameLevel.STEP=8,__reflect(GameLevel.prototype,"GameLevel");var GameStart=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var t=AssetManager.createBitmapByName("scene1_png");t.x=this.stage.stageWidth/2,t.y=this.stage.stageHeight/2,this.addChild(t),this.btnStart=AssetManager.createBitmapByName("suicide_png"),this.btnStart.x=this.stage.stageWidth/2,this.btnStart.y=this.stage.stageHeight/2,this.btnLoad=AssetManager.createBitmapByName("suicide_png"),this.btnLoad.x=this.btnStart.x,this.btnLoad.y=this.btnStart.y+100,this.btnInfo=AssetManager.createBitmapByName("suicide_png"),this.btnInfo.x=this.btnStart.x,this.btnInfo.y=this.btnStart.y+200,this.addChild(this.btnStart),this.addChild(this.btnLoad),this.addChild(this.btnInfo),this.btnStart.touchEnabled=!0,this.btnLoad.touchEnabled=!0,this.btnInfo.touchEnabled=!0,this.btnStart.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchStart,this),this.btnLoad.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchLoad,this),this.btnInfo.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchInfo,this)},e.prototype.onTouchInfo=function(t){this.next("gameInfo")},e.prototype.onTouchLoad=function(t){Game.instance.loadGame(),this.next("gameLevel")},e.prototype.onTouchStart=function(t){Game.instance.resetGame(),this.next("gameLevel")},e}(Scene);__reflect(GameStart.prototype,"GameStart");var Confirm=function(t){function e(){var e=t.call(this)||this;return e.skinName="ConfirmSkin",e.percentWidth=100,e.percentHeight=100,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btnOk.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOKClickHandler,this),this.btnCancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCancelClickHandler,this)},e.prototype.onCancelClickHandler=function(t){this.visible=!1},e.prototype.onOKClickHandler=function(t){this.visible=!1,this.call&&this.call()},e.prototype.setContent=function(t,e){this.text.text=t,this.call=e,this.bg.scaleX=this.bg.scaleY=1,this.bg.width=this.text.width+20,this.bg.height=this.text.height+20,this.bg.y=this.height/2-this.bg.height/2,this.bg.x=this.width/2-this.bg.width/2,this.text.y=this.bg.y+10,this.text.x=this.bg.x+10,this.visible=!0},e}(eui.Component);__reflect(Confirm.prototype,"Confirm");var suicideConfim;